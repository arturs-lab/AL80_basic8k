0000                             ;Edits:
0000                             ;    30-Jun-08 KJL
0000                             ;       - Created from IMSAI 8K BASIC Version 1.4 manual
0000                             ;---------------------------------------------------------
0000                             ; BASIC30.ASM   1.4     05/19/77        JRB     8K BASIC
0000                             ; BASICS2.ASM   1.401   05/11/77        DK      8K BASIC
0000                             ; BASIC19.ASM   1.401   05/11/77        DH
0000                             ; BASIC18.ASM   1.401   05/10/77        JRB
0000                             ; BASIC16.ASM   1.401   05/09/77        DH
0000                             ; BASIC11.ASM   1.401   05/04/77        DH
0000                             ; BASIC10.ASM   1.401   05/03/77        DH
0000                             ; BASIC8.ASM    1.401   05/02/77        DH
0000                             ; 
0000                             ; IMSAI 8K-9K BASIC
0000                             ; 
0000                             ; COPYRIGHT (C) 1977
0000                             ; IMSAI MANUFACTURING CORPORATION
0000                             ; 14860 WICKS BLVD, SAN LEANDRO CALIFORNIA  94577
0000                             ; 
0000                             ; CORRECTION HISTORY:
0000                             ; 
0000                             ;   02/25/77 - FIXED BEGPR POINTERS
0000                             ;            - FIXED LOG(X) FOR 0.5 < X < 1.0
0000                             ;            - FIXED SQR(X) FOR 0.0 < X < 0.5
0000                             ;            - FIXED SCI NOTATION INPUT ROUTINE
0000                             ;            - FIXED EDIT ROUTINE WHEN PROGRAM ENDS ON
0000                             ;              00 BOUNDARY (SYSTEM USED TO GO AWAY)
0000                             ;            - ADDED XEQ COMMAND (LIKE RUN BUT KEEPS DATA)
0000                             ;            - SOFTWARE MEMORY PROTECT OF 1ST 9K IMPLIMENTED
0000                             ;            - FIXED TAB FOR BACKWARDS MOVEMENT
0000                             ;            - FIXED OV ERROR FOR SMALL X IN TRIG,LOG & EXP
0000                             ;            - ADDED PROGRAM CHAINING CAPABILITY.
0000                             ;            - FIXED EXP(X) ROUTINE FOR LARGE X.
0000                             ;            - ADDED PEEK(X) COMMAND
0000                             ;            - ADDED POKE A,X COMMAND
0000                             ;            - ADDED CALL A COMMAND
0000                             ;  04/02/77  - ADDED TARBEL CASSETTE SAVE AND LOAD
0000                             ;            - ADDED FIX LINE EDITOR
0000                             ;            - RENAMED NATURAL LOG TO LN(X)
0000                             ;            - ADDED BASE 10 LOG AS LOG(X)
0000                             ;            - ALLOWED FOR DAZZLER IN OUTPUT ROUTINE
0000                             ;            - ADDED LINE # SEARCH UTILITY (LOCAT EQU $)
0000                             ;            - ADDED TABLE SEARCH UTILITY (SEEK EQU $)
0000                             ;            - ARRAYS CAN NOW HAVE > 256 ELEMENTS PER DIM
0000                             ; 04/09/77   -ADDED CONDITIONAL ASSY PARAMS FOR 8 AND 9K
0000                             ;            -FIXED POWER ERROR. (X^B WHEN B=0 GAVE X^2.)
0000                             ;            -ADDED CONTROL H AS PHYSICAL RUBOUT OF CHAR
0000                             ; 04/27/77   -CHANGE RST'S TO RUN UNDER CP/M
0000                             ;            -ADDED EXPRESSION EVALUATER FIX
0000                             ;            -LOAD UNDER CP/M
0000                             ; 05/02/77   -ADD DDT, BYE COMMANDS, BIOS I/O
0000                             ; 05/03/77   -OPTIMIZE FUNCTION ITERATION LOOP (SIN5)
0000                             ;            -SO UNDERFLOW CAN BE MADE NON-FATAL
0000                             ; 05/04/77   -OPTIMIZE SIN(X) ROUTINE
0000                             ;            -ADD NON-FATAL ERRORS
0000                             ; 05/09/77   -SQUISH TO INCLUDE PEEK,POKE,CALL IN 8K
0000                             ; 05/11/77   -MAKE RND(X) USE X AS RANGE; X^0->1,0^X->0
0000                             ;            -TAB(N) GO TO NEXT LINE IF PAST POSITION
0000                             ; 5/12/77   - BUG IN NESTED FOR"S AND REENTERED FOR"S FIXED
0000                             ; 
0000                             ; ASSEMBLY PARAMETERS:
0000                             ;        LARGE   EQU     0       ;-1=9K ASSEMBLY, 0=8K
0000                             ;        CPM     EQU     0       ;-1=RUN UNDER CPM
0000                             ;        HUNTER  EQU     0       ;-1= INCLUDE BAUD COMMAND
0000                             ;include "CONFIG.asm"
0000                             ; 
0000                             ; SIO equates
0000                             ; 
0000                SIO_RX:   EQU   $18   
0000                SIO_TX:   EQU   $18   
0000                SIO_RX_STATUS:   EQU   $19   
0000                SIO_TX_STATUS:   EQU   $19   
0000                SIO_RX_FULL:   EQU   $01   
0000                SIO_TX_EMPTY:   EQU   $04   
0000                UART_TX_EMPTY:   EQU   $20   
0000                UART_RX_FULL:   EQU   $01   
0000                UART:     EQU   $08   
0000                UART0:    EQU   UART+0   
0000                UART1:    EQU   UART+1   
0000                UART2:    EQU   UART+2   
0000                UART3:    EQU   UART+3   
0000                UART4:    EQU   UART+4   
0000                UART5:    EQU   UART+5   
0000                UART6:    EQU   UART+6   
0000                UART7:    EQU   UART+7   
0000                UART_TX:   EQU   UART0   
0000                UART_RX:   EQU   UART0   
0000                OFFSET:   EQU   $0000   
0000                RUBOUT:   EQU   0x08   
0000                             ; end include
0000                             ; 
0000                             ; BASIC EQUATES
0000                             ; 
0000                FATAL:    EQU   0F7H   ;CODE FOR FATAL IS RST 6
0000                             ; 
0000                BASIC:    .ORG   0+OFFSET   
0000   21 00 24               LXI   H,RAM+1024   
0003   3E AE                  MVI   A,0AEH   ;START OF INIT SEQUENCE
0005   C3 81 00               JMP   INIT1   ;FINISH INIT
0008                             ; 
0008                             ; 
0008                             ;       ORG     8
0008                             ; 
0008                             ; SKIP CHARS POINTED BY H,L UNTIL NON-BLANK,
0008                             ; LEAVE IN REG A
0008                             ; 
0008   7E           RST1:     MOV   A,M   ;LOAD THE BYTE AT (H,L)
0009   FE 20                  CPI   " "   ;TEST IF BLANK
000B   C0                     RNZ      ;RETURN IF NOT
000C   23                     INX   H   ;POINT NEXT
000D   C3 08 00               JMP   RST1   ;LOOP
0010                             ; 
0010                             ; 
0010                             ;       ORG     16
0010                             ; 
0010                             ; COMPARE STRING AT (H,L) TO STRING AT (D,E)
0010                             ; RETURN IF EQUAL (THRU X"00" IN D,E) OR ON FIRST NOT EQUAL
0010                             ; ONLY THE FIRST THREE CHARS NEED BE EQUAL
0010                             ; IGNORE ALL SPACES
0010                             ; 
0010   C5           RST2:     PUSH   B   ;SAVE B,C
0011   06 00                  MVI   B,0   ;INIT COUNT
0013   CF           COMP1:    RST   1   ;SKIP SPACES
0014   1A                     LDAX   D   ;GET CHAR TO MATCH WITH
0015   C3 7A 1A               JMP   COMP2   ;CONTINUE ELSEWHERE
0018                             ; 
0018                             ; 
0018                             ;       ORG     24
0018                             ; 
0018                             ; STORE THE FLOATING POINT ACCUMULATOR AT (H,L)
0018                             ; 
0018   11 58 22     RST3:     LXI   D,FACC   ;POINT FLOAT ACC
001B   06 04                  MVI   B,4   ;BYTE COUNT
001D   C3 4E 1C               JMP   COPYD   ;GO MOVE IT
0020                             ; 
0020                             ; 
0020                             ;       ORG     32
0020                             ; 
0020                             ; INCREMENT H,L BY BYTE AT (SP), RETURN TO (SP)+1
0020                             ; 
0020   E3           RST4:     XTHL      ;GET RETURN ADDRESS IN H,L
0021   7E                     MOV   A,M   ;GET THE INCREMENT
0022   23                     INX   H   ;POINT TRUE RETURN
0023   E3                     XTHL      ;PUT BACK TO STACK
0024   D5                     PUSH   D   ;SAVE D,E
0025   C3 3B 00               JMP   RST4A   ;CONTINUE
0028                             ; 
0028                             ; 
0028                             ;       ORG     40
0028                             ; 
0028                             ; LOAD THE FLOATING POINT ACCUM WITH THE 4 BYTES AT (H,L)
0028                             ; 
0028   11 58 22     RST5:     LXI   D,FACC   ;POINT FLOAT ACC
002B   06 04                  MVI   B,4   ;BYTE COUNT
002D   C3 59 1C               JMP   COPYH   ;GO MOVE IT
0030                             ; 
0030                             ; 
0030                             ;       ORG     48
0030                             ; 
0030                             ; PRINT:  "XX ERR & NNN"
0030                             ; **** IF ERROR MESSAGE CHANGES TO A DIFFERENT RST,
0030                             ; **** ...CHANGE "FATAL" EQUATE
0030                             ; 
0030   E3           RST6:     XTHL      ;SAVE HL, GET ERROR CODE PTR
0031   F5                     PUSH   PSW   ;SAVE REGS
0032   D5                     PUSH   D   
0033   C5                     PUSH   B   
0034   C3 32 1C               JMP   ERROR   ;CONTINUE
0037                             ; 
0037   00 00 00 00            DB   0,0,0,0   
003B                          .ORG   59+OFFSET   ;LEAVE 3 BYTES FOR DDT
003B                             ; 
003B   5F           RST4A:    MOV   E,A   ;PUT IN LOW
003C   B7                     ORA   A   ;TEST SIGN
003D   16 00                  MVI   D,0   ;DEFAULT POSITIVE
003F   F2 44 00               JP   RST4B   ;BRIF +
0042   16 FF                  MVI   D,0FFH   ;ELSE, NEG
0044   19           RST4B:    DAD   D   ;BUMP H,L
0045   D1                     POP   D   ;RESTORE D,E
0046   C9                     RET      ;RETURN
0047                             ;PAGE
0047   43 4F 50 59 52 49 47 48 54 20 28 43 29 20 31 39 37 37 20 DB   "COPYRIGHT (C) 1977 "   
005A   49 4D 53 41 49 20 4D 46 47 20 43 4F 52 50 20 DB   "IMSAI MFG CORP "   
0069   53 41 4E 20 4C 45 41 4E 44 52 4F 20 43 41 20 39 34 35 37 37 20 55 53 41 DB   "SAN LEANDRO CA 94577 USA"   
0081                             ; 
0081                             ; INITIALIZATION ROUTINE
0081                             ; DETERMINE MEMORY SIZE.
0081                             ;    (START AT 9K AND TRY 1K INCREMENTS TILL END)
0081                             ; SETUP POINTERS FOR STACK, DATA, AND PROGRAM
0081                             ; INIT SIO BOARD
0081                             ; 
0081   01 00 04     INIT1:    LXI   B,1024   ;1K INCR
0084   7C           INIT2:    MOV   A,H   ; check if we've reached A0
0085   FE A0                  CPI   0xA0   
0087   F2 97 00               JP   INIT3   ; if yes, then exit loop with HL=a000
008A   7E                     MOV   A,M   ;GET A BYTE FROM MEMORY
008B   2F                     CMA      ;COMPLEMENT
008C   77                     MOV   M,A   ;REPLACE
008D   BE                     CMP   M   ;TEST IF RAM/ROM/END
008E   C2 97 00               JNZ   INIT3   ;BRIF OUT OF RAM
0091   2F                     CMA      ;RE-COMPLEMENT
0092   77                     MOV   M,A   ;PUT ORIG BACK
0093   09                     DAD   B   ;POINT NEXT BLOCK
0094   D2 84 00               JNC   INIT2   ;LOOP
0097                             ; 
0097   F9           INIT3:    SPHL      ;SET STACK POINTER TO END OF MEMORY
0098   01 00 FF               LXI   B,-256   ;ALLOW 256 BYTES FOR STACK
009B   09                     DAD   B   ;ADD TO ADDRESS
009C   22 91 22               SHLD   DATAB   ;SAVE ADDR OF START OF DATA
009F   3E 80        UART_INIT:   MVI   A,80h   ;Mask to Set DLAB Flag
00A1   D3 0B                  OUT   UART3   
00A3   3E 0C                  MVI   A,12   ;Divisor = 12 @ 9600bps w/ 1.8432 Mhz
00A5                             ;			MVI    A,1			;Divisor = 1 @ 115200bps w/ 1.8432 Mhz
00A5   D3 08                  OUT   UART0   ;Set BAUD rate to 9600
00A7   3E 00                  MVI   A,00   
00A9   D3 09                  OUT   UART1   ;Set BAUD rate to 9600
00AB   3E 03                  MVI   A,03h   
00AD   D3 0B                  OUT   UART3   ;Set 8-bit data, 1 stop bit, reset DLAB Flag
00AF   3E 00                  MVI   A,00h   
00B1   D3 09                  OUT   UART1   ;no interrupts
00B3   AF                     XRA   A   ;GET A ZERO IN A
00B4   F5                     PUSH   PSW   ;SET STACK 1 LEVEL DEEP WITHOUT A GOSUB
00B5   21 00 00               LXI   H,0   ;CLEAR H,L
00B8   39                     DAD   SP   ;SP TO H,L
00B9   22 8B 22               SHLD   STACK   ;SAVE BEG OF STACK
00BC   CD 5D 01               CALL   IRAM   ;INIT RAM
00BF   11 6C 1D               LXI   D,NRNDX   ;POINT TO RANDOM # SERIES
00C2   06 08                  MVI   B,8   ;LOAD COUNT
00C4   CD 4E 1C               CALL   COPYD   ;COPY TO TRND<X> IN RAM TABLE
00C7   36 02                  MVI   M,2   ;SET RANDOM SWITCH
00C9   21 79 1D               LXI   H,VERS   ;POINT VERSION MESSAGE
00CC   CD BE 19     RDYM:     CALL   TERMM   ;WRITE IT
00CF                             ; 
00CF                RDY:      EQU   $   
00CF                             ; 
00CF                             ; PRINT "READY"
00CF                             ; 
00CF   21 29 1E               LXI   H,READY   ;POINT READY MSG
00D2   CD BE 19               CALL   TERMM   ;GO PRINT IT
00D5                             ; 
00D5                GETCM:    EQU   $   
00D5                             ; 
00D5                             ; 
00D5                             ; COMMAND INPUT ROUTINE
00D5                             ; 
00D5                             ; READ A LINE FROM THE TTY
00D5                             ; IF STARTS WITH NUMERIC CH, ASSUME IT'S A BASIC STATEMENT
00D5                             ; IF NOT, IT IS EITHER AN IMMEDIATE STATMENT, OR A COMMAND
00D5                             ; 
00D5   3E 3A                  MVI   A,":"   ;PROMPT & ON SET FOR SW
00D7   32 76 20               STA   EDSW   ;SET MODE=EDIT
00DA   2A 8B 22               LHLD   STACK   ;GET STACK ADDRESS
00DD   F9                     SPHL      ;SET REG SP
00DE   CD 10 19               CALL   TERMI   ;GET A LINE
00E1   CD B6 1A               CALL   PACK   ;GO PACK THE NUMBER INTO B,C
00E4   78                     MOV   A,B   ;GET HI BYTE OF LINE NUMBER
00E5   B1                     ORA   C   ;PLUS LOW BYTE
00E6   CA 70 01               JZ   EXEC   ;BRIF EXEC STATEMENT
00E9   C5                     PUSH   B   ;SAVE LINE NUMBER
00EA   11 7D 20               LXI   D,IMMED+1   ;POINT SAVE AREA
00ED   EB                     XCHG      ;FLIP/FLOP
00EE   70                     MOV   M,B   ;PUT LO LINE
00EF   23                     INX   H   ;POINT NEXT
00F0   71                     MOV   M,C   ;PUT LO LINE
00F1   23                     INX   H   ;POINT NEXT
00F2   06 03                  MVI   B,3   ;INIT COUNT
00F4   1A           EDIT1:    LDAX   D   ;GET A BYTE
00F5   77                     MOV   M,A   ;PUT IT DOWN
00F6   04                     INR   B   ;COUNT IT
00F7   23                     INX   H   ;POINT NEXT
00F8   13                     INX   D   ;DITTO
00F9   B7                     ORA   A   ;TEST BYTE JUST MOVED
00FA   C2 F4 00               JNZ   EDIT1   ;LOOP
00FD   78                     MOV   A,B   ;GET COUNT
00FE   32 7C 20               STA   IMMED   ;STORE THE COUNT
0101   C1                     POP   B   ;GET LINE NUM
0102   CD 61 1F               CALL   LOCAT   ;GO FIND REQUESTED LINE NUMBER
0105   E5                     PUSH   H   ;SAVE H,L
0106   DA 20 01               JC   EDIT5   ;BRIF IF LINE NOT FOUND
0109   54           EDIT2:    MOV   D,H   ;COPY ADDR
010A   5D                     MOV   E,L   ;TO D,E
010B   06 00                  MVI   B,0   ;GET A ZERO
010D   4E                     MOV   C,M   ;GET LEN
010E   09                     DAD   B   ;POINT NEXT STMT
010F   7E           EDIT3:    MOV   A,M   ;GET LEN NEXT STMT
0110   B7                     ORA   A   ;TEST IT
0111   CA 1B 01               JZ   EDIT8   ;BRIF END
0114   47                     MOV   B,A   ;SET LENGTH
0115   CD 59 1C               CALL   COPYH   ;ELSE MOVE LINE
0118   C3 0F 01               JMP   EDIT3   ;LOOP
011B   EB           EDIT8:    XCHG      ;PUT NEW ADDR TO H,L
011C   77                     MOV   M,A   ;MARK END
011D   22 93 22               SHLD   PROGE   ;AND UPDATE ADDRESS
0120   3A 7C 20     EDIT5:    LDA   IMMED   ;GET LEN OF INSERT
0123   FE 04                  CPI   4   ;TEST IF DELETE
0125   CA D5 00               JZ   GETCM   ;BRIF IS
0128   4F                     MOV   C,A   ;SET LO LEN
0129   06 00                  MVI   B,0   ;ZERO HI LEN
012B   2A 93 22               LHLD   PROGE   ;GET END OF PROG
012E   54                     MOV   D,H   ;COPY TO
012F   5D                     MOV   E,L   ;D,E
0130   09                     DAD   B   ;DISP LEN OF INSERT
0131   22 93 22               SHLD   PROGE   ;UPDATE END POINT
0134   C1                     POP   B   ;GET ADDR
0135   1A           EDIT6:    LDAX   D   ;GET A BYTE
0136   77                     MOV   M,A   ;COPY IT
0137   1B                     DCX   D   ;POINT PRIOR
0138   2B                     DCX   H   ;DITTO
0139   7A                     MOV   A,D   ;GET HI ADDR
013A   B8                     CMP   B   ;COMPARE
013B   CA 41 01               JZ   EDIT7   ;BRIF HI EQUAL
013E   D2 35 01               JNC   EDIT6   ;BRIF NOT LESS
0141   7B           EDIT7:    MOV   A,E   ;GET LO ADDR
0142   B9                     CMP   C   ;COMPARE
0143   D2 49 01               JNC   ED7A   ;MUST TEST FOR 00 BOUNDARY
0146   C3 52 01               JMP   ED7B   ;GO AROUND BOUNDARY TEST CODE
0149   2F           ED7A:     CMA      ;COMPLIMENT LOW LINE NUMBER
014A   B9                     CMP   C   ;AND COMPARE TO START
014B   C2 35 01               JNZ   EDIT6   ;BRIF NOT =
014E   B7                     ORA   A   ;NOT TEST FOR 00
014F   C2 35 01               JNZ   EDIT6   ;THIS IS USUAL CASE
0152   13           ED7B:     INX   D   ;POINT FORWARD
0153   21 7C 20               LXI   H,IMMED   ;POINT INSERT
0156   46                     MOV   B,M   ;GET LENGTH
0157   CD 59 1C               CALL   COPYH   ;GO MOVE IT
015A   C3 D5 00               JMP   GETCM   ;GO GET ANOTHER COMMAND
015D                             ; 
015D                             ; IRAM          INITIALIZE RAM
015D                             ;       ZEROES RAM FROM BZERO TO EZERO
015D                             ;       INITS RANDOM # CONSTANTS
015D                             ;       RETURNS H=PTR TO TRND
015D                             ; 
015D   21 00 20     IRAM:     LXI   H,BZERO   ;CLEAR BZERO->EZERO
0160   06 77                  MVI   B,EZERO-BZERO   
0162   CD 5F 1C               CALL   ZEROM   
0165   11 6C 1D               LXI   D,NRNDX   ;MOVE RANDOM # SERIES TO RNDX
0168   21 77 22               LXI   H,RNDX   
016B   06 08                  MVI   B,8   ;COUNT
016D   C3 4E 1C               JMP   COPYD   ;MOVE IT & RETURN
0170                             ;PAGE
0170                EXEC:     EQU   $   
0170                             ; 
0170                             ; 
0170                             ; DECODE COMMAND IN IOBUFF
0170                             ; EXECUTE IF POSSIBLE
0170                             ; THEN GOTO GET NEXT COMMAND
0170                             ; 
0170                             ; 
0170   32 74 22               STA   MULTI   ;RESET MULTI SW
0173   32 88 22               STA   FNMOD   ;RESET FN TYPE
0176   3C                     INR   A   ;GET A ONE
0177   32 75 20               STA   RUNSW   ;SET IMMEDIATE MODE
017A   21 CF 20               LXI   H,IOBUF+1   ;POINT SMT
017D   11 7C 20               LXI   D,IMMED   ;POINT NEW AREA
0180   7E           EXEC1:    MOV   A,M   ;GET A BYTE
0181   12                     STAX   D   ;PUT TO (D,L)
0182   13                     INX   D   ;POINT NEXT
0183   23                     INX   H   ;DITTO
0184   B7                     ORA   A   ;TEST BYTE
0185   C2 80 01               JNZ   EXEC1   ;CONTINUE
0188   21 EF 1D               LXI   H,NULLI   ;POINT NO LINE NUM
018B   22 89 22               SHLD   LINE   ;SAVE ADDR
018E   21 7C 20               LXI   H,IMMED   ;POINT START OF CMMD
0191   C3 43 02               JMP   RUN3   ;GO INTO RUN PROCESSOR
0194                             ; 
0194                NEW:      EQU   $   
0194                             ; 
0194                             ; NEW COMMAND
0194                             ; "NEW"==>CLEAR PROGRAM AND DATA
0194                             ; "NEW*"==>CLEAR PROGRAM ONLY
0194                             ; 
0194   E5                     PUSH   H   ;SAE PTR
0195   21 D5 00               LXI   H,GETCM   ;MAKE SUBROUTINE
0198   E3                     XTHL      ;RESTORE H
0199   CF                     RST   1   ;GET 1ST NON-BLANK CHAR AFTER "NEW"
019A   DE 2A                  SBI   "*"   ;TEST
019C   CA A4 01               JZ   NEW1   ;BRIF PROGRAM CLEAR ONLY
019F   AF           NEW0:     XRA   A   ;GET A ZERO
01A0   2A 91 22               LHLD   DATAB   ;POINT DATA AREA
01A3   77                     MOV   M,A   ;CLEAR IT
01A4   21 96 22     NEW1:     LXI   H,BEGPR   ;POINT START
01A7   22 93 22               SHLD   PROGE   ;RESET PROGRAM END
01AA   77                     MOV   M,A   ;CLEAR IT
01AB   C9                     RET      
01AC                             ; 
01AC                FREE:     EQU   $   
01AC                             ; 
01AC                             ; FREE COMMAND
01AC                             ; COMPUTE AMOUNT OF AVAILABLE STORAGE (EXCLUDING DATA AREA)
01AC                             ; 
01AC   2A 91 22               LHLD   DATAB   ;GET DATA BEG ADDRESS
01AF   EB                     XCHG      ;PUT IN D,E
01B0   2A 93 22               LHLD   PROGE   ;GET PROGRAM END ADDRESS
01B3   7B                     MOV   A,E   ;LO ADDR TO REG A
01B4   95                     SUB   L   ;SUBTRACT
01B5   5F                     MOV   E,A   ;SAVE IT
01B6   7A                     MOV   A,D   ;HI ADDR TO REG A
01B7   9C                     SBB   H   ;SUBTRACT
01B8   57                     MOV   D,A   ;SAVE IT
01B9   CD 8A 1C               CALL   BINFL   ;GO FLOAT D,E
01BC   21 CE 20               LXI   H,IOBUF   ;POINT BUFFER
01BF   CD FC 14               CALL   FOUT   ;GO CONVERT TO OUTPUT
01C2   36 00                  MVI   M,0   ;MARK END
01C4   CD B6 19               CALL   TERMO   ;GO WRITE IT
01C7   C3 D5 00               JMP   GETCM   ;CONTINUE
01CA                             ; 
01CA                TAPE:     EQU   $   
01CA                             ; 
01CA                             ; TAPE COMMAND. DON'T ECHO INPUT. CONTINUE UNTIL KEY
01CA                             ; COMMAND.
01CA                             ; 
01CA   3E 01                  MVI   A,1   ;SET TAPE INPUT SWITCH
01CC   32 71 20               STA   TAPES   ;STORE IT
01CF   3E 11                  MVI   A,11H   ;GET DC1 (=READER ON)
01D1   CD 5B 19               CALL   TESTO   ;WRITE IT
01D4   C3 D5 00               JMP   GETCM   ;GO PROCESS INPUT
01D7                             ; 
01D7                ENDIT:    EQU   $   
01D7                             ; 
01D7                             ; END COMMAND. IF TAPE PUNCH SWITCH IS ON, PUNCH "KEY" THEN
01D7                             ; CONTINUE
01D7                             ; 
01D7   3A 71 20               LDA   TAPES   ;GET PAPER TAPE SWITCH
01DA   FE 02                  CPI   2   ;TEST FOR SAVE
01DC   C2 CF 00               JNZ   RDY   ;BRIF NOT
01DF   21 7C 1E               LXI   H,KEYL   ;POINT "KEY"
01E2   CD BE 19               CALL   TERMM   ;WRITE IT
01E5   CD F2 01               CALL   HDRTL   ;GO PUT TRAILER
01E8                             ; 
01E8                             ; KEY COMMAND. RESET TAPE SWITCH. TURN READER OFF
01E8                             ; 
01E8   AF           KEY:      XRA   A   ;RESET TAPE SWITCH
01E9   32 71 20               STA   TAPES   
01EC   21 63 1D               LXI   H,PCHOF   ;POINT READER/PUNCH OFF
01EF   C3 CC 00               JMP   RDYM   ;PRINT POFF+READY MESSAGE
01F2                             ; 
01F2                HDRTL:    EQU   $   
01F2                             ; 
01F2                             ; PUNCH HEADER OR TRAILER ON PAPER TAPE.
01F2                             ; 
01F2   06 19                  MVI   B,25   ;LOAD COUNT
01F4   3E 08        HDR1:     MVI   A,RUBOUT   ;LOAD RUBOUT 0xff
01F6   CD 5B 19               CALL   TESTO   ;WRITE IT
01F9   05                     DCR   B   ;DECREMENT COUNT
01FA   AF                     XRA   A   ;ZERO A
01FB   B8                     CMP   B   ;TEST COUNT
01FC   C8                     RZ      ;RETURN ON ZERO
01FD   C3 F4 01               JMP   HDR1   ;CONTINUE
0200                             ;PAGE
0200                             ; 
0200                             ; RUN PROCESSOR, GET NEXT STATMENT, AND EXECUTE IT
0200                             ; IF IN IMMEDIATE MODE, THEN RETURN TO GETCMMD
0200                             ; 
0200   AF           RUNCM:    XRA   A   ;PUT A ZERO TO A
0201   2A 91 22               LHLD   DATAB   ;GET ADDRESS OF DATA POOL
0204   77                     MOV   M,A   ;INITIALIZE TO 0
0205                XEQ:      EQU   $   ;START FOR EXECUTION WITH OLD DATA
0205   CD 5D 01               CALL   IRAM   ;INITALIZE START OF RAM
0208   21 95 22               LXI   H,BEGPR-1   ;POINT 1 PRIOR TO BEGIN
020B   22 8F 22               SHLD   DATAP   ;RESTORE DATA STMT POINTER
020E   36 00                  MVI   M,0   ;RESET DATA STMT POINTER
0210   23                     INX   H   ;POINT TO START
0211   22 70 22               SHLD   STMT   ;SAVE IT
0214   C3 31 02               JMP   RUN2   ;GO PROCESS IT
0217                             ; 
0217                             ; STATEMENTS RETURN HERE TO CONTINUE PROCESSING
0217   21 74 22     RUN:      LXI   H,MULTI   ;POINT MULTIPLE SWITCH
021A   7E                     MOV   A,M   ;GET SW
021B   B7                     ORA   A   ;TEST IT
021C   CA 27 02               JZ   RUN1   ;BRIF NOT ON
021F   36 00                  MVI   M,0   ;ELSE, RESET IT
0221   2A 72 22               LHLD   ENDLI   ;GET ADDRESS
0224   C3 43 02               JMP   RUN3   ;GO PROCESS REMAIN
0227   2A 70 22     RUN1:     LHLD   STMT   ;ELSE, GET ADDR OF PREV STMT
022A   5E                     MOV   E,M   ;GET LEN CODE
022B   16 00                  MVI   D,0   ;CLEAR HIGH BYTE OF ADDR
022D   19                     DAD   D   ;INCR STMT POINTER
022E   22 70 22               SHLD   STMT   ;SAVE IT
0231   3A 75 20     RUN2:     LDA   RUNSW   ;GET RUN TYPE
0234   B7                     ORA   A   ;TEST IT
0235   C2 D5 00               JNZ   GETCM   ;BRIF IMMEDIATE MODE
0238   7E                     MOV   A,M   ;GET LEN CODE
0239   B7                     ORA   A   ;TEST IF END
023A   CA D7 01               JZ   ENDIT   ;BRIF IS
023D   23                     INX   H   ;POINT LINE NUMBER
023E   22 89 22               SHLD   LINE   ;SAVE ADDR
0241   23                     INX   H   ;POINT 2ND BYTE
0242   23                     INX   H   ;POINT 1ST PGM BYTE
0243                             ; 
0243                             ; ENTER HERE TO DO IMMEDIATE COMMAND
0243   CF           RUN3:     RST   1   ;SKIP BLANKS
0244   22 52 22     RUN4:     SHLD   ADDR1   ;SAVE ADDR
0247   CD 3B 1A               CALL   TSTCC   ;GO SEE IF CONTROL-C OR O
024A   11 4F 1E               LXI   D,JMPTB   ;POINT TO TABLE
024D   CD 89 1F               CALL   SEEK1   ;GO SEARCH COMMAND TABLE
0250   CA 5B 02               JZ   RUN7   ;BRIF COMMAND NOT FOUND
0253   E5                     PUSH   H   ;SAVE H,L
0254   1A                     LDAX   D   ;LOAD LOW BYTE
0255   6F                     MOV   L,A   ;LOW BYTE TO L
0256   13                     INX   D   ;POINT NEXT
0257   1A                     LDAX   D   ;LOAD HIGH BYTE
0258   67                     MOV   H,A   ;HIGH BYTE TO H
0259   E3                     XTHL      ;COMMAND ADDRESS TO STACK
025A   C9                     RET      ;JUMP TO ROUTINE
025B   2A 52 22     RUN7:     LHLD   ADDR1   ;RESTORE H,L POINTER
025E   C3 FD 05               JMP   LET   ;ASSUME IT'S LET STMT
0261                             ;PAGE
0261                             ; 
0261                             ; SAVE COMMAND. TURN THE PUNCH ON THEN LIST PROGRAM
0261                             ; 
0261   3E 02        SAVE:     MVI   A,2   ;SET PUNCH MODE
0263   32 71 20               STA   TAPES   
0266   3E 12                  MVI   A,12H   ;GET DC2 (=PUNCH ON)
0268   CD 5B 19               CALL   TESTO   ;WRITE IT
026B   CD F2 01               CALL   HDRTL   ;GP PUT HEADER
026E                             ; 
026E                LIST:     EQU   $   
026E                             ; 
026E                             ; 
026E                             ; LIST PROCESSOR
026E                             ; DUMP THE SOURCE PROGRAM TO TTY OR PAPER TAPE
026E                             ; 
026E                             ; 
026E   CF                     RST   1   ;SKIP TO NON BLANK
026F   11 00 00               LXI   D,0   ;GET A ZERO IN D
0272   EB                     XCHG      ;FLIP TO H,L
0273   22 4B 22               SHLD   LINEL   ;SAVE IT
0276   21 99 99               LXI   H,9999H   ;GET HIGH NUMBER IN H,L
0279   22 4D 22               SHLD   LINEH   ;SAVE IT
027C   EB                     XCHG      ;FLIP BACK
027D   B7                     ORA   A   ;TEST IF EOL
027E   CA 9E 02               JZ   LIST1   ;BRIF IT IS
0281   CD B6 1A               CALL   PACK   ;GO PACK THE NUMBER, IF ANY
0284   50                     MOV   D,B   ;COPY NUMBER TO D,L
0285   59                     MOV   E,C   ;SAME
0286   EB                     XCHG      ;FLIP TO H,L
0287   22 4B 22               SHLD   LINEL   ;SAVE IT
028A   22 4D 22               SHLD   LINEH   ;SAME
028D   EB                     XCHG      ;RESTORE H,L
028E   CF                     RST   1   ;SKIP TO NON BLANK
028F   FE 2C                  CPI   ","   ;TEST IF COMMA
0291   C2 9E 02               JNZ   LIST1   ;BRIF NOT
0294   23                     INX   H   ;POINT NEXT
0295   CF                     RST   1   ;SKIP TO NON-BLANK
0296   CD B6 1A               CALL   PACK   ;ELSE, GO GET THE NUMBER
0299   60                     MOV   H,B   ;COPY TO
029A   69                     MOV   L,C   ;D,L
029B   22 4D 22               SHLD   LINEH   ;SAVE IT
029E   21 96 22     LIST1:    LXI   H,BEGPR   ;POINT BEGINNING OF PROGRAM
02A1   CD 3B 1A     LIST2:    CALL   TSTCC   ;GO SEE IF CONTROL-C OR CONTROL-O
02A4   7E                     MOV   A,M   ;GET LEN CODE
02A5   B7                     ORA   A   ;TEST IF END OF PROGRAM
02A6   CA D7 01               JZ   ENDIT   ;BRIF END OF PGM
02A9   D6 03                  SUI   3   ;SUBTRACT THREE
02AB   47                     MOV   B,A   ;SAVE LEN
02AC   23                     INX   H   ;POINT HIGH BYTE OF LINE#
02AD   EB                     XCHG      ;FLIP H,L TO D,E
02AE   2A 4B 22               LHLD   LINEL   ;GET LOW LINE TO TEST
02B1   EB                     XCHG      ;RESTORE H,L
02B2   7E                     MOV   A,M   ;GET LOW BYTE OF LINE NUMBER
02B3   BA                     CMP   D   ;COMP WITH LINEL
02B4   DA F1 02               JC   LIST8   ;BRIF LESS
02B7   C2 C1 02               JNZ   LIST4   ;BRIF NOT EQUAL
02BA   23                     INX   H   ;POINT NEXT
02BB   7E                     MOV   A,M   ;GET NEXT BYTE OF LINE#
02BC   2B                     DCX   H   ;POINT BACK
02BD   BB                     CMP   E   ;COMP LOW BYTES
02BE   DA F1 02               JC   LIST8   ;BRIF LESS
02C1   EB           LIST4:    XCHG      ;SAVE H,L IN D,E
02C2   2A 4D 22               LHLD   LINEH   ;GET HIGH LINE FOR TEST
02C5   EB                     XCHG      ;RESTORE H,L
02C6   7E                     MOV   A,M   ;GET LINE BYTE
02C7   BA                     CMP   D   ;COMPARE HIGH BYTES
02C8   CA D1 02               JZ   LIST5   ;BRIF EQUAL
02CB   D2 D7 01               JNC   ENDIT   ;BRIF HIGHER
02CE   C3 DB 02               JMP   LIST6   ;GO AROUND
02D1   23           LIST5:    INX   H   ;POINT NEXT
02D2   7E                     MOV   A,M   ;GET NEXT BYTE
02D3   2B                     DCX   H   ;POINT BACK
02D4   BB                     CMP   E   ;COMPARE LOW BYTES
02D5   CA DB 02               JZ   LIST6   ;BRIF EQUAL
02D8   D2 D7 01               JNC   ENDIT   ;BRIF HIGHER
02DB   11 CE 20     LIST6:    LXI   D,IOBUF   ;POINT BUFFER AREA
02DE   CD 0A 1A               CALL   LINEO   ;CONVERT LINE NUMBER
02E1   7E           LIST7:    MOV   A,M   ;GET A BYTE
02E2   12                     STAX   D   ;PUT IT TO BUFFER
02E3   13                     INX   D   ;POINT NEXT BUFF
02E4   23                     INX   H   ;POINT NEXT PROG
02E5   05                     DCR   B   ;DECR CTR
02E6   C2 E1 02               JNZ   LIST7   ;LOOP
02E9   E5                     PUSH   H   ;SAVE HL ADDR
02EA   CD B6 19               CALL   TERMO   ;GO TYPE IT
02ED   E1                     POP   H   ;RETRIEVE H ADDR
02EE   C3 A1 02               JMP   LIST2   ;CONTINUE
02F1   58           LIST8:    MOV   E,B   ;PUT LEN  IN E
02F2   16 00                  MVI   D,0   ;CLEAR D
02F4   19                     DAD   D   ;POINT NEXT STMT
02F5   23                     INX   H   ;POINT NEXT
02F6   23                     INX   H   ;POINT LEN CODE
02F7   C3 A1 02               JMP   LIST2   ;GO LIST IT
02FA                             ; 
02FA                             ; 
02FA                CONTI:    EQU   $   
02FA                             ; 
02FA                             ; CONTINUE EXECUTION AT STATEMENT FOLLOWING STOP OR AT
02FA                             ; STATEMENT THAT WAS INTERRUPTED WHEN CONTROL-C WAS TYPED
02FA                             ; 
02FA                             ; 
02FA   21 77 20               LXI   H,LINEN   ;POINT LINE NUMBER OF LAST STOP/ERROR/
02FD   7E                     MOV   A,M   ;GET 1ST CHAR
02FE   B7                     ORA   A   ;TEST IF IMMED CMMD
02FF   CA FD 05               JZ   LET   ;BRIF IF IMMED CMMD
0302                             ;PAGE
0302                             ; 
0302                             ; 
0302                             ; STMT:  GOTO NNNN
0302                             ; 
0302                             ; 
0302   AF           GOTO:     XRA   A   ;CLEAR REG A
0303   32 76 20               STA   EDSW   ;RESET IMMED MODE (IF IT WAS SET)
0306   32 75 20               STA   RUNSW   ;AND RUN TYPE
0309   CD AE 1A               CALL   NOTEO   ;ERROR IF END-OF-LINE
030C   CD B6 1A               CALL   PACK   ;GO GET LINE NUMBER IN B,C
030F   CD 95 1A               CALL   EOL   ;ERROR IF NOT END-OF-LINE
0312   CD 61 1F     GOTO2:    CALL   LOCAT   ;GO SEARCH FOR REQUESTED LINE #
0315   DA 04 1C               JC   ULERR   ;BRIF NOT FOUND
0318   22 70 22               SHLD   STMT   ;SAVE ADDR
031B   AF                     XRA   A   ;GET A ZERO
031C   32 74 22               STA   MULTI   ;TURN OFF MULTIPLE STMTS
031F   C3 31 02               JMP   RUN2   ;GO PROCESS THE STATEMENT
0322                             ; 
0322                             ; 
0322                             ; STMT: RESTORE
0322                             ; 
0322   CD 95 1A     RESTO:    CALL   EOL   ;ERROR IF NOT END-OF-LINE
0325   21 95 22               LXI   H,BEGPR-1   ;POINT 1 BEFORE START OF PROGRAM
0328   22 8F 22               SHLD   DATAP   ;FORCE NEXT DATA TO BE AT START
032B   C3 17 02               JMP   RUN   ;GO NEXT STMT
032E                             ; 
032E                             ; 
032E                             ; STMT:  RETURN
032E                             ; 
032E   CD 95 1A     RETUR:    CALL   EOL   ;ERROR IF NOT END-OF-LINE
0331   F1                     POP   PSW   ;POP THE STACK
0332   FE FF                  CPI   0FFH   ;TEST IF GOSUB IN EFFECT
0334   C2 14 1C               JNZ   RTERR   ;BRIF ERROR
0337   E1                     POP   H   ;GET RETURNED STATMENT ADDRESS
0338   22 70 22               SHLD   STMT   ;RESTORE
033B   E1                     POP   H   ;GET ENDLINE VALUE
033C   22 72 22               SHLD   ENDLI   ;RESTORE
033F   F1                     POP   PSW   ;GET MULTI SW VALUE
0340   32 74 22               STA   MULTI   ;RESTORE
0343   C3 17 02               JMP   RUN   ;CONTINUE (AT STMT FOLLOWING GOSUB)
0346                             ; 
0346                             ; 
0346                             ; STMT:  GOSUB NNNN
0346                             ; 
0346   CD AE 1A     GOSUB:    CALL   NOTEO   ;ERROR IF END-OF-LINE
0349   CD B6 1A               CALL   PACK   ;GET LINE NUMBER
034C   CD 95 1A               CALL   EOL   ;ERROR IF NOT END-OF-LINE
034F   3A 74 22     GOSU1:    LDA   MULTI   ;GET SW SETTING
0352   F5                     PUSH   PSW   ;SAVE ON STACK
0353   2A 72 22               LHLD   ENDLI   ;GET ADDR OF END OF STMT
0356   E5                     PUSH   H   ;SAVE ONE STACK
0357   2A 70 22               LHLD   STMT   ;GET STATEMENT ADDRESS
035A   E5                     PUSH   H   ;SAVE RETURN ADDRESS IN STACK
035B   3E FF                  MVI   A,0FFH   ;MARK AS GOSUB
035D   F5                     PUSH   PSW   ;SAVE STATUS
035E   C3 12 03               JMP   GOTO2   ;GO LOOKUP LINE AND BRANCH
0361                             ;PAGE
0361                             ; 
0361                PRINT:    EQU   $   
0361                             ; 
0361                             ; 
0361                             ; STMT: PRINT ....
0361                             ; 
0361                             ; 
0361   AF                     XRA   A   ;CLEAR REG A
0362   32 8D 22     PRIN4:    STA   PRSW   ;SET SW TO SAY CRLF AT END OF LINE
0365   11 CE 20               LXI   D,IOBUF   ;POINT BUFFER
0368   CF                     RST   1   ;SKIP TO NEXT FIELD
0369                             ; 
0369   CD A9 1A               CALL   TSTEL   ;TEST IF END OF STMT
036C   CA DF 03               JZ   PRINC   ;BRIF IT IS
036F   FE 2C                  CPI   ","   ;TEST IF COMMA
0371   CA B6 03               JZ   PRIN8   ;BRIF IT IS
0374   FE 3B                  CPI   ";"   ;TEST IF SEMI-COLON
0376   CA B9 03               JZ   PRIN9   ;BRIF IT IS
0379   D5                     PUSH   D   ;SAVE D,E
037A   E5                     PUSH   H   ;SAVE H,L
037B   11 8C 1D               LXI   D,TABLI   ;POINT LITERAL
037E   D7                     RST   2   ;GO SEE IF TAB(XX)
037F   CA BF 03               JZ   PRINA   ;BRIF IS
0382   E1                     POP   H   ;ELSE, RESTORE H,L
0383   CD 8C 0F               CALL   EXPR   ;GO EVALUATE EXPRESSION
0386   D1                     POP   D   ;RESTORE D,E
0387   E5                     PUSH   H   ;SAVE H,L
0388   EB                     XCHG      ;FLIP/FLOP
0389   3A 8E 22               LDA   NS   ;GET TYPE OF RESULT
038C   FE E7                  CPI   0E7H   ;TEST IF STRING
038E   CA A2 03               JZ   PRIN5   ;BRIF IS
0391   CD FC 14               CALL   FOUT   ;GO CONVERT OUTPUT
0394   23                     INX   H   ;POINT NEXT
0395   EB           PRIN7:    XCHG      ;FLIP/FLOP: END ADDR TO DE
0396   E1                     POP   H   ;RESTORE H,L
0397                             ;HERE AFTER SETTING UP VALUE TO PRINT IN BUFFER
0397   3E FE        PRIN2:    MVI   A,0FEH   ;SET END CODE=NO CRLF
0399   12                     STAX   D   ;PUT TO BUFFER
039A   E5                     PUSH   H   ;SAVE H,L
039B   CD B6 19               CALL   TERMO   ;GO PRINT BUFFER
039E   E1                     POP   H   ;RESTORE HL
039F   C3 61 03               JMP   PRINT   ;REPEAT FOR NEXT FIELD
03A2                             ; 
03A2   11 20 21     PRIN5:    LXI   D,STRIN   ;POINT STRING
03A5   1A                     LDAX   D   ;GET LEN
03A6   B7                     ORA   A   ;TEST IT
03A7   CA 95 03               JZ   PRIN7   ;BRIF NULL
03AA   47                     MOV   B,A   ;SAVE LEN
03AB   13           PRIN6:    INX   D   ;POINT NEXT
03AC   1A                     LDAX   D   ;GET A BYTE
03AD   77                     MOV   M,A   ;STORE IT
03AE   23                     INX   H   ;POINT NEXT
03AF   05                     DCR   B   ;DECR CTR
03B0   C2 AB 03               JNZ   PRIN6   ;LOOP
03B3   C3 95 03               JMP   PRIN7   ;DIDDLE DE, HL AND CONTINUE
03B6                             ; 
03B6   CD E0 19     PRIN8:    CALL   TABST   ;GO POSITION NEXT TAB
03B9   23           PRIN9:    INX   H   ;PRINT NEXT
03BA   3E 01                  MVI   A,1   ;GET SETTTING FOR SW
03BC   C3 62 03               JMP   PRIN4   ;GO STORE A IN PRSW & DO NEXT FIELD
03BF   D1           PRINA:    POP   D   ;GET RID OF STACK ENTRY
03C0   CD 8C 0F               CALL   EXPR   ;GO EVALUATE
03C3   E5                     PUSH   H   ;SAVE H,L
03C4   CD 67 1C               CALL   FBIN   ;CONVERT TO BINARY
03C7   F5                     PUSH   PSW   ;SAVE SPECIFIED COLUMN
03C8   21 76 22               LXI   H,COLUM   ;POINT CURRENT POSITION
03CB   96                     SUB   M   ;SUBTRACT (LEAVES NUMBER OF FILLS)
03CC   FC 67 19               CM   CRLF   ;NEXT LINE IF ALREADY PAST
03CF   F1                     POP   PSW   ;RESTORE COL
03D0   96                     SUB   M   ;GET NUMBER FILLS
03D1   E1                     POP   H   
03D2   D1                     POP   D   
03D3   47                     MOV   B,A   ;SAVE COUNT
03D4   3E 20                  MVI   A," "   ;GET FILL
03D6   CA 97 03     PRINB:    JZ   PRIN2   ;BRIF COUNT ZERO
03D9   12                     STAX   D   ;PUT ONE SPACE
03DA   13                     INX   D   ;POINT NEXT
03DB   05                     DCR   B   ;DECR CTR
03DC   C3 D6 03               JMP   PRINB   ;LOOP
03DF                             ; 
03DF   CD 95 1A     PRINC:    CALL   EOL   ;SAVE EOL POSITION
03E2                             ;HERE TO PRINT FINAL CR/LF (OR NOT) AND GO TO NEXT STATEMENT
03E2   3A 8D 22               LDA   PRSW   ;GET SWITCH
03E5   47                     MOV   B,A   ;SAVE ,; SWITCH
03E6   3A 73 20               LDA   OUTSW   ;GET CONTROL-O SWITCH
03E9   B7                     ORA   A   ;TEST IF ^O IN EFFECT
03EA   B0                     ORA   B   ;AND IF STATEMENT ENDED IN , OR ;
03EB   CC 67 19               CZ   CRLF   ;CRLF IF NEITHER
03EE   C3 17 02               JMP   RUN   ;CONTINUE NEXT STATEMENT
03F1                             ;PAGE
03F1                             ; 
03F1                FOR:      EQU   $   
03F1                             ; 
03F1                             ; 
03F1                             ;  STMT:  FOR VAR = EXPR TO EXPR [STEP EXPR]
03F1                             ; 
03F1                             ; 
03F1                             ;  FIRST EVALUATE ARGUMENTS AND STORE POINTERS AND VALUES,
03F1                             ;  BUT DO NOT MAKE TABLE ENTRY YET
03F1   CD CA 1B               CALL   VAR   ;NEXT WORD MUST BE VARIABLE
03F4   EB                     XCHG      ;FLIP/FLOP
03F5   22 23 22               SHLD   INDX   ;SAVE VARIABLE NAME
03F8   EB                     XCHG      ;FLIP/FLOP AGAIN
03F9   FE 3D                  CPI   "="   ;TEST FOR EQUAL SIGN
03FB   C2 10 1C               JNZ   SNERR   ;BRIF NO EQUAL
03FE   23                     INX   H   ;POINT NEXT
03FF   CD 8C 0F               CALL   EXPR   ;GO EVALUATE EXPR, IF ANY
0402   EB                     XCHG      ;FLIP/FLOP AGAIN
0403   2A 23 22               LHLD   INDX   ;GET INDEX NAME
0406   EB                     XCHG      ;FLIP/FLOP
0407   E5                     PUSH   H   ;SAVE H,L
0408   CD 35 1B               CALL   SEARC   ;GO LOCATE NAME
040B   EB                     XCHG      ;PUT ADDR IN H,L
040C   22 52 22               SHLD   ADDR1   ;SAVE ADDR
040F   DF                     RST   3   ;GO STORE THE VALUE
0410   E1                     POP   H   ;RESTORE POINTER TO STMT
0411   11 D5 1E               LXI   D,TOLIT   ;GET LIT ADDR
0414   D7                     RST   2   ;GO COMPARE
0415   C2 10 1C               JNZ   SNERR   ;BRIF ERROR
0418   CD 8C 0F               CALL   EXPR   ;GO EVALUATE TO-EXPR
041B   E5                     PUSH   H   ;SAVE H,L
041C   21 27 22               LXI   H,TVAR1   ;POINT "TO" VALUE
041F   DF                     RST   3   ;SAVE IT
0420   21 ED 1D               LXI   H,ONE   ;POINT CONSTANT: 1
0423   EF                     RST   5   ;LOAD IT
0424   E1                     POP   H   ;GET H,L
0425   7E                     MOV   A,M   ;GET THE CHAR
0426   B7                     ORA   A   ;TEST FOR END OF STATEMENT
0427   CA 3A 04               JZ   FOR2   ;BRIF NO STEP
042A   E5                     PUSH   H   ;RE-SAVE
042B   11 90 1D               LXI   D,STEPL   ;TEST FOR LIT "STEP"
042E   D7                     RST   2   ;GO COMPARE
042F   CA 36 04               JZ   FOR1   ;BRIF STEP
0432   E1                     POP   H   ;RESTORE H,L
0433   C3 3A 04               JMP   FOR2   ;GO NO STEP VALUE
0436   D1           FOR1:     POP   D   ;POP OFF THE STACK
0437   CD 8C 0F               CALL   EXPR   ;GO EVALUATE EXPRESSION
043A   E5           FOR2:     PUSH   H   ;SAVE H,L TO END OF STATEMENT
043B   21 2B 22               LXI   H,TVAR2   ;POINT STEP VALUE
043E   DF                     RST   3   ;SAVE IT
043F   E1                     POP   H   ;RESTORE H,L
0440   CD 95 1A               CALL   EOL   ;ERROR IF NOT END-OF-LINE
0443                             ; DETERMINE WHETHER LOOP IS TO BE EXECUTED AT ALL
0443                             ; (IF VALUE > "TO" VALUE AND STEP POSITIVE,
0443                             ;    JUST SKIP TO NEXT, ETC)
0443   CD DA 18               CALL   FTEST   ;GET STATUS OF FACC
0446   F5                     PUSH   PSW   ;SAVE A,STATUS
0447   21 27 22               LXI   H,TVAR1   ;GET END VALUE
044A   EF                     RST   5   ;LOAD IT
044B   F1                     POP   PSW   ;RESTORE STATUS
044C   F2 5E 04               JP   FOR4   ;BRIF FOR IS POSITIVE
044F   2A 52 22               LHLD   ADDR1   ;GET ADDRESS OF INDEX
0452   CD 18 17               CALL   FSUB   ;COMPARE THIS AGAINST END VALUE
0455   CA 6A 04               JZ   FOR5   ;BRIF START = END
0458   FA 6A 04               JM   FOR5   ;BRIF START > END
045B   C3 BE 04               JMP   FOR9   ;GO LOCATE MATCHING NEXT
045E   2A 52 22     FOR4:     LHLD   ADDR1   ;GET ADDRESS OF INDEX
0461   CD 18 17               CALL   FSUB   ;COMPARE
0464   CA 6A 04               JZ   FOR5   ;BRIF START = END
0467   FA BE 04               JM   FOR9   ;BRIF START > END: SKIP TO "NEXT"
046A                             ; LOOP IS TO BE EXECUTED AT LEAST ONCE:
046A                             ; NEED AN ENTRY IN FOR-NEXT TABLE.
046A                             ; SEE IF THERE IS ALREADY ENTRY FOR THIS VARIABLE
046A                             ; (IE PROGRAM JUMPED OUT OF LOOP EARLIER)
046A   11 00 20     FOR5:     LXI   D,FORNE   ;POINT TABLE
046D   2A 23 22               LHLD   INDX   ;GET INDEX VARIABLE NAME
0470   EB                     XCHG      ;FLIP/FLOP
0471   7E                     MOV   A,M   ;GET COUNT OF ENTRIES NOW IN TABLE
0472   47                     MOV   B,A   ;STORE IT
0473   0E 01                  MVI   C,1   ;NEW CTR
0475   B7                     ORA   A   ;TEST IF ZERO
0476   23                     INX   H   ;POINT
0477   CA 8D 04               JZ   FOR8   ;BRIF TABLE EMPTY
047A   7E           FOR6:     MOV   A,M   ;GET 1ST BYTE OF TABLE VARIABLE
047B   BA                     CMP   D   ;TEST IF EQUAL TO THIS FOR'S INDEX
047C   C2 86 04               JNZ   FOR7   ;BRIF NOT
047F   23                     INX   H   ;POINT NEXT
0480   7E                     MOV   A,M   ;GET NEXT BYTE
0481   2B                     DCX   H   ;POINT BACK
0482   BB                     CMP   E   ;TEST IF EQUAL
0483   CA 8D 04               JZ   FOR8   ;BRIF EQUAL
0486   E7           FOR7:     RST   4   ;ADJUST H,L
0487   0E                     DB   14   
0488   0C                     INR   C   ;COUNT IT
0489   05                     DCR   B   ;DECR CTR
048A   C2 7A 04               JNZ   FOR6   ;LOOP
048D                             ; ENTER THIS FOR IN TABLE (WHERE HL POINTS)
048D   79           FOR8:     MOV   A,C   ;GET UDPATE COUNT
048E   FE 09                  CPI   9   ;TEST IF TBL EXCEEDED
0490   D2 1C 1C               JNC   NXERR   ;ERROR IF MORE THAN 8 OPEN FOR/NEXT
0493   32 00 20               STA   FORNE   ;PUT IN TABLE
0496   72                     MOV   M,D   ;HI BYTE INDEX VARIABLE NAME
0497   23                     INX   H   ;POINT NEXT
0498   73                     MOV   M,E   ;STORE LO BYTE
0499   23                     INX   H   ;POINT NEXT
049A   E5                     PUSH   H   ;SAVE H,L
049B   21 2B 22               LXI   H,TVAR2   ;POINT STEP VALUE
049E   EF                     RST   5   ;LOAD IT
049F   E1                     POP   H   ;RESTORE H,L
04A0   DF                     RST   3   ;STORE IN STACK
04A1   E5                     PUSH   H   ;SAVE H,L
04A2   21 27 22               LXI   H,TVAR1   ;POINT "TO" VALUE
04A5   EF                     RST   5   ;LOAD IT
04A6   E1                     POP   H   ;RESTORE H,L
04A7   DF                     RST   3   ;STORE IN STACK
04A8   EB                     XCHG      ;FLIP/FLOP
04A9   2A 72 22               LHLD   ENDLI   ;GET END ADDR
04AC   2B                     DCX   H   ;POINT ONE PRIOR
04AD   EB                     XCHG      ;FLIP BACK
04AE   72                     MOV   M,D   ;STORE IT
04AF   23                     INX   H   ;POINT NEXT
04B0   73                     MOV   M,E   ;STORE IT
04B1   23                     INX   H   ;POINT NEXT
04B2   3A 71 22               LDA   STMT+1   ;GET HIGH STMT ADDR
04B5   77                     MOV   M,A   ;PUT IT
04B6   23                     INX   H   ;POINT NEXT
04B7   3A 70 22               LDA   STMT   ;GET LOW STMT ADDR
04BA   77                     MOV   M,A   ;PUT IT
04BB   C3 17 02               JMP   RUN   ;CONTINUE
04BE                             ; 
04BE                             ; IF HERE, THIS LOOP IS TO BE EXECUTED ZERO TIMES:
04BE                             ; SCAN THRU PROGRAM TO FIND MATCHING "NEXT".
04BE                             ; THIS CODE WILL FAIL IF USER'S PROGRAM IS TOO
04BE                             ; COMPLEX SINCE IT WON"T FOLLOW GOTO"S, IF'S, ETC.
04BE   2A 70 22     FOR9:     LHLD   STMT   ;GET ADDRESS OF STATMENT
04C1   5E                     MOV   E,M   ;GET LENGTH CODE
04C2   16 00                  MVI   D,0   ;INIT INCREMENT
04C4   19                     DAD   D   ;COMPUTE ADDR OF NEXT STATEMENT
04C5   7E                     MOV   A,M   ;GET NEW LEN CODE
04C6   B7                     ORA   A   ;SEE IF END OF PGM
04C7   CA 1C 1C               JZ   NXERR   ;BRIF IT IS
04CA   22 70 22               SHLD   STMT   ;SAVE ADDRESS
04CD   E7                     RST   4   ;ADJUST H,L
04CE   03                     DB   3   
04CF   CF                     RST   1   ;SKIP SPACES
04D0   11 AB 1E               LXI   D,NEXTL   ;POINT "NEXT"
04D3   D7                     RST   2   ;SEE IF IT IS A NEXT STMT
04D4   C2 BE 04               JNZ   FOR9   ;LOOP IF NOT
04D7   CF                     RST   1   ;SKIP SPACES
04D8   3A 24 22               LDA   INDX+1   ;GET FIRST CHAR
04DB   BE                     CMP   M   ;COMPARE
04DC   C2 BE 04               JNZ   FOR9   ;BRIF NOT MATCH NEXT
04DF   3A 23 22               LDA   INDX   ;GET 2ND CHAR
04E2   23                     INX   H   ;DITTO
04E3   FE 20                  CPI   " "   ;SEE IF SINGLE CHAR
04E5   CA EC 04               JZ   FORA   ;BRIF IT IS
04E8   BE                     CMP   M   ;COMPARE THE TWO
04E9   C2 BE 04               JNZ   FOR9   ;BRIF NOT EQUAL
04EC   CF           FORA:     RST   1   ;SKIP TO END (HOPEFULLY)
04ED   7E                     MOV   A,M   ;GET THE NON BLANK
04EE   B7                     ORA   A   ;SEE IF END
04EF   C2 BE 04               JNZ   FOR9   ;BRIF END
04F2   C3 17 02               JMP   RUN   ;ELSE, GO NEXT STMT
04F5                             ;PAGE
04F5                             ; 
04F5                IFSTM:    EQU   $   
04F5                             ; 
04F5                             ; 
04F5                             ; STMT: IF EXPR RELATION EXPR THEN STMT#
04F5                             ; 
04F5                             ; 
04F5   CD 8C 0F               CALL   EXPR   ;GO EVALUATE LEFT EXPR
04F8   E5                     PUSH   H   ;SAVE H,L
04F9   3A 8E 22               LDA   NS   ;GET TYPE CODE
04FC   32 26 22               STA   IFTYP   ;SAVE IT
04FF   FE E7                  CPI   0E7H   ;TEST IF STRING
0501   C2 13 05               JNZ   IF1   ;BRIF NOT
0504   21 CE 20               LXI   H,IOBUF   ;POINT BUFFER
0507   11 20 21               LXI   D,STRIN   ;POINT RESULT
050A   1A                     LDAX   D   ;GET LEN
050B   3C                     INR   A   ;PLUS ONE
050C   47                     MOV   B,A   ;SAVE IT
050D   CD 4E 1C               CALL   COPYD   ;GO MOVE IT
0510   C3 17 05               JMP   IF2   ;GO AROUND
0513   21 27 22     IF1:      LXI   H,TVAR1   ;GET ADDR OF TEMP STORAGE
0516   DF                     RST   3   ;SAVE IT
0517   E1           IF2:      POP   H   ;RESTORE H,L
0518   AF                     XRA   A   ;CLEAR A
0519   4F                     MOV   C,A   ;SAVE IN REG C
051A   47                     MOV   B,A   ;INIT REG
051B   7E           IF3:      MOV   A,M   ;GET OPERATOR
051C   04                     INR   B   ;COUNT
051D   FE 3D                  CPI   "="   ;TEST FOR EQUAL
051F   C2 24 05               JNZ   IF4   ;BRIF IT IS
0522   0C                     INR   C   ;ADD 1 TO C
0523   23                     INX   H   ;POINT NEXT
0524   FE 3E        IF4:      CPI   ">"   ;TEST FOR GREATER THAN
0526   C2 2C 05               JNZ   IF5   ;BRIF IT IS
0529   0C                     INR   C   ;ADD TWO
052A   0C                     INR   C   ;TO REL CODE
052B   23                     INX   H   ;POINT NEXT
052C   FE 3C        IF5:      CPI   "<"   ;TEST FOR LESS THAN
052E   C2 36 05               JNZ   IF6   ;BRIF IT IS
0531   79                     MOV   A,C   ;GET REL CODE
0532   C6 04                  ADI   4   ;PLUS FOUR
0534   4F                     MOV   C,A   ;PUT BACK
0535   23                     INX   H   ;POINT NEXT
0536   79           IF6:      MOV   A,C   ;GET REL CODE
0537   B7                     ORA   A   ;TEST IT
0538   C5                     PUSH   B   ;SAVE B,C
0539   CA 10 1C               JZ   SNERR   ;BRIF SOME ERROR
053C   C1                     POP   B   ;RESTORE B,C
053D   32 25 22               STA   REL   ;SAVE CODE
0540   78                     MOV   A,B   ;GET COUNT
0541   FE 02                  CPI   2   ;TEST FOR TWO
0543   C2 1B 05               JNZ   IF3   ;SEE IF MULTIPLE RELATION
0546   CD 8C 0F               CALL   EXPR   ;GO EVALUATE RIGHT SIDE
0549   22 52 22               SHLD   ADDR1   ;SAVE LOCATION OF THEN (IF ANY)
054C   3A 8E 22               LDA   NS   ;GET TYPE CODE
054F   21 26 22               LXI   H,IFTYP   ;POINT LEFT TYPE
0552   BE                     CMP   M   ;COMPARE
0553   C2 10 1C               JNZ   SNERR   ;BRIF MIXED
0556   FE E7                  CPI   0E7H   ;TEST IF STRING
0558   CA B4 05               JZ   IFF   ;BRIF IS
055B   21 27 22               LXI   H,TVAR1   ;POINT LEFT
055E   CD 18 17               CALL   FSUB   ;SUBTRACT LEFT FROM RIGHT
0561   3A 25 22               LDA   REL   ;GET RELATION
0564   1F                     RAR      ;TEST BIT D0
0565   D2 6E 05               JNC   IF8   ;BRIF NO EQUAL TEST
0568   CD DA 18               CALL   FTEST   ;GET STATUS OF FACC
056B   CA 8D 05               JZ   TRUE   ;BRIF LEFT=RIGHT
056E   3A 25 22     IF8:      LDA   REL   ;LOAD RELATION
0571   E6 02                  ANI   02H   ;MASK IT
0573   CA 7C 05               JZ   IF9   ;BRIF NO >
0576   CD DA 18               CALL   FTEST   ;GET STATUS OF FACC
0579   FA 8D 05               JM   TRUE   ;BRIF GT
057C   3A 25 22     IF9:      LDA   REL   ;LOAD RELATION
057F   E6 04                  ANI   04H   ;MASK IT
0581   CA 17 02               JZ   FALSE   ;BRIF NO <
0584   CD DA 18               CALL   FTEST   ;GET STATUS OF FACC
0587   FA 17 02               JM   FALSE   ;BRIF GT
058A   CA 17 02               JZ   FALSE   ;BRIF ZERO (NOT EQUAL)
058D   2A 52 22     TRUE:     LHLD   ADDR1   ;GET POINTER TO STATEMENT
0590   11 D3 1E               LXI   D,GOTOL   ;POINT "GO TO"
0593   D7                     RST   2   ;GO COMPARE
0594   CA 02 03               JZ   GOTO   ;BRIF IF ... GOTO NN
0597   2A 52 22               LHLD   ADDR1   ;GET POINTER TO STATEMENT
059A   11 B2 1E               LXI   D,GOSBL   ;POINT LITERAL
059D   D7                     RST   2   ;GO COMAPRE
059E   CA 46 03               JZ   GOSUB   ;BRIF IF ... GOSUB NN
05A1   2A 52 22               LHLD   ADDR1   ;GET POINTER TO STATEMENT
05A4   11 95 1D               LXI   D,THENL   ;GET ADDR "THEN"
05A7   D7                     RST   2   ;GO COMPARE
05A8   C2 10 1C               JNZ   SNERR   ;BRIF ERROR
05AB   CD 2B 1B               CALL   NUMER   ;TEST IF NUMERIC
05AE   CA 02 03               JZ   GOTO   ;BRIF IT IS
05B1   C3 44 02               JMP   RUN4   ;ELSE, MAY BE ANY STMT
05B4                FALSE:    EQU   RUN   
05B4   21 CE 20     IFF:      LXI   H,IOBUF   ;POINT PRIOR
05B7   46                     MOV   B,M   ;GET LEN
05B8   11 20 21               LXI   D,STRIN   ;POINT THIS
05BB   1A                     LDAX   D   ;GET LEN
05BC   4F                     MOV   C,A   ;SAVE IT
05BD   13           IFG:      INX   D   ;POINT NEXT
05BE   23                     INX   H   ;DITTO
05BF   78                     MOV   A,B   ;GET LEFT LEN
05C0   B7                     ORA   A   ;TEST IT
05C1   C2 C6 05               JNZ   IFH   ;BRIF NOT ZERO
05C4   36 20                  MVI   M," "   ;EXTEND WITH SPACE
05C6   79           IFH:      MOV   A,C   ;GET RIGHT LEN
05C7   B7                     ORA   A   ;TEST IT
05C8   C2 CE 05               JNZ   IFI   ;BRIF NOT ZERO
05CB   3E 20                  MVI   A," "   ;GET SPACE
05CD   12                     STAX   D   ;EXTEND
05CE   1A           IFI:      LDAX   D   ;GET RIGHT CHAR
05CF   BE                     CMP   M   ;TEST WITH LEFT
05D0   DA F3 05               JC   IFM   ;BRIF LEFT>RIGHT
05D3   C2 F8 05               JNZ   IFN   ;BRIF LEFT<RIGHT
05D6   78                     MOV   A,B   ;GET LEFT COUNT
05D7   3D                     DCR   A   ;SUBT ONE
05D8   FA DC 05               JM   IFJ   ;BRIF WAS ZERO
05DB   47                     MOV   B,A   ;UPDATE CTR
05DC   79           IFJ:      MOV   A,C   ;GET RIGHT LEN
05DD   3D                     DCR   A   ;SUBT ONE
05DE   FA E2 05               JM   IFK   ;BRIF WAS ZERO
05E1   4F                     MOV   C,A   ;UPDT CTR
05E2   78           IFK:      MOV   A,B   ;GET LEFT LEN
05E3   B1                     ORA   C   ;COMPARE TO RIGHT
05E4   C2 BD 05               JNZ   IFG   ;BRIF BOTH NOT ZERO
05E7   06 01                  MVI   B,1   ;SET SW= EQUAL
05E9   3A 25 22     IFL:      LDA   REL   ;GET RELATION
05EC   A0                     ANA   B   ;AND WITH RESULT
05ED   CA 17 02               JZ   FALSE   ;BRIF FALSE
05F0   C3 8D 05               JMP   TRUE   ;ELSE, TRUE
05F3   06 02        IFM:      MVI   B,2   ;SET CODE
05F5   C3 E9 05               JMP   IFL   ;JUMP
05F8   06 04        IFN:      MVI   B,4   ;SET CODE
05FA   C3 E9 05               JMP   IFL   ;JUMP
05FD                             ;PAGE
05FD                             ; 
05FD                LET:      EQU   $   
05FD                             ; 
05FD                             ; 
05FD                             ; STMT: [LET] VAR = EXPR
05FD                             ; 
05FD                             ; 
05FD   CD 5B 18               CALL   GETS8   ;GO GET ADDRESS OF VARIABLE
0600   C5                     PUSH   B   ;SAVE NAME
0601   D5                     PUSH   D   ;SAVE ADDRESS
0602   CF                     RST   1   ;GET NEXT CHAR
0603   FE 3D                  CPI   "="   ;TEST FOR EQUAL SIGN
0605   CA 18 06               JZ   LET1   ;BRIF IS
0608   3A 76 20               LDA   EDSW   ;GET MODE SW
060B   B7                     ORA   A   ;TEST IT
060C   CA 10 1C               JZ   SNERR   ;BRIF LET ERROR
060F   21 74 1D               LXI   H,WHATL   ;POINT LITERAL
0612   CD BE 19               CALL   TERMM   ;GO PRINT IT
0615   C3 D5 00               JMP   GETCM   ;GO TO COMMAND
0618   23           LET1:     INX   H   ;POINT NEXT
0619   CD 8C 0F               CALL   EXPR   ;GO EVALUATE EXPRESSION
061C   CD 95 1A               CALL   EOL   ;ERROR IF NOT END-OF-LINE
061F   E1                     POP   H   ;RESTORE ADDRESSS
0620   D1                     POP   D   ;RESTORE NAME
0621   7B                     MOV   A,E   ;GET TYPE
0622   B7                     ORA   A   ;TEST IT
0623   3A 8E 22               LDA   NS   ;GET RESULT TYPE
0626   FA 32 06               JM   LET2   ;BRIF STRING
0629   FE E3                  CPI   0E3H   ;TEST IF NUMERIC
062B   C2 10 1C               JNZ   SNERR   ;BRIF MIXED MODE
062E   DF                     RST   3   ;GO STORE VARIABLE
062F   C3 17 02               JMP   RUN   ;CONTINUE
0632   FE E7        LET2:     CPI   0E7H   ;TEST IF STRING
0634   C2 10 1C               JNZ   SNERR   ;BRIF MIXED MODE
0637   CD 3D 06               CALL   LET2A   ;GO STORE IT
063A   C3 17 02               JMP   RUN   ;CONTINUE
063D                             ; 
063D   11 20 21     LET2A:    LXI   D,STRIN   ;POINT STRING BUFFER
0640   1A                     LDAX   D   ;GET NEW LEN
0641   96                     SUB   M   ;MINUS OLD LEN
0642   CA 92 06               JZ   LET8   ;BRIF SAME LENGTH
0645   54                     MOV   D,H   ;COPY H,L
0646   5D                     MOV   E,L   ;TO D,E
0647   7E                     MOV   A,M   ;GET LEN
0648   3C                     INR   A   ;TRUE LEN
0649   13           LET3:     INX   D   ;POINT NEXT
064A   3D                     DCR   A   ;DECR CTR
064B   C2 49 06               JNZ   LET3   ;LOOP
064E   13                     INX   D   ;SKIP
064F   13                     INX   D   ;AGAIN
0650   1A                     LDAX   D   ;GET LO NAM
0651   4F                     MOV   C,A   ;SAVE
0652   13                     INX   D   ;GET HI NAME
0653   1A                     LDAX   D   ;LOAD IT
0654   47                     MOV   B,A   ;SAVE
0655   C5                     PUSH   B   ;SAVE NAME
0656   2B                     DCX   H   ;POINT NEXT ENTRY
0657   7E           LET4:     MOV   A,M   ;GET NEXT
0658   B7                     ORA   A   ;TEST IF END
0659   CA 70 06               JZ   LET6   ;BRIF IS
065C   E5                     PUSH   H   ;SAVE H,L
065D   2B                     DCX   H   ;SKIP NEXT
065E   2B                     DCX   H   ;POINT LEN
065F   46                     MOV   B,M   ;GET HI LEN
0660   2B                     DCX   H   ;POINT LO
0661   4E                     MOV   C,M   ;GET LO LEN
0662   E1                     POP   H   ;RESTORE H,L
0663   7E           LET5:     MOV   A,M   ;GET A BYTE
0664   12                     STAX   D   ;COPY
0665   2B                     DCX   H   ;POINT NEXT
0666   1B                     DCX   D   ;DITTO
0667   03                     INX   B   ;ADD TO CTR
0668   78                     MOV   A,B   ;GET HI
0669   B1                     ORA   C   ;TEST IF ZERO
066A   C2 63 06               JNZ   LET5   ;LOOP
066D   C3 57 06               JMP   LET4   ;CONTINUE
0670   EB           LET6:     XCHG      ;PUT NEW ADDR TO H,L
0671   C1                     POP   B   ;GET NAME
0672   70                     MOV   M,B   ;STORE HI BYTE
0673   2B                     DCX   H   ;POINT NEXT
0674   71                     MOV   M,C   ;STORE LO
0675   11 20 21               LXI   D,STRIN   ;GET NEW LEN
0678   1A                     LDAX   D   ;LOAD IT
0679   06 FF                  MVI   B,0FFH   ;INIT HI COMPLEMENT
067B   C6 05                  ADI   5   ;COMPUTE ENTRY LENGTH
067D   CA 85 06               JZ   LET7   ;BRIF 256 BYTES
0680   D2 85 06               JNC   LET7   ;BRIF LESS 256
0683   06 FE                  MVI   B,0FEH   ;SET BIT OFF
0685   2F           LET7:     CMA      ;1'S COMPLEMENT
0686   3C                     INR   A   ;THEN 2'S
0687   4F                     MOV   C,A   ;SAVE LO LEN
0688   2B                     DCX   H   ;POINT NEXT
0689   70                     MOV   M,B   ;STORE HI LEN
068A   2B                     DCX   H   ;POINT NEXT
068B   71                     MOV   M,C   ;STORE LO LEN
068C   E7                     RST   4   ;ADJUST H,L
068D   03                     DB   3   
068E   09                     DAD   B   ;COMPUTE END OF ENTRY
068F   36 00                  MVI   M,0   ;MARK NEW END
0691   23                     INX   H   ;POINT 1ST BYTE
0692   1A           LET8:     LDAX   D   ;GET LEN
0693   3C                     INR   A   ;TRUE LEN
0694   47                     MOV   B,A   ;SAVE LEN
0695   1A           LET9:     LDAX   D   ;GET A BYTE
0696   77                     MOV   M,A   ;COPY IT
0697   23                     INX   H   ;POINT NEXT
0698   13                     INX   D   ;DITTO
0699   05                     DCR   B   ;SUBT CTR
069A   C2 95 06               JNZ   LET9   ;LOOP
069D   C9                     RET      ;RETURN
069E                             ;PAGE
069E                             ; 
069E                             ;NEXT   EQQU    $
069E                             ; 
069E                             ; 
069E                             ; STMT:  NEXT VAR
069E                             ; 
069E                             ; 
069E   CD CA 1B     NEXT:     CALL   VAR   ;GET VARIABLE NAME
06A1   CD 95 1A               CALL   EOL   ;ERROR IF NOT END-OF-LNE
06A4   EB                     XCHG      ;FLIP/FLOP
06A5   22 23 22               SHLD   INDX   ;SAVE VAR NAME
06A8   E5                     PUSH   H   ;SAVE VAR NAME
06A9   21 00 20               LXI   H,FORNE   ;POINT FOR/NEXT TABLE
06AC   46                     MOV   B,M   ;GET SIZE
06AD   78                     MOV   A,B   ;LOAD IT
06AE   B7                     ORA   A   ;TEST IT
06AF   CA 1C 1C               JZ   NXERR   ;BRIF TABLE EMPTY
06B2   23                     INX   H   ;POINT NEXT
06B3   D1                     POP   D   ;RESTORE VAR NAME
06B4   7E           NEXT1:    MOV   A,M   ;GET 1ST BYTE
06B5   23                     INX   H   ;POINT NEXT
06B6   BA                     CMP   D   ;COMPARE
06B7   C2 BF 06               JNZ   NEXT2   ;BRIF NOT EQUAL
06BA   7E                     MOV   A,M   ;GET 2ND BYTE
06BB   BB                     CMP   E   ;COMPARE
06BC   CA C8 06               JZ   NEXT3   ;BRIF EQUAL
06BF   E7           NEXT2:    RST   4   ;ADJUST H,L
06C0   0D                     DB   13   
06C1   05                     DCR   B   ;DECR COUNT
06C2   C2 B4 06               JNZ   NEXT1   ;LOOP
06C5   C3 1C 1C               JMP   NXERR   ;GO PUT ERROR MSG
06C8   3A 00 20     NEXT3:    LDA   FORNE   ;GET ORIG COUNT
06CB   90                     SUB   B   ;MINUS REMAIN
06CC   3C                     INR   A   ;PLUS ONE
06CD   32 00 20               STA   FORNE   ;STORE NEW COUNT
06D0   23                     INX   H   ;POINT ADDR
06D1   E5                     PUSH   H   ;SAVE H,L ADDR
06D2   CD 35 1B               CALL   SEARC   ;GO GET ADDR OF INDEX
06D5   EB                     XCHG      ;PUT TO H,L
06D6   22 52 22               SHLD   ADDR1   ;SAVR IT
06D9   EF                     RST   5   ;LOAD INDEX
06DA   E1                     POP   H   ;GET H,L (TBL)
06DB   E5                     PUSH   H   ;RE-SAVE
06DC   CD 43 16               CALL   FADD   ;ADD STEP VALUE
06DF   21 27 22               LXI   H,TVAR1   ;POINT TEMP AREA
06E2   DF                     RST   3   ;SAVE NEW INDEX
06E3   E1                     POP   H   ;GET H,L (TBL)
06E4   E5                     PUSH   H   ;RE-SAVE
06E5   E7                     RST   4   ;GET LEN TO NEXT
06E6   04                     DB   4   
06E7   CD 18 17               CALL   FSUB   ;SUBTRACT TO VALUE
06EA   CA 07 07               JZ   NEXT6   ;BRIF ZERO
06ED   E1                     POP   H   ;GET H,L (PTR TO STEP)
06EE   E5                     PUSH   H   ;RE-SAVE
06EF   7E                     MOV   A,M   ;GET SIGN&EXPONENT OF STEP
06F0   B7                     ORA   A   ;TEST IT
06F1   3A 58 22               LDA   FACC   ;GET SIGN & EXPON OF DIFF
06F4   FA 03 07               JM   NEXT5   ;BRIF NEGATIVE
06F7   B7                     ORA   A   ;TEST SIGN OF DIFF
06F8   FA 07 07               JM   NEXT6   ;BRIF LESS THAN TO-EXPR
06FB   21 00 20     NEXT7:    LXI   H,FORNE   ;GET ADDR TABLE
06FE   35                     DCR   M   ;SUBTRACT ONE FROM COUNT
06FF   D1                     POP   D   ;ADJUST STACK
0700   C3 17 02               JMP   RUN   ;GO STMT AFTER NEXT
0703   B7           NEXT5:    ORA   A   ;TEST SIGN OF DIFFERENCE
0704   FA FB 06               JM   NEXT7   ;BRIF END OF LOOP
0707   E1           NEXT6:    POP   H   ;GET PTR TO TBL
0708   E7                     RST   4   ;ADJUST H,L
0709   08                     DB   8   
070A   56                     MOV   D,M   ;GET HI BYTE
070B   23                     INX   H   ;POINT NEXT
070C   5E                     MOV   E,M   ;GET LOW BYTE
070D   23                     INX   H   ;POINT NEXT
070E   7E                     MOV   A,M   ;GET HI BYTE
070F   32 71 22               STA   STMT+1   ;SAVE
0712   23                     INX   H   ;POINT NEXT
0713   7E                     MOV   A,M   ;GET LOW BYTE
0714   32 70 22               STA   STMT   ;SAVE
0717   EB                     XCHG      ;H,L = ADDR OF STMT AFTR FOR
0718   CD 95 1A               CALL   EOL   ;SETUP MULTI PTP
071B   2A 70 22               LHLD   STMT   ;GET ADDR OF FOR STMT
071E   23                     INX   H   ;POINT LINE NUM
071F   22 89 22               SHLD   LINE   ;SAVE ADDR LINE
0722   21 27 22               LXI   H,TVAR1   ;POINT UPDTED VALUE
0725   EF                     RST   5   ;GO LOAD IT
0726   2A 52 22               LHLD   ADDR1   ;GET ADDR OF INDEX
0729   DF                     RST   3   ;GO STORE IT
072A   C3 17 02               JMP   RUN   ;CONTINUE WITH STMT AFTER FOR
072D                             ;PAGE
072D                INPUT:    EQU   $   
072D                             ; 
072D                             ; 
072D                             ; STMT:  INPUT VAR [, VAR, VAR]
072D                             ; 
072D                             ; 
072D   11 87 1D               LXI   D,LLINE   ;POINT "LINE"
0730   E5                     PUSH   H   ;SAVE H,L ADDR
0731   D7                     RST   2   ;GO COMPARE
0732   CA B1 07               JZ   INPL   ;BRIF EQUAL
0735   D1                     POP   D   ;ELSE, RESTORE H,L ADDR
0736   21 CE 20               LXI   H,IOBUF   ;GET ADDR OF BUFFER
0739   22 52 22               SHLD   ADDR1   ;SAVE ADDR
073C   36 00                  MVI   M,0   ;MARK BUFFER EMPTY
073E   EB                     XCHG      ;FLIP/BACK
073F   CF           INPU1:    RST   1   ;SKIP SPACES
0740   FE 27                  CPI   27H   ;TEST IF QUOTE
0742   CA 4A 07               JZ   INPU2   ;BRIF IS
0745   FE 22                  CPI   0x22   ;"""     ;TEST IF INPUT LITERAL
0747   C2 6D 07               JNZ   INPU6   ;BRIF NOT
074A   4F           INPU2:    MOV   C,A   ;SAVE DELIM
074B   11 CE 20               LXI   D,IOBUF   ;POINT BUFFER
074E   23           INPU3:    INX   H   ;POINT NEXT
074F   7E                     MOV   A,M   ;LOAD IT
0750   B9                     CMP   C   ;TEST IF END
0751   CA 59 07               JZ   INPU4   ;BRIF IS
0754   12                     STAX   D   ;PUT TO BUFF
0755   13                     INX   D   ;POINT NEXT
0756   C3 4E 07               JMP   INPU3   ;LOOP
0759   23           INPU4:    INX   H   ;SKIP TRAILING QUOTE
075A   EB                     XCHG      ;PUT ADDR TO H,L
075B   36 FE                  MVI   M,0FEH   ;MARK END
075D   CD B6 19               CALL   TERMO   ;GO PRINT PROMPT
0760   EB                     XCHG      ;GET H,L
0761   CF                     RST   1   ;SKIP TO NON BLANK
0762   FE 2C                  CPI   ","   ;TEST IF COMMA
0764   CA 6C 07               JZ   INPU5   ;BRIF IS
0767   FE 3B                  CPI   ";"   ;TEST IF COMMA
0769   C2 6D 07               JNZ   INPU6   ;BRIF NOT
076C   23           INPU5:    INX   H   ;SKIP IT
076D   CD 5B 18     INPU6:    CALL   GETS8   ;GO GET VAR ADDR
0770   E5                     PUSH   H   ;SAVE H ADDR
0771   D5                     PUSH   D   ;SAVE VAR ADDR
0772   2A 52 22               LHLD   ADDR1   ;GET ADDR PREV BUFFER
0775   7E                     MOV   A,M   ;LOAD CHAR
0776   FE 2C                  CPI   ","   ;TEST IF COMMA
0778   23                     INX   H   ;POINT NEXT
0779   CA 81 07               JZ   INPU7   ;BRIF CONTINUE FROM PREV
077C   3E 3F                  MVI   A,"?"   ;LOAD PROMPT
077E   CD 10 19               CALL   TERMI   ;GO READ FROM TTY
0781   CF           INPU7:    RST   1   ;SKIP SPACES
0782   79                     MOV   A,C   ;GET LO NAME
0783   B7                     ORA   A   ;TEST IT
0784   FA A8 07               JM   INPUA   ;BRIF STRING
0787   CD 3A 14               CALL   FIN   ;GO CONVERT TO FLOATING
078A   CF                     RST   1   ;SKIP SPACES
078B   FE 2C                  CPI   ","   ;TEST IF COMMA
078D   CA 94 07               JZ   INPU8   ;BRIF IS
0790   B7                     ORA   A   ;TEST IF END OF LINE
0791   C2 20 1C               JNZ   CVERR   ;BRIF ERROR
0794   22 52 22     INPU8:    SHLD   ADDR1   ;SAVE ADDRESS
0797   E1                     POP   H   ;GET VAR ADDR
0798   DF                     RST   3   ;GO STORE THE NUMBER
0799   E1           INPU9:    POP   H   ;RESTORE STMT POINTER
079A   7E                     MOV   A,M   ;GET CHAR
079B   FE 2C                  CPI   ","   ;TEST FOR COMMA
079D   23                     INX   H   ;POINT NEXT
079E   CA 3F 07               JZ   INPU1   ;RECDURSIVE IF COMMA
07A1   2B                     DCX   H   ;POINT BACK
07A2   CD 95 1A     INPUB:    CALL   EOL   ;ERROR IF NOT END OF LINE
07A5   C3 17 02               JMP   RUN   ;CONTINUE NEXT STMT
07A8   CD 19 18     INPUA:    CALL   GETST   ;GO GET THE STRING
07AB   22 52 22               SHLD   ADDR1   ;SAVE ADDRESS
07AE   C3 99 07               JMP   INPU9   ;CONTINUE
07B1                             ; 
07B1                INPL:     EQU   $   
07B1                             ; 
07B1                             ; 
07B1                             ; STMT: INPUT LINE A$
07B1                             ; 
07B1                             ; 
07B1   D1                     POP   D   ;DUMMY POP TO ADJUST STACK
07B2   CD CA 1B               CALL   VAR   ;GET STRING NAME
07B5   7B                     MOV   A,E   ;LOAD LO BYTE
07B6   B7                     ORA   A   ;TEST IT
07B7   F2 10 1C               JP   SNERR   ;BRIF NOT STRING VARIABLE
07BA   CD 35 1B               CALL   SEARC   ;ELSE, GET ADDRESS
07BD   D5                     PUSH   D   ;SAVE ON STACK
07BE   CD 95 1A               CALL   EOL   ;ERROR IF NOT END-OF-LINE
07C1   3E 01                  MVI   A,1   ;GET ON SETTING
07C3   32 74 20               STA   ILSW   ;SET INPUT LINE SWITCH
07C6   3E 3F                  MVI   A,"?"   ;LOAD PROMPT
07C8   CD 10 19               CALL   TERMI   ;GO READ A LINE
07CB   06 00                  MVI   B,0   ;INIT COUNT
07CD   11 21 21               LXI   D,STRIN+1   ;POINT STRING BUFFER
07D0   21 CF 20               LXI   H,IOBUF+1   ;POINT INPUT BUFFER
07D3   7E           INPL1:    MOV   A,M   ;GET NEXT BYTE
07D4   B7                     ORA   A   ;TEST IT
07D5   CA DF 07               JZ   INPL2   ;BRIF END
07D8   04                     INR   B   ;ADD TO COUNT
07D9   12                     STAX   D   ;PUT TO STRING BUFF
07DA   13                     INX   D   ;POINT NEXT
07DB   23                     INX   H   ;DITTO
07DC   C3 D3 07               JMP   INPL1   ;LOOP
07DF   32 74 20     INPL2:    STA   ILSW   ;RESET SWITCH
07E2   78                     MOV   A,B   ;GET COUNT
07E3   32 20 21               STA   STRIN   ;SET STRING LENGTH
07E6   E1                     POP   H   ;GET ADDRESS OF VARIABLE
07E7   CD 3D 06               CALL   LET2A   ;GO STORE THE STRING
07EA   C3 17 02               JMP   RUN   ;GO NEXT STMT
07ED                             ;PAGE
07ED                             ; 
07ED                READ:     EQU   $   
07ED                             ; 
07ED                             ; STMT: READ VAR [,VAR ...]
07ED                             ; 
07ED   CF                     RST   1   ;SKIP BLANKS
07EE   CD 5B 18               CALL   GETS8   ;GET VAR ADDR
07F1   E5                     PUSH   H   ;SAVE H,L
07F2   D5                     PUSH   D   ;SAVE D,E
07F3   2A 8F 22               LHLD   DATAP   ;GET DATA STMT POINTER
07F6   7E                     MOV   A,M   ;LOAD THE CHAR
07F7   B7                     ORA   A   ;TEST IF END OF STMT
07F8   C2 17 08               JNZ   READ2   ;BRIF NOT END OF STMT
07FB   23                     INX   H   ;POINT START NEXT STMT
07FC   7E           READ1:    MOV   A,M   ;LOAD LEN
07FD   22 8F 22               SHLD   DATAP   ;SAVE ADDR
0800   B7                     ORA   A   ;TEST IF END OF PGM
0801   CA 18 1C               JZ   DAERR   ;BRIF OUT OF DATA
0804   E7                     RST   4   ;ADJUST H,L
0805   03                     DB   3   
0806   11 9E 1E               LXI   D,DATAL   ;POINT "DATA"
0809   D7                     RST   2   ;COMPARE
080A   CA 17 08               JZ   READ2   ;BRIF IT IS DATA STMT
080D   2A 8F 22               LHLD   DATAP   ;GET ADDR START
0810   5E                     MOV   E,M   ;GET LEN CODE
0811   16 00                  MVI   D,0   ;CLEAR D
0813   19                     DAD   D   ;POINT NEXT STMT
0814   C3 FC 07               JMP   READ1   ;LOOP NEXT STMT
0817   CF           READ2:    RST   1   ;SKIP SPACES
0818   79                     MOV   A,C   ;LOAD LO NAME
0819   B7                     ORA   A   ;TEST IT
081A   FA 3F 08               JM   READ6   ;BRIF STRING
081D   CD 3A 14               CALL   FIN   ;GO CONVERT VALUE
0820   7E                     MOV   A,M   ;GET CHAR WHICH STOPPED US
0821   FE 2C                  CPI   ","   ;TEST IF COMMA
0823   C2 38 08               JNZ   READ5   ;BRIF NOT
0826   23                     INX   H   ;POINT NEXT
0827   22 8F 22     READ3:    SHLD   DATAP   ;SAVE ADDRESS
082A   E1                     POP   H   ;RESTORE ADDR OF VAR
082B   DF                     RST   3   ;STORE THE VALUE
082C   E1           READ4:    POP   H   ;RESTORE POINTER TO STM
082D   7E                     MOV   A,M   ;GET THE CHAR
082E   FE 2C                  CPI   ","   ;TEST IF COMMA
0830   23                     INX   H   ;POINT NEXT
0831   CA ED 07               JZ   READ   ;RECURSIVE IF IT IS
0834   2B                     DCX   H   ;RESET
0835   C3 A2 07               JMP   INPUB   ;CONTINUE
0838   B7           READ5:    ORA   A   ;TEST IF END OF STMT
0839   CA 27 08               JZ   READ3   ;BRIF OK
083C   C3 20 1C               JMP   CVERR   ;GO PROCESS ERROR
083F   CD 19 18     READ6:    CALL   GETST   ;GO GET STRING
0842   7E                     MOV   A,M   ;GET CHAR
0843   FE 2C                  CPI   ","   ;TEST IF COMMA
0845   CA 4F 08               JZ   READ7   ;BRIF IS
0848   B7                     ORA   A   ;TEST IF END
0849   C2 38 08               JNZ   READ5   ;BRIF NOT
084C   C3 50 08               JMP   READ8   ;GO AROUND
084F   23           READ7:    INX   H   ;POINT PAST
0850   22 8F 22     READ8:    SHLD   DATAP   ;SAVE ADDRESS
0853   C3 2C 08               JMP   READ4   ;CONTINUE
0856                             ; 
0856                OUTP:     EQU   $   
0856                             ; 
0856                             ; STMT; OUT ADDR,VALUE
0856                             ; 
0856                             ; 
0856   CD 8C 0F               CALL   EXPR   ;GO EVALUATE ADDRESS
0859   7E                     MOV   A,M   ;GET DELIM
085A   FE 2C                  CPI   ","   ;TEST IF COMMA
085C   C2 10 1C               JNZ   SNERR   ;BRIF NOT
085F   23                     INX   H   ;SKIP OVER COMMA
0860   CD 67 1C               CALL   FBIN   ;CONVERT TO BINARY IN A-REG
0863   11 20 22               LXI   D,OUTA   ;POINT INSTR
0866   EB                     XCHG      ;PUT TO H,L
0867   36 D3                  MVI   M,0D3H   ;OUT INSTR
0869   23                     INX   H   ;POINT NEXT
086A   77                     MOV   M,A   ;PUT ADDR
086B   23                     INX   H   ;POINT NEXT
086C   36 C9                  MVI   M,0C9H   ;RET INSTR
086E   EB                     XCHG      ;RESTORE ORIG H,L
086F   CD 8C 0F               CALL   EXPR   ;GO EVAL DATA BYTE
0872   CD 95 1A               CALL   EOL   ;ERROR IF NOT END OF STATEMENT
0875   CD 67 1C               CALL   FBIN   ;CONVERT TO BINARY
0878   CD 20 22               CALL   OUTA   ;GO PUT THE BYTE
087B   C3 17 02               JMP   RUN   ;GO NEXT STMT
087E                             ;PAGE
087E                             ; 
087E                STOP:     EQU   $   
087E                             ; 
087E                             ; STMT: STOP
087E                             ; 
087E                             ; 
087E   CD 95 1A               CALL   EOL   ;POINT END OF LINE
0881   21 30 1E               LXI   H,STOPM   ;POINT MESSAGE: "STOP AT LINE "
0884   CD BE 19               CALL   TERMM   ;GO WRITE IT
0887   CD F2 1B               CALL   PRLIN   ;GO PRINT LINE NUMBER
088A   3A 75 20               LDA   RUNSW   ;GET RUN TYPE
088D   B7                     ORA   A   ;TEST IT
088E   C2 CF 00               JNZ   RDY   ;BRIF IMMED
0891   32 74 22               STA   MULTI   ;CLEAR MULTI SW
0894   2A 70 22               LHLD   STMT   ;GET ADDR OF PREV STMT
0897   5E                     MOV   E,M   ;GET LEN
0898   16 00                  MVI   D,0   ;CLEAR HI BYTE
089A   19                     DAD   D   ;POINT NEXT
089B   23                     INX   H   ;POINT LINE NUMBER
089C   22 89 22               SHLD   LINE   ;SAVE ADDR
089F   11 77 20               LXI   D,LINEN   ;POINT AREA
08A2   CD 0A 1A               CALL   LINEO   ;GO CONVERT LINE NUMBER
08A5   EB                     XCHG      ;FLIP TO H,L
08A6   36 00                  MVI   M,0   ;MARK END
08A8   C3 CF 00               JMP   RDY   ;GO TO READY MSG
08AB                             ; 
08AB                RANDO:    EQU   $   
08AB                             ; 
08AB                             ; 
08AB                             ; STMT: RANDOMIZE
08AB                             ; 
08AB                             ; 
08AB   CD 95 1A               CALL   EOL   ;ERROR IF NOT END-OF-LINE
08AE   3E 01                  MVI   A,1   ;LOAD A ONE
08B0   32 87 22               STA   RNDSW   ;SET SWITCH = TRUE RANDOM
08B3   11 7F 22               LXI   D,TRNDX   ;POINT "TRUE" RANDOM NUMBERS
08B6   21 77 22               LXI   H,RNDX   ;POINT RECEIVE
08B9   06 08                  MVI   B,8   ;LOOP CTR
08BB   CD 4E 1C               CALL   COPYD   ;GO MOVE IT
08BE   C3 17 02               JMP   RUN   ;CONTINUE
08C1                             ; 
08C1                ON:       EQU   $   
08C1                             ; 
08C1                             ; 
08C1                             ; STMT: ON EXPR GOTO NNN NNNN NNNN
08C1                             ;               GOSUB
08C1                             ; 
08C1                             ; 
08C1   CD 8C 0F               CALL   EXPR   ;GO EVALUATE EXPRESSION
08C4   CD 67 1C               CALL   FBIN   ;GET BINARY NUMBER IN ACC
08C7   B7                     ORA   A   ;TEST RESULT
08C8   CA 10 1C               JZ   SNERR   ;BRIF ZERO (ERROR)
08CB   4F                     MOV   C,A   ;SAVE VALUE
08CC   0D                     DCR   C   ;LESS ONE
08CD   AF                     XRA   A   ;GET A ZERO
08CE   32 25 22               STA   REL   ;TURN OFF SWITCH
08D1   11 D3 1E               LXI   D,GOTOL   ;POINT LITERAL
08D4   E5                     PUSH   H   ;SAVE H,L ADDRESS
08D5   D7                     RST   2   ;GO COMPARE
08D6   CA E7 08               JZ   ON3   ;BRIF ON...GOTO
08D9   E1                     POP   H   ;ELSE, RESTORE H,L
08DA   11 B2 1E               LXI   D,GOSBL   ;POINT LITERAL
08DD   D7                     RST   2   ;GO COMPARE
08DE   C2 10 1C               JNZ   SNERR   ;BRIF ERROR
08E1   3E 01                  MVI   A,1   ;GET ON SETTING
08E3   32 25 22               STA   REL   ;SET SWITCH
08E6   E5                     PUSH   H   ;DUMMY PUSH
08E7   D1           ON3:      POP   D   ;ADJUST STACK
08E8   79           ON3A:     MOV   A,C   ;GET COUNT
08E9   B7                     ORA   A   ;TEST IT
08EA   CA 09 09               JZ   ON6   ;BRIF VALUE 1
08ED   CF                     RST   1   ;ELSE, SKIP BLANKS
08EE   B7                     ORA   A   ;TEST IF END OF LINE
08EF   CA 10 1C               JZ   SNERR   ;BRIF IS
08F2   FE 2C                  CPI   ","   ;TEST IS COMMA
08F4   C2 FB 08               JNZ   ON4   ;BRIF NOT
08F7   23                     INX   H   ;SKIP COMMA
08F8   C3 E8 08               JMP   ON3A   ;CONTINUE
08FB   CD 2B 1B     ON4:      CALL   NUMER   ;GO TEST IF NUMERIC
08FE   C2 05 09               JNZ   ON5   ;BRIF NOT
0901   23                     INX   H   ;POINT NEXT
0902   C3 FB 08               JMP   ON4   ;LOOP
0905   0D           ON5:      DCR   C   ;SUB ONE FROM COUNT
0906   C2 E8 08               JNZ   ON3A   ;LOOP TILL JUST BEFORE STMT#
0909   CD AE 1A     ON6:      CALL   NOTEO   ;ERROR IF NOT END-OF-LINE
090C   FE 2C                  CPI   ","   ;TEST IF COMMA
090E   C2 15 09               JNZ   ON7   ;BRIF NOT
0911   23                     INX   H   ;POINT NEXT
0912   C3 09 09               JMP   ON6   ;LOOP
0915   CD 2B 1B     ON7:      CALL   NUMER   ;TEST IF NUMERIC
0918   C2 10 1C               JNZ   SNERR   ;BRIF NOT
091B   CD B6 1A               CALL   PACK   ;GET THE LINE NUMBER
091E   7E           ON8:      MOV   A,M   ;GET NEXT CHAR
091F   CD A9 1A               CALL   TSTEL   ;TEST IF END STMT
0922   CA 29 09               JZ   ON9   ;BRIF END
0925   23                     INX   H   ;POINT NEXT
0926   C3 1E 09               JMP   ON8   ;LOOP
0929   CD 95 1A     ON9:      CALL   EOL   ;SET END OF LINE POINTERS
092C   3A 25 22               LDA   REL   ;GET TYPE (GOTO OR GOSUB)
092F   B7                     ORA   A   ;TEST IT
0930   C2 4F 03               JNZ   GOSU1   ;BRIF GOSUB
0933   C3 12 03               JMP   GOTO2   ;BR TO GOTO LOOKUP
0936                             ;PAGE
0936                             ; 
0936                CHANG:    EQU   $   
0936                             ; 
0936                             ; STATEMENT: CHANGE A$ TO X     - OR -
0936                             ; 
0936                             ;            CHANGE X TO A$
0936                             ; 
0936   CD CA 1B               CALL   VAR   ;NEXT WORD MUST BE VAR
0939   7B                     MOV   A,E   ;TEST TYPE
093A   B7                     ORA   A   ;SET FLAGS
093B   F2 74 09               JP   CHA2   ;BRIF NOT-STRING
093E   CD 35 1B               CALL   SEARC   ;GET ADDR
0941   D5                     PUSH   D   ;SAVE IT
0942   11 D5 1E               LXI   D,TOLIT   ;POINT "TO"
0945   D7                     RST   2   ;COMPARE
0946   C2 10 1C               JNZ   SNERR   ;BRIF ERROR
0949   CD CA 1B               CALL   VAR   ;GET NEXT VARIABLE
094C   7A                     MOV   A,D   ;GET HI NAME
094D   F6 80                  ORI   80H   ;SET MASK FOR ARRAY
094F   57                     MOV   D,A   ;REPLACE
0950   CD 35 1B               CALL   SEARC   ;GET ADDRESS
0953   E7                     RST   4   ;POINT START OF ELEMENT 0,0
0954   F5                     DB   -11   ; AND 0FFH
0955   D1                     POP   D   ;GET PTR TO STMT
0956   EB                     XCHG      ;FLIP
0957   CD 95 1A               CALL   EOL   ;NEXT MUST BE E-O-L
095A   EB                     XCHG      ;FLIP AGAIN
095B   D1                     POP   D   ;GET ADDR STRING
095C   1A                     LDAX   D   ;GET COUNT
095D   47                     MOV   B,A   ;SAVE IT
095E   04                     INR   B   ;BUMP
095F   C5           CHA1:     PUSH   B   ;SAVE CTR
0960   D5                     PUSH   D   ;SAVE ADDR STRING
0961   E5                     PUSH   H   ;SAVE ADDR NUM
0962   CD 26 0D               CALL   FDEC   ;CONVERT TO F.P.
0965   E1                     POP   H   ;GET ADDR
0966   DF                     RST   3   ;STORE IT
0967   E7                     RST   4   ;POINT TO NEXT
0968   F8                     DB   -8   ; AND 0FFH
0969   D1                     POP   D   ;RESTORE STRING
096A   C1                     POP   B   ;AND CTR
096B   13                     INX   D   ;POINT NEXT CHAR
096C   1A                     LDAX   D   ;LOAD IT
096D   05                     DCR   B   ;DECR CTR
096E   C2 5F 09               JNZ   CHA1   ;LOOP
0971   C3 17 02               JMP   RUN   
0974                             ; 
0974                             ; 
0974   7A           CHA2:     MOV   A,D   ;GET HI NAME
0975   F6 80                  ORI   80H   ;MAKE ARRAY NAME
0977   57                     MOV   D,A   ;SAVE
0978   CD 35 1B               CALL   SEARC   ;GET ADDR
097B   E7                     RST   4   ;POINT ELEMENT 0,0
097C   F5                     DB   -11   ; AND 0FFH
097D   E3                     XTHL      ;SAVE ON STACK
097E   11 D5 1E               LXI   D,TOLIT   ;POINT "TO"
0981   D7                     RST   2   ;COMPARE
0982   C2 10 1C               JNZ   SNERR   ;BRIF ERROR
0985   CD CA 1B               CALL   VAR   ;GET NAME
0988   7B                     MOV   A,E   ;GET TYPE
0989   B7                     ORA   A   ;SET FLAGS
098A   F2 10 1C               JP   SNERR   ;BRIF NOT STRING
098D   CD 95 1A               CALL   EOL   ;BRIF NOT E-O-L
0990   CD 35 1B               CALL   SEARC   ;GET ADDR
0993   E1                     POP   H   ;GET ADDR VAR
0994   D5                     PUSH   D   ;SAVE D,E
0995   11 20 21               LXI   D,STRIN   ;POINT STRING BUFFER
0998   D5                     PUSH   D   ;SAVE IT
0999   EF                     RST   5   ;LOAD IT
099A   E7                     RST   4   ;POINT NEXT
099B   F8                     DB   -8   ; AND 0FFH
099C   E5                     PUSH   H   ;SAVE H,L
099D   CD 67 1C               CALL   FBIN   ;CONVERT
09A0   E1                     POP   H   ;RESTORE
09A1   D1                     POP   D   ;DITTO
09A2   47                     MOV   B,A   ;SAVE COUNT
09A3   04                     INR   B   ;BUMP IT
09A4   12           CHA3:     STAX   D   ;PUT TO STRING
09A5   13                     INX   D   ;POINT NEXT STR LOC.
09A6   C5                     PUSH   B   ;SAVE CTRS
09A7   D5                     PUSH   D   ;AND AD^DR
09A8   EF                     RST   5   ;LOAD NEXT
09A9   E7                     RST   4   ;POINT NEXT
09AA   F8                     DB   -8   ;  AND 0FFH
09AB   E5                     PUSH   H   ;AND H ADDR
09AC   CD 67 1C               CALL   FBIN   ;CONVERT
09AF   E1                     POP   H   ;RESTORE H,L
09B0   D1                     POP   D   ;AND D,E
09B1   C1                     POP   B   ;AND CTRS
09B2   05                     DCR   B   ;DECR CTR
09B3   C2 A4 09               JNZ   CHA3   ;LOOP
09B6   E1                     POP   H   ;GET ADDR OF VAR (STRING)
09B7   CD 3D 06               CALL   LET2A   ;GO STORE IT
09BA   C3 17 02               JMP   RUN   ;CONTINUE
09BD                             ;PAGE
09BD                             ; 
09BD                DIM:      EQU   $   
09BD                             ; 
09BD                             ; STMT: DIM VAR(A,B),...
09BD                             ; 
09BD                             ; 
09BD   CD CA 1B               CALL   VAR   ;GO GET VAR NAME
09C0   F2 10 1C               JP   SNERR   ;BRIF NO (
09C3   CD 35 1B               CALL   SEARC   ;GO LOCATE THE VAR
09C6   E3                     XTHL      ;PUT ADDR IN STACK, GET PTR TO (
09C7   F5                     PUSH   PSW   ;SAVE STATUS
09C8   3E FF                  MVI   A,0FFH   ;TURN ON SW
09CA   32 72 20               STA   DIMSW   ;SET IT
09CD   CD 8C 0F               CALL   EXPR   ;GO EVALUATE
09D0   F1                     POP   PSW   ;GET STATUS
09D1   E3                     XTHL      ;SWAP PTRS
09D2   D5                     PUSH   D   ;SAVE ROW NUMBER
09D3   C5                     PUSH   B   ;SAVE COL NUMBER
09D4   03                     INX   B   ;INCREMENT COLUMNS
09D5   13                     INX   D   ;AND ROWS
09D6   E5                     PUSH   H   ;SAVE H,L
09D7   F5                     PUSH   PSW   ;RESAVE STATUS
09D8   21 00 00               LXI   H,0   ;GET A ZERO
09DB   19           DIM1:     DAD   D   ;TIMES ONE
09DC   0B                     DCX   B   ;DCR COLS
09DD   78                     MOV   A,B   ;GET HI
09DE   B1                     ORA   C   ;PLUS LO
09DF   C2 DB 09               JNZ   DIM1   ;LOOP
09E2   F1                     POP   PSW   ;GET STATUS
09E3   D1                     POP   D   ;GET ADDRESS
09E4   29                     DAD   H   ;TIMES TWO
09E5   29                     DAD   H   ;TIMES FOUR
09E6   01 08 00               LXI   B,8   ;PLUS 2 (NAME AND DISP)
09E9   FA 29 0A               JM   REDIM   ;GO RE-DIMENSION
09EC   E5                     PUSH   H   ;SAVE PRODUCT
09ED   09                     DAD   B   ;ADD IT
09EE   EB                     XCHG      ;FLIP/FLOP
09EF   2B                     DCX   H   ;POINT LO NAME
09F0   2B                     DCX   H   ;POINT HI DISP
09F1   7B                     MOV   A,E   ;GET LO
09F2   2F                     CMA      ;COMPLEMENT
09F3   C6 01                  ADI   1   ;PLUS ONE
09F5   5F                     MOV   E,A   ;RESTORE
09F6   7A                     MOV   A,D   ;GET HI
09F7   2F                     CMA      ;COMPLEMENT
09F8   CE 00                  ACI   0   ;PLUS CARRY
09FA   77                     MOV   M,A   ;STORE IT
09FB   2B                     DCX   H   ;POINT NEXT
09FC   73                     MOV   M,E   ;STORE LO
09FD   EB                     XCHG      ;SAVE IN D,E
09FE   E1                     POP   H   ;GET PRODUCT
09FF   44                     MOV   B,H   ;COPY H,L
0A00   4D                     MOV   C,L   ;TO B,C
0A01   EB                     XCHG      ;GET LOCAT
0A02   D1                     POP   D   ;GET COLUMNS
0A03   2B                     DCX   H   ;POINT NEXT
0A04   72                     MOV   M,D   ;MOVE LO COL
0A05   2B                     DCX   H   ;POINT NEXT
0A06   73                     MOV   M,E   ;MOVE HI COL
0A07   D1                     POP   D   ;GET ROWS
0A08   2B                     DCX   H   ;POINT NEXT
0A09   72                     MOV   M,D   ;MOVE HI ROW
0A0A   2B                     DCX   H   ;POINT NEXT
0A0B   73                     MOV   M,E   ;MOVE LO ROW
0A0C   2B                     DCX   H   ;POINT NEXT
0A0D   36 00        DIM2:     MVI   M,0   ;CLEAR ONE BYTE
0A0F   2B                     DCX   H   ;POINT NEXT
0A10   0B                     DCX   B   ;DECR CTR
0A11   78                     MOV   A,B   ;GET HI
0A12   B1                     ORA   C   ;PLUS LO
0A13   C2 0D 0A               JNZ   DIM2   ;LOOP
0A16   36 00                  MVI   M,0   ;MARK END
0A18   E1           DIM3:     POP   H   ;GET PTR TO STMT
0A19   7E                     MOV   A,M   ;LOAD CHAR
0A1A   FE 2C                  CPI   ","   ;TEST IF COMMA
0A1C   C2 23 0A               JNZ   DIM4   ;BRIF NOT
0A1F   23                     INX   H   ;SKIP IT
0A20   C3 BD 09               JMP   DIM   ;CONTINUE
0A23   CD 95 1A     DIM4:     CALL   EOL   ;TEST END OF LINE
0A26   C3 17 02               JMP   RUN   ;CONTINUE WITH PROGRAM
0A29   09           REDIM:    DAD   B   ;COMPUTE LEN TO NEXT
0A2A   1B                     DCX   D   ;POINT LO NAME
0A2B   1B                     DCX   D   ;POINT HI DISP
0A2C   1A                     LDAX   D   ;GET IT
0A2D   47                     MOV   B,A   ;SAVE
0A2E   1B                     DCX   D   ;POINT LO DISP
0A2F   1A                     LDAX   D   ;GET IT
0A30   4F                     MOV   C,A   ;SAVE
0A31   09                     DAD   B   ;COMPUTE DIFF OR PRIOR DIM AND THIS
0A32   7C                     MOV   A,H   ;GET HI DIFF
0A33   B7                     ORA   A   ;TEST IT
0A34   FA 3F 0A               JM   REDM1   ;BRIF PREV > NEW
0A37   C2 10 1C               JNZ   SNERR   ;BRIF PREV < NEW
0A3A   7D                     MOV   A,L   ;GET LO DIFF
0A3B   B7                     ORA   A   ;TEST IT
0A3C   C2 10 1C               JNZ   SNERR   ;BRIF PREV < NEW
0A3F   EB           REDM1:    XCHG      ;PUT ADDR IN H,L
0A40   2B                     DCX   H   ;POINT HI COL
0A41   D1                     POP   D   ;GET COL
0A42   72                     MOV   M,D   ;MOVE HI
0A43   2B                     DCX   H   ;POINT LO COL
0A44   73                     MOV   M,E   ;MOVE LO
0A45   D1                     POP   D   ;GET ROW
0A46   2B                     DCX   H   ;POINT HI ROW
0A47   72                     MOV   M,D   ;MOVE HI
0A48   2B                     DCX   H   ;POINT LO ROW
0A49   73                     MOV   M,E   ;MOVE LO
0A4A   C3 18 0A               JMP   DIM3   ;CONTINUE
0A4D                             ;PAGE
0A4D                             ; 
0A4D                SIN:      EQU   $   
0A4D                             ; 
0A4D                             ; COMPUTE SINE OF X, (X IN RADIANS)
0A4D                             ; 
0A4D                             ; USES 4TH DEGREE POLYNOMIAL APPROXIMATION
0A4D                             ; 
0A4D                             ; 
0A4D                             ; FIRST, REDUCE ANGLE TO RANGE: (-PI/2,PI/2)
0A4D                             ; 
0A4D   CD DA 18               CALL   FTEST   ;GET STATUS OF ANGLE
0A50   C8                     RZ      ;SIN(0)=0
0A51   F5                     PUSH   PSW   ;SAVE SIGN OF ANGLE
0A52   CD D3 0B               CALL   ABS   
0A55   F1           SIN1:     POP   PSW   ;COMPLEMENT SIGN FOR EACH PI SUB'D
0A56   2F                     CMA      ;..
0A57   F5                     PUSH   PSW   ;..
0A58   21 A5 1D               LXI   H,PI   ;REDUCE TO -PI<X<0
0A5B   CD 18 17               CALL   FSUB   
0A5E   F2 55 0A               JP   SIN1   
0A61   21 D9 1D               LXI   H,HALFP   ;NOW ADD PI FOR -PI<X<-PI/2
0A64   E5                     PUSH   H   
0A65   CD 43 16               CALL   FADD   
0A68   F4 86 0C               CP   NEG   ;AND JUST NEGATE FOR -PI/2<X<0
0A6B   E1                     POP   H   
0A6C   CD 43 16               CALL   FADD   
0A6F   F1                     POP   PSW   ;RESTORE SIGN
0A70   B7                     ORA   A   
0A71   F4 86 0C               CP   NEG   
0A74                             ; 
0A74                             ; INIT REGISTERS
0A74                             ; 
0A74   21 2F 22               LXI   H,TEMP1   ;POINT IT
0A77   DF                     RST   3   ;SAVE IT
0A78   3A 58 22               LDA   FACC   ;GET SIGN&EXPONENT
0A7B   CD E8 18               CALL   FEXP   ;EXPAND EXPON.
0A7E   F2 84 0A               JP   SIN3A   ;BRIF POSITIVE
0A81   FE FD                  CPI   0FDH   ;TEST EXPONENT
0A83   D8                     RC      ;RETURN IF VERY SMALL RADIAN
0A84                             ; 
0A84                             ; ABOVE ROUTINE WILL APPROX SIN(X) == X FOR X: (-.06,.06)
0A84                             ; 
0A84   21 D9 1D     SIN3A:    LXI   H,HALFP   ;POINT PI/2
0A87   CD A7 17               CALL   FDIV   ;COMPUTE X/PI/2
0A8A   21 33 22               LXI   H,TEMP2   ;POINT T2
0A8D   DF                     RST   3   ;STORE IT
0A8E   21 33 22               LXI   H,TEMP2   ;POINT BACK
0A91   CD 24 17               CALL   FMUL   ;COMPUTE SQUARE
0A94   21 E9 1D               LXI   H,SINCO   ;POINT CONSTANTS
0A97                             ; 
0A97                             ; EVALUATE POWER SERIES
0A97                             ; 
0A97                             ; EVALUATE STARTING FROM HIGH ORDER COEFFICIENT:
0A97                             ;  F(X)=(...(CN*FACC+C(N-1))*FACC+...+C1)*FACC*TEMP2+TEMP1
0A97                             ; 
0A97                             ;ON ENTRY:
0A97                             ;       TEMP1=CONSTANT TERM
0A97                             ;       TEMP2=X OR 1
0A97                             ;       FACC=X^2 OR X
0A97                             ;       (HL)=COEFFICIENT OF LAST TERM
0A97                             ; 
0A97   E5           EVPS:     PUSH   H   ;SAVE POINTER TO COEFFICIENTS
0A98   21 37 22               LXI   H,TEMP3   ;SAVE FACC
0A9B   DF                     RST   3   
0A9C   E1                     POP   H   ;RESTORE H
0A9D   E5                     PUSH   H   
0A9E   C3 A8 0A               JMP   EVPS2   
0AA1   E5           EVPS1:    PUSH   H   ;SAVE PTR TO NEXT COEFFICIENT
0AA2   CD 43 16               CALL   FADD   ;FACC+CN->FACC
0AA5   21 37 22               LXI   H,TEMP3   ;POINTER TO X^N
0AA8   CD 24 17     EVPS2:    CALL   FMUL   ;FACC*X^N->FACC
0AAB   E1                     POP   H   ;COEFFICENT PTR
0AAC   E7                     RST   4   ;MOVE TO NEXT COEFFICIENT
0AAD   FC                     DB   -4   ; AND 0FFH
0AAE   7E                     MOV   A,M   ;GET EXPONENT
0AAF   3D                     DCR   A   ;TEST FOR 1
0AB0   C2 A1 0A               JNZ   EVPS1   ;BRIF NOT 1
0AB3   21 33 22               LXI   H,TEMP2   ;MUL BY TEMP2
0AB6   CD 24 17               CALL   FMUL   
0AB9   21 2F 22               LXI   H,TEMP1   ;POINT TO CONSTANT TERM
0ABC   C3 43 16               JMP   FADD   ;ADD IT AND RETURN TO CALLER
0ABF                             ; 
0ABF                COS:      EQU   $   
0ABF                             ; 
0ABF                             ; 
0ABF                             ; COMPUTE COSINE OF ANGLE, X EXPRESSED IN RADIANS
0ABF                             ; USES THE TRANSFORMATION: Y = PI/2 +- X
0ABF                             ;     AND THEN COMPUTES SIN(Y).
0ABF                             ; 
0ABF                             ; 
0ABF   21 D9 1D               LXI   H,HALFP   ;COMPUTE PI/2 + X
0AC2   CD 43 16               CALL   FADD   ;GO ADD
0AC5   C3 4D 0A               JMP   SIN   ;GO COMPUTE SINE
0AC8                             ; 
0AC8                TAN:      EQU   $   
0AC8                             ; 
0AC8                             ; COMPUTE TANGENT OF X, IN RADIANS
0AC8                             ; USES THE RELATION:
0AC8                             ; 
0AC8                             ;          SIN(X)
0AC8                             ; TAN(X) = ------
0AC8                             ;          COS(X)
0AC8                             ; 
0AC8   21 3B 22               LXI   H,TEMP4   ;POINT SAVE AREA
0ACB   DF                     RST   3   ;SAVE ANGLE
0ACC   CD BF 0A               CALL   COS   ;COMPUTE COS(X)
0ACF   21 47 22               LXI   H,TEMP7   ;SAVE COS(X)->TEMP7
0AD2   DF                     RST   3   
0AD3   21 3B 22               LXI   H,TEMP4   ;MOVE X->FACC
0AD6   EF                     RST   5   
0AD7   CD 4D 0A               CALL   SIN   ;COMPUTE SINE
0ADA   21 47 22               LXI   H,TEMP7   ;POINT COS
0ADD   C3 A7 17               JMP   FDIV   ;DIVIDE AND RETURN TO CALLER
0AE0                             ; 
0AE0                ATN:      EQU   $   
0AE0                             ; 
0AE0                             ; COMPUTES THE ARCTANGENT OF X
0AE0                             ; USES A SEVENTH DEGREE POLYNOMIAL APPROXIMATION
0AE0                             ; 
0AE0   CD DA 18               CALL   FTEST   ;CHECK SIGN OF ARGUMENT
0AE3   F2 EF 0A               JP   ATN1   ;BRIF POSITIVE
0AE6   CD 86 0C               CALL   NEG   ;REVERSE SIGN
0AE9   CD EF 0A               CALL   ATN1   ;GET POSITIVE ATN
0AEC   C3 86 0C               JMP   NEG   ;MAKE NEG & RETURN
0AEF                             ; 
0AEF   21 ED 1D     ATN1:     LXI   H,ONE   ;POINT: 1
0AF2   CD 43 16               CALL   FADD   ;GO ADD
0AF5   21 2F 22               LXI   H,TEMP1   ;POINT SAVE
0AF8   DF                     RST   3   ;STORE
0AF9   21 9D 1D               LXI   H,TWO   ;POINT: 2
0AFC   CD 18 17               CALL   FSUB   ;GO SUBTRACT
0AFF   21 2F 22               LXI   H,TEMP1   ;POINT SAVED
0B02   CD A7 17               CALL   FDIV   ;DIVIDE
0B05   21 33 22               LXI   H,TEMP2   ;POINT SAVE
0B08   DF                     RST   3   ;SAVE X'=(X-1)/(X+1)
0B09   21 A9 1D               LXI   H,QTRPI   ;X'+PI/4 -> TEMP1
0B0C   CD 43 16               CALL   FADD   
0B0F   21 2F 22               LXI   H,TEMP1   
0B12   DF                     RST   3   
0B13   E5                     PUSH   H   ;SAVE PTR TO TEMP2
0B14   EF                     RST   5   ;LOAD IT
0B15   E1                     POP   H   
0B16   CD 24 17               CALL   FMUL   ;FACC=X"*X"
0B19   21 D5 1D               LXI   H,ATNCO   ;POINT LIST COEFFICIENTS
0B1C   C3 97 0A               JMP   EVPS   ;GO COMPUTE & RETURN
0B1F                             ; 
0B1F                LN:       EQU   $   
0B1F                             ; 
0B1F                             ; 
0B1F                             ; COMPUTES THE NATRUAL LOGRITHM, LN(X)
0B1F                             ; USES A 7TH DEGREE POLYNOMIAL APPROXIMATION
0B1F                             ; 
0B1F   CD DA 18               CALL   FTEST   ;TEST THE ARGUMENT
0B22   FA 08 1C               JM   ZMERR   ;LN(-X)=NO NO
0B25   CA 08 1C               JZ   ZMERR   ;LN(0)=NO NO ALSO
0B28   21 33 22               LXI   H,TEMP2   ;POINT SAVE AREA
0B2B   DF                     RST   3   ;STORE IT
0B2C   3A 58 22               LDA   FACC   ;GET EXPON
0B2F   CD E8 18               CALL   FEXP   ;EXPAND TO 8 BITS
0B32   CA 38 0B               JZ   LN0   ;BRIF 0.5 < X < 1.0
0B35   F2 44 0B               JP   LN1   ;BRIF POSITIVE EXPONENT
0B38   2F           LN0:      CMA      ;ELSE COMPLIMENT
0B39   C6 02                  ADI   2   ;PLUS TWO
0B3B   CD 26 0D               CALL   FDEC   ;CONVERT TO FLOAT POINT
0B3E   CD 86 0C               CALL   NEG   ;THEN NEGATE
0B41   C3 49 0B               JMP   LN2   ;GO AROUND
0B44   DE 01        LN1:      SBI   1   ;MINUS ONE
0B46   CD 26 0D               CALL   FDEC   ;CONVERT TO FLOATING POINT
0B49   21 B1 1D     LN2:      LXI   H,LN2C   ;POINT LN(2)
0B4C   CD 24 17               CALL   FMUL   ;MULTIPLY
0B4F   21 2F 22               LXI   H,TEMP1   ;POINT SAVE AREA
0B52   DF                     RST   3   ;STORE IT
0B53   EF                     RST   5   ;GET ORIG X
0B54   3E 01                  MVI   A,1   ;GET EXPONENT: 1
0B56   32 58 22               STA   FACC   ;ADJUST TO RANGE (1,2)
0B59   21 ED 1D               LXI   H,ONE   ;POINT 1
0B5C   E5                     PUSH   H   ;SAVE PTR TO ONE
0B5D   CD 18 17               CALL   FSUB   ;SUBTRACT ONE
0B60   D1                     POP   D   ;SET TEMP2=1
0B61   21 33 22               LXI   H,TEMP2   
0B64   CD 4C 1C               CALL   CPY4D   
0B67   21 09 1E               LXI   H,LNCO   ;POINT COEFFICIENTS
0B6A   C3 97 0A               JMP   EVPS   ;APPROXIMATE & RETURN
0B6D                             ; 
0B6D                             ; X=LOG(X) --- THIS IS LOG BASE 10.
0B6D                             ; 
0B6D                LOG:      EQU   $   
0B6D   CD 1F 0B               CALL   LN   ;COMPUTE NATURAL LOG
0B70   21 25 1E               LXI   H,LNC   ;POINT LOG(E)
0B73   C3 24 17               JMP   FMUL   ;MULTIPLY AND RETURN
0B76                             ; 
0B76                EXP:      EQU   $   
0B76                             ; 
0B76                             ;  COMPUTES EXP(X) USING ALGORITHM EXP(X)=(2^I)*(2^FP) WHERE
0B76                             ;  2^I=INT(X*LN BASE 2 OF E) AND,
0B76                             ;  2^FP=5TH DEGREE POLY. APPROXIMATION
0B76                             ;  FP=FRACTIONAL PART OF INT(X*LN2E)
0B76                             ; 
0B76   CD DA 18               CALL   FTEST   ;CHECK SIGN
0B79   F2 90 0B               JP   EXP1   ;BRIF POSITIVE
0B7C   CD 86 0C               CALL   NEG   ;ELSE, REVERSE SIGN
0B7F   CD 90 0B               CALL   EXP1   ;COMPUTE POSITIVE EXP
0B82   21 2F 22               LXI   H,TEMP1   ;POINT SAVE AREA
0B85   DF                     RST   3   ;STORE IT
0B86   21 ED 1D               LXI   H,ONE   ;POINT 1
0B89   EF                     RST   5   ;LOAD IT
0B8A   21 2F 22               LXI   H,TEMP1   ;POINT PREV
0B8D   C3 A7 17               JMP   FDIV   ;RECIPRICAL AND RETURN
0B90                             ; 
0B90   21 0D 1E     EXP1:     LXI   H,LN2E   ;POINT LN BASE 2 OF E
0B93   CD 24 17               CALL   FMUL   ;FACC=X*(LN2E)
0B96   21 37 22               LXI   H,TEMP3   ;POINT SAVE AREA
0B99   DF                     RST   3   ;TEMP3=X*LN2E
0B9A   CD EE 0B               CALL   INT   ;FACC=INT(X*LN2E)
0B9D   21 3B 22               LXI   H,TEMP4   ;POINT SAVE AREA
0BA0   DF                     RST   3   ;TEMP4=INT(X*LN2E)
0BA1   DF                     RST   3   ;DITTO FOR TEMP5
0BA2   3A 58 22               LDA   FACC   ;GET THE EXPONENT COUNT
0BA5   47                     MOV   B,A   ;SAVE COUNT IN B
0BA6   3A 59 22               LDA   FACC+1   ;GET MANTISSA
0BA9   07           ELOOP:    RLC      ;ROTATE LEFT
0BAA   05                     DCR   B   ;REDUCE COUNT
0BAB   C2 A9 0B               JNZ   ELOOP   ;CONTINUE SHIFTING
0BAE   3C                     INR   A   ;ADJUST EXPONENT
0BAF   32 3B 22               STA   TEMP4   ;STORE EXPONENT
0BB2   3E 80                  MVI   A,80H   ;LOAD CONSTANT
0BB4   32 3C 22               STA   TEMP4+1   ;STORE AS MANTISSA
0BB7   21 ED 1D               LXI   H,ONE   ;1 -> TEMP1, TEMP2
0BBA   EF                     RST   5   
0BBB   21 2F 22               LXI   H,TEMP1   
0BBE   DF                     RST   3   
0BBF   DF                     RST   3   
0BC0   EF                     RST   5   ;LOAD TEMP3=INT(X*LN2E)
0BC1   21 3F 22               LXI   H,TEMP5   ;GET FACC=FP(X*LN2E)
0BC4   CD 18 17               CALL   FSUB   
0BC7   21 21 1E               LXI   H,EXPCO   ;POINT CONSTANTS
0BCA   CD 97 0A               CALL   EVPS   ;COMPUTE POLYNOMIAL
0BCD   21 3B 22               LXI   H,TEMP4   ;POINT 2^(INT(X*LN2E))
0BD0   C3 24 17               JMP   FMUL   ;MULTIPLY,NORMALIZE AND RETURN
0BD3                             ; 
0BD3                             ; 
0BD3                ABS:      EQU   $   
0BD3                             ; 
0BD3                             ; 
0BD3                             ; RETURN THE ABSOLUTE VALUE OF THE FLOATING ACCUMULATOR
0BD3                             ; 
0BD3                             ; 
0BD3   3A 58 22               LDA   FACC   ;GET EXPONENT
0BD6   E6 7F                  ANI   7FH   ;STRIP NEGATIVE SIGN
0BD8   32 58 22               STA   FACC   ;REPLACE
0BDB   C9                     RET      ;RETURN
0BDC                             ; 
0BDC                SGN:      EQU   $   
0BDC                             ; 
0BDC                             ; 
0BDC                             ; RETURNS THE SIGN OF THE FLOATING ACCUMULATOR
0BDC                             ; THAT IS:
0BDC                             ;  1 IF FACC > 0
0BDC                             ;  0 IF FACC = 0
0BDC                             ; -1 IF FACC < 0
0BDC                             ; 
0BDC   CD DA 18               CALL   FTEST   ;GET STATUS OF FACC
0BDF   C8                     RZ      ;RETURN IF ZERO
0BE0   E6 80                  ANI   80H   ;ISOLATE SIGN
0BE2   F6 01        SGN1:     ORI   1   ;CREATE EXPONENT
0BE4   F5                     PUSH   PSW   ;SAVE IT
0BE5   21 ED 1D               LXI   H,ONE   ;GET ADDRESS OF CONSTANT 1
0BE8   EF                     RST   5   ;GO LOAD IT
0BE9   F1                     POP   PSW   ;RESTORE SIGN
0BEA   32 58 22               STA   FACC   ;SET THE SIGN
0BED   C9                     RET      ;RETURN
0BEE                             ; 
0BEE                INT:      EQU   $   
0BEE                             ; 
0BEE                             ; 
0BEE                             ; RETURNS THE GREATEST INTEGER NOT LARGER THAN VALUE IN FACC
0BEE                             ; E.G.:
0BEE                             ;    INT(3.14159) =  3
0BEE                             ;    INT(0)       =  0
0BEE                             ;    INT(-3.1415) = -4
0BEE                             ; 
0BEE                             ; 
0BEE   21 58 22               LXI   H,FACC   ;POINT FLOAT ACC
0BF1   7E                     MOV   A,M   ;GET EXPONENT
0BF2   E6 40                  ANI   40H   ;GET SIGN OF CHARACTERISTIC
0BF4   CA FC 0B               JZ   INT2   ;BRIF GE ZERO
0BF7   06 04                  MVI   B,4   ;LOOP CTR
0BF9   C3 5F 1C               JMP   ZEROM   ;GO ZERO THE FACC
0BFC   7E           INT2:     MOV   A,M   ;GET EXPONENT AGAIN
0BFD   B7                     ORA   A   ;TEST SIGN
0BFE   F2 0B 0C               JP   INT3   ;BRIF POSITIVE OR ZERO
0C01   21 AD 1D               LXI   H,NEGON   ;POINT CONSTANT: -.9999999
0C04   CD 43 16               CALL   FADD   ;ADD TO FACC
0C07   21 58 22               LXI   H,FACC   ;POINT EXPONTENT AGAIN
0C0A   7E                     MOV   A,M   ;LOAD IT
0C0B   E6 3F        INT3:     ANI   3FH   ;ISOLATE CHARACTERISTIC
0C0D   FE 18                  CPI   24   ;TEST IF ANY FRACTION
0C0F   F0                     RP      ;RETURN IF NOT
0C10   47                     MOV   B,A   ;SAVE EXPONENT
0C11   3E 18                  MVI   A,24   ;GET CONSTANT
0C13   90                     SUB   B   ;MINUS EXPONENT = LOOP CTR
0C14   4F                     MOV   C,A   ;SAVE IT
0C15   21 59 22     INT4:     LXI   H,FACC+1   ;POINT MSB
0C18   AF                     XRA   A   ;CLEAR CY FLAG
0C19   06 03                  MVI   B,3   ;BYTE COUNT
0C1B   7E           INT5:     MOV   A,M   ;LOAD A BYTE
0C1C   1F                     RAR      ;SHIFT RIGHT
0C1D   77                     MOV   M,A   ;REPLACE
0C1E   23                     INX   H   ;POINT NEXT
0C1F   05                     DCR   B   ;DECR BYTE CTR
0C20   C2 1B 0C               JNZ   INT5   ;LOOP
0C23   0D                     DCR   C   ;DECR BIT CTR
0C24   C2 15 0C               JNZ   INT4   ;LOOP
0C27   21 58 22               LXI   H,FACC   ;POINT SIGN & EXP
0C2A   7E                     MOV   A,M   ;LOAD IT
0C2B   E6 80                  ANI   80H   ;ISOLATE SIGN
0C2D   C6 18                  ADI   24   ;PLUS INTEGER
0C2F   77                     MOV   M,A   ;REPLACE IT
0C30   C3 E9 16               JMP   FNORM   ;GO NORMALIZE & RETURN
0C33                             ; 
0C33                SQR:      EQU   $   
0C33                             ; 
0C33                             ; COMPUTE SQAURE ROOT OF ARG IN FACC, PUT RESULT IN FACC
0C33                             ; 
0C33                             ; USE HERON'S ITERATIVE PROCESS
0C33                             ; 
0C33   CD DA 18               CALL   FTEST   ;TEST THE ARGUMENT
0C36   C8                     RZ      ;RETURN IF ZERO
0C37   FA 08 1C               JM   ZMERR   ;ERROR IF NEGATIVE
0C3A   32 75 22               STA   DEXP   ;SAVE ORIG EXPONENT
0C3D   AF                     XRA   A   ;GET A ZERO
0C3E   32 58 22               STA   FACC   ;PUT ARG IN RANGE [.5, 1]
0C41   21 33 22               LXI   H,TEMP2   ;POINT SAVE AREA
0C44   DF                     RST   3   ;STORE IT
0C45                             ; 
0C45                             ; INITIAL APPROXIMATION 0.41730759 + 0.59016206 * MANTISSA
0C45                             ; 
0C45   21 B5 1D               LXI   H,SQC1   ;POINT .59016
0C48   CD 24 17               CALL   FMUL   ;GO MULTIPLY
0C4B   21 B9 1D               LXI   H,SQC2   ;PINT .4173
0C4E   CD 43 16               CALL   FADD   ;GO ADD
0C51   21 2F 22               LXI   H,TEMP1   ;POINT SAVE AREA
0C54   DF                     RST   3   ;GO STORE IT
0C55                             ; 
0C55                             ; NEWTON'S METHOD OF ITERATION TO THE APPROXIMATE
0C55                             ; VALUE OF THE SQR OF MANTISSA
0C55                             ; 
0C55   CD 70 0C               CALL   SQR1   ;FIRST ITERATION
0C58   21 2F 22               LXI   H,TEMP1   ;POINT SAVE AREA
0C5B   DF                     RST   3   ;STORE IT
0C5C   CD 70 0C               CALL   SQR1   ;SECOND ITERATION
0C5F                             ; 
0C5F                             ; RESTORE RANGE TO OBTAIN THE FINAL RESULT
0C5F                             ; 
0C5F   3A 75 22               LDA   DEXP   ;GET SAVE EXPONENT
0C62   CD E8 18               CALL   FEXP   ;EXPAND IT
0C65   1F                     RAR      ;DIVIDE BY 2
0C66   32 58 22               STA   FACC   ;STORE IT
0C69   D0                     RNC      ;RETURN IF EXPON EVEN
0C6A   21 BD 1D               LXI   H,SQC3   ;ELSE, POINT SQR(2)
0C6D   C3 24 17               JMP   FMUL   ;GO MULTIPLY AND RETURN
0C70                             ; 
0C70                             ; THIS ROUTINE PERFORMS ONE NEWTON ITERATION
0C70                             ; TO THE SQUARE ROOT FUNCTION
0C70                             ; 
0C70   21 33 22     SQR1:     LXI   H,TEMP2   ;POINT MANTISSA
0C73   EF                     RST   5   ;LOAD IT
0C74   21 2F 22               LXI   H,TEMP1   ;POINT PREV GUESS
0C77   CD A7 17               CALL   FDIV   ;FORM MANT/TEMP1
0C7A   21 2F 22               LXI   H,TEMP1   ;POINT PREV
0C7D   CD 43 16               CALL   FADD   ;FORM TEMP1 + MANT/TEMP1
0C80   D6 01                  SUI   1   ;DIVIDE BY 2
0C82   32 58 22               STA   FACC   ;FORM (TEMP1 + MANT/TEMP1)/2
0C85   C9                     RET      ;RETURN
0C86                             ; 
0C86                NEG:      EQU   $   
0C86                             ; 
0C86                             ; 
0C86                             ; REVERSES THE SIGN OF THE FLOATING ACC
0C86                             ; 
0C86                             ; 
0C86   CD DA 18               CALL   FTEST   ;GET STATUS OF FACC
0C89   C8                     RZ      ;RETURN IF ZERO
0C8A   EE 80                  XRI   80H   ;REVERSE SIGN
0C8C   32 58 22               STA   FACC   ;RESTORE EXPONENT
0C8F   C9                     RET      ;CONTINUE EVALUATION
0C90                             ; 
0C90                RND:      EQU   $   
0C90                             ; 
0C90                             ; 
0C90                             ; PSEUDO RANDOM NUMBER GENERATOR
0C90                             ; 
0C90                             ; 
0C90   21 47 22               LXI   H,TEMP7   ;SAVE ARG
0C93   DF                     RST   3   
0C94   06 04                  MVI   B,4   ;LOOP CTR
0C96   21 58 22               LXI   H,FACC   ;POINT FLOAT ACCUM
0C99   CD 5F 1C               CALL   ZEROM   ;GO ZERO THE FACC
0C9C   0E 03                  MVI   C,3   ;OUTTER LOP CTR
0C9E   21 59 22               LXI   H,FACC+1   ;POINT MSB
0CA1   E5                     PUSH   H   ;SAVE H,L
0CA2   21 7C 22     RND1:     LXI   H,RNDZ+1   ;POINT X,Y,Z
0CA5   06 06                  MVI   B,6   ;LOOP CTR
0CA7   B7                     ORA   A   ;TURN OFF CY
0CA8   7E           RND2:     MOV   A,M   ;GET A BYTE
0CA9   17                     RAL      ;SHIFT LEFT (MULT BY 2)
0CAA   77                     MOV   M,A   ;REPLACE THE BYTE
0CAB   2B                     DCX   H   ;POINT NEXT
0CAC   05                     DCR   B   ;DECR CTR
0CAD   C2 A8 0C               JNZ   RND2   ;LOOP
0CB0   23                     INX   H   ;POINT MSD X,Y,Z
0CB1   11 66 1D               LXI   D,RNDP   ;POINT TO MODULO
0CB4   06 03                  MVI   B,3   ;LOOP CTR
0CB6   1A           FND3:     LDAX   D   ;GET BYTE OF P,Q,R
0CB7   BE                     CMP   M   ;COMPARE WITH X,Y,Z
0CB8   13                     INX   D   ;POINT NEXT
0CB9   23                     INX   H   ;DITTO
0CBA   DA C5 0C               JC   RND4   ;BRIF P<X
0CBD   C2 D1 0C               JNZ   RND5   ;BRIF P>X
0CC0   1A                     LDAX   D   ;GET LOW BYTE
0CC1   BE                     CMP   M   ;CMPARE
0CC2   D2 D1 0C               JNC   RND5   ;BRIF P>=X
0CC5   EB           RND4:     XCHG      ;FLIP D,E TO H,L
0CC6   1A                     LDAX   D   ;GET LOW X BYTE
0CC7   96                     SUB   M   ;SUBTRACT LOW P BYTE
0CC8   12                     STAX   D   ;STORE IT
0CC9   1B                     DCX   D   ;POINT HIGH
0CCA   2B                     DCX   H   ;DITTO
0CCB   1A                     LDAX   D   ;GET HIGH X BYTE
0CCC   9E                     SBB   M   ;SUB HIGH P BYTE
0CCD   12                     STAX   D   ;STORE IT
0CCE   13                     INX   D   ;POINT LOW
0CCF   23                     INX   H   ;DITTO
0CD0   EB                     XCHG      ;RESTORE ADDRS
0CD1   13           RND5:     INX   D   ;POINT NEXT
0CD2   23                     INX   H   ;DITTO
0CD3   05                     DCR   B   ;DECR CTR
0CD4   C2 B6 0C               JNZ   FND3   ;LOOP
0CD7   06 03                  MVI   B,3   ;LOOP CTR
0CD9   11 7E 22     RND6:     LXI   D,RNDS+1   ;POINT LOW S
0CDC   1A                     LDAX   D   ;GET LOW S
0CDD   86                     ADD   M   ;ADD LOW X,Y,Z
0CDE   12                     STAX   D   ;PUT S
0CDF   1B                     DCX   D   ;POINT HIGH
0CE0   2B                     DCX   H   ;DITTO
0CE1   1A                     LDAX   D   ;GET HIGH S
0CE2   8E                     ADC   M   ;ADD HIGH X,Y,Z
0CE3   E6 3F                  ANI   3FH   ;TURN OFF HIGH BITS
0CE5   12                     STAX   D   ;STORE IT
0CE6   2B                     DCX   H   ;POINT NEXT X,Y,Z
0CE7   05                     DCR   B   ;DECR CTR
0CE8   C2 D9 0C               JNZ   RND6   ;LOOP
0CEB   3E 08                  MVI   A,8   ;CONSTANT
0CED   91                     SUB   C   ;LESS CTR
0CEE   1F                     RAR      ;DIVIDE BY TWO
0CEF   E1                     POP   H   ;GET H,L ADDR
0CF0   3A 7E 22               LDA   RNDS+1   ;GET LSB OF S
0CF3   77                     MOV   M,A   ;STORE IT
0CF4   23                     INX   H   ;POINT NEXT
0CF5   E5                     PUSH   H   ;SAVE H,L
0CF6   0D                     DCR   C   ;DECR CTR
0CF7   C2 A2 0C               JNZ   RND1   ;LOOP
0CFA   E1                     POP   H   ;RESTORE SP PTR
0CFB   3A 87 22               LDA   RNDSW   ;GET SWITCH
0CFE   B7                     ORA   A   ;TEST IT
0CFF   CA 0D 0D               JZ   RND7   ;BRIF NO RANDOMIZE
0D02   11 7F 22               LXI   D,TRNDX   ;POINT SAVED VALUES
0D05   21 77 22               LXI   H,RNDX   ;POINT NEXT VALUES
0D08   06 08                  MVI   B,8   ;LOOP CTR
0D0A   CD 59 1C               CALL   COPYH   ;GO COPY
0D0D   CD E9 16     RND7:     CALL   FNORM   
0D10   21 47 22               LXI   H,TEMP7   ;MULTIPLY BY RANGE
0D13   C3 24 17               JMP   FMUL   
0D16                             ; 
0D16                INP:      EQU   $   
0D16                             ; 
0D16                             ; 
0D16                             ; INPUT A BYTE FROM THE DEVICE IN FACC
0D16                             ; 
0D16                             ; PUT THE RESULT IN THE FACC
0D16                             ; 
0D16   CD 67 1C               CALL   FBIN   ;CONVERT FACC TO BINARY
0D19   21 20 22               LXI   H,OUTA   ;POINT INSTR BUFFER
0D1C   36 DB                  MVI   M,0DBH   ;IN INSTR
0D1E   23                     INX   H   ;POINT NEXT
0D1F   77                     MOV   M,A   ;MOVE ADDR
0D20   23                     INX   H   ;POINT NEXT
0D21   36 C9                  MVI   M,0C9H   ;RET INSTR
0D23   CD 20 22               CALL   OUTA   ;GO INPUT A BYTE
0D26   5F           FDEC:     MOV   E,A   ;MOVE BYTE TO LO D,E
0D27   16 00                  MVI   D,0   ;ZERO HI D,E
0D29   C3 8A 1C               JMP   BINFL   ;GO CONVERT TO DEC & RET
0D2C                             ; 
0D2C                POS:      EQU   $   
0D2C                             ; 
0D2C                             ; 
0D2C                             ; RETURNS THE CURRENT POSITION OF THE TTY CURSOR
0D2C                             ; 
0D2C                             ; 
0D2C   3A 76 22               LDA   COLUM   ;GET POSITION
0D2F   C3 26 0D               JMP   FDEC   ;CONVERT TO FLOAT AND RETURN
0D32                             ; 
0D32                CONCA:    EQU   $   
0D32                             ; 
0D32                             ; 
0D32                             ; CONCATONATE TWO STRING TOGETHER
0D32                             ; COMBINE LENGTH <= 255
0D32                             ; 
0D32   D1                     POP   D   ;ADJUST STACK
0D33   11 20 21               LXI   D,STRIN   ;POINT STRING BUFFER
0D36   1A                     LDAX   D   ;GET CURRENT LENGTH
0D37   4F                     MOV   C,A   ;STORE IT
0D38   06 00                  MVI   B,0   ;CLEAR HI
0D3A   EB                     XCHG      ;FLIP FLOP
0D3B   09                     DAD   B   ;COMPUTE NEXT
0D3C   EB                     XCHG      ;FLIP BACK
0D3D   86                     ADD   M   ;COMPUTE COMBINE LENGTH
0D3E   46                     MOV   B,M   ;SAVE LEN2
0D3F   D2 48 0D               JNC   CONC2   ;BRIF NO OVFLW
0D42   3E FF                  MVI   A,255   ;MAX LEN
0D44   91                     SUB   C   ;MINUS 1ST PART
0D45   47                     MOV   B,A   ;SAVE LEN
0D46   3E FF                  MVI   A,255   ;UPDATED LENGTH
0D48   32 20 21     CONC2:    STA   STRIN   ;STORE IT
0D4B   78                     MOV   A,B   ;GET LEN TO MOVE
0D4C   B7                     ORA   A   ;TEST IT
0D4D   CA 58 0D               JZ   CONC4   ;BRIF NULL
0D50   23           CONC3:    INX   H   ;POINT NEXT
0D51   13                     INX   D   ;DITTO
0D52   7E                     MOV   A,M   ;GET NEXT CHAR
0D53   12                     STAX   D   ;PUT IT
0D54   05                     DCR   B   ;DECR COUNT
0D55   C2 50 0D               JNZ   CONC3   ;LOOP
0D58   E1           CONC4:    POP   H   ;GET H,L
0D59   2B                     DCX   H   ;POINT BACK
0D5A   3A 20 21               LDA   STRIN   ;GET LEN
0D5D   1F                     RAR      ;DIVIDE BY TWO
0D5E   3C                     INR   A   ;PLUS ONE
0D5F   EB                     XCHG      ;SAVE H,L
0D60   2A 69 22               LHLD   SPCTR   ;GET CTR
0D63   4F                     MOV   C,A   ;SAVE CTR
0D64   06 00                  MVI   B,0   ;ZERO HI BYTE
0D66   09                     DAD   B   ;ADD LEN THIS STRING
0D67   22 69 22               SHLD   SPCTR   ;SAVE CTR
0D6A   C1                     POP   B   
0D6B   21 00 00               LXI   H,0   ;GET ADDR ZERO
0D6E   E5           CONC5:    PUSH   H   ;2 BYTE WORD
0D6F   3D                     DCR   A   ;DECR CTR
0D70   C2 6E 0D               JNZ   CONC5   ;CONTINUE
0D73   39                     DAD   SP   ;GET ADDRESS IN H,L
0D74   EB                     XCHG      ;PUT STACK PTR IN D,E
0D75   72                     MOV   M,D   ;MOVE HI ADDR
0D76   23                     INX   H   ;POINT NEXT
0D77   73                     MOV   M,E   ;MOVE LO ADDR
0D78   23                     INX   H   ;POINT NEXT
0D79   36 E7                  MVI   M,0E7H   ;TYPE=STRING
0D7B   E5                     PUSH   H   ;SAVE H,L
0D7C   21 20 21               LXI   H,STRIN   ;GET TEMP STR
0D7F   7E                     MOV   A,M   ;GET LENGTH
0D80   3C                     INR   A   ;PLUS ONE
0D81   4F                     MOV   C,A   ;SAVE IT
0D82   7E           CONC6:    MOV   A,M   ;GET A BYTE
0D83   12                     STAX   D   ;PUT IT DOWN
0D84   13                     INX   D   ;POINT NEXT
0D85   23                     INX   H   ;DITTO
0D86   0D                     DCR   C   ;SUBT CTR
0D87   C2 82 0D               JNZ   CONC6   ;LOOP
0D8A   E1                     POP   H   ;RESTORE H,L
0D8B   E7                     RST   4   ;ADJUST H,L
0D8C   F9                     DB   -7   ; AND 0FFH
0D8D   3E 04                  MVI   A,4   ;DELETE 4 BYTES
0D8F   CD E3 1A               CALL   SQUIS   ;GO COMPRESS
0D92   C3 C6 11               JMP   EVAL   ;CONTINUE EVALUATION
0D95                             ; 
0D95                LENFN:    EQU   $   
0D95                             ; 
0D95                             ; X=LEN(A$)
0D95                             ; 
0D95                             ; RETURN THE LENGTH OF THE STRING
0D95                             ; 
0D95   3A 20 21               LDA   STRIN   ;GET LEN IN ACC
0D98   C3 26 0D               JMP   FDEC   ;GO CONVERT TO DECIMAL & RETURN
0D9B                             ; 
0D9B                CHRFN:    EQU   $   
0D9B                             ; 
0D9B                             ; A$=CHR$(X)
0D9B                             ; 
0D9B                             ; RETURNS A ONE CHAR STRING HAVING THE ASCII VALUE - X
0D9B                             ; 
0D9B   CD 67 1C               CALL   FBIN   ;CONVERT FACC TO BINARY
0D9E   21 20 21               LXI   H,STRIN   ;POINT OUT AREA
0DA1   36 01                  MVI   M,1   ;LEN=1
0DA3   23                     INX   H   ;POINT NEXT
0DA4   77                     MOV   M,A   ;STORE THE CHAR
0DA5   C9                     RET      ;RETURN
0DA6                             ; 
0DA6                ASCII:    EQU   $   
0DA6                             ; 
0DA6                             ; X=ASCII(A$)
0DA6                             ; 
0DA6                             ; RETURNS THE ASCII VALUE OF THE FIRST CHAR IN STRING
0DA6                             ; 
0DA6   21 20 21               LXI   H,STRIN   ;POINT STRING
0DA9   7E                     MOV   A,M   ;GET LENGTH
0DAA   B7                     ORA   A   ;TEST IF > ZERO
0DAB   CA 26 0D               JZ   FDEC   ;BRIF ZERO & RETURN A ZERO
0DAE   23                     INX   H   ;POINT 1ST CHAR
0DAF   7E                     MOV   A,M   ;LOAD IT
0DB0   C3 26 0D               JMP   FDEC   ;GO CONVERT TO DECIMAL & RETURN
0DB3                             ; 
0DB3                NUMFN:    EQU   $   
0DB3                             ; 
0DB3                             ; A$=NUM$(X)
0DB3                             ; 
0DB3                             ; RETURNS A STRING REPRESENTING X AS IT WOULD HAVE
0DB3                             ; BEEN PRINTED (INCLUDING TRAILING SPACE)
0DB3                             ; 
0DB3   21 20 21               LXI   H,STRIN   ;POINT STRING AREA
0DB6   36 00                  MVI   M,0   ;INIT COUNT
0DB8   23                     INX   H   ;SKIP TO 1ST POSITION
0DB9   CD FC 14               CALL   FOUT   ;GO CONVERT TO EXTRN DEC
0DBC   AF                     XRA   A   ;GET A ZERO
0DBD   47                     MOV   B,A   ;INIT CTR
0DBE   2B           NUM1:     DCX   H   ;POINT PRIOR
0DBF   04                     INR   B   ;COUNT IT
0DC0   BE                     CMP   M   ;TEST IF ZERO
0DC1   C2 BE 0D               JNZ   NUM1   ;LOOP TILL AT START
0DC4   70                     MOV   M,B   ;SET LEN CODE
0DC5   C9                     RET      ;THEN RETURN
0DC6                             ; 
0DC6                VAL:      EQU   $   
0DC6                             ; 
0DC6                             ; X = VAL(A$)
0DC6                             ; 
0DC6                             ; RETURNS THE VALUE OF THE STRING OF NUMERIC CHARACTERS
0DC6                             ; 
0DC6   21 20 21               LXI   H,STRIN   ;POINT STRING AREA
0DC9   7E                     MOV   A,M   ;GET LEN
0DCA   B7                     ORA   A   ;TEST FOR NULL STRING
0DCB   47                     MOV   B,A   ;SAVE LEN
0DCC   CA 26 0D               JZ   FDEC   ;BRIF IS (RETURNS A 0.00)
0DCF   11 20 21               LXI   D,STRIN   ;POINT BUFFER
0DD2   23           VAL1:     INX   H   ;POINT NEXT
0DD3   7E                     MOV   A,M   ;GET A CHAR
0DD4   FE 20                  CPI   " "   ;TEST IF SPACE
0DD6   CA DB 0D               JZ   VAL2   ;BRIF IS
0DD9   12                     STAX   D   ;PUT THE CHAR
0DDA   13                     INX   D   ;INCR ADDR
0DDB   05           VAL2:     DCR   B   ;DECR CTR
0DDC   C2 D2 0D               JNZ   VAL1   ;LOOP
0DDF   AF                     XRA   A   ;GET A ZERO
0DE0   12                     STAX   D   ;PUT IN BUFF
0DE1   21 20 21               LXI   H,STRIN   ;POINT START OF BUFFER
0DE4   CD 3A 14               CALL   FIN   ;GO CONVERT
0DE7   7E                     MOV   A,M   ;GET NON-NUMERIC
0DE8   B7                     ORA   A   ;TEST IT
0DE9   C2 20 1C               JNZ   CVERR   ;BRIF ERROR
0DEC   C9                     RET      ;ELSE, RETURN
0DED                             ; 
0DED                SPACE:    EQU   $   
0DED                             ; 
0DED                             ; A$=SPACE$(X)
0DED                             ; 
0DED                             ; CREATES A STRING FO SPACES LENGTH = X
0DED                             ; 
0DED   CD 67 1C               CALL   FBIN   ;GET BINARY LENGTH
0DF0   21 20 21               LXI   H,STRIN   ;POINT TEMP STRING
0DF3   77                     MOV   M,A   ;PUT LEN
0DF4   B7                     ORA   A   ;TEST IT
0DF5   C8           SPAC1:    RZ      ;RETURN IF ZERO
0DF6   23                     INX   H   ;ELSE, POINT NEXT
0DF7   36 20                  MVI   M," "   ;MOVE 1 SPACE
0DF9   3D                     DCR   A   ;DECR CTR
0DFA   C3 F5 0D               JMP   SPAC1   ;LOOP
0DFD                             ; 
0DFD                STRFN:    EQU   $   
0DFD                             ; 
0DFD                             ; A$=STRING$(X,Y)
0DFD                             ; 
0DFD                             ; CREATES STRING OF LNGTH X CONTAINING REPETITION OF CHR$(Y)
0DFD                             ; 
0DFD   CD 67 1C               CALL   FBIN   ;GET BINARY LENGTH
0E00   32 20 21               STA   STRIN   ;PUT TO STRING
0E03   CD 84 1C               CALL   ARGNU   ;GET NEXT ARGUMENT
0E06   21 20 21               LXI   H,STRIN   ;POINT STRING
0E09   46                     MOV   B,M   ;GET COUNT
0E0A   23           STR11:    INX   H   ;POINT NEXT
0E0B   77                     MOV   M,A   ;STORE THE CHAR
0E0C   05                     DCR   B   ;DECR CTR
0E0D   C2 0A 0E               JNZ   STR11   ;LOOP
0E10   C9                     RET      ;RETURN
0E11                             ; 
0E11                LEFT:     EQU   $   
0E11                             ; 
0E11                             ; B$=LEFT$(A$,X)
0E11                             ; 
0E11                             ; SUBSTRING FROM THE LEFTMOST X CHARACTERS OF A$
0E11                             ; 
0E11   CD 84 1C               CALL   ARGNU   ;GET 2ND ARGUMENT
0E14   4F                     MOV   C,A   ;SAVE LEN
0E15   06 01                  MVI   B,1   ;INIT START
0E17   C3 2D 0E               JMP   MID0   ;CONTINUE
0E1A                             ; 
0E1A                RIGHT:    EQU   $   
0E1A                             ; 
0E1A                             ; B$=RIGHT$(A$,X)
0E1A                             ; 
0E1A                             ; SUBSTRING STARTING AT POSITION X TO END OF STRING
0E1A                             ; 
0E1A   CD 84 1C               CALL   ARGNU   ;GET 2ND ARGUMENT
0E1D   47                     MOV   B,A   ;SAVE START
0E1E   0E FF                  MVI   C,255   ;MAX LEN
0E20   C3 2D 0E               JMP   MID0   ;CONTINUE
0E23                             ; 
0E23                MIDFN:    EQU   $   
0E23                             ; 
0E23                             ; B$=MID$(A$,X,Y)
0E23                             ; 
0E23                             ; SUBSTRING OF THE STRING A$ STARTING WITH CHARACTER @ X
0E23                             ; AND Y CHARACTERS LONG
0E23                             ; 
0E23   CD 84 1C               CALL   ARGNU   ;LOAD X
0E26   47                     MOV   B,A   ;SAVE START
0E27   C5                     PUSH   B   ;PUT ON STACK
0E28   CD 84 1C               CALL   ARGNU   ;GET 3RD ARG
0E2B   C1                     POP   B   ;RETREIVE
0E2C   4F                     MOV   C,A   ;SAVE LEN
0E2D   78           MID0:     MOV   A,B   ;LOAD START
0E2E   21 20 21               LXI   H,STRIN   ;POINT STRING
0E31   BE                     CMP   M   ;TEST IF X>L
0E32   DA 3B 0E               JC   MID1   ;BRIF X>L
0E35   CA 3B 0E               JZ   MID1   ;OR EQUAL
0E38   36 00                  MVI   M,0   ;ELSE, RESULT IS NULL
0E3A   C9                     RET      ;RETURN
0E3B   81           MID1:     ADD   C   ;COMPUTE END POSITION
0E3C   DA 48 0E               JC   MID2   ;BRIF OVERFLOW
0E3F   DE 01                  SBI   1   ;COMPUTE X+Y-1
0E41   DA 48 0E               JC   MID2   ;BRIF OVERFLOW
0E44   BE                     CMP   M   ;COMPARE TO EXISTING LEN
0E45   DA 4C 0E               JC   MID3   ;BRIF X+Y-1<LEN(A$)
0E48   7E           MID2:     MOV   A,M   ;ELSE GET ORIG LEN
0E49   90                     SUB   B   ;MINUS X
0E4A   3C                     INR   A   ;PLUS ONE
0E4B   4F                     MOV   C,A   ;SAVE (REPLACE Y)
0E4C   71           MID3:     MOV   M,C   ;PUT NEW LEN
0E4D   58                     MOV   E,B   ;PUT START IN LO
0E4E   16 00                  MVI   D,0   ;ZERO IN HI
0E50   19                     DAD   D   ;COMPUTE START
0E51   11 20 21               LXI   D,STRIN   ;GET BEGIN
0E54   7E           MID4:     MOV   A,M   ;GET A CHAR
0E55   13                     INX   D   ;POINT NEXT
0E56   23                     INX   H   ;DITTO
0E57   12                     STAX   D   ;PUT DOWN
0E58   0D                     DCR   C   ;DECR CTR
0E59   C2 54 0E               JNZ   MID4   ;LOOP
0E5C   C9                     RET      ;THEN RETURN
0E5D                             ; 
0E5D                INSTR:    EQU   $   
0E5D                             ; 
0E5D                             ; X = INSTR(Y,A$,B$)
0E5D                             ; 
0E5D                             ; SEARCH FOR SUBSTRING B$ IN STRING A$ STARTING AT POS Y.
0E5D                             ; RETURN 0 IF B$ IS NOT IN A$
0E5D                             ; RETURN 1 IF B$ IS NULL
0E5D                             ; ELSE RETURN THE CHARACTER POSITION
0E5D                             ; 
0E5D   CD 84 1C               CALL   ARGNU   ;GET A$
0E60   21 20 21               LXI   H,STRIN   ;POINT A$
0E63   B7                     ORA   A   ;TEST Y
0E64   C2 6C 0E               JNZ   INST2   ;BRIF Y NOT ZERO
0E67   36 00        INST1:    MVI   M,0   ;ELSE A$ IS NULL
0E69   C3 73 0E               JMP   INST3   ;GO AROUND
0E6C   BE           INST2:    CMP   M   ;TEST Y TO LEN(A$)
0E6D   CA 73 0E               JZ   INST3   ;BRIF EQUAL
0E70   D2 67 0E               JNC   INST1   ;BRIF Y > LEN(A$)
0E73   4F           INST3:    MOV   C,A   ;SAVE Y
0E74   06 00                  MVI   B,0   ;ZERO HI INCR
0E76   7E                     MOV   A,M   ;GET LEN(A$)
0E77   91                     SUB   C   ;MINUS Y
0E78   3C                     INR   A   ;PLUS ONE
0E79   09                     DAD   B   ;COMPUTE START ADDR
0E7A   47                     MOV   B,A   ;# CHARS REMAIN IN A$
0E7B   E5                     PUSH   H   ;SAVE ADDR
0E7C   2A 52 22               LHLD   ADDR1   ;GET ADDR OF ARG
0E7F   23                     INX   H   ;POINT NEXT
0E80   56                     MOV   D,M   ;GET HI ADDR
0E81   23                     INX   H   ;POINT NEXT
0E82   5E                     MOV   E,M   ;GET LO ADDR
0E83   23                     INX   H   ;POINT NEXT
0E84   22 52 22               SHLD   ADDR1   ;UPDATED PTR
0E87   E1                     POP   H   ;RESTORE ADDR
0E88   1A                     LDAX   D   ;GET LEN(B$)
0E89   B7                     ORA   A   ;TEST IF NULL
0E8A   C2 93 0E               JNZ   INST6   ;BRIF NOT
0E8D   0E 01                  MVI   C,1   ;SET POSIT = 1
0E8F   79           INST5:    MOV   A,C   ;GET POSIT
0E90   C3 26 0D               JMP   FDEC   ;CONVERT TO DECIMAL & RETURN
0E93   EB           INST6:    XCHG      ;FLIP/FLOP
0E94   78                     MOV   A,B   ;GET LEN OF A$
0E95   BE                     CMP   M   ;COMPARE TO LEN B$
0E96   DA B8 0E               JC   INSTA   ;BRIF LEN(B$)< LEN(REM A$)
0E99   C5                     PUSH   B   ;SAVE CTR, POSIT
0E9A   D5                     PUSH   D   ;SAVE ADDR A$
0E9B   E5                     PUSH   H   ;SAVE ADDR B$
0E9C   4E                     MOV   C,M   ;GET LEN B$
0E9D   EB                     XCHG      ;FLIP/FLOP
0E9E   13           INST8:    INX   D   ;POINT NEXT B$
0E9F   1A                     LDAX   D   ;GET B$ CHAR
0EA0   BE                     CMP   M   ;COMPARE A$ CHAR
0EA1   C2 AF 0E               JNZ   INST9   ;BRIF NOT EQUAL
0EA4   23                     INX   H   ;POINT NEXT A$
0EA5   0D                     DCR   C   ;DECR CTR (LEN(B$))
0EA6   C2 9E 0E               JNZ   INST8   ;LOOP
0EA9   E1                     POP   H   ;DUMMY POP
0EAA   E1                     POP   H   ;GET DUMMY STACK
0EAB   C1                     POP   B   ;GET POSITION
0EAC   C3 8F 0E               JMP   INST5   ;WE FOUND A MATCH
0EAF   D1           INST9:    POP   D   ;GET PTR B$
0EB0   E1                     POP   H   ;GET PTR A$
0EB1   C1                     POP   B   ;GET CTRS, POSIT
0EB2   0C                     INR   C   ;UP PTR NUM
0EB3   23                     INX   H   ;POINT NEXT A$
0EB4   05                     DCR   B   ;DECR B
0EB5   C2 93 0E               JNZ   INST6   ;LOOP
0EB8   0E 00        INSTA:    MVI   C,0   ;ELSE B$ NOT IN A$
0EBA   C3 8F 0E               JMP   INST5   ;RETURN
0EBD                             ; 
0EBD                FN:       EQU   $   
0EBD                             ; 
0EBD                             ; STMT: DEF FNX(A)=EXPR
0EBD                             ; 
0EBD                             ; NOTE: ENTRY FROM EXPR ANALYZER (RECURSIVE)
0EBD                             ; 
0EBD   C5                     PUSH   B   ;SAVE B,C
0EBE   D5                     PUSH   D   ;SAVE D,E
0EBF   E5                     PUSH   H   ;SAVE H,L
0EC0   EB                     XCHG      ;PUT H,L TO D,E
0EC1   2A 56 22               LHLD   ADDR3   ;GET ADDR
0EC4   E5                     PUSH   H   ;SAVE IT
0EC5   EB                     XCHG      ;PUT D,E BACK TO H,L
0EC6   22 56 22               SHLD   ADDR3   ;UPDATE PTR
0EC9   2A 69 22               LHLD   SPCTR   ;GET SP COUNT
0ECC   E5                     PUSH   H   ;SAVE IT
0ECD   3A 68 22               LDA   PARCT   ;GET PAREN COUNT
0ED0   47                     MOV   B,A   ;PUT TO B
0ED1   3A 88 22               LDA   FNMOD   ;GET FN MODE
0ED4   4F                     MOV   C,A   ;PUT TO C
0ED5   C5                     PUSH   B   ;SAVE B,C
0ED6   3A 72 20               LDA   DIMSW   ;GET DIM SW
0ED9   F5                     PUSH   PSW   ;SAVE IT
0EDA   AF                     XRA   A   ;CLEAR A
0EDB   32 72 20               STA   DIMSW   ;RESET DIM SW
0EDE   2A 6C 22               LHLD   FNARG   ;GET OLD ARG NAME
0EE1   E5                     PUSH   H   ;SAVE
0EE2   2A 6E 22               LHLD   FNARG+2   ;GET OLD ARG ADDRESS
0EE5   E5                     PUSH   H   ;SAVE
0EE6   2A 93 22               LHLD   PROGE   ;GET END OF PROGRAM
0EE9   E5                     PUSH   H   ;SAVE IT
0EEA   2A 50 22               LHLD   EXPRS   ;GET END OF EXPR
0EED   E5                     PUSH   H   ;SAVE IT
0EEE   22 93 22               SHLD   PROGE   ;SAVE NEW "END" OF PROGRAM
0EF1   3E 01                  MVI   A,1   ;GET ON SETTING
0EF3   32 88 22               STA   FNMOD   ;SET IN FUNCTION
0EF6   2A 56 22               LHLD   ADDR3   ;POINT TO EXPR
0EF9   4E                     MOV   C,M   ;GET FN CHAR
0EFA   2B                     DCX   H   ;POINT BACK
0EFB   46                     MOV   B,M   ;GET HI NAME
0EFC   21 96 22               LXI   H,BEGPR   ;POINT START OF PROGRAM
0EFF   7E           FN2:      MOV   A,M   ;LOAD LEN TO NEXT STMT
0F00   B7                     ORA   A   ;TEST IF AT END
0F01   CA 10 1C               JZ   SNERR   ;BRIF FN NOT FOUND
0F04   E5                     PUSH   H   ;SAVE PTR
0F05   E7                     RST   4   ;ADJUST H,L
0F06   03                     DB   3   
0F07   11 21 1F               LXI   D,DEFLI   ;LITERAL
0F0A   D7                     RST   2   ;GO COMPARE
0F0B   C2 1D 0F               JNZ   FN3   ;BRIF NOT EQUAL
0F0E   C5                     PUSH   B   ;SAVE TEST NAME
0F0F   CD CA 1B               CALL   VAR   ;GO GET NAME
0F12   C1                     POP   B   ;RESTORE NAME
0F13   7A                     MOV   A,D   ;GET HI NAME
0F14   B8                     CMP   B   ;COMPARE
0F15   C2 1D 0F               JNZ   FN3   ;BRIF NOT EQUAL
0F18   7B                     MOV   A,E   ;GET LO
0F19   B9                     CMP   C   ;COMPARE
0F1A   CA 25 0F               JZ   FN4   ;BRIF EQUAL
0F1D   E1           FN3:      POP   H   ;GET OLD PTR
0F1E   5E                     MOV   E,M   ;GET LO LEN
0F1F   16 00                  MVI   D,0   ;ZERO HI LEN
0F21   19                     DAD   D   ;POINT NEXT STMT
0F22   C3 FF 0E               JMP   FN2   ;LOOP
0F25   D1           FN4:      POP   D   ;ADJUST STACK
0F26   CF                     RST   1   ;SKIP BLANKS
0F27   FE 28                  CPI   "("   ;TEST IF OPEN PAREN
0F29   C2 10 1C               JNZ   SNERR   ;BRIF NOT
0F2C   23                     INX   H   ;SKIP IT
0F2D   CD CA 1B               CALL   VAR   ;GO GET VAR NAME
0F30   E5                     PUSH   H   ;SAVE HL ADDR
0F31   21 6C 22               LXI   H,FNARG   ;POINT DUMMY ARG TBL
0F34   72                     MOV   M,D   ;STORE LETTER
0F35   23                     INX   H   ;POINT NEXT
0F36   73                     MOV   M,E   ;STORE DIGIT
0F37   23                     INX   H   ;POINT NEXT
0F38   EB                     XCHG      ;PUT H,L TO D,E
0F39   2A 56 22               LHLD   ADDR3   ;POINT TO EXPR STACK
0F3C   23                     INX   H   ;POINT CODE
0F3D   23                     INX   H   ;POINT HI ADR
0F3E   7E                     MOV   A,M   ;GET HI
0F3F   12                     STAX   D   ;PUT TO TABLE
0F40   13                     INX   D   ;POINT NEXT
0F41   23                     INX   H   ;DITTO
0F42   7E                     MOV   A,M   ;GET LO ADDR
0F43   12                     STAX   D   ;PUT TO TABLE
0F44   E1                     POP   H   ;RESTORE PTR TO STMT
0F45   CF                     RST   1   ;SKIP BLANKS
0F46   FE 29                  CPI   ")"   ;TEST IF CLOSE PAREN
0F48   C2 10 1C               JNZ   SNERR   ;BRIF NOT
0F4B   23                     INX   H   ;SKIP IT
0F4C   CF                     RST   1   ;SKIP BLANKS
0F4D   FE 3D                  CPI   "="   ;TEST IF EQUAL SIGN
0F4F   C2 10 1C               JNZ   SNERR   ;BRIF NOT
0F52   23                     INX   H   ;SKIP IT
0F53   CD 8C 0F               CALL   EXPR   ;GO EVAL FUNCTION
0F56   CD 95 1A               CALL   EOL   ;MUST BE END OF LINE
0F59   E1                     POP   H   ;GET H,L
0F5A   22 50 22               SHLD   EXPRS   ;RESTORE START OF EXPR
0F5D   E1                     POP   H   ;GET H,L
0F5E   22 93 22               SHLD   PROGE   ;RESTORE "END" OF PROGRAM
0F61   E1                     POP   H   ;GET H,L
0F62   22 6E 22               SHLD   FNARG+2   ;STORE ADDR
0F65   E1                     POP   H   ;GET H,L
0F66   22 6C 22               SHLD   FNARG   ;STORE DUMMY ARG
0F69   F1                     POP   PSW   ;GET A,STATUS
0F6A   32 72 20               STA   DIMSW   ;RESTORE DIM SW
0F6D   C1                     POP   B   ;GET B,C
0F6E   79                     MOV   A,C   ;LOAD C
0F6F   32 88 22               STA   FNMOD   ;RESTORE MOE
0F72   78                     MOV   A,B   ;LOAD B
0F73   32 68 22               STA   PARCT   ;RESTORE PAREN COUNT
0F76   E1                     POP   H   ;GET H,L
0F77   22 69 22               SHLD   SPCTR   ;RESTORE SP COUNTER
0F7A   E1                     POP   H   ;GET H,L
0F7B   22 56 22               SHLD   ADDR3   ;RESTORE ADDR OF EVAL
0F7E   E1                     POP   H   ;GET H,L
0F7F   D1                     POP   D   ;GET D,E
0F80   2B                     DCX   H   ;POINT 2ND BYTE FOLLOWING OP
0F81   22 54 22               SHLD   ADDR2   ;SAVE IT
0F84   E7                     RST   4   ;POINT TO ARG TYPE
0F85   05                     DB   5   
0F86   22 52 22               SHLD   ADDR1   ;SAVE ADDR
0F89   C3 13 12               JMP   EV3   ;GO WRAPUP
0F8C                             ;PAGE
0F8C                             ; 
0F8C                EXPR:     EQU   $   
0F8C                             ; 
0F8C                             ; 
0F8C                             ; EVALUATE EXPRESSION ROUTINE
0F8C                             ; LEAVE RESULT IN FACC
0F8C                             ; RETURN WHEN EXPRESSION ENDS (TYPICALLY AT END OF LINE)
0F8C                             ; 
0F8C                             ; 
0F8C   AF                     XRA   A   ;CLEAR REG A
0F8D   32 68 22               STA   PARCT   ;SET PAREN CTR
0F90   EB                     XCHG      ;SAVE H,L
0F91   21 00 00               LXI   H,0   ;GET A ZERO
0F94   22 69 22               SHLD   SPCTR   ;INIT CTR
0F97   2A 93 22               LHLD   PROGE   ;POINT END OF PROGRAM AREA
0F9A   23                     INX   H   ;POINT ONE MORE
0F9B   36 00                  MVI   M,0   ;INIT START OF STACK
0F9D   22 50 22               SHLD   EXPRS   ;SAVE IT
0FA0   EB                     XCHG      ;RESTORE H,L
0FA1                             ; 
0FA1                LOOKD:    EQU   $   ;LOOK FOR CON, VAR, OR FUNCTION
0FA1   CF                     RST   1   ;SKIP TO NON-BLANK
0FA2   CD 2B 1B               CALL   NUMER   ;GO TEST IF NUMERIC
0FA5   C2 BB 0F               JNZ   LDALP   ;BRIF NOT
0FA8   CD 3A 14     LDNUM:    CALL   FIN   ;GO CONVERT NUMERIC (PUT TO FACC)
0FAB   44           LDF:      MOV   B,H   ;COPY H,L TO B,C
0FAC   4D                     MOV   C,L   ;SAME
0FAD   2A 50 22               LHLD   EXPRS   ;GET ADDR OF EXPR AREA
0FB0   CD 01 1B               CALL   GTEMP   ;GO STORE THE FACC IN TEMP AREA
0FB3   22 50 22               SHLD   EXPRS   ;SAVE UPDATED ADDRESS
0FB6   60                     MOV   H,B   ;RESTORE H
0FB7   69                     MOV   L,C   ;RESTORE L
0FB8   C3 29 11               JMP   LOOKO   ;GO GET AN OPERATION CODE
0FBB   FE 2E        LDALP:    CPI   "."   ;SEE IF LEADING DECIMAL POINT
0FBD   CA A8 0F               JZ   LDNUM   ;BRIF IS
0FC0   CD 22 1B               CALL   ALPHA   ;GO SEE IF ALPHA
0FC3   C2 9D 10               JNZ   LDDTN   ;BRIF NOT
0FC6   46                     MOV   B,M   ;SAVE 1ST CHAR
0FC7   23                     INX   H   ;POINT NEXT
0FC8   0E 20                  MVI   C," "   ;DEFAULT FOR 1 CHAR VAR
0FCA   CD 2B 1B               CALL   NUMER   ;GO SEE IF 2ND IS NUMERIC
0FCD   C2 00 10               JNZ   LDFN   ;BRIF NOT
0FD0   23                     INX   H   ;POINT NEXT
0FD1   4F                     MOV   C,A   ;SAVE THE CHAR
0FD2   CF           LDV1:     RST   1   ;GET NEXT CHAR
0FD3   FE 24                  CPI   "$"   ;TEST IF STRING
0FD5   F5                     PUSH   PSW   ;SAVE STATUS
0FD6   C2 DF 0F               JNZ   LDV2   ;BRIF NOT
0FD9   79                     MOV   A,C   ;GET LOW CHAR
0FDA   F6 80                  ORI   80H   ;SET STRING
0FDC   4F                     MOV   C,A   ;SAVE IT
0FDD   23                     INX   H   ;SKIP $
0FDE   CF                     RST   1   ;SKIP SPACES
0FDF   FE 28        LDV2:     CPI   "("   ;TEST IF PAREN
0FE1   CA E3 13               JZ   LDV2A   ;BRIF IS
0FE4   E5                     PUSH   H   ;SAVE H,L
0FE5   50                     MOV   D,B   ;COPY B,C
0FE6   59                     MOV   E,C   ;TO D,E
0FE7   CD 35 1B               CALL   SEARC   ;GO GET VAR ADDR IN D,E
0FEA   2A 50 22     LDV:      LHLD   EXPRS   ;GET EXPR ADDR
0FED   CD 1A 1B               CALL   SADR   ;GO STORE ADDRESS
0FF0   22 50 22               SHLD   EXPRS   ;SAVE ADDRESS
0FF3   EB                     XCHG      ;H,L TO D,E
0FF4   E1                     POP   H   ;GET OLD H,L
0FF5   F1                     POP   PSW   ;GET STATUS
0FF6   C2 29 11               JNZ   LOOKO   ;BRIF NOT STRING
0FF9   EB                     XCHG      ;GET OLD H,L
0FFA   36 E7                  MVI   M,0E7H   ;MARK AS STRING ADDRESS
0FFC   EB                     XCHG      ;RESTORE H,L
0FFD   C3 29 11               JMP   LOOKO   ;GO LOOK FOR OPCODE
1000   CD 22 1B     LDFN:     CALL   ALPHA   ;GO SEE IF FUNCTION
1003   C2 D2 0F               JNZ   LDV1   ;BRIF IT'S NOT
1006   2B           LDFN1:    DCX   H   ;POINT BACK TO 1ST
1007   7E                     MOV   A,M   ;GET THAT CHAR
1008   FE 20                  CPI   " "   ;TEST IF SPACE
100A   CA 06 10               JZ   LDFN1   ;LOOP IF TRUE
100D   E5                     PUSH   H   ;SAVE H,L
100E   11 B5 1C               LXI   D,RNDLI   ;POINT LITERAL
1011   D7                     RST   2   ;GO COMPARE
1012   CA 6F 10               JZ   LDRND   ;BRIF FND
1015   E1                     POP   H   ;GET H,L
1016   E5                     PUSH   H   ;RESAVE
1017   11 24 1F               LXI   D,FNLIT   ;POINT LITERAL
101A   D7                     RST   2   ;GO SEE IF FN X
101B   CA 4A 10               JZ   FNL   ;BRIF IS
101E   E1                     POP   H   ;GET H,L
101F   E5                     PUSH   H   ;RESAVE
1020   11 9A 1D               LXI   D,PILIT   ;POINT LIT
1023   D7                     RST   2   ;GO COMPARE
1024   CA 81 10               JZ   LDPI   ;BRIF PI
1027   E1           FUNC0:    POP   H   ;GET H,L
1028   11 99 1C               LXI   D,FUNCT   ;POINT FUNCTION TABLE
102B   E5                     PUSH   H   ;SAVE POINTER
102C   CD 89 1F               CALL   SEEK1   ;GO SEARCH FUNCTION TABLE
102F   CA 42 10               JZ   FUNC4   ;BRIF FUNCTION NOT FOUND
1032   1A                     LDAX   D   ;GET A BYTE LOW
1033   4F                     MOV   C,A   ;SAVE IT
1034   13                     INX   D   ;POINT NEXT
1035   1A                     LDAX   D   ;GET HI BYTE
1036   47                     MOV   B,A   ;SAVE IT (B,C = ADDR OF FUNC)
1037   CF                     RST   1   ;SKIP BLANKS
1038   FE 28                  CPI   "("   ;TEST FOR OPEN PAREN
103A   C2 10 1C               JNZ   SNERR   ;BRIF MISSING PAREN
103D   13                     INX   D   ;POINT TYPE CODE
103E   1A                     LDAX   D   ;LOAD IT
103F   C3 8B 10               JMP   LDFNC   ;CONTINUE
1042   E1           FUNC4:    POP   H   ;GET H,L
1043   46                     MOV   B,M   ;GET 1ST CHAR
1044   0E 20                  MVI   C," "   ;SPACE 2ND CHAR
1046   23                     INX   H   ;POINT TO NEXT
1047   C3 D2 0F               JMP   LDV1   ;BRIF VARIABLE
104A   D1           FNL:      POP   D   ;DUMMY RESET STACK POINTER
104B   CD CA 1B               CALL   VAR   ;GO GET FN NAME
104E   42                     MOV   B,D   ;COPY TO B,C
104F   4B                     MOV   C,E   ;SAME
1050   EB                     XCHG      ;SAVE H,L
1051   2A 50 22               LHLD   EXPRS   ;POINT EXPR STACK
1054   23                     INX   H   ;POINT NEXT
1055   70                     MOV   M,B   ;MOVE THE LETTER
1056   23                     INX   H   ;POINT NEXT
1057   71                     MOV   M,C   ;MOVE DIGIT ($??)
1058   23                     INX   H   ;POINT NEXT
1059   36 AF                  MVI   M,0AFH   ;MOVE CODE
105B   79                     MOV   A,C   ;GET LO NAME
105C   B7                     ORA   A   ;TEST IT
105D   F2 62 10               JP   FNL3   ;BRIF NOT STRING
1060   36 CF                  MVI   M,0CFH   ;MOVE CODE
1062   22 50 22     FNL3:     SHLD   EXPRS   ;SAVE POINTER
1065   EB                     XCHG      ;GET H,L
1066   CF                     RST   1   ;GET NEXT CHAR
1067   FE 28                  CPI   "("   ;TEST IF OPEN PAREN
1069   C2 10 1C               JNZ   SNERR   ;BRIF NOT
106C   C3 A1 0F               JMP   LOOKD   ;CONTINUE
106F   FE 28        LDRND:    CPI   "("   ;TEST IF RND(X)
1071   CA 27 10               JZ   FUNC0   ;BRIF IS
1074   E5                     PUSH   H   ;ELSE, SAVE H,L
1075   21 ED 1D               LXI   H,ONE   ;USE RANGE (0,1)
1078   EF                     RST   5   ;LOAD FACC
1079   CD 90 0C               CALL   RND   ;GO GET RANDOM NUMBER
107C   E1                     POP   H   ;RESTORE H,L
107D   D1                     POP   D   ;RESTORE STACK POINTER
107E   C3 AB 0F               JMP   LDF   ;ACT AS IF CONSTANT
1081   3C           LDPI:     INR   A   ;SET NON ZERO
1082   D1                     POP   D   ;DUMMY STACK POP
1083   F5                     PUSH   PSW   ;SAVE STATUS
1084   E5                     PUSH   H   ;SAVE H,L
1085   11 A5 1D               LXI   D,PI   ;GET ADDRESS OF 3.1415
1088   C3 EA 0F               JMP   LDV   ;GO ACT LIKE VARIABLE
108B   D1           LDFNC:    POP   D   ;POP THE STACK
108C   EB                     XCHG      ;FLIP/FLOP
108D   2A 50 22               LHLD   EXPRS   ;GET ADDR
1090   23                     INX   H   ;POINT NEXT
1091   70                     MOV   M,B   ;HIGH ADDR
1092   23                     INX   H   ;POINT NEXT
1093   71                     MOV   M,C   ;LOW ADDR
1094   23                     INX   H   ;POINT NEXT
1095   77                     MOV   M,A   ;CODE
1096   22 50 22               SHLD   EXPRS   ;SAVE ADDR
1099   EB                     XCHG      ;RESTORE H,L
109A   C3 A1 0F               JMP   LOOKD   ;NEXT MUST BE DATA TOO
109D   FE 2D        LDDTN:    CPI   "-"   ;TEST IF UNARY MINUS
109F   C2 B1 10               JNZ   LDDTP   ;BRIF NOT
10A2   EB                     XCHG      ;SAVE H,L
10A3   2A 50 22               LHLD   EXPRS   ;GET EXPR END
10A6   23                     INX   H   ;POINT ONE MORE
10A7   36 61                  MVI   M,61H   ;CODE FOR NEG
10A9   22 50 22               SHLD   EXPRS   ;RESTORE PTR
10AC   EB                     XCHG      ;RESTORE H,L
10AD   23           SKPP:     INX   H   ;POINT PAST THIS BYTE
10AE   C3 A1 0F               JMP   LOOKD   ;NEXT MUST BE DATA
10B1   FE 2B        LDDTP:    CPI   "+"   ;TEST IF UNARY PLUS
10B3   CA AD 10               JZ   SKPP   ;IGNORE IF IS
10B6   FE 28                  CPI   "("   ;ELSE, TEST IF OPEN PAREN
10B8   CA 17 11               JZ   CERCE   ;BRIF IS
10BB   FE 27                  CPI   27H   ;TEST IF LITERAL (SINGLE QUOTE)
10BD   CA C5 10               JZ   LITST   ;BRIF IS
10C0   FE 22                  CPI   0x22   ;"""     ;TEST IF LITERAL
10C2   C2 10 1C               JNZ   SNERR   ;BRIF NOT CON, FUNCTION, OR VAR
10C5   4F           LITST:    MOV   C,A   ;SAVE DELIMITER
10C6   11 20 21               LXI   D,STRIN   ;POINT BUFFER
10C9   06 FF                  MVI   B,0FFH   ;INIT CTR
10CB   23           LIT1:     INX   H   ;POINT NEXT
10CC   7E                     MOV   A,M   ;LOAD NEXT
10CD   13                     INX   D   ;POINT NEXT
10CE   12                     STAX   D   ;STORE IT
10CF   B7                     ORA   A   ;TEST IF END
10D0   CA 10 1C               JZ   SNERR   ;BRIF ERROR
10D3   04                     INR   B   ;COUNT IT
10D4   B9                     CMP   C   ;TEST IF END OF STRING
10D5   C2 CB 10               JNZ   LIT1   ;BRIF NOT
10D8   23                     INX   H   ;POINT NEXT
10D9   11 20 21               LXI   D,STRIN   ;POINT BEGIN
10DC   78                     MOV   A,B   ;GET COUNT
10DD   12                     STAX   D   ;PUT COUNT
10DE   1F                     RAR      ;DIVIDE BY TWO
10DF   3C                     INR   A   ;PLUS ONE
10E0   4F                     MOV   C,A   ;SAVE IT
10E1   06 00                  MVI   B,0   ;ZERO HIGH
10E3   E5                     PUSH   H   ;SAVE PTR
10E4   2A 69 22               LHLD   SPCTR   ;GET CTR
10E7   09                     DAD   B   ;PLUS OLD
10E8   22 69 22               SHLD   SPCTR   ;UPDATE IT
10EB   D1                     POP   D   ;GET OLD H,L
10EC   21 00 00               LXI   H,0   ;GET A ZERO
10EF   E5           LIT2:     PUSH   H   ;GET 2 WORK BYTES
10F0   0D                     DCR   C   ;SUB 1 FROM COUNT
10F1   C2 EF 10               JNZ   LIT2   ;CONTINUE
10F4   39                     DAD   SP   ;GET ADDR OF STACK
10F5   D5                     PUSH   D   ;SAVE PTR TO STMT
10F6   EB                     XCHG      ;SAVE H,L IN D,E
10F7   2A 50 22               LHLD   EXPRS   ;GET START OF EXPR
10FA   23                     INX   H   ;PLUS ONE
10FB   72                     MOV   M,D   ;HI BYTE
10FC   23                     INX   H   ;POINT NEXT
10FD   73                     MOV   M,E   ;LO BYTE
10FE   23                     INX   H   ;POINT NEXT
10FF   36 E7                  MVI   M,0E7H   ;TYPE CODE
1101   22 50 22               SHLD   EXPRS   ;SAVE ADDR
1104   EB                     XCHG      ;D,E BACK TO H,L
1105   11 20 21               LXI   D,STRIN   ;POINT STRING AREA
1108   1A                     LDAX   D   ;GET COUNT
1109   3C                     INR   A   ;ADD ONE TO COUNT
110A   47                     MOV   B,A   ;SAVE CTR
110B   1A           LIT3:     LDAX   D   ;GET A BYTE
110C   77                     MOV   M,A   ;STORE IT
110D   23                     INX   H   ;POINT NEXT
110E   13                     INX   D   ;DITTO
110F   05                     DCR   B   ;DECR CTR
1110   C2 0B 11               JNZ   LIT3   ;LOOP
1113   E1                     POP   H   ;RESTORE H,L
1114   C3 29 11               JMP   LOOKO   ;NEXT IS OP
1117   EB           CERCE:    XCHG      ;SAVE H,L
1118   21 68 22               LXI   H,PARCT   ;POINT PAREN COUNT
111B   34                     INR   M   ;ADD 1
111C   2A 50 22               LHLD   EXPRS   ;GET ADDR
111F   23                     INX   H   ;POINT NEXT
1120   36 05                  MVI   M,5   ;PUT CODE
1122   22 50 22               SHLD   EXPRS   ;SAVE ADDR
1125   EB                     XCHG      ;RESTORE H,L
1126   C3 AD 10               JMP   SKPP   ;GO SKIP CHAR
1129   CF           LOOKO:    RST   1   ;SKIP BLANKS
112A   FE 2B                  CPI   "+"   ;TEST IF PLUS
112C   06 21                  MVI   B,21H   ;CODE
112E   CA 64 11               JZ   OP1   ;BRIF IS
1131   FE 2D                  CPI   "-"   ;TEST IF MINUS
1133   06 25                  MVI   B,25H   
1135   CA 64 11               JZ   OP1   ;BRIF IS
1138   FE 2F                  CPI   "/"   ;TEST IF DIVIDE
113A   06 45                  MVI   B,45H   ;CODE
113C   CA 64 11               JZ   OP1   ;BRIF IS
113F   FE 5E                  CPI   "^"   ;TEST IF EXPON
1141   06 81                  MVI   B,81H   ;CODE
1143   CA 64 11               JZ   OP1   ;BRIF IS
1146   FE 29                  CPI   ")"   ;TEST IF CLOSE PAREN
1148   CA B8 11               JZ   OP3   ;BRIF IS
114B   FE 2C                  CPI   ","   ;TEST IF COMMA
114D   CA A3 11               JZ   OP2   ;BRIF IS
1150   FE 2A                  CPI   "*"   ;TEST IF MULTIPLY
1152   06 41                  MVI   B,41H   ;CODE
1154   CA 64 11               JZ   OP1   ;BRIF IS
1157                             ; ELSE MUST BE END OF EXPRESSION
1157   3A 68 22     ENDXP:    LDA   PARCT   ;GET OPEN PAREN COUNT
115A   B7                     ORA   A   ;TEST IT
115B   C2 10 1C               JNZ   SNERR   ;BRIF # OF ("S NOT = # OF )"S
115E   22 56 22               SHLD   ADDR3   ;SAVE ADDR OF STMT
1161   C3 C6 11               JMP   EVAL   ;GO EVALUATE
1164   E5           OP1:      PUSH   H   ;SAVE PLACE IN ASCII EXPRESSION
1165   11 05 01               LXI   D,0105H   ;D=BYTE COUNT, E=CODE FOR "("
1168   2A 50 22               LHLD   EXPRS   ;POINT TO LAST BYTE
116B   78                     MOV   A,B   ;B&E3 -> C
116C   E6 E3                  ANI   0E3H   
116E   4F                     MOV   C,A   
116F                             ; INSERT ( AND EVALUATE IF PRECEDENCE REDUCTION,
116F                             ;   ELSE INNSERT OP CODE
116F   7E           OPLP1:    MOV   A,M   ;GET TYPE CODE FROM EXPRESSION
1170   F5                     PUSH   PSW   ;SAVE
1171   E6 03                  ANI   3   ;GET LENGTH
1173   14           OPLP2:    INR   D   ;BUMP BYTE COUNT
1174   2B                     DCX   H   ;EXPRESSION POINTER
1175   3D                     DCR   A   ;LOOP MOVES TO NEXT ELEMENT
1176   C2 73 11               JNZ   OPLP2   
1179   F1                     POP   PSW   ;RESTORE TYPE CODE
117A   E6 E3                  ANI   0E3H   ;MASK FOR VARIABLE
117C   FE E3                  CPI   0E3H   ;WE SKIP OVER VARIABLES
117E   CA 6F 11               JZ   OPLP1   ;BR IF TYPE = E3 OR E7
1181   B9                     CMP   C   ;PRECEDENCE REDUCTION?
1182   D2 8D 11               JNC   INS   ;IF NC, YES, INSERT 05
1185   2A 50 22               LHLD   EXPRS   ;NO, INSERT OPCODE BEFORE VAR AT END
1188   E7                     RST   4   ;SKIP OVER VARIABLE
1189   FD                     DB   -3   ; AND 0FFH
118A   16 04                  MVI   D,4   ;BYTE COUNT
118C   58                     MOV   E,B   ;INSERT THIS OP CODE
118D   43           INS:      MOV   B,E   ;SAVE FOR BRANCH AFTER INSERTION
118E   23           INS1:     INX   H   ;BUMP POINTER
118F   4E                     MOV   C,M   ;PICK UP BYTE
1190   70                     MOV   M,B   ;PUT DOWN REPLACEMENT
1191   41                     MOV   B,C   ;SAVE FOR NEXT LOOP
1192   15                     DCR   D   ;DONE?
1193   C2 8E 11               JNZ   INS1   ;IF NZ, NO
1196   22 50 22               SHLD   EXPRS   ;STORE POINTER
1199   E1                     POP   H   ;RESTORE ASCII EXPRESSION POINTER
119A   7B                     MOV   A,E   ;GET FLAG SAVED IN E
119B   FE 05                  CPI   5   ;STORED A "("?
119D   C2 AD 10               JNZ   SKPP   ;IF NZ, NO, PROCESS NEXT ELEMENT
11A0   C3 C3 11               JMP   OP4   ;YES, GO EVALUATE
11A3   3A 68 22     OP2:      LDA   PARCT   ;GET OPEN PAREN COUNT
11A6   B7                     ORA   A   ;TEST IT
11A7   CA 57 11               JZ   ENDXP   ;BRIF END OF EXPR
11AA   EB                     XCHG      ;ELSE SAVE H,L
11AB   2A 50 22               LHLD   EXPRS   ;GET EXPR BEGIN
11AE   23                     INX   H   ;POINT NEXT
11AF   36 01                  MVI   M,1   ;MOVE A COMMA
11B1   22 50 22               SHLD   EXPRS   ;UPDATE POINTER
11B4   EB                     XCHG      ;FLIP BACK
11B5   C3 AD 10               JMP   SKPP   
11B8   3A 68 22     OP3:      LDA   PARCT   ;GET OPEN PAREN COUNT
11BB   3D                     DCR   A   ;SUBTRACT ONE
11BC   32 68 22               STA   PARCT   ;SAVE IT
11BF   FA 10 1C               JM   SNERR   ;BRIF TOO MANY )'S
11C2   23                     INX   H   ;POINT NEXT SOURCE
11C3   22 56 22     OP4:      SHLD   ADDR3   ;SAVE ADDR
11C6   2A 50 22     EVAL:     LHLD   EXPRS   ;GET END OF EXPR
11C9   01 00 00               LXI   B,0   ;INIT B,C TO ZERO
11CC   04           EV1:      INR   B   ;COUNT EACH BYTE
11CD   7E                     MOV   A,M   ;GET CODE IN REG A
11CE   2B                     DCX   H   ;POINT NEXT
11CF   FE E3                  CPI   0E3H   ;TEST IF DATA
11D1   C2 DC 11               JNZ   EV2   ;BRIF NOT DATA
11D4   2B           EV1A:     DCX   H   ;POINT NEXT
11D5   2B                     DCX   H   ;DITTO
11D6   04                     INR   B   ;BUMP CTR
11D7   04                     INR   B   ;BY TWO
11D8   0C                     INR   C   ;COUNT THE TERM
11D9   C3 CC 11               JMP   EV1   ;LOOP
11DC   FE AF        EV2:      CPI   0AFH   ;TEST IF NUMERIC USER FN
11DE   CA BD 0E               JZ   FN   ;BRIF IS
11E1   FE CF                  CPI   0CFH   ;TEST IF STRING USER FN
11E3   CA BD 0E               JZ   FN   ;BRIF IS
11E6   F5                     PUSH   PSW   ;ELSE, SAVE STATUS
11E7   E6 E3                  ANI   0E3H   ;MASK IT
11E9   FE A3                  CPI   0A3H   ;TEST IF NUMERIC FUNCTION
11EB   CA FC 11               JZ   EV2A   ;BRIF IS
11EE   FE C3                  CPI   0C3H   ;TEST IF STRING FUNCTION
11F0   CA FC 11               JZ   EV2A   ;BRIF IS
11F3   F1                     POP   PSW   ;RESTORE CODE
11F4   FE E7                  CPI   0E7H   ;TEST IF STRING ADDR
11F6   CA D4 11               JZ   EV1A   ;BRIF IS
11F9   C3 84 12               JMP   EV5   ;BR AROUND
11FC   23           EV2A:     INX   H   ;RESET TO TYPE CODE
11FD   22 52 22               SHLD   ADDR1   ;SAVE ADDR
1200   D1                     POP   D   ;DUMMY POP
1201   C5                     PUSH   B   ;SAVE CTRS
1202   2B                     DCX   H   ;POINT TO LOW JMP ADDR
1203   5E                     MOV   E,M   ;LOW BYTE
1204   2B                     DCX   H   ;POINT BACK
1205   56                     MOV   D,M   ;HIGH BACK
1206   22 54 22               SHLD   ADDR2   ;SAVE LOCATION
1209   21 13 12               LXI   H,EV3   ;GET RETURN ADDRESS
120C   E5                     PUSH   H   ;SAVE ON STACK
120D   D5                     PUSH   D   ;SAVE ADDRESS
120E   CD 75 1C               CALL   ARG   ;GO GET 1ST ARG
1211   E1                     POP   H   ;GET H,L ADDRESS
1212   E9                     PCHL      ;GO EXECUTE THE FUNCTION
1213                EV3:      EQU   $   ;FUNCTIONS RETURN HERE
1213   2A 54 22               LHLD   ADDR2   ;GET ADDR FUNC
1216   23                     INX   H   ;POINT LO
1217   23                     INX   H   ;POINT TYPE
1218   7E                     MOV   A,M   ;LOAD IT
1219   E6 E0                  ANI   0E0H   ;MASK IT
121B   FE C0                  CPI   0C0H   ;TEST IF STRING
121D   CA 58 12               JZ   EV4   ;BRIF IS
1220   C1                     POP   B   ;GET CTRS
1221   2A 69 22               LHLD   SPCTR   ;GET COUNTER
1224   23                     INX   H   ;PLUS
1225   23                     INX   H   ;TWO WORDS
1226   22 69 22               SHLD   SPCTR   ;STORE IT
1229   21 00 00               LXI   H,0   ;LOAD ZERO TO H,L
122C   E5                     PUSH   H   ;GET BLOCK OF
122D   E5                     PUSH   H   ;BYTES
122E   39                     DAD   SP   ;GET STACK ADDR
122F   C5                     PUSH   B   ;SAVE CTRS
1230   E5                     PUSH   H   ;SAVE ADDR
1231   DF                     RST   3   ;GO STORE THE VARIABLE
1232   3E E3                  MVI   A,0E3H   ;TYPE=NUM
1234   D1           EV3A:     POP   D   ;GET ADDR IN STACK
1235   2A 52 22               LHLD   ADDR1   ;GET ADDR LST ARG
1238   77                     MOV   M,A   ;STORE TYPE CODE
1239   2B                     DCX   H   ;POINT ONE BACK
123A   73                     MOV   M,E   ;STORE LO ADDR
123B   2B                     DCX   H   ;POINT BACK
123C   72                     MOV   M,D   ;STORE HI ADDR
123D   2A 54 22               LHLD   ADDR2   ;GET LOCATION FUNCTION
1240   23                     INX   H   ;POINT LO
1241   23                     INX   H   ;POINT TYPE
1242   7E                     MOV   A,M   ;LOAD TYPE
1243   46                     MOV   B,M   ;GET TYPE
1244   E7                     RST   4   ;ADJUST H,L
1245   FD                     DB   -3   ; AND 0FFH
1246   78                     MOV   A,B   ;LOAD TYPE
1247   C1                     POP   B   ;RESTORE CTRS
1248   E6 18                  ANI   18H   ;ISOLATE #ARGS
124A   1F                     RAR      ;SHIFT RIGHT
124B   1F                     RAR      ;AGAIN
124C   1F                     RAR      ;ONCE MORE
124D   57                     MOV   D,A   ;SAVE IT
124E   82                     ADD   D   ;TIMES 2
124F   82                     ADD   D   ;TIMES 3
1250   04                     INR   B   ;POINT
1251   04                     INR   B   ;LST POSIT IN LOC
1252   CD E3 1A               CALL   SQUIS   ;GO COMPRESS STACK
1255   C3 C6 11               JMP   EVAL   ;START AT BEGINNING
1258   11 20 21     EV4:      LXI   D,STRIN   ;POINT STRING BUFFER
125B   1A                     LDAX   D   ;LOAD IT
125C   1F                     RAR      ;DIVIDE BY TWO
125D   3C                     INR   A   ;ADD 1
125E   2A 69 22               LHLD   SPCTR   ;GET SP COUNT
1261   4F                     MOV   C,A   ;SAVE LO
1262   06 00                  MVI   B,0   ;SET HI
1264   09                     DAD   B   ;ADD NUMBER WORDS
1265   22 69 22               SHLD   SPCTR   ;SAVE SP COUNT
1268   21 00 00               LXI   H,0   ;GET SOME ZEROS
126B   C1                     POP   B   ;GET CTRS
126C   E5           EV4A:     PUSH   H   ;GET 1 WORD
126D   3D                     DCR   A   ;DECR CTR
126E   C2 6C 12               JNZ   EV4A   ;LOOP
1271   39                     DAD   SP   ;GET ADDRESS IN H,L
1272   C5                     PUSH   B   ;RE-SAVE CTRS
1273   E5                     PUSH   H   ;SAVE ADDR
1274   1A                     LDAX   D   ;GET COUNT
1275   3C                     INR   A   ;PLUS ONE
1276   47                     MOV   B,A   ;SAVE IT
1277   1A           EV4B:     LDAX   D   ;GET A BYTE
1278   77                     MOV   M,A   ;STORE IT
1279   13                     INX   D   ;POINT NEXT
127A   23                     INX   H   ;DITTO
127B   05                     DCR   B   ;DECR CTR
127C   C2 77 12               JNZ   EV4B   ;LOOP
127F   3E E7                  MVI   A,0E7H   ;TYPE CODE
1281   C3 34 12               JMP   EV3A   ;CONTINUE
1284   FE 05        EV5:      CPI   5   ;TEST IF OPEN PAREN
1286   C2 A2 12               JNZ   EV6   ;BRIF NOT
1289   3E 01                  MVI   A,1   ;DELETE 1 BYTE
128B   CD E3 1A               CALL   SQUIS   ;GO COMPRESS IT
128E   2A 56 22               LHLD   ADDR3   ;RESTORE STMT POINTER
1291   3A 72 20               LDA   DIMSW   ;GET SUBSR SWITCH
1294   B7                     ORA   A   ;TEST IT
1295   CA 29 11               JZ   LOOKO   ;BRIF NOT IN SUBS^CRIPT
1298   3A 68 22               LDA   PARCT   ;GET OPEN PAREN COUNT
129B   B7                     ORA   A   ;TEST
129C   C2 29 11               JNZ   LOOKO   ;BRIF NOT ZERO
129F   C3 C6 11               JMP   EVAL   ;ELSE EVALUATE COMPLETE SUBSCR
12A2   B7           EV6:      ORA   A   ;TEST IF END OF EXPRESSION
12A3   C2 D3 12               JNZ   EV9   ;BRIF NOT
12A6   3A 72 20               LDA   DIMSW   ;GET DIM SW
12A9   B7                     ORA   A   ;TEST IT
12AA   C4 A9 13               CNZ   EDM1   ;BRIF NOT OFF
12AD   79                     MOV   A,C   ;GET TERM COUNT
12AE   FE 01                  CPI   1   ;TEST IF ONE
12B0   C2 0C 1C               JNZ   STERR   ;ERROR IF NOT ONE
12B3   23                     INX   H   ;POINT HIGH ADDR
12B4   23                     INX   H   ;SAME
12B5   56                     MOV   D,M   ;HIGH TO D
12B6   23                     INX   H   ;POINT LOW
12B7   5E                     MOV   E,M   ;LOW TO E
12B8   CD 8F 13               CALL   EVLD   ;GO LOAD VALUE
12BB   2A 69 22               LHLD   SPCTR   ;GET STACK CTR
12BE   7D           EV7:      MOV   A,L   ;GET LO BYTE
12BF   B4                     ORA   H   ;PLUS HI
12C0   CA C8 12               JZ   DV8   ;BRIF ZERO
12C3   D1                     POP   D   ;RETURN 2 BYTES
12C4   2B                     DCX   H   ;DECR CTR
12C5   C3 BE 12               JMP   EV7   ;LOOP
12C8   3A 72 20     DV8:      LDA   DIMSW   ;GET DIM SW
12CB   B7                     ORA   A   ;TEST IT
12CC   C4 D0 13               CNZ   EDM4   ;BRIF ON
12CF   2A 56 22               LHLD   ADDR3   ;RESTORE STMT PTR
12D2   C9                     RET      ;RETURN TO STMT PROCESSOR
12D3   FE 21        EV9:      CPI   21H   ;TEST IF PLUS
12D5   11 27 13               LXI   D,FADDJ   ;ADDR
12D8   CA 05 13               JZ   EV10   ;BRIF IS
12DB   FE 25                  CPI   25H   ;TEST IF MINUS
12DD   11 18 17               LXI   D,FSUB   ;ADDR
12E0   CA 05 13               JZ   EV10   ;BRIF IS
12E3   FE 41                  CPI   41H   ;TEST IF MUL
12E5   11 24 17               LXI   D,FMUL   ;ADDR
12E8   CA 05 13               JZ   EV10   ;BRIF IS
12EB   FE 45                  CPI   45H   ;TEST IF DIV
12ED   11 A7 17               LXI   D,FDIV   ;ADDR
12F0   CA 05 13               JZ   EV10   ;BRIF IS
12F3   FE 01                  CPI   1   ;TEST IF COMMA
12F5   CA 83 13               JZ   EVCOM   ;BRIF IS
12F8   FE 61                  CPI   61H   ;TEST IF UNARY MINUS
12FA   CA 6F 13               JZ   EVNEG   ;BRIF IS
12FD   FE 81                  CPI   81H   ;TEST IF EXPONENTIAL
12FF   11 2F 13               LXI   D,POWER   ;ADDR
1302   C2 0C 1C               JNZ   STERR   ;ERROR IF NOT
1305   23           EV10:     INX   H   ;POINT TO
1306   23                     INX   H   ;1ST DATA
1307   C5                     PUSH   B   ;SAVE CTRS
1308   D5                     PUSH   D   ;SAVE ROUTINE ADDR
1309   56                     MOV   D,M   ;HIGH TO D
130A   23                     INX   H   ;POINT NEXT
130B   5E                     MOV   E,M   ;LOW TO E
130C   E5                     PUSH   H   ;SAVE POINTER
130D   CD 8F 13               CALL   EVLD   ;GO LOAD VALUE
1310   E1                     POP   H   ;RESTORE H,L
1311   23                     INX   H   ;POINT 2ND DATA
1312   23                     INX   H   ;SAME
1313   56                     MOV   D,M   ;HIGH TO D
1314   23                     INX   H   ;POINT NEXT
1315   5E                     MOV   E,M   ;LOW TO E
1316   23                     INX   H   ;POINT NEXT
1317   3A 8E 22               LDA   NS   ;GET PREV TYPE
131A   BE                     CMP   M   ;TEST THIS TYPE
131B   C2 10 1C               JNZ   SNERR   ;BRIF MIXED MODE
131E   2B                     DCX   H   ;POINT BACK
131F   E3                     XTHL      ;POP ADDR FROM STACK, PUSH H ONTO
1320   01 5E 13               LXI   B,EV11   ;RETURN ADDRESS
1323   C5                     PUSH   B   ;SAVE ON STACK
1324   E5                     PUSH   H   ;SAVE JUMP ADDR
1325   EB                     XCHG      ;PUT VAR ADDR TO H,L
1326   C9                     RET      ;FAKE CALL TO ROUTINE
1327   FE E7        FADDJ:    CPI   0E7H   ;TEST IF STRINGS
1329   CA 32 0D               JZ   CONCA   ;BRIF IS
132C   C3 43 16               JMP   FADD   ;ELSE, GO ADD
132F   E5           POWER:    PUSH   H   ;SAVE ADDR OF VAR
1330   21 2F 22               LXI   H,TEMP1   ;POINT SAVE AREA
1333   DF                     RST   3   ;SAVE X
1334   E1                     POP   H   ;RESTORE H,L
1335   EF                     RST   5   ;LOAD IT
1336   CD DA 18               CALL   FTEST   ;TEST FOR ZERO
1339   CA E2 0B               JZ   SGN1   ;GIVE RESULT = 1 IF POWER = 0
133C   21 47 22               LXI   H,TEMP7   ;POINT SAVE AREA
133F   DF                     RST   3   ;SAVE B
1340   21 2F 22               LXI   H,TEMP1   ;POINT X
1343   EF                     RST   5   ;GO LOAD IT
1344   CD DA 18               CALL   FTEST   ;TEST FOR ZERO
1347   C8                     RZ      ;0^X = 0
1348   CD 1F 0B               CALL   LN   ;GET NATURAL LNRITHM
134B   21 47 22               LXI   H,TEMP7   ;POINT B
134E   CD 24 17               CALL   FMUL   ;GO MULTIPLY
1351   C3 76 0B               JMP   EXP   ;GET EXP FUNC
1354                             ; X^B = EXP(B*LN(X))
1354   21 2F 22     XSQR:     LXI   H,TEMP1   ;POINT X
1357   EF                     RST   5   ;LOAD X
1358   21 2F 22               LXI   H,TEMP1   ;POINT X
135B   C3 24 17               JMP   FMUL   ;TIMES X
135E   E1           EV11:     POP   H   ;GET H,L
135F   C1                     POP   B   ;GET CTRS
1360   2B                     DCX   H   ;POINT BACK
1361   2B                     DCX   H   ;AND AGAIN
1362   CD 01 1B               CALL   GTEMP   ;GO SAVE FACC
1365   E7                     RST   4   ;ADJUST H,L
1366   F9                     DB   -7   ; AND 0FFH
1367   3E 04                  MVI   A,4   ;DELETE 4 BYTES
1369   CD E3 1A               CALL   SQUIS   ;GO COMPRESS
136C   C3 C6 11               JMP   EVAL   ;CONTINUE
136F   23           EVNEG:    INX   H   ;POINT BACK TO OP
1370   C5                     PUSH   B   ;SAVE CTRS
1371   E5                     PUSH   H   ;SAVE H,L
1372   23                     INX   H   ;DITTO
1373   56                     MOV   D,M   ;GET HI BYTE
1374   23                     INX   H   ;POINT NEXT
1375   5E                     MOV   E,M   ;GET LO BYTE
1376   CD 8F 13               CALL   EVLD   ;GO LOAD VAR
1379   CD 86 0C               CALL   NEG   ;GO NEGATE IT
137C   E1                     POP   H   ;GET LOCATINO
137D   C1                     POP   B   ;GET CTRS
137E   CD 01 1B               CALL   GTEMP   ;GO STORE FACC IN STACK
1381   E7                     RST   4   ;ADJUST H,L
1382   FC                     DB   -4   ; AND 0FFH
1383   3E 01        EVCOM:    MVI   A,1   ;DELETE 1 BYTE
1385   CD E3 1A               CALL   SQUIS   ;COMPRESS
1388   21 6B 22               LXI   H,CMACT   ;GET COUNT
138B   34                     INR   M   ;INCR
138C   C3 C6 11               JMP   EVAL   ;CONTINUE
138F   23           EVLD:     INX   H   ;POINT TYPE
1390   7E                     MOV   A,M   ;LOAD IT
1391   32 8E 22               STA   NS   ;SAVE IT
1394   EB                     XCHG      ;SAVE H,L IN D,E
1395   FE E7                  CPI   0E7H   ;TEST IF STRING
1397   C2 28 00               JNZ   RST5   ;LOAD FLOATING POINT
139A   11 20 21               LXI   D,STRIN   ;POINT BUFFER
139D   7E                     MOV   A,M   ;GET COUNT
139E   3C                     INR   A   ;ADD ONE
139F   47                     MOV   B,A   ;SAVE COUNT
13A0   7E           EVLD1:    MOV   A,M   ;GET NEXT
13A1   12                     STAX   D   ;STORE IT
13A2   23                     INX   H   ;POINT NEXT
13A3   13                     INX   D   ;DITTO
13A4   05                     DCR   B   ;DECR COUNT
13A5   C2 A0 13               JNZ   EVLD1   ;LOOP
13A8   C9                     RET      ;RETURN
13A9                             ; 
13A9   79           EDM1:     MOV   A,C   ;GET ITEM COUNT
13AA   E5                     PUSH   H   ;SAVE H,L
13AB   FE 01                  CPI   1   ;TEST IF 1
13AD   C2 BC 13               JNZ   EDM3   ;BRIF NOT
13B0   06 04                  MVI   B,4   ;GET COUNT
13B2   21 2F 22               LXI   H,TEMP1   ;POINT AREA
13B5   CD 5F 1C               CALL   ZEROM   ;GO ZERO IT
13B8   E1           EDM2A:    POP   H   ;RESTORE H,L
13B9   0E 01                  MVI   C,1   ;SET COUNT
13BB   C9                     RET      ;RETURN
13BC   FE 02        EDM3:     CPI   2   ;TEST IF 2
13BE   C2 10 1C               JNZ   SNERR   ;ELSE, ERROR
13C1   E7                     RST   4   ;POINT 2ND ARG
13C2   05                     DB   5   
13C3   56                     MOV   D,M   ;GET HI ADDR
13C4   23                     INX   H   ;POINT NEXT
13C5   5E                     MOV   E,M   ;GET LO ADDR
13C6   CD 8F 13               CALL   EVLD   ;LOAD THE ARG
13C9   21 2F 22               LXI   H,TEMP1   ;POINT AREA
13CC   DF                     RST   3   ;SAVE THE ARG
13CD   C3 B8 13               JMP   EDM2A   ;CONTINUE
13D0   CD 38 1F     EDM4:     CALL   FACDE   ;CONVERT FACC TO D,E
13D3   D5                     PUSH   D   ;PUT D,E TO B,C
13D4   C1                     POP   B   
13D5   C5                     PUSH   B   ;SAVE COL
13D6   21 2F 22               LXI   H,TEMP1   ;POINT 2ND ARGUMENT
13D9   EF                     RST   5   ;LOAD IT IN FACC
13DA   CD 38 1F               CALL   FACDE   ;CONVERT TO D,E
13DD   C1                     POP   B   ;GET COL
13DE   AF                     XRA   A   ;GET A ZERO
13DF   32 72 20               STA   DIMSW   ;RESET SW
13E2   C9                     RET      ;RETURN
13E3   78           LDV2A:    MOV   A,B   ;GET HI NAME
13E4   F6 80                  ORI   80H   ;SET BIT
13E6   47                     MOV   B,A   ;RESTORE
13E7   C5                     PUSH   B   ;SAVE NAME
13E8   EB                     XCHG      ;SAVE H,L IN D,E
13E9   3A 68 22               LDA   PARCT   ;GET PAREN COUNT
13EC   F5                     PUSH   PSW   ;SAVE
13ED   AF                     XRA   A   ;CLEAR REG A
13EE   32 68 22               STA   PARCT   ;RESET COUNT
13F1   2A 69 22               LHLD   SPCTR   ;GET STACK COUNTER
13F4   E5                     PUSH   H   ;SAVE IT
13F5   21 00 00               LXI   H,0   ;GET A ZERO
13F8   22 69 22               SHLD   SPCTR   ;RESET CTR
13FB   2A 50 22               LHLD   EXPRS   ;GET EXPRST
13FE   E5                     PUSH   H   ;SAVE IT
13FF   23                     INX   H   ;POINT NEXT
1400   36 00                  MVI   M,0   ;SET NEW START
1402   22 50 22               SHLD   EXPRS   ;SAVE IT
1405   3A 72 20               LDA   DIMSW   ;GET PREV SE
1408   F5                     PUSH   PSW   ;SAVE IT
1409   EB                     XCHG      ;RESTORE H,L
140A   3E FF                  MVI   A,0FFH   ;GET ON VALUE
140C   32 72 20               STA   DIMSW   ;SET SW
140F   CD A1 0F               CALL   LOOKD   ;RECURSIVE CALL
1412   F1                     POP   PSW   ;GET DIM SW
1413   32 72 20               STA   DIMSW   ;REPLACE IT
1416   22 56 22               SHLD   ADDR3   ;SAVE H,L
1419   E1                     POP   H   ;GET EXPRST
141A   22 50 22               SHLD   EXPRS   ;SAVE IT
141D   E1                     POP   H   ;GET STACK COUNTER
141E   22 69 22               SHLD   SPCTR   ;RESTORE IT
1421   F1                     POP   PSW   ;GET PAREN COUNT
1422   32 68 22               STA   PARCT   ;RESTORE IT
1425   E1                     POP   H   ;GET NAME
1426   D5                     PUSH   D   ;SAVE ROW
1427   C5                     PUSH   B   ;SAVE COL
1428   EB                     XCHG      ;PUT NAME IN D,E
1429   CD 35 1B               CALL   SEARC   ;GO FIND ADDRESS (PUT IN D,E)
142C   D1                     POP   D   ;GET ADDR
142D   C1                     POP   B   ;RESTORE COL
142E   D1                     POP   D   ;RESTORE ROW
142F   CD 91 18               CALL   SUBSC   ;GET SUBSCRIPT (RETURNS ADDR IN H,L)
1432   EB                     XCHG      ;SAVE IN D,E
1433   2A 56 22               LHLD   ADDR3   ;GET H,L
1436   E5                     PUSH   H   ;SAVE ON STACK
1437   C3 EA 0F               JMP   LDV   ;CONTINUE
143A                             ;       PAGE
143A                             ; 
143A                FIN:      EQU   $   
143A                             ; 
143A                             ; FLOATING POINT INPUT CONVERSION ROUTINE
143A                             ; 
143A                             ; THIS SUBROUTINE CONVERTS AN ASCII STRING OF CHARACTERS
143A                             ; TO THE FLOATING POINT ACCUMULATOR.  THE INPUT FIELD
143A                             ; MAY CONTAIN ANY VALID NUMBER, INCLUDING SCIENTIFIC
143A                             ; NOTATION (NNN.NNNNE+NN).
143A                             ; THE INPUT STRING IS TERMINATED BY ANY NON-NUMERIC CHAR
143A                             ; 
143A                             ; 
143A   EB                     XCHG      ;PUT ADDR TO D,E
143B   0E 00                  MVI   C,0   ;INITIAL VALUE EXCESS DIGIT COUNT
143D   CD 94 14               CALL   FIN8   ;GET INTEGER PORTION
1440   06 00                  MVI   B,0   ;CLEAR DIGIT COUNT
1442   FE 2E                  CPI   "."   ;TEST IF DEC-POINT
1444   C2 4A 14               JNZ   FIN2   ;BRIF NOT
1447   CD AE 14               CALL   FIN9   ;GET FRACTION
144A   F1           FIN2:     POP   PSW   ;GET SIGN
144B   F6 18                  ORI   24   ;SET UP FOR FLOAT
144D   32 58 22               STA   FACC   
1450   78                     MOV   A,B   ;GET # FRACTION DIGITS
1451   81                     ADD   C   ;+ EXCESS DIGITS
1452   F5                     PUSH   PSW   ;SAVE POWER OF TEN
1453   D5                     PUSH   D   ;SAVE PTR
1454   CD E9 16               CALL   FNORM   ;NORMALIZE NUMBER
1457   1A                     LDAX   D   ;GET NEXT CHARACTER
1458   FE 45                  CPI   "E"   ;TEST IF EXPONENT
145A   C2 78 14               JNZ   FIN4   ;BRIF NOT
145D   21 5C 22               LXI   H,FTEMP   ;POINT SAVE AREA
1460   DF                     RST   3   ;SAVE ACC
1461   D1                     POP   D   ;RESTORE PTR
1462   13                     INX   D   ;SKIP "E"
1463   CD 94 14               CALL   FIN8   ;GET NUMERIC EXP
1466   3A 5B 22               LDA   FACC+3   ;GET EXPONENT
1469   C1                     POP   B   ;EXPONENT SIGN
146A   04                     INR   B   ;TEST
146B   F2 70 14               JP   FIN3   ;BRIF NOT NEG
146E   2F                     CMA      ;NEGATE EXPONENT
146F   3C                     INR   A   
1470   C1           FIN3:     POP   B   ;POWER OF TEN
1471   80                     ADD   B   ;ADD EXPONENT
1472   F5                     PUSH   PSW   ;SAVE COUNT
1473   21 5C 22               LXI   H,FTEMP   ;RESTORE NUMBER
1476   D5                     PUSH   D   ;SAVE PTR
1477   EF                     RST   5   ;LOAD IT
1478   E1           FIN4:     POP   H   ;RESTORE PTR
1479   F1                     POP   PSW   ;RESTORE COUNT
147A   C8           FIN5:     RZ      ;RETURN IF ZERO
147B   E5                     PUSH   H   ;SAVE H,L
147C   21 A1 1D               LXI   H,TEN   ;POINT CONSTANT: 10
147F   FA 8C 14               JM   FIN7   ;BRIF DIVIDE NEEDED
1482   3D                     DCR   A   ;DECR COUNT
1483   F5                     PUSH   PSW   ;SAVE COUNT
1484   CD 24 17               CALL   FMUL   ;GO MULTIPLY BY 10
1487   F1           FIN6:     POP   PSW   ;RESTORE COUNT
1488   E1                     POP   H   ;RESTORE H,L
1489   C3 7A 14               JMP   FIN5   ;CONTINUE
148C   3C           FIN7:     INR   A   ;INCR COUNT
148D   F5                     PUSH   PSW   ;SAVE COUNT
148E   CD A7 17               CALL   FDIV   ;GO DIVIDE BY 10
1491   C3 87 14               JMP   FIN6   ;LOOP
1494                             ; 
1494                             ; FIN8  CONVERT NUMBER STRING TO FACC
1494                             ; ON ENTRY, C=INIT VALUE EXCESS DIGIT COUNT
1494                             ;             DE=INPUT STRING
1494                             ; ON EXIT, SIGN IS ON STACK
1494                             ;       B=DIGIT COUNT
1494                             ;       C=EXCESS DIGIT COUNT
1494                             ; 
1494   21 58 22     FIN8:     LXI   H,FACC   ;CLEAR FACC
1497   06 04                  MVI   B,4   
1499   CD 5F 1C               CALL   ZEROM   
149C   21 00 80               LXI   H,8000H   ;ASSUME MINUS
149F   1A                     LDAX   D   ;GET CHAR
14A0   FE 2D                  CPI   "-"   
14A2   CA AC 14               JZ   FIN8A   
14A5   65                     MOV   H,L   ;NOPE, MUST BE PLUS
14A6                             ;(B IS CLEARED BY ZEROM)
14A6   FE 2B                  CPI   "+"   
14A8   CA AC 14               JZ   FIN8A   
14AB   1B                     DCX   D   ;NEITHER, BACK UP POINTER
14AC   E3           FIN8A:    XTHL      ;GET RETURN, PUSH SIGN
14AD   E5                     PUSH   H   ;RESTORE RETURN
14AE   13           FIN9:     INX   D   ;POINT NEXT
14AF   1A                     LDAX   D   ;GET CHAR
14B0   FE 30                  CPI   "0"   ;TEST IF LESS ZERO
14B2   D8                     RC      ;RETURN IF IS
14B3   FE 3A                  CPI   "9"+1   ;TEST IF GT NINE
14B5   D0                     RNC      ;RETURN IF IS
14B6   05                     DCR   B   ;DIGIT COUNT
14B7   D5                     PUSH   D   ;SAVE PTR
14B8   C5                     PUSH   B   ;SAVE COUNTERS
14B9   CD E1 14               CALL   FMTEN   ;MULTIPLY FACC*TEN
14BC   B7                     ORA   A   ;TEST FOR OVERFLOW
14BD   CA CA 14               JZ   FINB   ;BRIF NO OVERFLOW
14C0   21 60 22               LXI   H,FTEMP+4   
14C3   EF                     RST   5   ;RESTORE OLD FACC
14C4   C1                     POP   B   ;RESTORE COUNTERS
14C5   0C                     INR   C   ;EXCESS DIGIT
14C6   D1                     POP   D   
14C7   C3 AE 14               JMP   FIN9   
14CA   C1           FINB:     POP   B   ;RSTORE COUNTERS
14CB   D1                     POP   D   ;& PTR
14CC   1A                     LDAX   D   ;GET THE DIGIT
14CD   E6 0F                  ANI   0FH   ;MASK OFF ZONE
14CF   21 5B 22               LXI   H,FACC+3   ;POINT ACC
14D2   86                     ADD   M   ;ADD
14D3   77                     MOV   M,A   ;STORE
14D4   2B                     DCX   H   ;POINT NEXT
14D5   7E                     MOV   A,M   ;LOAD
14D6   CE 00                  ACI   0   ;PLUS CARRY
14D8   77                     MOV   M,A   ;STORE
14D9   2B                     DCX   H   ;POINT NEXT
14DA   7E                     MOV   A,M   ;LOAD
14DB   CE 00                  ACI   0   ;PLUS CARRY
14DD   77                     MOV   M,A   ;STORE
14DE   C3 AE 14               JMP   FIN9   ;LOOP
14E1                             ; 
14E1                             ; MULTIPLY FACC BY TEN
14E1                             ; 
14E1   21 60 22     FMTEN:    LXI   H,FTEMP+4   
14E4   DF                     RST   3   ;SAVE FACC
14E5   CD F1 14               CALL   FIND   ;*2
14E8   CD F1 14               CALL   FIND   ;*4
14EB   21 63 22               LXI   H,FTEMP+7   
14EE   CD F4 14               CALL   FIND0   ;*5
14F1   21 5B 22     FIND:     LXI   H,FACC+3   ;DOUBLE FACC
14F4   11 5B 22     FIND0:    LXI   D,FACC+3   
14F7   06 04                  MVI   B,4   ;BYTE COUNT
14F9   C3 FC 18               JMP   FADDT   ;ADD & RETURN
14FC                             ;PAGE
14FC                             ; 
14FC                FOUT:     EQU   $   
14FC                             ; 
14FC                             ; FLOATING POINT OUTPUT FORMAT ROUTINE
14FC                             ; 
14FC                             ; THIS SUBROUTINE CONVERTS A NUMBER IN FACC TO A
14FC                             ; FORMAT SUITABLE FOR PRINTING.  THAT IS, THE
14FC                             ; NUMBER WILL BE IN SCIENTIFIC NOTATION IF EXPONENT
14FC                             ; IS > 5 OR < -2, OTHERWISE IT WILL BE ZERO SUPRESSED
14FC                             ; ON BOTH SIDES.
14FC                             ; 
14FC   11 5B 22               LXI   D,FACC+3   ;POINT LSB
14FF   1A                     LDAX   D   ;LOAD IT
1500   F6 07                  ORI   7   ;MASK FOR OUTPUT
1502   12                     STAX   D   ;REPLACE
1503   CD DA 18               CALL   FTEST   ;GET SIGN OF NUMBER
1506   36 20                  MVI   M," "   ;DEFAULT SPACE
1508   F2 0D 15               JP   FOUT0   ;BRIF NOT MINUS
150B   36 2D                  MVI   M,"-"   ;MOVE DASH
150D   23           FOUT0:    INX   H   ;POINT NEXT
150E   C2 17 15               JNZ   FOUT2   ;BRIF NOT ZERO
1511   36 30                  MVI   M,"0"   ;MOVE THE ZERO
1513   23                     INX   H   ;POINT NEXT
1514   36 20                  MVI   M," "   ;MOVE SPACE FOLLOWING
1516   C9                     RET      ;RETURN
1517   3A 58 22     FOUT2:    LDA   FACC   ;GET SIGN & EXP
151A   CD E8 18               CALL   FEXP   ;EXPAND EXPONENT
151D   C2 22 15               JNZ   FOUTV   ;BRIF NOT ZERO
1520   3E 80                  MVI   A,80H   ;SET NEG
1522   E6 80        FOUTV:    ANI   80H   ;ISOLATE
1524   32 75 22               STA   DEXP   ;SAVE SIGN
1527   E5                     PUSH   H   ;SAVE H,L
1528   3A 58 22     FOUT3:    LDA   FACC   ;GET SIGN & EXP
152B   CD E8 18               CALL   FEXP   ;EXPAND EXP
152E   FE 01                  CPI   1   ;TEST RANGE
1530   F2 49 15               JP   FOUT6   ;BRIF IN RANGE
1533   21 75 22     FOUT4:    LXI   H,DEXP   ;POINT DEC.EXP
1536   34                     INR   M   ;INCR IT
1537   21 A1 1D               LXI   H,TEN   ;POINT CONST: 10
153A   F2 43 15               JP   FOUT5   ;BRIF POS.
153D   CD 24 17               CALL   FMUL   ;MULTIPLY
1540   C3 28 15               JMP   FOUT3   ;LOOP
1543   CD A7 17     FOUT5:    CALL   FDIV   ;DIVIDE
1546   C3 28 15               JMP   FOUT3   ;LOOP
1549   FE 05        FOUT6:    CPI   5   ;TEST HIGH RANGE
154B   F2 33 15               JP   FOUT4   ;BRIF 5 OR GREATER
154E   21 5C 22               LXI   H,FTEMP   ;POINT SAVE AREA
1551   DF                     RST   3   ;STORE IT
1552   3A 58 22               LDA   FACC   ;GET EXPONENT
1555   CD E8 18               CALL   FEXP   ;EXPAND
1558   0E 06                  MVI   C,6   ;DIGIT COUNT
155A   CD 8E 15               CALL   FOUTB   ;SHIFT LEFT
155D   FE 0A                  CPI   10   ;TEST IF DECIMAL POINT
155F   FA 69 15               JM   FOUTU   ;BRIF LT
1562   21 5C 22               LXI   H,FTEMP   ;POINT SAVE AREA
1565   EF                     RST   5   ;LOAD IT
1566   C3 33 15               JMP   FOUT4   ;ONCE MORE
1569   CD 7C 15     FOUTU:    CALL   FOUT9   ;PUT DIGIT
156C   AF           FOUT7:    XRA   A   ;CLEAR STATUS
156D   32 58 22               STA   FACC   ;AND OVERFLOW
1570   CD E1 14               CALL   FMTEN   ;MULTIPLY BY TEN
1573   CD 7C 15               CALL   FOUT9   ;PUT DIGIT
1576   C2 6C 15               JNZ   FOUT7   ;LOOP
1579   C3 A5 15               JMP   FOUTH   ;GO AROUND
157C   F6 30        FOUT9:    ORI   30H   ;DEC. ZONE
157E   E1                     POP   H   ;GET RETURN ADDR
157F   E3                     XTHL      ;EXCH WITH TOP (PTR)
1580   77                     MOV   M,A   ;PUT DIGIT
1581   23                     INX   H   ;POINT NEXT
1582   79                     MOV   A,C   ;GET COUNT
1583   FE 06                  CPI   6   ;TEST IF 1ST
1585   C2 8B 15               JNZ   FOUTA   ;BRIF NOT
1588   36 2E                  MVI   M,"."   ;MOVE DEC. PT.
158A   23                     INX   H   ;POINT NEXT
158B   E3           FOUTA:    XTHL      ;EXCH WITH RTN
158C   0D                     DCR   C   ;DECR COUNT
158D   E9                     PCHL      ;RETURN
158E   5F           FOUTB:    MOV   E,A   ;SAVE BIT COUNT
158F   AF                     XRA   A   ;CLEAR ACC FLAGS
1590   32 58 22               STA   FACC   ;AND OVERFLOW
1593   21 5B 22     FOUTC:    LXI   H,FACC+3   ;POINT LSB
1596   06 04                  MVI   B,4   ;BYTE COUNT
1598   7E           FOUTD:    MOV   A,M   ;GET A BYTE
1599   17                     RAL      ;SHIFT LEFT
159A   77                     MOV   M,A   ;STORE
159B   2B                     DCX   H   ;POINT NEXT
159C   05                     DCR   B   ;DECR CTR
159D   C2 98 15               JNZ   FOUTD   ;LOOP
15A0   1D                     DCR   E   ;DECR BIT CTR
15A1   C2 93 15               JNZ   FOUTC   ;LOOP
15A4   C9                     RET      ;RETURN
15A5   E1           FOUTH:    POP   H   ;GET PTR
15A6   36 45                  MVI   M,"E"   ;EXPONENT
15A8   23                     INX   H   ;POINT NEXT
15A9   3A 75 22               LDA   DEXP   ;GET EXPONENT
15AC   36 2B                  MVI   M,"+"   ;DEFAULT
15AE   57                     MOV   D,A   ;SAVE NUMBER
15AF   B7                     ORA   A   ;TEST IT
15B0   F2 BC 15               JP   FOUTI   ;BRIF POS
15B3   36 2D                  MVI   M,"-"   ;ELSE, DASH
15B5   E6 7F                  ANI   7FH   ;STRIP DUMB SIGN
15B7   2F                     CMA      ;COMPLEMENT
15B8   3C                     INR   A   ;PLUS ONE (TWOS COMP)
15B9   57                     MOV   D,A   ;SAVE IT
15BA   2F                     CMA      ;RE-COMPLEMENT
15BB   3C                     INR   A   ;PLUS ONE
15BC   23           FOUTI:    INX   H   ;POINT NEXT
15BD   E5                     PUSH   H   ;SAVE PTR
15BE   1E FF                  MVI   E,-1   ; AND 0FFH   ;INIT CTR (TENS)
15C0   1C           FOUTJ:    INR   E   ;ADD ONE
15C1   D6 0A                  SUI   10   ;LESS 10
15C3   F2 C0 15               JP   FOUTJ   ;LOOP
15C6   C6 0A                  ADI   10   ;CORRECT UNITS
15C8   47                     MOV   B,A   ;SAVE UNITS
15C9   7B                     MOV   A,E   ;GET TENS
15CA   CD 7C 15               CALL   FOUT9   ;OUTPUT
15CD   78                     MOV   A,B   ;GET UNITS
15CE   CD 7C 15               CALL   FOUT9   ;OUTPUT
15D1   E1                     POP   H   ;GET PTR
15D2   36 20                  MVI   M," "   ;SPACE AFTER
15D4   7A                     MOV   A,D   ;GET DEC EXPON
15D5   B7                     ORA   A   ;SET FLAGS
15D6   F2 DF 15               JP   FOUTK   ;BRIF POS.
15D9   FE FE                  CPI   -2   ; AND 0FFH     ;TEST FOR MIN
15DB   D8                     RC      ;RETURN IF LESS THAN -2
15DC   C3 E2 15               JMP   FOUTL   ;GO AROUND
15DF   FE 06        FOUTK:    CPI   6   ;TEST IF TOO BIG
15E1   D0                     RNC      ;RETURN IF 6 OR GREATER
15E2   4F           FOUTL:    MOV   C,A   ;SAVE EXPONENT
15E3   06 05                  MVI   B,5   ;CTR
15E5   36 20        FOUTM:    MVI   M," "   ;SPACE OUT EXPONENT
15E7   2B                     DCX   H   ;POINT PRIOR
15E8   05                     DCR   B   ;DECR CTR
15E9   C2 E5 15               JNZ   FOUTM   ;LOOP
15EC   EB                     XCHG      ;FLIP/FLOP
15ED   7B                     MOV   A,E   ;GET LOW BYTE
15EE   D6 05                  SUI   5   ;POINT TO DOT
15F0   6F                     MOV   L,A   ;PUT DOWN
15F1   7A                     MOV   A,D   ;GET HIGH
15F2   DE 00                  SBI   0   ;IN CASE OF BORROW
15F4   67                     MOV   H,A   ;PUT DOWN
15F5   79                     MOV   A,C   ;GET EXPONENT
15F6   B7                     ORA   A   ;TEST SIGN
15F7   CA 08 16               JZ   FOUTO   ;BRIF ZERO
15FA   FA 1D 16               JM   FOUTR   ;BRIF NEGATIVE
15FD   46           FOUTN:    MOV   B,M   ;GET HIGH BYTE
15FE   23                     INX   H   ;POINT NEXT
15FF   7E                     MOV   A,M   ;GET LOW BYTE
1600   70                     MOV   M,B   ;SHIFT DOT TO RIGHT
1601   2B                     DCX   H   ;POINT BACK
1602   77                     MOV   M,A   ;MOVE THE DIGIT LEFT
1603   23                     INX   H   ;POINT NEXT
1604   0D                     DCR   C   ;DECR CTR
1605   C2 FD 15               JNZ   FOUTN   ;LOOP
1608   EB           FOUTO:    XCHG      ;POINT END
1609   7E           FOUTP:    MOV   A,M   ;GET A DIGIT/DOT
160A   FE 30                  CPI   "0"   ;TEST FOR TRAILING ZERO
160C   C2 15 16               JNZ   FOUTQ   ;BRIF NOT
160F   36 20                  MVI   M," "   ;SPACE FILL
1611   2B                     DCX   H   ;POINT PRIOR
1612   C3 09 16               JMP   FOUTP   ;LOOP
1615   FE 2E        FOUTQ:    CPI   "."   ;TEST FOR TRAILING DOT
1617   23                     INX   H   ;JUST IN CASE NOT
1618   C0                     RNZ      ;RETURN IF NOT
1619   2B                     DCX   H   ;RESET PTR
161A   36 20                  MVI   M," "   ;SPACE IT OUT
161C   C9                     RET      ;RETURN
161D   FE FF        FOUTR:    CPI   0FFH   ;TEST IF -1
161F   C2 2B 16               JNZ   FOUTS   ;ELSE -2
1622   2B                     DCX   H   ;POINT SIGNIFICANT
1623   7E                     MOV   A,M   ;GET THE CHAR
1624   36 2E                  MVI   M,"."   ;MOVE THE DOT
1626   23                     INX   H   ;POINT NEXT
1627   77                     MOV   M,A   ;SHIFT THE DIGIT
1628   C3 08 16               JMP   FOUTO   ;GO ZERO SUPPRESS
162B   2B           FOUTS:    DCX   H   ;POINT ONE TO LEFT
162C   7E                     MOV   A,M   ;PICK UP DIGIT
162D   36 30                  MVI   M,"0"   ;REPLACE
162F   23                     INX   H   ;POINT RIGHT
1630   77                     MOV   M,A   ;PUT THE DIGIT
1631   62                     MOV   H,D   ;GET LOW ADDR
1632   6B                     MOV   L,E   ;POINT LAST DIGIT
1633   06 06                  MVI   B,6   ;CTR
1635   2B           FOUTT:    DCX   H   ;POINT PRITO
1636   7E                     MOV   A,M   ;GET A DIGIT
1637   23                     INX   H   ;POINT
1638   77                     MOV   M,A   ;PUT IT ONE TO RIGHT
1639   2B                     DCX   H   ;POINT
163A   05                     DCR   B   ;DECR CTR
163B   C2 35 16               JNZ   FOUTT   ;LOOP
163E   36 2E                  MVI   M,"."   ;MOVE THE DOT
1640   C3 08 16               JMP   FOUTO   ;CONTINUE
1643                             ; 
1643                FADD:     EQU   $   
1643                             ; 
1643                             ; 
1643                             ; FLOATING POINT ADD THE NUMBER AT (H,L) TO THE FACC
1643                             ; 
1643                             ; 
1643   23                     INX   H   ;POINT FIRST DIGIT
1644   7E                     MOV   A,M   ;LOAD IT
1645   B7                     ORA   A   ;TEST IT
1646   CA DA 18               JZ   FTEST   ;BRIF ZERO
1649   2B                     DCX   H   ;POINT BACK
164A   CD DA 18               CALL   FTEST   ;GO TEST SIGN OF FACC
164D   CA 28 00               JZ   RST5   ;JUST LOAD IF FACC = 0
1650   CD E8 18               CALL   FEXP   ;GO GET EXPONENT
1653   47                     MOV   B,A   ;SAVE EXPONENT
1654   7E                     MOV   A,M   ;GET EXPONENT OF ADDR
1655   CD E8 18               CALL   FEXP   ;GO GET EXPONENT
1658   4F                     MOV   C,A   ;SAVE THE EXPONENT
1659   90                     SUB   B   ;GET DIFFERENCE OF TWO EXPONENTS
165A   CA 6F 16               JZ   FADD4   ;BRIF THEY'RE EQ
165D   F2 62 16               JP   FADD3   ;BRIF DIFFERENCE IS POSITIVE
1660   2F                     CMA      ;COMPLEMENT ACC
1661   3C                     INR   A   ;PLUS ONE (TWO'S COMPLEMENT)
1662   FE 18        FADD3:    CPI   24   ;COMPARE DIFFERENCE TO MAX
1664   DA 6F 16               JC   FADD4   ;BRIF LESS
1667   78                     MOV   A,B   ;GET EXPON OF ADDUEND
1668   91                     SUB   C   ;GET TRUE DIFFERENCE AGAIN
1669   F2 DA 18               JP   FTEST   ;BRIF FACC > ADDER
166C   C3 28 00               JMP   RST5   ;ELSE, ADDER > FACC
166F   F5           FADD4:    PUSH   PSW   ;SAVE DIFFERENCE
1670   C5                     PUSH   B   ;SAVE EXPONENTS
1671   11 5C 22               LXI   D,FTEMP   ;GET ADDR OF TEMP ACC
1674   CD 57 1C               CALL   CPY4H   
1677   C1                     POP   B   ;GET EXPONENTS
1678   F1                     POP   PSW   ;GET DIFFERENCE
1679   CA A0 16               JZ   FADD9   ;JUST ADD IF ZERO
167C   21 5D 22               LXI   H,FTEMP+1   ;DEFAULT
167F   F5                     PUSH   PSW   ;SAVE DIFFERENCE
1680   78                     MOV   A,B   ;GET FACC EXPON
1681   91                     SUB   C   ;MINUS FTEMP EXPON
1682   F2 92 16               JP   FADD6   ;BRIF TEMP MUST BE SHIFTED
1685   21 58 22               LXI   H,FACC   ;POINT FLOAT ACC
1688   79                     MOV   A,C   ;GET EXPONENT, SIGN
1689   E6 7F                  ANI   7FH   ;STRIP EXP SIGN
168B   4F                     MOV   C,A   ;PUT BACK
168C   7E                     MOV   A,M   ;GET THE EXP
168D   E6 80                  ANI   80H   ;STRIP OFF OLD EXPON
168F   B1                     ORA   C   ;MOVE ADDR EXPON TO IT
1690   77                     MOV   M,A   ;REPLACE
1691   23                     INX   H   ;POINT FIRST DATA BYTE
1692   F1           FADD6:    POP   PSW   ;GET DIFFER
1693   4F                     MOV   C,A   ;SAVE IT
1694   06 03        FADD7:    MVI   B,3   ;LOOP CTR (INNER)
1696   AF                     XRA   A   ;INIT CARRY TO Z
1697   E5                     PUSH   H   ;SAVE ADDR
1698   CD 07 19               CALL   FSHFT   ;GO SHIFT
169B   E1                     POP   H   ;GET ADDR
169C   0D                     DCR   C   ;DECR CTR
169D   C2 94 16               JNZ   FADD7   ;LOOP
16A0                FADD9:    EQU   $   
16A0   21 5C 22               LXI   H,FTEMP   
16A3   3A 58 22               LDA   FACC   ;GET EXPONENT
16A6   AE                     XRA   M   ;SEE IF SIGNS THE SAME
16A7   11 5B 22               LXI   D,FACC+3   ;POINT LEAST SIGN BYTE
16AA   21 5F 22               LXI   H,FTEMP+3   
16AD   FA C8 16               JM   FADDA   ;BRIF SIGNS DIFFERENT
16B0   CD FA 18               CALL   FADT3   ;ADD 3 BYTES
16B3   D2 DA 18               JNC   FTEST   ;BRIF NO OVERFLOW
16B6   EB                     XCHG      ;POINT HL TO FACC
16B7   CD 95 17               CALL   SVSGN   ;SAVE SIGN, RETURN EXPONENT
16BA   3C                     INR   A   ;INCREMENT EXPONENT
16BB   CD 9D 17               CALL   RSSGN   ;RESTORE SIGN TO EXPONENT
16BE   23                     INX   H   ;POINT DATA
16BF   37                     STC      ;SET CY
16C0   06 03                  MVI   B,3   ;CTR
16C2   CD 07 19               CALL   FSHFT   ;GO SHIFT IT
16C5   C3 DA 18               JMP   FTEST   ;RETURN
16C8                FADDA:    EQU   $   
16C8   06 03                  MVI   B,3   
16CA   CD EF 18               CALL   FSUBT   ;SUBTRACT
16CD   D2 E9 16               JNC   FNORM   ;BRIF NO BORROW
16D0   21 5B 22               LXI   H,FACC+3   ;MUST NEGATE
16D3   06 03                  MVI   B,3   
16D5   37                     STC      
16D6   7E           FNEG1:    MOV   A,M   ;GET BYTE
16D7   2F                     CMA      
16D8   D2 DD 16               JNC   FNEG2   
16DB   C6 01                  ADI   1   ;INCREMENT + COMPLEMENT=NEGATE
16DD   77           FNEG2:    MOV   M,A   
16DE   2B                     DCX   H   
16DF   05                     DCR   B   
16E0   C2 D6 16               JNZ   FNEG1   
16E3   CD E9 16               CALL   FNORM   
16E6   C3 86 0C               JMP   NEG   ;REVERSE SIGN
16E9                             ;PAGE
16E9                             ; 
16E9                FNORM:    EQU   $   
16E9                             ; 
16E9                             ; 
16E9                             ; NORMALIZE THE FLOATING ACCUMULATOR
16E9                             ; THAT IS, THE FIRST BIT MUST BE SIGNIFICANT
16E9                             ; 
16E9                             ; 
16E9   21 5B 22               LXI   H,FACC+3   ;POINT LSB
16EC   7E                     MOV   A,M   ;LOAD IT
16ED   2B                     DCX   H   ;POINT PRIOR
16EE   B6                     ORA   M   ;MERGE
16EF   2B                     DCX   H   ;POINT PRIOR
16F0   B6                     ORA   M   ;MERGE
16F1   2B                     DCX   H   
16F2   46                     MOV   B,M   ;SAVE EXPONENT
16F3   77                     MOV   M,A   ;CLEAR
16F4   C8                     RZ      ;RETURN ON NOTHING TO NORMALIZE
16F5   70                     MOV   M,B   ;RESTORE EXP
16F6   C5                     PUSH   B   ;SAVE C FOR CALLER
16F7   CD 95 17               CALL   SVSGN   ;SAVE SIGN
16FA   77                     MOV   M,A   ;STORE EXPANDED EXPONENT
16FB   23           FNRM1:    INX   H   ;POINT TO MOST SIGN BYTE
16FC   7E                     MOV   A,M   ;GET MSB
16FD   B7                     ORA   A   ;TEST IT
16FE   FA 11 17               JM   FNRM3   ;BRIF NORMALIZED
1701   23                     INX   H   ;POINT LSB
1702   23                     INX   H   
1703   06 03                  MVI   B,3   ;SHIFT COUNT
1705   7E           FNRM2:    MOV   A,M   ;SHIFT LEFT
1706   17                     RAL      
1707   77                     MOV   M,A   
1708   2B                     DCX   H   
1709   05                     DCR   B   
170A   C2 05 17               JNZ   FNRM2   
170D   35                     DCR   M   ;ADJUST EXPONENT
170E   C3 FB 16               JMP   FNRM1   ;LOOP
1711   2B           FNRM3:    DCX   H   ;POINT BACK TO EXPONENT
1712   7E                     MOV   A,M   
1713   CD 9D 17               CALL   RSSGN   ;RESTORE SIGN
1716   C1                     POP   B   ;RESTORE C
1717   C9                     RET      
1718                             ; 
1718                FSUB:     EQU   $   
1718                             ; 
1718                             ; 
1718                             ; FLOATING POINT SUBTRACT THE NUMBER AT (H,L) FROM THE FACC
1718                             ; 
1718                             ; 
1718   CD 86 0C               CALL   NEG   ;NEGATE FACC
171B   CD 43 16               CALL   FADD   ;ADD
171E   CD 86 0C               CALL   NEG   ;NEGATE RESULT
1721   C3 DA 18               JMP   FTEST   
1724                             ;PAGE
1724                             ; 
1724                FMUL:     EQU   $   
1724                             ; 
1724                             ; 
1724                             ; FLOATING POINT MULTIPLY THE NUMBER AT (H,L) TO THE FACC
1724                             ; 
1724                             ; 
1724   CD DA 18               CALL   FTEST   ;TEST FACC
1727   C8                     RZ      ;RETURN IF ZERO
1728   23                     INX   H   ;POINT 1ST DIGIT OF MULTIPLIER
1729   7E                     MOV   A,M   ;LOAD IT
172A   2B                     DCX   H   ;RESTORE
172B   B7                     ORA   A   ;TEST IF ZERO
172C   CA 28 00               JZ   RST5   ;GO LOAD TO FACC IF IT IS
172F   E5                     PUSH   H   ;SAVE MULTIPLIER ADDRESS
1730   CD 8B 17               CALL   MDSGN   ;GET SIGN PRODUCT, & BOTH EXPONENTS
1733   80                     ADD   B   ;ADD EXPONENTS
1734   CD 9D 17               CALL   RSSGN   ;RESTORE SIGN
1737   E1                     POP   H   ;RESTORE
1738   11 65 22               LXI   D,FTEMP+9   ;POINT TEMP STORAGE
173B   06 03                  MVI   B,3   ;BYTE COUNT
173D   23                     INX   H   ;POINT MSD
173E   CD 59 1C               CALL   COPYH   ;MOVE MULTIPLIER
1741   21 5C 22               LXI   H,FTEMP   ;POINT DIGIT 7 OF RESULT
1744   06 06                  MVI   B,6   ;LOOP CTR
1746   CD 5F 1C               CALL   ZEROM   ;GO ZERO EIGHT BYTES
1749   11 59 22               LXI   D,FACC+1   ;POINT 1ST DIGIT OF ACC
174C   06 03                  MVI   B,3   ;LOOP CTR
174E   1A           FMUL5:    LDAX   D   ;GET AN ACC DIGIT PAIR
174F   77                     MOV   M,A   ;PUT TO TEMP STORAGE
1750   AF                     XRA   A   ;ZERO A
1751   12                     STAX   D   ;CLEAR ACC
1752   13                     INX   D   ;POINT NEXT
1753   23                     INX   H   ;DITTO
1754   05                     DCR   B   ;DECR CTR
1755   C2 4E 17               JNZ   FMUL5   ;LOOP
1758   0E 18                  MVI   C,24   ;OUTTER LOOP CTR
175A   06 03        FMUL6:    MVI   B,3   ;CTR
175C   21 65 22               LXI   H,FTEMP+9   ;POINT MULTIPLIER
175F   AF                     XRA   A   ;CLEAR CY
1760   7E           FMUL7:    MOV   A,M   ;GET BYTE
1761   1F                     RAR      ;SHIFT RIGHT
1762   77                     MOV   M,A   ;PUT DOWN
1763   23                     INX   H   ;POINT NEXT
1764   05                     DCR   B   ;DECR CTR
1765   C2 60 17               JNZ   FMUL7   ;LOOP
1768   D2 76 17               JNC   FMUL8   ;BRIF ZERO BIT
176B   11 5E 22               LXI   D,FTEMP+2   ;POINT RESULT
176E   21 64 22               LXI   H,FTEMP+8   ;POINT MULTIPLICAND
1771   06 06                  MVI   B,6   ;SIX BYTE ADD
1773   CD FC 18               CALL   FADDT   ;GO ADD
1776   06 06        FMUL8:    MVI   B,6   ;SIZ BYTE SHIFT
1778   21 64 22               LXI   H,FTEMP+8   ;POINT MULTIPLICAND
177B   AF                     XRA   A   ;CLEAR CY
177C   7E           FMUL9:    MOV   A,M   ;GET BYTE
177D   17                     RAL      ;SHIFT LEFT
177E   77                     MOV   M,A   ;PUT BACT
177F   2B                     DCX   H   ;POINT NEXT BYTE
1780   05                     DCR   B   ;DECR CTR
1781   C2 7C 17               JNZ   FMUL9   ;LOOP
1784   0D                     DCR   C   ;DEC BIT COUNT
1785   C2 5A 17               JNZ   FMUL6   ;CONTINUE
1788   C3 E9 16               JMP   FNORM   ;GO NORMALIZE
178B                             ; 
178B                             ; MDSGN   GET SIGN PRODUCT AND EXPONENTS FOR MULT & DIV
178B                             ; ON ENTRY:
178B                             ;       (HL) = ONE NUMBER
178B                             ;       (FACC)=THE OTHER
178B                             ; ON RETURN:
178B                             ;       A = EXPONENT OF FACC(EXPANDED)
178B                             ;       B = OTHER EXPONENT
178B                             ;       C = SIGN PRODUCT
178B                             ;       HL DESTROYED
178B                             ; 
178B   CD 95 17     MDSGN:    CALL   SVSGN   ;GET SIGN IN C, EXP IN A
178E   47                     MOV   B,A   ;SAVE EXPONENT
178F   21 58 22               LXI   H,FACC   
1792   79                     MOV   A,C   ;GET SIGN
1793   86                     ADD   M   ;MULTIPLY SIGNS
1794   77                     MOV   M,A   ;PUT DOWN
1795                             ; 
1795                             ; SVSGN         GET SIGN AND EXP
1795                             ; ON ENTRY:
1795                             ;       (HL) = EXPONENT
1795                             ; ON RETURN:
1795                             ;       A = EXPANDED EXPONENT
1795                             ;       C = SIGN IN HI ORDER BIT
1795                             ; 
1795   7E           SVSGN:    MOV   A,M   ;GET EXPONENT
1796   E6 80                  ANI   80H   ;ISOLATE SIGN
1798   4F                     MOV   C,A   
1799   7E                     MOV   A,M   
179A   C3 E8 18               JMP   FEXP   ;EXPAND EXP AND RETURN
179D                             ; 
179D                             ; RSSGN         RESTORE SIGN TO EXPONENT
179D                             ; ON ENTRY:
179D                             ;       (HL)=EXPONENT
179D                             ;       A = EXPANDED EXPONENT
179D                             ;       C = SIGN
179D                             ; ON RETURN:
179D                             ;       A = EXPONENT
179D                             ;       (HL) = EXPONENT WITH SIGN
179D                             ;       Z,M BITS SET FOR EXPONENT
179D                             ; 
179D   CD 7D 18     RSSGN:    CALL   FOVUN   ;CHECK FOR OVER/UNDERFLOW
17A0   E6 7F                  ANI   7FH   ;REMOVE EXPONENT SIGN
17A2   B1                     ORA   C   ;ADD SIGN
17A3   77                     MOV   M,A   ;SET DOWN
17A4   C3 DA 18               JMP   FTEST   ;SET Z,M BITS
17A7                             ;PAGE
17A7                             ; 
17A7                FDIV:     EQU   $   
17A7                             ; 
17A7                             ; 
17A7                             ; FLOATING POINT DIVIDE THE NUMBER AT (H,L) INTO THE FACC
17A7                             ; 
17A7                             ; 
17A7   CD DA 18               CALL   FTEST   ;TEST IF FACC ZERO
17AA   C8                     RZ      ;RETURN IF IT IS
17AB   23                     INX   H   ;POINT 1ST DIGIT OF DIVISOR
17AC   7E                     MOV   A,M   ;LOAD IT
17AD   2B                     DCX   H   ;POINT BACK
17AE   B7                     ORA   A   ;TEST IF ZERO
17AF   CA 08 1C               JZ   ZMERR   ;DIVISION BY ZERO = ERROR
17B2   E5                     PUSH   H   ;SAVE DIVISOR PTR
17B3   CD 8B 17               CALL   MDSGN   ;GET SIGN ON STACK, EXPS INTO A,B
17B6   90                     SUB   B   ;SUBTRACT EXPONENTS
17B7   3C                     INR   A   ;PLUS ONE
17B8   CD 9D 17               CALL   RSSGN   ;SET SIGN/EXPONENT IN FACC
17BB   11 59 22               LXI   D,FACC+1   
17BE   21 5C 22               LXI   H,FTEMP   ;POINT TEMPORARY STORAGE
17C1   36 00                  MVI   M,0   ;CLEAR MSB
17C3   23                     INX   H   ;POINT NEXT
17C4   06 03                  MVI   B,3   ;LOOP CTR
17C6   1A           FDIV3:    LDAX   D   ;GET BYTE FROM FACC
17C7   77                     MOV   M,A   ;PUT TO FTEMP
17C8   AF                     XRA   A   ;CLEAR A
17C9   12                     STAX   D   ;ZERO FACC
17CA   23                     INX   H   ;POINT NEXT
17CB   13                     INX   D   ;DITTO
17CC   05                     DCR   B   ;DECR CTR
17CD   C2 C6 17               JNZ   FDIV3   ;LOOP
17D0   D1                     POP   D   ;GET ADDR
17D1   06 03                  MVI   B,3   ;LOOP CTR
17D3   13                     INX   D   ;POINT MSD OF DIVISOR
17D4   36 00                  MVI   M,0   ;CLEAR MSB
17D6   23                     INX   H   ;POINT NEXT
17D7   CD 4E 1C               CALL   COPYD   ;GO MOVE IT
17DA   0E 18                  MVI   C,24   ;OUTER LOOP CTR
17DC   11 5F 22     FDIV5:    LXI   D,FTEMP+3   ;POINT DIVIDEND
17DF   21 63 22               LXI   H,FTEMP+7   ;AND DIVISOR
17E2   06 04                  MVI   B,4   ;CTR
17E4   CD EF 18               CALL   FSUBT   ;GO SUBTRACT
17E7   D2 F6 17               JNC   FDIV6   ;BRIF NO GO
17EA   11 5F 22               LXI   D,FTEMP+3   ;POINT DIVIDEND
17ED   21 63 22               LXI   H,FTEMP+7   ;AND DIVISOR
17F0   06 04                  MVI   B,4   ;CTR
17F2   CD FC 18               CALL   FADDT   ;GO RE-ADD
17F5   37                     STC      ;TURN ON CY
17F6   3F           FDIV6:    CMC      ;REVERSE CY
17F7   06 03                  MVI   B,3   ;CTR
17F9   21 5B 22               LXI   H,FACC+3   ;POINT LSB
17FC   7E           FDIV7:    MOV   A,M   ;LOAD BYTE
17FD   17                     RAL      ;SHIFT LEFT
17FE   77                     MOV   M,A   ;REPLACE
17FF   2B                     DCX   H   ;POINT NEXT
1800   05                     DCR   B   ;DECR CTR
1801   C2 FC 17               JNZ   FDIV7   ;LOOP
1804   AF                     XRA   A   ;CLEAR FLAGS
1805   06 04                  MVI   B,4   ;CTR
1807   21 5F 22               LXI   H,FTEMP+3   ;POINT-DIVIDEND
180A   7E           FDIV8:    MOV   A,M   ;LOAD BYTE
180B   17                     RAL      ;SHIFT LEFT
180C   77                     MOV   M,A   ;REPLACE
180D   2B                     DCX   H   ;POINT ENXT
180E   05                     DCR   B   ;DECR CTR
180F   C2 0A 18               JNZ   FDIV8   ;LOOP
1812   0D                     DCR   C   ;DECR OTR CTR
1813   C2 DC 17               JNZ   FDIV5   ;LOOP
1816   C3 E9 16               JMP   FNORM   ;WRAPUP
1819                             ; 
1819                             ; UTILITY ROUTINE TO GET A VARIABLE'S ADDRESS TO H,L
1819                             ; 
1819   11 20 21     GETST:    LXI   D,STRIN   ;POINT BUFFER
181C   06 00                  MVI   B,0   ;INIT CTR
181E   7E                     MOV   A,M   ;GET THE CHAR
181F   FE 22                  CPI   0x22   ;"""     ;TEST IF LIT TYPE
1821   CA 3A 18               JZ   GETS2   ;BRIF IS
1824   FE 27                  CPI   27H   ;TEST IF QUOTED LITERAL
1826   CA 3A 18               JZ   GETS2   ;BRIF IS
1829   FE 2C        GETS1:    CPI   ","   ;TEST IF COMMA
182B   CA 4D 18               JZ   GETS5   ;BRIF IS
182E   B7                     ORA   A   ;TEST IF END
182F   CA 4D 18               JZ   GETS5   ;BRIF IS
1832   04                     INR   B   ;COUNT IT
1833   13                     INX   D   ;POINT NEXT
1834   12                     STAX   D   ;PUT CHAR
1835   23                     INX   H   ;POINT NEXT
1836   CF                     RST   1   ;SKIP SPACES
1837   C3 29 18               JMP   GETS1   ;LOOP
183A   4F           GETS2:    MOV   C,A   ;SAVE DELIM
183B   23           GETS3:    INX   H   ;SKIP THE QUOTE
183C   7E                     MOV   A,M   ;GET NEXT CHAR
183D   B9                     CMP   C   ;TEST IF END OF LITERAL
183E   CA 4B 18               JZ   GETS4   ;BRIF IS
1841   B7                     ORA   A   ;TEST IF END OF LINE
1842   CA 20 1C               JZ   CVERR   ;BRIF IS
1845   04                     INR   B   ;COUNT IT
1846   13                     INX   D   ;POINT NEXT
1847   12                     STAX   D   ;PUT CHAR
1848   C3 3B 18               JMP   GETS3   ;LOOP
184B   23           GETS4:    INX   H   ;SKIP END QUOTE
184C   CF                     RST   1   ;SKIP TRAILING SPACES
184D   11 20 21     GETS5:    LXI   D,STRIN   ;POINT BEGIN BUFFER
1850   78                     MOV   A,B   ;GET COUNT
1851   12                     STAX   D   ;PUT COUNT
1852   D1                     POP   D   ;GET RETURN ADDR
1853   EB                     XCHG      ;FLIP/FLOP
1854   E3                     XTHL      ;PUT RET ON STACK, HL OF VAR IN HL
1855   D5                     PUSH   D   ;SAVE H,L OF LOC
1856   CD 3D 06               CALL   LET2A   ;GO STORE STRING
1859   E1                     POP   H   ;RESTORE LOCATION
185A   C9                     RET      ;RETURN
185B   CD CA 1B     GETS8:    CALL   VAR   ;GET VAR NAME
185E   D5                     PUSH   D   ;SAVE ON STACK
185F   7A                     MOV   A,D   ;GET HI BYTE
1860   B7                     ORA   A   ;TEST IF ARRAY
1861   F2 78 18               JP   GETS9   ;BRIF NOT
1864   CD 35 1B               CALL   SEARC   ;GO GET ARRAY PARAMS
1867   3E FF                  MVI   A,0FFH   ;TURN ON SW
1869   32 72 20               STA   DIMSW   ;SET IT
186C   E3                     XTHL      ;SWAP ADDR ON STACK
186D   CD 8C 0F               CALL   EXPR   ;GO GET ROW, COL PTRS
1870   E3                     XTHL      ;SWAP ADDR ON STACK
1871   CD 91 18               CALL   SUBSC   ;GO POINT TO ENTRY
1874   EB                     XCHG      ;EXCHANGE
1875   E1                     POP   H   ;GET ADDRESS OF STMT
1876   C1                     POP   B   ;GET NAME
1877   C9                     RET      ;RETURN
1878   CD 35 1B     GETS9:    CALL   SEARC   ;FIND ADDR
187B   C1                     POP   B   ;RESTORE NAME
187C   C9                     RET      ;RETURN
187D                             ; 
187D                FOVUN:    EQU   $   
187D                             ; 
187D                             ; TEST EXPONENT FOR OVERFLO OR UNDERFLOW
187D                             ; 
187D   B7                     ORA   A   ;TEST IT
187E   F2 89 18               JP   FOV1   ;BRIF POS.
1881   FE C1                  CPI   0C1H   ;TEST FOR MAX NEG
1883   D0                     RNC      ;RETURN IF NO UNDER.
1884   3E C1                  MVI   A,0C1H   ;SET EXPONENT AT MINIMUM
1886   C3 2D 1C               JMP   UNERR   
1889   FE 40        FOV1:     CPI   40H   ;TEST MAX POS
188B   D8                     RC      ;RETURN IF NO OVER.
188C   3E 3F                  MVI   A,3FH   ;SET EXPONENT AT MAXIMUM
188E   C3 28 1C               JMP   OVERR   
1891                             ; 
1891                SUBSC:    EQU   $   
1891                             ; 
1891                             ; 
1891                             ; COMPUTES SUBSCR ADDR
1891                             ; INPUT: B HAS ROW NUMBER (1ST SUB)
1891                             ;        D HAS COL NUMBER (2ND SUB)
1891                             ;        H HAS ADDR NAME
1891                             ; 
1891   D5                     PUSH   D   ;SAVE COL
1892   E7                     RST   4   ;ADJUST H,L
1893   FC                     DB   -4   ; AND 0FFH     ;BY FOUR
1894   56                     MOV   D,M   ;GET HI
1895   2B                     DCX   H   ;POINT LO
1896   5E                     MOV   E,M   ;GET LO
1897   7A                     MOV   A,D   ;GET HI
1898   B8                     CMP   B   ;COMPARE
1899   DA 10 1C               JC   SNERR   ;BRIF EXCESS
189C   C2 A4 18               JNZ   SUB1   ;BRIF NOT EQUAL
189F   7B                     MOV   A,E   ;GET LO
18A0   B9                     CMP   C   ;COMPARE
18A1   DA 10 1C               JC   SNERR   ;BRIF EXCESS
18A4   2B           SUB1:     DCX   H   ;POINT HI COLS
18A5   56                     MOV   D,M   ;LOAD IT
18A6   2B                     DCX   H   ;POINT LO COLS
18A7   5E                     MOV   E,M   ;LOAD IT
18A8   E3                     XTHL      ;SAVE ADDRESS
18A9   E5                     PUSH   H   ;SAVE SUB COL
18AA   D5                     PUSH   D   ;SAVE DIM COLS
18AB   13                     INX   D   ;MAKE COLS=MAX+1 (ACCOUNT FOR 0 B??KE
18AC   21 00 00               LXI   H,0   ;GET A ZERO
18AF   78           SUB2:     MOV   A,B   ;GET HI
18B0   B1                     ORA   C   ;PLUS LO
18B1   CA B9 18               JZ   SUB3   ;BRIF ZERO
18B4   19                     DAD   D   ;ADD ONCE
18B5   0B                     DCX   B   ;SUB ONCE
18B6   C3 AF 18               JMP   SUB2   ;LOOP
18B9   D1           SUB3:     POP   D   ;GET DIM COL
18BA   C1                     POP   B   ;GET SUB COL
18BB   7A                     MOV   A,D   ;GET HI
18BC   B8                     CMP   B   ;COMPARE
18BD   DA 10 1C               JC   SNERR   ;BRIF GT
18C0   C2 C8 18               JNZ   SUB4   ;BRIF NOT ZERO
18C3   7B                     MOV   A,E   ;GET LO
18C4   B9                     CMP   C   ;COMPARE
18C5   DA 10 1C               JC   SNERR   ;BRIF GT
18C8   09           SUB4:     DAD   B   ;ADD TO PROD
18C9   29                     DAD   H   ;TIMES TWO
18CA   29                     DAD   H   ;TIMES FOUR
18CB   7D                     MOV   A,L   ;GET LOW
18CC   2F                     CMA      ;COMPLEMENT
18CD   C6 01                  ADI   1   ;PLUS ONE
18CF   5F                     MOV   E,A   ;SAVE IT
18D0   7C                     MOV   A,H   ;GET HI
18D1   2F                     CMA      ;COMPLEMENT
18D2   CE 00                  ACI   0   ;PLUS CARRY
18D4   57                     MOV   D,A   ;SAVE
18D5   E1                     POP   H   ;GET ADDR (0,0)
18D6   19                     DAD   D   ;COMPUTE (I,J) RIGHT SIDE
18D7   E7                     RST   4   ;ADJUST H,L
18D8   FC                     DB   -4   ; AND 0FFH
18D9   C9                     RET      ;RETURN
18DA                FTEST:    EQU   $   
18DA                             ; 
18DA                             ; TEST THE SIGN OF THE NUMBER IN THE FACC
18DA                             ; RETURN WITH S & Z SET TO SIGN
18DA                             ; 
18DA   3A 59 22               LDA   FACC+1   ;GET MSD
18DD   B7                     ORA   A   ;TEST IT
18DE   C8                     RZ      ;RETURN IF ZERO
18DF   3A 58 22               LDA   FACC   ;GET SIGN&EXPON BYTE
18E2   F6 7F                  ORI   7FH   ;TEST SIGN BIT ONLY
18E4   3A 58 22               LDA   FACC   ;RE-LOAD EXPON BYTE
18E7   C9                     RET      ;THEN RETURN
18E8                FEXP:     EQU   $   
18E8                             ; 
18E8                             ; EXPAND EXPONENT INTO 8 BINARY BITS
18E8                             ; 
18E8   E6 7F                  ANI   7FH   ;MASK MANTISA SIGN
18EA   C6 40                  ADI   40H   ;PROPAGATE CHAR SIGN TO LEFTMOST BIT
18EC   EE 40                  XRI   40H   ;RESTORE ORIGINAL SIGN BIT
18EE   C9                     RET      ;RETURN
18EF                             ; 
18EF                FSUBT:    EQU   $   
18EF                             ; 
18EF                             ; SUBTRACT THE TWO MULTIPRECISION NUMBERS (D,E) & (H,L)
18EF                             ; 
18EF   AF                     XRA   A   ;TURN OF CY
18F0   1A           FSB1:     LDAX   D   ;GET A BYTE
18F1   9E                     SBB   M   ;SUB OTHER BYTE
18F2   12                     STAX   D   ;PUT DOWN
18F3   1B                     DCX   D   ;POINT NEXT
18F4   2B                     DCX   H   ;DITTO
18F5   05                     DCR   B   ;DECR CTR
18F6   C2 F0 18               JNZ   FSB1   ;LOOP
18F9   C9                     RET      ;RETURN
18FA                             ; 
18FA                             ; ADD TWO MULTI-PRECISION NUMBERS (D,E) & (H,L)
18FA                             ; 
18FA   06 03        FADT3:    MVI   B,3   
18FC   AF           FADDT:    XRA   A   ;CLEAR STATUS
18FD   1A           FAD1:     LDAX   D   ;GET BYTE
18FE   8E                     ADC   M   ;ADD OTHER BYTE
18FF   12                     STAX   D   ;PUT DOWN
1900   1B                     DCX   D   ;POINT NEXT
1901   2B                     DCX   H   ;DITTO
1902   05                     DCR   B   ;DECR LOOP CTR
1903   C2 FD 18               JNZ   FAD1   ;LOOP
1906   C9                     RET      ;RETURN
1907                             ; 
1907                FSHFT:    EQU   $   
1907                             ; 
1907                             ; INCREMENTING SHIFT RIGHT
1907                             ; 
1907   7E                     MOV   A,M   ;GET A BYTE
1908   1F                     RAR      ;SHIFT RIGHT
1909   77                     MOV   M,A   ;PUT DOWN
190A   23                     INX   H   ;POINT NEXT
190B   05                     DCR   B   ;DECR CTR
190C   C2 07 19               JNZ   FSHFT   ;LOOP
190F   C9                     RET      ;RETURN
1910                             ;PAGE
1910                             ; 
1910                TERMI:    EQU   $   
1910                             ; 
1910                             ; READ A LINE FROM THE TTY
1910                             ; FIRST PROMPT WITH THE CHAR IN THE A REG
1910                             ; TERMINATE THE LINE WITH A X"00"
1910                             ; IGNORE EMPTY LINES
1910                             ; CONTROL C WILL CANCLE THE LINE
1910                             ; CONTROL O WILL TOGGLE THE OUTPUT SWITCH
1910                             ; RUBOUT WILL DELETE THE LAST CHAR INPUT
1910                             ; 
1910                             ; 
1910   32 4F 22               STA   PROMP   ;SAVE THE PROMPT CHAR
1913   21 CE 20     REIN:     LXI   H,IOBUF   ;POINT TO INPUT BUFFER
1916   36 00                  MVI   M,0   ;MARK BEGIN
1918   23                     INX   H   ;POINT START
1919   3A 4F 22               LDA   PROMP   ;GET THE PROMPT AGAIN
191C   CD 5B 19               CALL   TESTO   ;WRITE TO TERMINAL
191F   FE 3F                  CPI   "?"   ;TEST IF Q.M.
1921   C2 29 19               JNZ   TREAD   ;BRIF NOT
1924   3E 20                  MVI   A," "   ;GET SPACE
1926   CD 5B 19               CALL   TESTO   ;WRITE TO TERMINAL
1929                TREAD:    EQU   $   
1929   DB 0D                  IN   UART5   ;GET TTY STATUS
192B   E6 01                  ANI   UART_RX_FULL   ;TEST IF RXRDY
192D   CA 29 19               JZ   TREAD   ;LOOP TIL CHAR
1930   CD 40 1A               CALL   GETCH   ;GO READ THE CHAR
1933   77                     MOV   M,A   ;PUT IN BUFFER
1934   FE 0A                  CPI   0AH   ;TEST IF LINE FEED
1936   CA 29 19               JZ   TREAD   ;IGNORE IF IT IS
1939   FE 0D                  CPI   0DH   ;TEST IF CR
193B   C2 76 19               JNZ   NOTCR   ;BRIF NOT
193E   3A 71 20               LDA   TAPES   ;GET PAPER TAPE SWITCH
1941   1F                     RAR      ;TEST IF LOAD
1942   D4 67 19               CNC   CRLF   ;CR/LF IF NOT
1945   36 00        CR1:      MVI   M,0   ;MARK END
1947   3A 74 20               LDA   ILSW   ;GET INPUT LINE SW
194A   B7                     ORA   A   ;TEST IT
194B   C0                     RNZ      ;RETURN IF ON
194C   2B                     DCX   H   ;POINT PRIOR
194D   7E                     MOV   A,M   ;LOAD IT
194E   FE 20                  CPI   20H   ;TEST IF SPACE
1950   CA 45 19               JZ   CR1   ;BRIF SPACE
1953   B7                     ORA   A   ;TEST IF AT BEGINNING
1954   CA 13 19               JZ   REIN   ;BRIF IS (NULL LINE)
1957   21 CF 20               LXI   H,IOBUF+1   ;POINT BEGIN
195A   C9                     RET      ;ELSE, RETURN
195B   F5           TESTO:    PUSH   PSW   ;SAVE CHAR
195C   DB 0D        TEST1:    IN   UART5   ;GET STATUS
195E   E6 20                  ANI   UART_TX_EMPTY   
1960   CA 5C 19               JZ   TEST1   ;LOOP TILL READY
1963   F1                     POP   PSW   ;GET CHAR
1964   D3 08                  OUT   UART_TX   ;WRITE IT
1966   C9                     RET      ;RETURN
1967   3E 0D        CRLF:     MVI   A,0DH   ;LOAD A CR
1969   CD 5B 19               CALL   TESTO   ;WRITE IT
196C   3E 0A                  MVI   A,0AH   ;LF
196E   CD 5B 19               CALL   TESTO   ;WRITE IT
1971                             ;        MVI     A,RUBOUT   ;GET RUBOUT CHAR
1971                             ;        MVI     B,0FAH  ;LOAD 255-RUBOUT COUNT
1971                             ;PAUZ:   CALL    TESTO   ;SEND RUBOUT
1971                             ;        INR     B       ;INCREMENT COUNT
1971                             ;        CMP     B       ;COMPARE TO 255
1971                             ;        JNZ     PAUZ    ;SET ANOTHER RUBOUT
1971   AF                     XRA   A   ;GET A ZERO
1972   32 76 22               STA   COLUM   ;RESET COLUMN POINTER
1975   C9                     RET      ;RETURN
1976   FE 15        NOTCR:    CPI   15H   ;TEST IF CONTROL-U
1978   C2 84 19               JNZ   NOTCO   ;BRIF NOT
197B   CD 6E 1A               CALL   PRCNT   ;GO PRINT ^U
197E   CD 67 19               CALL   CRLF   ;GET CR/LF
1981   C3 13 19               JMP   REIN   ;GO RE-ENTER
1984   FE 08        NOTCO:    CPI   RUBOUT   ;TEST IF RUBOUT 7fh
1986   C2 A7 19               JNZ   NOTBS   ;BRIF NOT
1989   3A 71 20               LDA   TAPES   ;GET PAPER TAPE SW
198C   1F                     RAR      ;TEST IF LOAD
198D   DA 29 19               JC   TREAD   ;IGNORE IF LOAD
1990   2B                     DCX   H   ;POINT PRIOR
1991   7E                     MOV   A,M   ;LOAD PREV CHAR
1992   B7                     ORA   A   ;TEST IF BEGIN
1993   CA B2 19               JZ   ECHO   ;BRIF IS
1996   3E 5C                  MVI   A,0x5c   ;"\"   ;BACK SLASH
1998   CD 5B 19               CALL   TESTO   ;WRITE IT
199B   7E                     MOV   A,M   ;FETCH CHARACTER TO BE DISCARDED
199C   CD 5B 19               CALL   TESTO   ;WRITE IT
199F   3E 5C                  MVI   A,0x5c   ;"\"   ;BACK SLASH
19A1   CD 5B 19               CALL   TESTO   ;WRITE IT
19A4   C3 29 19               JMP   TREAD   ;GET REPLACEMENT CHARACTER
19A7                NOTBS:    EQU   $   
19A7   3A 71 20     NOTCH:    LDA   TAPES   ;GET PAPER TAPE SWITCH
19AA   1F                     RAR      ;FLAG TO CARRY
19AB   DA B2 19               JC   ECHO   ;NO ECHO IF TAPE
19AE   7E                     MOV   A,M   ;ELSE, LOAD THE CHAR
19AF   CD 5B 19               CALL   TESTO   ;ECHO THE CHARCTER
19B2   23           ECHO:     INX   H   ;POINT NEXT POSIT
19B3   C3 29 19               JMP   TREAD   ;LOOP FOR NEXT
19B6                             ; 
19B6                TERMO:    EQU   $   
19B6                             ; 
19B6                             ; TTY PRINT ROUTINE
19B6                             ; 
19B6                             ; OUTPUT STRING OF CHARS
19B6                             ; STARTING AT IOBUF +0 THRU END (FF OR FE OR 00)
19B6                             ; FOLLOWING IMBEDDED CHARACTERS ARE INTERPRETED AS CONTROLS:
19B6                             ; X"00" END OF BUFFER, TYPE CR/LF AND RETURN
19B6                             ; X"FE" END OF BUFFER, RETURN (NO CR/LF)
19B6                             ; X"FD" TYPE CR/LF, CONTINUE
19B6                             ; 
19B6                             ; RETURN WITHOUT OUTPUT IF OUTPUT SW IS OFF
19B6                             ; 
19B6   3A 73 20               LDA   OUTSW   ;GET OUTPUT SW
19B9   B7                     ORA   A   ;TEST IT
19BA   C0                     RNZ      ;RETURN IF NO PRINT
19BB   21 CE 20               LXI   H,IOBUF   ;POINT I/O BUFFER
19BE   7E           OT1:      MOV   A,M   ;LOAD A BYTE
19BF   FE FE                  CPI   0FEH   ;SEE IF END OF LINE (NO CR/LF)
19C1   C8                     RZ      ;RETURN IF EQUAL
19C2   FE FD                  CPI   0FDH   ;SEE IF IMBEDDED CR/LF
19C4   C2 CD 19               JNZ   OT2   ;BRIF NOT
19C7   CD 67 19               CALL   CRLF   ;LINE FEED
19CA   C3 DC 19               JMP   OT4   ;CONTINUE
19CD   B7           OT2:      ORA   A   ;TEST IF END OF OUTPUT
19CE   CA 67 19               JZ   CRLF   ;BRIF IS
19D1   7E                     MOV   A,M   ;LOAD THE BYTE
19D2   CD 5B 19               CALL   TESTO   ;TYPE IT
19D5   3A 76 22               LDA   COLUM   ;GET COLUMN POINTER
19D8   3C                     INR   A   ;ADD ONE
19D9   32 76 22               STA   COLUM   ;RESTORE IT
19DC   23           OT4:      INX   H   ;POINT NEXT
19DD   C3 BE 19               JMP   OT1   ;LOOP
19E0                TERMM:    EQU   OT1   
19E0                             ; 
19E0                TABST:    EQU   $   
19E0                             ; 
19E0                             ; 
19E0                             ; POSITION TTY AT NEXT TAB STOP
19E0                             ; 
19E0                             ; 
19E0   3A 73 20               LDA   OUTSW   ;GET OUTPUT SWITCH
19E3   B7                     ORA   A   ;TEST IT
19E4   C0                     RNZ      ;RETURN IF SUPPRESSED
19E5   3A 76 22               LDA   COLUM   ;GET COLUMN POINTER
19E8   FE 38                  CPI   56   ;COMPARE TO 56
19EA   D2 67 19               JNC   CRLF   ;BRIF NO ROOM LEFT
19ED   47                     MOV   B,A   ;SAVE IT
19EE   AF                     XRA   A   ;INIT POSITION
19EF   B8           TBLP:     CMP   B   ;COMPARE
19F0   CA F6 19               JZ   TBLP2   
19F3   D2 FB 19               JNC   TBON   ;BRIF SHY OF TAB
19F6   C6 0E        TBLP2:    ADI   14   ;POINT NEXT STOP
19F8   C3 EF 19               JMP   TBLP   ;LOOP
19FB   32 76 22     TBON:     STA   COLUM   ;UPDATE CTR
19FE   90                     SUB   B   ;COMPUTE NUMBER OF SPACES
19FF   47                     MOV   B,A   ;SAVE IT
1A00   3E 20        TBSPA:    MVI   A," "   ;SPACE TO REG A
1A02   CD 5B 19               CALL   TESTO   ;OUTPUT IT
1A05   05                     DCR   B   ;SUB 1 FROM CTR
1A06   C8                     RZ      ;RETURN IF ZERO
1A07   C3 00 1A               JMP   TBSPA   ;ELSE, LOOP
1A0A                             ; 
1A0A                LINEO:    EQU   $   
1A0A                             ; 
1A0A                             ; UNPACK LINE NUMBER FROM (H,L) TO (D,E)
1A0A                             ; ZERO SUPPRESS LEADING ZEROS
1A0A                             ; 
1A0A                             ; 
1A0A   C5                     PUSH   B   ;PUSH B,C
1A0B   06 01                  MVI   B,1   ;SET SWITCH
1A0D   CD 15 1A               CALL   LOUT   ;GO FORMAT 2 BYTES
1A10   CD 15 1A               CALL   LOUT   ;THEN THE NEXT 2
1A13   C1                     POP   B   ;RESTORE B,C
1A14   C9                     RET      ;RETURN
1A15                             ; 
1A15                LOUT:     EQU   $   
1A15   7E                     MOV   A,M   ;GET BYTE
1A16   E6 F0                  ANI   0F0H   ;ISOLATE LEFT HALF
1A18   1F                     RAR      ;SHIFT RIGHT 1 BIT
1A19   1F                     RAR      ;AGAIN
1A1A   1F                     RAR      ;AGAIN
1A1B   1F                     RAR      ;LAST TIME
1A1C   C2 23 1A               JNZ   NOTZ1   ;BRIF NOT ZERO
1A1F   B0                     ORA   B   ;MERGE IN B
1A20   C2 29 1A               JNZ   Z1   ;BRIF ZERO
1A23   06 00        NOTZ1:    MVI   B,0   ;RESET SWITCH
1A25   F6 30                  ORI   30H   ;ZONE
1A27   12                     STAX   D   ;PUT TO BUFFER
1A28   13                     INX   D   ;POINT NEXT
1A29   7E           Z1:       MOV   A,M   ;LOAD BYTE
1A2A   E6 0F                  ANI   0FH   ;MASK
1A2C   C2 33 1A               JNZ   NOTZ2   ;BRIF NOT ZERO
1A2F   B0                     ORA   B   ;MERGE SWITCH
1A30   C2 39 1A               JNZ   Z2   ;BRIF ZERO
1A33   06 00        NOTZ2:    MVI   B,0   ;SET SWITCH OFF
1A35   F6 30                  ORI   30H   ;ZONE
1A37   12                     STAX   D   ;PUT TO BUFFER
1A38   13                     INX   D   ;POINT TO NEXT
1A39   23           Z2:       INX   H   ;AND NEXT LINE BYTE
1A3A   C9                     RET      ;RETURN
1A3B                             ; 
1A3B                TSTCC:    EQU   $   
1A3B                             ; 
1A3B                             ; TEST IF KEY WAS PRESSED DURING EXECUTION
1A3B                             ; CANCEL IF CONTROL-C
1A3B                             ; TOGGLE OUTPUT SUPPRESS SW IF CONTROL-O
1A3B                             ; 
1A3B   DB 0D                  IN   UART5   ;GET TTY STATUS
1A3D   E6 01                  ANI   UART_RX_FULL   ;TEST IF RXRDY
1A3F   C8                     RZ      ;RETURN IF NO CHAR
1A40   DB 08        GETCH:    IN   UART_RX   ;READ THE CHAR
1A42   E6 7F                  ANI   7FH   ;TURN OFF PARITY
1A44   FE 03                  CPI   3   ;TEST IF CONTROL C
1A46   C2 5F 1A               JNZ   TSTC1   ;BRIF NOT
1A49   CD 6E 1A               CALL   PRCNT   ;GO PRINT ^C
1A4C   3A 76 20               LDA   EDSW   ;GET MODE SW
1A4F   B7                     ORA   A   ;TEST IT
1A50   C2 E8 01               JNZ   KEY   ;**;BRIF COMMAND MODE
1A53   21 30 1E               LXI   H,STOPM   ;POINT MSG
1A56   CD BE 19               CALL   TERMM   ;GO PRINT IT
1A59   CD F2 1B               CALL   PRLIN   ;GO PRINT LINE
1A5C   C3 E8 01               JMP   KEY   ;GOTO READY
1A5F   FE 0F        TSTC1:    CPI   0FH   ;TEST IF CONTROL O
1A61   C0                     RNZ      ;RETURN IF NOT
1A62   CD 6E 1A               CALL   PRCNT   ;GO PRINT ^O
1A65   3A 73 20               LDA   OUTSW   ;GET OUTPUT SWTICH
1A68   EE 01                  XRI   1   ;TOGGLE
1A6A   32 73 20               STA   OUTSW   ;PUT SW
1A6D   C9                     RET      ;RETURN
1A6E                             ; 
1A6E                PRCNT:    EQU   $   
1A6E                             ; 
1A6E                             ; 
1A6E                             ; PRINTS ^ AND CHAR
1A6E                             ; 
1A6E   F5                     PUSH   PSW   ;SAVE CHAR
1A6F   3E 5E                  MVI   A,"^"   ;GET UP ARROW
1A71   CD 5B 19               CALL   TESTO   ;WRITE IT
1A74   F1                     POP   PSW   ;GET CHAR
1A75   C6 40                  ADI   64   ;TRNSLATE
1A77   C3 5B 19               JMP   TESTO   ;WRITE IT
1A7A                             ;PAGE
1A7A                             ; 
1A7A                COMP2:    EQU   $   
1A7A                             ; 
1A7A                             ; CONTINUATION OF COMPARE (RST 2) ROUTINE
1A7A                             ; 
1A7A   B7                     ORA   A   ;TEST IT
1A7B   C2 82 1A               JNZ   COMP5   ;BRIF NOT END
1A7E   AF           COMP3:    XRA   A   ;SET EQUAL STATUS
1A7F   7E           COMP4:    MOV   A,M   ;GET LAST CHAR
1A80   C1                     POP   B   ;RESTORE B,C
1A81   C9                     RET      ;RETURN
1A82   BE           COMP5:    CMP   M   ;COMPARE THE TWO CHARS
1A83   CA 8F 1A               JZ   COMP6   ;BRIF EQUAL
1A86   78                     MOV   A,B   ;GET COUNT
1A87   FE 03                  CPI   3   ;GET IF >= 3
1A89   D2 7E 1A               JNC   COMP3   ;BRIF NOT LESS THAN 3
1A8C   C3 7F 1A               JMP   COMP4   ;BRIF LESS THAN 3 AND NOT EQUAL
1A8F   04           COMP6:    INR   B   ;COUNT IT
1A90   13                     INX   D   ;POINT NEXT LIT
1A91   23                     INX   H   ;POINT NEXT VAR
1A92   C3 13 00               JMP   COMP1   ;CONTINUE
1A95                             ; 
1A95                EOL:      EQU   $   
1A95                             ; 
1A95                             ; TESTS IF (H,L) IS END OF LINE
1A95                             ; ERROR-DL IF NOT
1A95                             ; 
1A95   CF                     RST   1   ;SKIP TO NON-BLANK
1A96   CD A9 1A               CALL   TSTEL   ;TEST IF END LINE
1A99   C2 10 1C               JNZ   SNERR   ;ERROR IF NOT
1A9C   FE 3A                  CPI   ":"   ;TEST FOR MULTIPLE STATEMENT
1A9E   C2 A4 1A               JNZ   EOL1   ;BRIF NOT
1AA1   32 74 22               STA   MULTI   ;SET SWITCH
1AA4   23           EOL1:     INX   H   ;POINT NEXT
1AA5   22 72 22               SHLD   ENDLI   ;SAVE POINTER
1AA8   C9                     RET      ;RETURN
1AA9                             ; 
1AA9                TSTEL:    EQU   $   
1AA9                             ; 
1AA9                             ; TEST (H,L) FOR END OF STATEMENT (00H OR ":")
1AA9                             ; RETURN WITH Z SET IF IT IS
1AA9                             ; 
1AA9   B7                     ORA   A   ;TEST FOR ZERO
1AAA   C8                     RZ      ;RETURN IF IS
1AAB   FE 3A                  CPI   ":"   ;TEST FOR MULTIPLE STATEMENT
1AAD   C9                     RET      ;RETURN
1AAE                             ; 
1AAE                NOTEO:    EQU   $   
1AAE                             ; 
1AAE                             ; 
1AAE                             ; TEST IF (H,L) IS END OF LINE
1AAE                             ; RETURN IF NOT, ERROR-DL IF IS
1AAE                             ; 
1AAE   CF                     RST   1   ;SKIP TO NON-BLANK
1AAF   CD A9 1A               CALL   TSTEL   ;TEST IF END OF LINE
1AB2   CA 10 1C               JZ   SNERR   ;ERROR IF IS
1AB5   C9                     RET      ;ELSE, RETURN
1AB6                             ; 
1AB6                PACK:     EQU   $   
1AB6                             ; 
1AB6                             ; PACK LINE NUMBER FROM (H,L) TO B,C
1AB6                             ; 
1AB6                             ; 
1AB6   01 00 00               LXI   B,0   ;CLEAR B AND C
1AB9   3E 04                  MVI   A,4   ;INIT DIGIT COUNTER
1ABB   32 8D 22               STA   PRSW   ;SAVE A
1ABE   7E           PK1:      MOV   A,M   ;GET CHAR ### THIS HAPPENS AGAIN IN NUMER
1ABF   CD 2B 1B               CALL   NUMER   ;TEST FOR NUMERIC
1AC2   C0                     RNZ      ;RETURN IF NOT NUMERIC
1AC3   E6 0F                  ANI   0FH   ;STRIP OFF ZONE
1AC5   57                     MOV   D,A   ;SAVE IT
1AC6   3A 8D 22               LDA   PRSW   ;GET COUNT
1AC9   3D                     DCR   A   ;SUBTRACT ONE
1ACA   FA 10 1C               JM   SNERR   ;BRIF ERROR
1ACD   32 8D 22               STA   PRSW   ;SAVE CTR
1AD0   1E 04                  MVI   E,4   ;4 BIT SHIFT LOOP
1AD2   79           PK3:      MOV   A,C   ;GET LOW BYTE
1AD3   17                     RAL      ;ROTATE LEFT 1 BIT
1AD4   4F                     MOV   C,A   ;REPLACE
1AD5   78                     MOV   A,B   ;GET HIGH BYTE
1AD6   17                     RAL      ;ROTATE LEFT 1 BIT
1AD7   47                     MOV   B,A   ;REPLACE
1AD8   1D                     DCR   E   ;DECR CTR
1AD9   C2 D2 1A               JNZ   PK3   ;LOOP
1ADC   79                     MOV   A,C   ;GET LOW
1ADD   B2                     ORA   D   ;PUT DIGIT IN RIGHT HALF OF BYTE
1ADE   4F                     MOV   C,A   ;REPLACE
1ADF   23                     INX   H   ;POINT NEXT BYTE
1AE0   C3 BE 1A               JMP   PK1   ;LOOP
1AE3                             ; 
1AE3                SQUIS:    EQU   $   
1AE3                             ; 
1AE3                             ; COMPRESS THE EXPR STACK
1AE3                             ; REG A CONTAINS # OF BYTES TO REMOVE STARTING AT (H,L+1)
1AE3                             ; CONTAINS TOTAL NUMBER OF CHARACTERS IN STACK THUS FAR
1AE3                             ; 
1AE3   E5                     PUSH   H   ;SAVE H,L
1AE4   5F                     MOV   E,A   ;COUNT TO E
1AE5   16 00                  MVI   D,0   ;ZERO HI BYTE
1AE7   19                     DAD   D   ;COMPUTE START
1AE8   EB                     XCHG      ;PUT TO D,E
1AE9   E1                     POP   H   ;GET H,L
1AEA   2F                     CMA      ;COMPLEMENT COUNT
1AEB   3C                     INR   A   ;THEN 2'S COMPLEMENT
1AEC   80                     ADD   B   ;COMPUTE B-A
1AED   47                     MOV   B,A   ;PUT TO B
1AEE   13           SQUI2:    INX   D   ;POINT NEXT SEND
1AEF   23                     INX   H   ;POINT NEXT RECEIVE
1AF0   1A                     LDAX   D   ;GET A CHAR
1AF1   77                     MOV   M,A   ;PUT IT DOWN
1AF2   05                     DCR   B   ;DECR CTR
1AF3   C2 EE 1A               JNZ   SQUI2   ;LOOP
1AF6   22 50 22               SHLD   EXPRS   ;UPDATE NEW START OF EXPR
1AF9   C9                     RET      ;RETURN
1AFA                             ; 
1AFA                SKP2Z:    EQU   $   
1AFA                             ; 
1AFA                             ; FIND END OF LITERAL IN (D,E)
1AFA                             ; 
1AFA   1A                     LDAX   D   ;GET BYTE OF LIT
1AFB   B7                     ORA   A   ;TEST IT
1AFC   C8                     RZ      ;RETURN IF ZERO (END)
1AFD   13                     INX   D   ;ELSE, POINT NEXT
1AFE   C3 FA 1A               JMP   SKP2Z   ;LOOP
1B01                             ; 
1B01                GTEMP:    EQU   $   
1B01                             ; 
1B01                             ; GETS FOUR BYTE TEMPORARY STORAGE AREA,
1B01                             ; STORES THE FACC THERE,
1B01                             ; PUTS ADDR OF AREA IN EXPR STACK (H,L)
1B01                             ; 
1B01   EB                     XCHG      ;SAVE H,L IN D,E
1B02   E3                     XTHL      ;EXCHANGE 0 AND RET ADDR
1B03   E5                     PUSH   H   ;PUT NEW RET ADDR
1B04   E5                     PUSH   H   ;DOIT IT AGAIN
1B05   21 00 00               LXI   H,0   ;ZERO H,L
1B08   39                     DAD   SP   ;GET SP ADDR IN H,L
1B09   23                     INX   H   ;PLUS ONE
1B0A   23                     INX   H   ;PLUS ONE MORE (POINT TO NEW AREA)
1B0B   C5                     PUSH   B   ;SAVE CTRS
1B0C   D5                     PUSH   D   ;SAVE EXPR ADDR
1B0D   E5                     PUSH   H   ;SAVE TEMP ADDR
1B0E   DF                     RST   3   ;GO STORE FACC
1B0F   D1                     POP   D   ;RESTORE TEMP ADDR
1B10   2A 69 22               LHLD   SPCTR   ;GET COUNT
1B13   23                     INX   H   ;PLUS ONE
1B14   23                     INX   H   ;ONE MORE
1B15   22 69 22               SHLD   SPCTR   ;PUT BACK
1B18   E1                     POP   H   ;RESTORE EXPR ADDR
1B19   C1                     POP   B   ;RESTORE CTRS
1B1A   23           SADR:     INX   H   ;POINT NEXT BYTE
1B1B   72                     MOV   M,D   ;HIGH BYTE TO EXPRSTK
1B1C   23                     INX   H   ;POINT NEXT
1B1D   73                     MOV   M,E   ;LOW BYTE TO EXPR STK
1B1E   23                     INX   H   ;POINT NEXT
1B1F   36 E3                  MVI   M,0E3H   ;CODE = NUMERIC DATA
1B21   C9                     RET      ;RETURN
1B22                             ; 
1B22                ALPHA:    EQU   $   
1B22                             ; 
1B22                             ; TESTS THE CHAR AT (H,L)
1B22                             ; RETURNS WITH Z SET IF CHAR IS ALPHA (A-Z)
1B22                             ; RETURNS WITH Z OFF IF NOT ALPHA
1B22                             ; CHAR IS LEFT IN REG A
1B22                             ; 
1B22   7E                     MOV   A,M   ;PUT CHAR TO REG A
1B23   FE 41                  CPI   "A"   ;TEST IF A OR HIGHER
1B25   D8                     RC      ;RETURN IF NOT ALPHA (Z IS OFF)
1B26   FE 5A                  CPI   "Z"   ;TEST IF Z OR LESS
1B28   C3 31 1B               JMP   NUMEN   ;GO WRAPUP
1B2B                             ; 
1B2B                NUMER:    EQU   $   
1B2B                             ; 
1B2B                             ; TESTS THE CHAR AT (H,L)
1B2B                             ; RETURNS WITH Z SET IF NUMERIC (0-9)
1B2B                             ; ELSE Z IS OFF
1B2B                             ; CHAR IS LEFT IN THE A REG
1B2B                             ; 
1B2B   7E                     MOV   A,M   ;GET CHAR TO REG A
1B2C   FE 30                  CPI   "0"   ;TEST IF ZERO OR GREATER
1B2E   D8                     RC      ;RETURN IF LESS THAN ZERO
1B2F   FE 39                  CPI   "9"   ;TEST IF 9 OR LESS
1B31   C8           NUMEN:    RZ      ;RETURN IF 9
1B32   D0                     RNC      ;RETURN IF NOT NUMERIC
1B33   BF                     CMP   A   ;SET Z
1B34   C9                     RET      ;RETURN
1B35                             ; 
1B35                SEARC:    EQU   $   
1B35                             ; 
1B35                             ; SEARCHES FOR THE VARIABLE IN D,E
1B35                             ; RETURNS WITH ADDR OF DATA AREA FOR VARIABLE
1B35                             ; 
1B35   E5                     PUSH   H   ;SAVE H,L
1B36   3A 88 22               LDA   FNMOD   ;GET FUNCTION MODE
1B39   B7                     ORA   A   ;TEST IT
1B3A   C2 90 1B               JNZ   SCH6   ;BRIF IN A FUNCTION
1B3D   2A 91 22     SCH0:     LHLD   DATAB   ;GET ADDR OF DATA POOL
1B40   7E           SCH1:     MOV   A,M   ;GET THE BYTE
1B41   B7                     ORA   A   ;TEST IF END
1B42   CA 66 1B               JZ   SCH3   ;BRIF END
1B45   2B                     DCX   H   ;POINT NEXT
1B46   2B                     DCX   H   ;DITTO
1B47   46                     MOV   B,M   ;GET HI LEN
1B48   2B                     DCX   H   ;POINT NEXT
1B49   4E                     MOV   C,M   ;GET LO LEN
1B4A   E7                     RST   4   ;ADJUST H,L
1B4B   03                     DB   3   
1B4C   7E                     MOV   A,M   ;LOAD 1ST CHAR
1B4D   BA                     CMP   D   ;COMPARE 1ST CHAR
1B4E   C2 62 1B               JNZ   SCH2   ;BRIF NOT EQUAL
1B51   2B                     DCX   H   ;POINT NEXT
1B52   7E                     MOV   A,M   ;LOAD 2ND DIGIT
1B53   23                     INX   H   ;POINT BACK
1B54   BB                     CMP   E   ;COMPARE 2ND CHAR
1B55   C2 62 1B               JNZ   SCH2   ;BRIF NOT EQUAL
1B58   7A                     MOV   A,D   ;GET HI NAME
1B59   B7                     ORA   A   ;TEST IT
1B5A   FA C5 1B               JM   SCH9   ;RETURN IF MATRIX
1B5D   09                     DAD   B   ;POINT NEXT ENTRY
1B5E   23                     INX   H   ;PLUS ONE
1B5F   EB                     XCHG      ;FLIP/FLOP
1B60   E1                     POP   H   ;RESTORE H
1B61   C9                     RET      ;RETURN
1B62   09           SCH2:     DAD   B   ;MINUS LEN
1B63   C3 40 1B               JMP   SCH1   ;LOOP
1B66   72           SCH3:     MOV   M,D   ;PUT 1ST CHAR
1B67   2B                     DCX   H   ;POINT NEXT
1B68   73                     MOV   M,E   ;PUT 2ND CHAR
1B69   2B                     DCX   H   ;POINT NEXT
1B6A   7A                     MOV   A,D   ;GET HI NAME
1B6B   B7                     ORA   A   ;TEST IT
1B6C   FA A4 1B               JM   SCH7   ;BRIF ARRAY
1B6F   36 FF                  MVI   M,0FFH   ;HI LEN
1B71   2B                     DCX   H   ;POINT NEXT
1B72   7B                     MOV   A,E   ;GET LO NAME
1B73   B7                     ORA   A   ;TEST TYPE
1B74   FA 7E 1B               JM   SCH4   ;BRIF CHAR
1B77   36 F8                  MVI   M,0F8H   ;LO LEN
1B79   06 04                  MVI   B,4   ;LOOP CTR
1B7B   C3 82 1B               JMP   SCH5   ;BRARND
1B7E   36 FB        SCH4:     MVI   M,0FBH   ;LO LEN
1B80   06 01                  MVI   B,1   ;LOOP CTR
1B82   2B           SCH5:     DCX   H   ;POINT NEXT
1B83   36 00                  MVI   M,0   ;ZERO THE VALUE
1B85   05                     DCR   B   ;DECR CTR
1B86   C2 82 1B               JNZ   SCH5   ;LOOP
1B89   2B                     DCX   H   ;POINT NEXT
1B8A   36 00                  MVI   M,0   ;MARK NEW END
1B8C   23                     INX   H   ;POINT ADDR OF VARIABLE
1B8D   EB                     XCHG      ;PUT LOCATION TO D,E
1B8E   E1                     POP   H   ;RESTORE H,L
1B8F   C9                     RET      ;RETURN
1B90   21 6C 22     SCH6:     LXI   H,FNARG   ;POINT DUMMY ARG
1B93   7E                     MOV   A,M   ;LOAD 1ST CHAR
1B94   BA                     CMP   D   ;COMPARE
1B95   C2 3D 1B               JNZ   SCH0   ;BRIF NOT EQUAL
1B98   23                     INX   H   ;POINT NEXT
1B99   7E                     MOV   A,M   ;LOAD 2ND CHAR
1B9A   BB                     CMP   E   ;COMPARE
1B9B   C2 3D 1B               JNZ   SCH0   ;BRIF NOT EQUAL
1B9E   23                     INX   H   ;POINT NEXT
1B9F   56                     MOV   D,M   ;GET HI ADDR
1BA0   23                     INX   H   ;POINT NEXT
1BA1   5E                     MOV   E,M   ;GET LO ADDR
1BA2   E1                     POP   H   ;RESTORE H,L
1BA3   C9                     RET      ;RETURN
1BA4   E5           SCH7:     PUSH   H   ;SAVE ADDRESS
1BA5   36 FE                  MVI   M,0FEH   ;MOVE HI DISP
1BA7   2B                     DCX   H   ;POINT NEXT
1BA8   36 14                  MVI   M,14H   ;MOVE LO DISP
1BAA   2B                     DCX   H   
1BAB   36 00                  MVI   M,0   ;MOVE A ZERO
1BAD   2B                     DCX   H   ;POINT NEXT
1BAE   36 0A                  MVI   M,10   ;MOVE 10
1BB0   2B                     DCX   H   ;POINT NEXT
1BB1   36 00                  MVI   M,0   ;MOVE A ZERO
1BB3   2B                     DCX   H   ;POINT NEXT
1BB4   36 0A                  MVI   M,10   ;MOVE A 10 (DEFAULT IS 10 X 10)
1BB6   01 E5 01               LXI   B,485   ;TOTAL # OF BYTES TAKEN BY ARRAY
1BB9   2B           SCH8:     DCX   H   ;POINT NEXT
1BBA   36 00                  MVI   M,0   ;CLEAR ONE BYTE
1BBC   0B                     DCX   B   ;DCR CTR
1BBD   78                     MOV   A,B   ;GET HI
1BBE   B1                     ORA   C   ;PLUS LO
1BBF   C2 B9 1B               JNZ   SCH8   ;LOOP
1BC2   E1                     POP   H   ;RESTORE PTR TO START
1BC3   23                     INX   H   ;POINT LO NAME
1BC4   23                     INX   H   ;POINT HI NAME
1BC5   C1           SCH9:     POP   B   ;NEED TO XCHANGE LAST 2 STACK ENTRIES
1BC6   D1                     POP   D   ;SO DOIT
1BC7   C5                     PUSH   B   
1BC8   D5                     PUSH   D   
1BC9   C9                     RET      ;RETURN
1BCA                             ; 
1BCA                VAR:      EQU   $   
1BCA                             ; 
1BCA                             ; 
1BCA                             ; TEST (H,L) FOR A VARIABLE NAME
1BCA                             ; PUTS THE NAME IN D,E IF FOUND
1BCA                             ; ERROR SN IF NONE FOUND
1BCA                             ; 
1BCA   CF                     RST   1   ;SKIP TO NON-BLANK
1BCB   CD 22 1B               CALL   ALPHA   ;TEST IF ALPHA
1BCE   C2 10 1C               JNZ   SNERR   ;BRIF NOT ALPHA
1BD1   57                     MOV   D,A   ;FIRST CHAR
1BD2   1E 20                  MVI   E," "   ;DEFAULT
1BD4   23                     INX   H   ;POINT NEXT
1BD5   CF                     RST   1   ;GET 2ND CHAR
1BD6   CD 2B 1B               CALL   NUMER   ;TEST IF NUMERIC
1BD9   C2 DF 1B               JNZ   VAR2   ;BRIF NOT NUMERIC
1BDC   5F                     MOV   E,A   ;SAVE 2ND CHAR
1BDD   23                     INX   H   ;POINT NEXT
1BDE   CF                     RST   1   ;GET NON-BLANK FOLLOWING
1BDF   FE 24        VAR2:     CPI   "$"   ;TEST IF STRING
1BE1   C2 EA 1B               JNZ   VAR3   ;BRIF NOT
1BE4   7B                     MOV   A,E   ;GET 2ND CHAR
1BE5   F6 80                  ORI   80H   ;SET TYPE
1BE7   5F                     MOV   E,A   ;SAVE IT
1BE8   23                     INX   H   ;SKIP $
1BE9   C9                     RET      ;THEN RETURN
1BEA   FE 28        VAR3:     CPI   "("   ;TEST IF ARRAY
1BEC   C0                     RNZ      ;RETURN IF NOT
1BED   7A                     MOV   A,D   ;GET HI NAME
1BEE   F6 80                  ORI   80H   ;TURN ON D7
1BF0   57                     MOV   D,A   ;RESTORE
1BF1   C9                     RET      ;RETURN
1BF2                             ; 
1BF2                PRLIN:    EQU   $   
1BF2                             ; 
1BF2                             ; PRINTS LINE NUMBER FOLLOWED BY CR/LF
1BF2                             ; 
1BF2   11 77 20               LXI   D,LINEN   ;POINT AREA
1BF5   2A 89 22               LHLD   LINE   ;GET ADDR OF LINE NUMBER
1BF8   CD 0A 1A               CALL   LINEO   ;GO UNPACK
1BFB   EB                     XCHG      ;PUT TO H,L
1BFC   36 00                  MVI   M,0   ;END OF MSG
1BFE   21 77 20               LXI   H,LINEN   ;POINT AREA
1C01   C3 BE 19               JMP   TERMM   ;GO PRINT IT
1C04                             ;PAGE
1C04                             ; 
1C04                             ; ERROR MESSAGE ROUTINES
1C04                             ; FATAL ERROR MUST BE FIRST
1C04                             ; 
1C04                EM:       EQU   0FEH   
1C04                             ; 
1C04   F7           ULERR:    RST   6   
1C05   55 4C FE F7            DB   "UL",EM,FATAL   ;NOTE FATAL = CODE FOR RST 6
1C09                ZMERR:    EQU   $-1   ;LOG(X<=0),SQR(-X),0 DIVIDE
1C09   4F 46 FE F7            DB   "OF",EM,FATAL   
1C0D                STERR:    EQU   $-1   ;ERROR IN EXPRESSION STACK
1C0D   53 54 FE F7            DB   "ST",EM,FATAL   
1C11                SNERR:    EQU   $-1   ;DELIMITER ERROR
1C11   53 4E FE F7            DB   "SN",EM,FATAL   
1C15                RTERR:    EQU   $-1   ;RETURN & NO GOSUB
1C15   52 54 FE F7            DB   "RT",EM,FATAL   
1C19                DAERR:    EQU   $-1   ;OUT OF DATA
1C19   44 41 FE F7            DB   "DA",EM,FATAL   
1C1D                NXERR:    EQU   $-1   ;NEXT & NO FOR / >8 FOR'S
1C1D   4E 58 FE F7            DB   "NX",EM,FATAL   
1C21                CVERR:    EQU   $-1   ;CONVERSION ERROR
1C21   43 56 FE F7            DB   "CV",EM,FATAL   
1C25                CKERR:    EQU   $-1   ;CHECKSUM ERROR
1C25   43 4B FE F7            DB   "CK",EM,FATAL   
1C29                             ; 
1C29                             ; NON-FATAL ERRORS
1C29                             ; 
1C29                OVERR:    EQU   $-1   ;OVERFLOW ERROR
1C29   4F 56 FE               DB   "OV",EM   
1C2C   C9                     RET      ;RETURN TO ROUTINE
1C2D   F7           UNERR:    RST   6   ;CALL   ERROR ROUTINE
1C2E   55 4E FE               DB   "UN",EM   
1C31   C9                     RET      
1C32                             ; 
1C32                             ; CONTINUATION OF ERROR MESSAGE ROUTINE (RST 6)
1C32                             ; 
1C32   CD BE 19     ERROR:    CALL   TERMM   ;PRINT "XX"
1C35   E5                     PUSH   H   ;SAVE RETURN
1C36   21 3F 1E               LXI   H,ERRMS   ;PRINT "ERROR IN LINE"
1C39   CD BE 19               CALL   TERMM   
1C3C   CD F2 1B               CALL   PRLIN   ;PRINT LINE #
1C3F   E1                     POP   H   
1C40   23                     INX   H   ;RETURN ADDRESS
1C41   7E                     MOV   A,M   ;GET INSTRUCTION
1C42   FE F7                  CPI   FATAL   ;IS IT AN RST 6?
1C44   CA E8 01               JZ   KEY   ;IF ZERO, YES, ABORT
1C47   C1                     POP   B   ;RESTORE REGISTERS
1C48   D1                     POP   D   
1C49   F1                     POP   PSW   
1C4A   E3                     XTHL      
1C4B   C9                     RET      
1C4C                             ;PAGE
1C4C                             ; 
1C4C                             ; 
1C4C                             ; MOVE THE STRING FROM (D,E) TO (H,L) COUNT IN B
1C4C                             ; 
1C4C                             ; 
1C4C   06 04        CPY4D:    MVI   B,4   
1C4E   1A           COPYD:    LDAX   D   ;GET A BYTE
1C4F   77                     MOV   M,A   ;MOVE IT
1C50   23                     INX   H   ;POINT NEXT
1C51   13                     INX   D   ;DITTO
1C52   05                     DCR   B   ;DECR CTR
1C53   C2 4E 1C               JNZ   COPYD   ;LOOP
1C56   C9                     RET      ;THEN RETURN
1C57                             ; 
1C57                             ; 
1C57                             ; MOVE THE STRING FROM (H,L) TO (D,E) COUNT IN B
1C57                             ; 
1C57                             ; 
1C57   06 04        CPY4H:    MVI   B,4   
1C59   EB           COPYH:    XCHG      ;FLIP/FLOP
1C5A   CD 4E 1C               CALL   COPYD   ;GO COPY
1C5D   EB                     XCHG      ;FLIP/FLOP BACK
1C5E   C9                     RET      ;RETURN
1C5F                             ; 
1C5F                ZEROM:    EQU   $   
1C5F                             ; 
1C5F                             ; MOVES A STRING OF BINARY ZEROS, COUNT IN B
1C5F                             ; 
1C5F   36 00                  MVI   M,0   ;MOVE A ZERO
1C61   23                     INX   H   ;POINT NEXT
1C62   05                     DCR   B   ;DECR CTR
1C63   C2 5F 1C               JNZ   ZEROM   ;LOOP
1C66   C9                     RET      ;RETURN
1C67                             ; 
1C67                FBIN:     EQU   $   
1C67                             ; 
1C67                             ; 
1C67                             ; CONVERT FLOAT ACC TO UNSIGNED BINARY NUMBER IN A REG
1C67                             ; RETURNS 0 IN A REG IF FACC<0 OR FACC>255
1C67                             ; 
1C67                             ; 
1C67   E5                     PUSH   H   ;SAVE H,L
1C68   D5                     PUSH   D   ;SAVE D,E
1C69   CD 38 1F               CALL   FACDE   ;CONVERT FACC TO D,E
1C6C   AF                     XRA   A   ;ZERO A
1C6D   B2                     ORA   D   ;TEST HIGH VALUE
1C6E   C2 72 1C               JNZ   FBIN1   ;BRIF NOT ZERO
1C71   7B                     MOV   A,E   ;VALUE TO A
1C72   D1           FBIN1:    POP   D   ;RESTORE D,E
1C73   E1                     POP   H   ;RESTORE H,L
1C74   C9                     RET      ;RETURN
1C75                             ; 
1C75                ARG:      EQU   $   
1C75                             ; 
1C75                             ; GET NEXT ARGUMENT FROM POLISH STACK
1C75                             ; 
1C75   2A 52 22               LHLD   ADDR1   ;GET ADDRESS
1C78   23                     INX   H   ;POINT NEXT
1C79   56                     MOV   D,M   ;GET HI ADDRESS
1C7A   23                     INX   H   ;POINT NEXT
1C7B   5E                     MOV   E,M   ;GET LO ADDRESS
1C7C   23                     INX   H   ;POINT TYPE
1C7D   22 52 22               SHLD   ADDR1   ;GET ADDRESS
1C80   2B                     DCX   H   ;POINT BACK
1C81   C3 8F 13               JMP   EVLD   ;CALL EVLOAD AND RETURN
1C84                             ; 
1C84                             ; 
1C84                ARGNU:    EQU   $   
1C84                             ; 
1C84   CD 75 1C               CALL   ARG   ;GET ARGUMENT
1C87   C3 67 1C               JMP   FBIN   ;THEN CONVERT FACC TO BIN
1C8A                             ; 
1C8A                BINFL:    EQU   $   
1C8A                             ; 
1C8A                             ; CONVERT D,E TO FLOATING POINT NUMBER IN FAC
1C8A                             ; 
1C8A                             ; 
1C8A   21 58 22               LXI   H,FACC   ;POINT ACC
1C8D   36 18                  MVI   M,24   ;MAX BITS
1C8F   23                     INX   H   ;POINT NEXT
1C90   36 00                  MVI   M,0   ;CLEAR MSB
1C92   23                     INX   H   ;POINT NEXT
1C93   72                     MOV   M,D   ;MOVE MID
1C94   23                     INX   H   ;POINT NEXT
1C95   73                     MOV   M,E   ;MOVE LSB
1C96   C3 E9 16               JMP   FNORM   ;GO NORMALIZE & RETURN
1C99                             ;PAGE
1C99                             ; 
1C99                             ; FUNCTION TABLE. FORMAT IS:
1C99                             ;     DB <LITERAL>,0
1C99                             ;     DW <ADDRESS>
1C99                             ;     DB <FUNCTION TYPE>
1C99                             ; 
1C99                             ; TABLE IS TERMINATED WITH A "00"
1C99                             ; 
1C99                FUNCT:    EQU   $   
1C99   41 42 53 00            DB   "ABS",0   
1C9D   D3 0B                  DW   ABS   
1C9F   AB                     DB   0ABH   
1CA0   53 51 52 00            DB   "SQR",0   
1CA4   33 0C                  DW   SQR   
1CA6   AB                     DB   0ABH   
1CA7   49 4E 54 00            DB   "INT",0   
1CAB   EE 0B                  DW   INT   
1CAD   AB                     DB   0ABH   
1CAE   53 47 4E 00            DB   "SGN",0   
1CB2   DC 0B                  DW   SGN   
1CB4   AB                     DB   0ABH   
1CB5   52 4E 44 00  RNDLI:    DB   "RND",0   
1CB9   90 0C                  DW   RND   
1CBB   AB                     DB   0ABH   
1CBC   53 49 4E 00            DB   "SIN",0   
1CC0   4D 0A                  DW   SIN   
1CC2   AB                     DB   0ABH   
1CC3   43 4F 53 00            DB   "COS",0   
1CC7   BF 0A                  DW   COS   
1CC9   AB                     DB   0ABH   
1CCA   54 41 4E 00            DB   "TAN",0   
1CCE   C8 0A                  DW   TAN   
1CD0   AB                     DB   0ABH   
1CD1   41 54 4E 00            DB   "ATN",0   
1CD5   E0 0A                  DW   ATN   
1CD7   AB                     DB   0ABH   
1CD8   49 4E 50 00            DB   "INP",0   
1CDC   16 0D                  DW   INP   
1CDE   AB                     DB   0ABH   
1CDF   4C 4E 00               DB   "LN",0   
1CE2   1F 0B                  DW   LN   
1CE4   AB                     DB   0ABH   
1CE5   4C 4F 47 00            DB   "LOG",0   
1CE9   6D 0B                  DW   LOG   
1CEB   AB                     DB   0ABH   
1CEC   45 58 50 00            DB   "EXP",0   
1CF0   76 0B                  DW   EXP   
1CF2   AB                     DB   0ABH   
1CF3   50 4F 53 00            DB   "POS",0   
1CF7   2C 0D                  DW   POS   
1CF9   AB                     DB   0ABH   
1CFA   4C 45 4E 00            DB   "LEN",0   
1CFE   95 0D                  DW   LENFN   
1D00   AB                     DB   0ABH   
1D01   43 48 52 24 00         DB   "CHR$",0   
1D06   9B 0D                  DW   CHRFN   
1D08   CB                     DB   0CBH   
1D09   41 53 43 49 49 00      DB   "ASCII",0   
1D0F   A6 0D                  DW   ASCII   
1D11   AB                     DB   0ABH   
1D12   4E 55 4D 24 00         DB   "NUM$",0   
1D17   B3 0D                  DW   NUMFN   
1D19   CB                     DB   0CBH   
1D1A   56 41 4C 00            DB   "VAL",0   
1D1E   C6 0D                  DW   VAL   
1D20   AB                     DB   0ABH   
1D21   53 50 41 43 45 24 00   DB   "SPACE$",0   
1D28   ED 0D                  DW   SPACE   
1D2A   CB                     DB   0CBH   
1D2B   53 54 52 49 4E 47 24 00 DB   "STRING$",0   
1D33   FD 0D                  DW   STRFN   
1D35   D3                     DB   0D3H   
1D36   4C 45 46 54 24 00      DB   "LEFT$",0   
1D3C   11 0E                  DW   LEFT   
1D3E   D3                     DB   0D3H   
1D3F   52 49 47 48 54 24 00   DB   "RIGHT$",0   
1D46   1A 0E                  DW   RIGHT   
1D48   D3                     DB   0D3H   
1D49   4D 49 44 24 00         DB   "MID$",0   
1D4E   23 0E                  DW   MIDFN   
1D50   DB                     DB   0DBH   
1D51   49 4E 53 54 52 00      DB   "INSTR",0   
1D57   5D 0E                  DW   INSTR   
1D59   BB                     DB   0BBH   
1D5A   50 45 45 4B 00         DB   "PEEK",0   
1D5F   AE 1F                  DW   PEEK   
1D61   AB                     DB   0ABH   
1D62   00                     DB   0   ;END OF FUNCTION TABLE
1D63                             ;PAGE
1D63                             ; 
1D63                             ; PROGRAM CONSTANTS
1D63                             ; 
1D63   13 14 00     PCHOF:    DB   19,20,0   
1D66   3F FD        RNDP:     DB   3FH,0FDH   ;16381
1D68   3F EB                  DB   3FH,0EBH   ;16363
1D6A   3F DD                  DB   3FH,0DDH   ;16349
1D6C   1B EC        NRNDX:    DB   1BH,0ECH   
1D6E   33 D3                  DB   33H,0D3H   
1D70   1A 85                  DB   1AH,85H   
1D72   2B 1E                  DB   2BH,1EH   
1D74   57 48 41 54 00 WHATL:   DB   "WHAT",0   
1D79                VERS:     EQU   $   ;VERSION MESSAGE
1D79   0D 0A 38 4B 20 56 45 52 53 20 31 2E 34 00 DB   $0d,$0a,"8K VERS 1.4",0   
1D87   4C 49 4E 45 00 LLINE:   DB   "LINE",0   
1D8C   54 41 42 00  TABLI:    DB   "TAB",0   
1D90   53 54 45 50 00 STEPL:   DB   "STEP",0   
1D95   54 48 45 4E 00 THENL:   DB   "THEN",0   
1D9A   50 49 00     PILIT:    DB   "PI",0   
1D9D   02 80 00 00  TWO:      DB   02H,80H,00H,00H   ;CONSTANT:  2
1DA1   04 A0 00 00  TEN:      DB   04H,0A0H,00H,00H   ;CONSTANT:  10
1DA5   02 C9 0F D7  PI:       DB   02H,0C9H,0FH,0D7H   ;CONSTANT:  3.141593
1DA9   00 C9 0F D7  QTRPI:    DB   00H,0C9H,0FH,0D7H   ;CONSTANT:  0.7853892
1DAD   80 FF FF FF  NEGON:    DB   80H,0FFH,0FFH,0FFH   ;CONSTANT: -0.9999999
1DB1   00 B1 72 16  LN2C:     DB   00H,0B1H,72H,16H   ;CONSTANT:  0.6931472
1DB5   00 97 14 EB  SQC1:     DB   00H,97H,14H,0EBH   ;CONSTANT:  0.59016206
1DB9   7F D5 A9 56  SQC2:     DB   7FH,0D5H,0A9H,56H   ;CONSTANT:  0.41730759
1DBD                             ;PAGE
1DBD                             ; 
1DBD                             ; THE FOLLOWING CONSTANTS MUST BE IN THIS ORDER ***********
1DBD                             ; 
1DBD                             ;       CONSTANT WITH EXPONENT OF 1
1DBD                             ;       COEFFICIENT OF FIRST TERM
1DBD                             ;       ...
1DBD                             ;       COEEFICIENT OF NTH TERM
1DBD                             ; 
1DBD                             ; SINCE ALL COEFFICIENTS ARE LESS THAN 1,
1DBD                             ; THE ITERATION LOOP USES THE
1DBD                             ; CONSTANT WITH EXPONENT 1 TO TERMINATE THE EVALUATION.
1DBD                             ; 
1DBD   01 B5 04 F3  SQC3:     DB   01H,0B5H,04H,0F3H   ;CONSTANT:  1.41421356
1DC1   FF AA 95 BC            DB   0FFH,0AAH,95H,0BCH   ;CONSTANT: -0.3331738
1DC5   7E CA D5 20            DB   7EH,0CAH,0D5H,20H   ;CONSTANT:  0.1980787
1DC9   FE 87 82 D6            DB   0FEH,87H,82H,0D6H   ;CONSTANT: -0.1323351
1DCD   7D A3 13 1C            DB   7DH,0A3H,13H,1CH   ;CONSTANT:  0.07962632
1DD1   FC 89 A6 B8            DB   0FCH,89H,0A6H,0B8H   ;CONSTANT: -0.03360627
1DD5   79 DF 3A 9E  ATNCO:    DB   79H,0DFH,3AH,9EH   ;CONSTANT:  0.006812411
1DD9                             ; 
1DD9   01 C9 0F D7  HALFP:    DB   01H,0C9H,0FH,0D7H   ;CONSTANT:  1.570796
1DDD   80 A5 5D DE            DB   80H,0A5H,5DH,0DEH   ;CONSTANT: -0.64596371
1DE1   7D A3 34 55            DB   7DH,0A3H,34H,55H   ;CONSTANT:  0.076589679
1DE5   F9 99 38 60            DB   0F9H,99H,38H,60H   ;CONSTANT: -0.0046737656
1DE9   74 9E D7 B6  SINCO:    DB   74H,9EH,0D7H,0B6H   ;CONSTANT:  0.00015148419
1DED                             ; 
1DED   01 80        ONE:      DB   001H,080H   
1DEF   00 00        NULLI:    DB   00H,00H   ;CONSTANT:  1.0
1DF1   00 FF FE C1            DB   00H,0FFH,0FEH,0C1H   ;CONSTANT:  0.99998103
1DF5   FF FF BA B0            DB   0FFH,0FFH,0BAH,0B0H   ;CONSTANT: -0.4994712
1DF9   7F A8 0E 2B            DB   7FH,0A8H,0EH,2BH   ;CONSTANT:  0.3282331
1DFD   FE E7 4B 55            DB   0FEH,0E7H,4BH,55H   ;CONSTANT: -0.2258733
1E01   7E 89 DE E3            DB   7EH,89H,0DEH,0E3H   ;CONSTANT:  0.134693
1E05   FC E1 C5 78            DB   0FCH,0E1H,0C5H,078H   ;CONSTANT: -0.05511996
1E09   7A B0 3F AE  LNCO:     DB   7AH,0B0H,3FH,0AEH   ;CONSTANT:  0.01075737
1E0D                             ; 
1E0D   01 B8 AA 3B  LN2E:     DB   001H,0B8H,0AAH,03BH   ;CONSTANT:  1.44269504
1E11   00 B1 6F E6            DB   000H,0B1H,06FH,0E6H   ;C=.69311397
1E15   7E F6 2F 70            DB   07EH,0F6H,02FH,070H   ;C=.24041548
1E19   7C E1 C2 AE            DB   07CH,0E1H,0C2H,0AEH   ;C=.05511732
1E1D   7A A0 BB 7E            DB   07AH,0A0H,0BBH,07EH   ;C=.00981033
1E21   77 CA 09 CB  EXPCO:    DB   077H,0CAH,009H,0CBH   ;C=.00154143
1E25                             ; 
1E25   7F DE 5B D0  LNC:      DB   07FH,0DEH,05BH,0D0H   ;C=LOG BASE 10 OF E
1E29                READY:    EQU   $   
1E29   FD                     DB   0FDH   
1E2A   52 45 41 44 59 00      DB   "READY",0   
1E30                STOPM:    EQU   $   
1E30   FD                     DB   0FDH   
1E31   53 54 4F 50 20 41 54 20 4C 49 4E 45 20 FE DB   "STOP AT LINE ",254   
1E3F   20 45 52 52 4F 52 20 49 4E 20 4C 49 4E 45 20 FE ERRMS:   DB   " ERROR IN LINE ",0FEH   
1E4F                TTY:      EQU   2   
1E4F                             ;PAGE
1E4F                             ; 
1E4F                             ; VERB (STATEMENT/COMMAND) TABLE
1E4F                             ; FORMAT IS: DB "VERB",0
1E4F                             ;            DW ADDR
1E4F                             ;            DB "NEXT VERB",0
1E4F                             ;            ETC
1E4F                             ;  END OF TABLE IS MARKED BY DB 0
1E4F                             ; 
1E4F                JMPTB:    EQU   $   
1E4F   4C 49 53 54 00         DB   "LIST",0   
1E54   6E 02                  DW   LIST   
1E56   52 55 4E 00            DB   "RUN",0   
1E5A   00 02                  DW   RUNCM   
1E5C   58 45 51 00            DB   "XEQ",0   
1E60   05 02                  DW   XEQ   
1E62   4E 45 57 00            DB   "NEW",0   
1E66   94 01                  DW   NEW   
1E68   43 4F 4E 00            DB   "CON",0   
1E6C   FA 02                  DW   CONTI   
1E6E   54 41 50 45 00         DB   "TAPE",0   
1E73   CA 01                  DW   TAPE   
1E75   53 41 56 45 00         DB   "SAVE",0   
1E7A   61 02                  DW   SAVE   
1E7C   4B 45 59 00  KEYL:     DB   "KEY",0   
1E80   E8 01                  DW   KEY   
1E82   46 52 45 00            DB   "FRE",0   
1E86   AC 01                  DW   FREE   
1E88   49 46 00               DB   "IF",0   
1E8B   F5 04                  DW   IFSTM   
1E8D   52 45 41 44 00         DB   "READ",0   
1E92   ED 07                  DW   READ   
1E94   52 45 53 54 4F 52 45 00 DB   "RESTORE",0   
1E9C   22 03                  DW   RESTO   
1E9E   44 41 54 41 00 DATAL:   DB   "DATA",0   
1EA3   17 02                  DW   RUN   
1EA5   46 4F 52 00            DB   "FOR",0   
1EA9   F1 03                  DW   FOR   
1EAB   4E 45 58 54 00 NEXTL:   DB   "NEXT",0   
1EB0   9E 06                  DW   NEXT   
1EB2   47 4F 53 55 42 00 GOSBL:   DB   "GOSUB",0   
1EB8   46 03                  DW   GOSUB   
1EBA   52 45 54 55 52 4E 00   DB   "RETURN",0   
1EC1   2E 03                  DW   RETUR   
1EC3   49 4E 50 55 54 00      DB   "INPUT",0   
1EC9   2D 07                  DW   INPUT   
1ECB   50 52 49 4E 54 00      DB   "PRINT",0   
1ED1   61 03                  DW   PRINT   
1ED3   47 4F        GOTOL:    DB   "GO"   
1ED5   54 4F 00     TOLIT:    DB   "TO",0   
1ED8   02 03                  DW   GOTO   
1EDA   4C 45 54 00            DB   "LET",0   
1EDE   FD 05                  DW   LET   
1EE0   53 54 4F 50 00         DB   "STOP",0   
1EE5   7E 08                  DW   STOP   
1EE7   45 4E 44 00            DB   "END",0   
1EEB   D7 01                  DW   ENDIT   
1EED   52 45 4D 00            DB   "REM",0   
1EF1   17 02                  DW   RUN   
1EF3   21 00                  DB   "!",0   
1EF5   17 02                  DW   RUN   
1EF7   3F 00                  DB   "?",0   
1EF9   61 03                  DW   PRINT   
1EFB   52 41 4E 44 4F 4D 49 5A 45 00 DB   "RANDOMIZE",0   
1F05   AB 08                  DW   RANDO   
1F07   4F 4E 00               DB   "ON",0   
1F0A   C1 08                  DW   ON   
1F0C   4F 55 54 00            DB   "OUT",0   
1F10   56 08                  DW   OUTP   
1F12   44 49 4D 00            DB   "DIM",0   
1F16   BD 09                  DW   DIM   
1F18   43 48 41 4E 47 45 00   DB   "CHANGE",0   
1F1F   36 09                  DW   CHANG   
1F21   44 45 46     DEFLI:    DB   "DEF"   
1F24   46 4E 00     FNLIT:    DB   "FN",0   
1F27   17 02                  DW   RUN   
1F29   50 4F 4B 45 00         DB   "POKE",0   
1F2E   B9 1F                  DW   POKE   
1F30   43 41 4C 4C 00         DB   "CALL",0   
1F35   D7 1F                  DW   JUMP   
1F37   00                     DB   0   ;END OF TABLE
1F38                             ; 
1F38                             ; DDT COMMAND, CPM ONLY
1F38                             ; 
1F38                             ;PAGE
1F38                             ; 
1F38                FACDE:    EQU   $   
1F38                             ; 
1F38                             ; THIS ROUTINE CONVERTS THE FACC TO AN ADDRESS IN D,E
1F38                             ; 
1F38   CD EE 0B               CALL   INT   ;INTEGERIZE THE FACC
1F3B   3A 58 22               LDA   FACC   ;GET THE EXPONENT
1F3E   B7                     ORA   A   ;TEST IT
1F3F   FA 28 1C               JM   OVERR   ;BRIF NEGATIVE ADDRESS
1F42   D6 10                  SUI   16   ;SUBTRACT MAX EXPONENT
1F44   CA 5A 1F               JZ   FDE2   ;BRIF EQUAL MAX
1F47   F2 28 1C               JP   OVERR   ;BRIF GREATER THAN 64K
1F4A   2F                     CMA      ;2'S COMPLIMENT OF A YIELDS..
1F4B   3C                     INR   A   ;16-A
1F4C   4F                     MOV   C,A   ;SAVE SHIFT COUNT
1F4D   AF           FDE1:     XRA   A   ;CLEAR CARRY
1F4E   21 59 22               LXI   H,FACC+1   ;POINT MANTISSA
1F51   06 02                  MVI   B,2   ;WORDS TO SHIFT
1F53   CD 07 19               CALL   FSHFT   ;GO SHIFT FACC+1 AND FACC+2
1F56   0D                     DCR   C   ;REDUCE COUNT
1F57   C2 4D 1F               JNZ   FDE1   ;LOOP TILL COMPLETE
1F5A   21 59 22     FDE2:     LXI   H,FACC+1   ;POINT HIGH BYTE
1F5D   56                     MOV   D,M   ;LOAD D
1F5E   23                     INX   H   ;POINT LOW BYTE
1F5F   5E                     MOV   E,M   ;LOADE E
1F60   C9                     RET      ;RETURN
1F61                             ; 
1F61                             ; 
1F61                LOCAT:    EQU   $   
1F61                             ; 
1F61                             ; THIS ROUTINE SEARCHES FOR A LINE IN THE PROGRAM FILE.
1F61                             ; Z SET, C RESET==>LINE FOUND. ADDRESS IS IN H,L
1F61                             ; C SET, Z RESET==>NOT FOUND. H,L POINT TO NEXT LINE
1F61                             ; C SET, Z SET==>NOT FOUND. H,L POINT AT END OF PROGRAM
1F61                             ; 
1F61   21 96 22               LXI   H,BEGPR   ;POINT START
1F64   7E           FIND1:    MOV   A,M   ;FETCH LENGTH OF LINE
1F65   E5                     PUSH   H   ;SAVE POINTER
1F66   B7                     ORA   A   ;TEST
1F67   CA 86 1F               JZ   FIND3   ;BRIF END
1F6A   23                     INX   H   ;POINT LINE #
1F6B   7E                     MOV   A,M   ;FETCH HI #
1F6C   B8                     CMP   B   ;COMPARE TO REQUESTED
1F6D   DA 7E 1F               JC   FIND2   ;BRIF LOW
1F70   C2 86 1F               JNZ   FIND3   ;BRIF PAST AND NOT FOUND
1F73   23                     INX   H   ;POINT LO #
1F74   7E                     MOV   A,M   ;FETCH IT
1F75   B9                     CMP   C   ;COMPARE TO REQUESTED
1F76   DA 7E 1F               JC   FIND2   ;BRIF LOW
1F79   C2 86 1F               JNZ   FIND3   ;BRIF PAST AND NOT FOUND
1F7C   E1                     POP   H   ;POINT BEGIN IF MATCH
1F7D   C9                     RET      ;RETURN
1F7E                             ; 
1F7E                             ; BUMP H,L TO NEXT LINE
1F7E                             ; 
1F7E   E1           FIND2:    POP   H   ;POINT START OF LINE
1F7F   5E                     MOV   E,M   ;LENGHT TO E
1F80   16 00                  MVI   D,0   ;CLEAR D
1F82   19                     DAD   D   ;BUMP H,L
1F83   C3 64 1F               JMP   FIND1   ;CONTINUE
1F86                             ; 
1F86                             ; LINE NOT FOUND
1F86                             ; 
1F86   37           FIND3:    STC      ;SET CARRY
1F87   E1                     POP   H   ;POINT LINE JUST PAST REQUESTED
1F88   C9                     RET      ;RETURN
1F89                             ; 
1F89                             ; 
1F89                SEEK:     EQU   $   
1F89                             ; 
1F89                             ;  THIS CODE FINDS AN ENTRY IN THE TABLE POINTED TO BY D,E.
1F89                             ;  THE SOUGHT ENTRY IS POINTED TO BY H,L.
1F89                             ; 
1F89   E5           SEEK1:    PUSH   H   ;SAVE ADDRESS OF STRING
1F8A   1A                     LDAX   D   ;GET BYTE FROM TABLE
1F8B   B7                     ORA   A   ;TEST IT
1F8C   CA AC 1F               JZ   SEEK3   ;BRIF END OF TABLE
1F8F   D7                     RST   2   ;COMPARE
1F90   C2 9C 1F               JNZ   SEEK2   ;BRIF NOT FOUND
1F93   E3                     XTHL      ;PUT CURRENT H,L ON STACK
1F94   CD FA 1A               CALL   SKP2Z   ;FIND END TO LITERAL IN TABLE
1F97   13                     INX   D   ;POINT LOW BYTE
1F98   E1                     POP   H   ;RESTORE LINE POINTER
1F99   3C                     INR   A   ;PUT 1 IN A
1F9A   B7                     ORA   A   ;RESET Z BIT
1F9B   C9                     RET      ;RETURN
1F9C   CD FA 1A     SEEK2:    CALL   SKP2Z   ;FIND END OF TABLE LITERAL
1F9F   13                     INX   D   ; 
1FA0   13                     INX   D   ;POINT NEXT LIT IN TABLE
1FA1   13                     INX   D   ; 
1FA2   E1                     POP   H   ;GET ORIGINAL STRING
1FA3   1A                     LDAX   D   ;GET BYTE
1FA4   17                     RAL      ;HIGH BIT TO CARRY
1FA5   D2 89 1F               JNC   SEEK1   ;NOT A FUNCTION SEARCH
1FA8   13                     INX   D   ;POINT NEXT BYTE IN FUNCTION TABLE
1FA9   C3 89 1F               JMP   SEEK1   ;CONTINUE SEARCH
1FAC   E1           SEEK3:    POP   H   ;RESTORE ORIGINAL STRING
1FAD   C9                     RET      ;RETURN
1FAE                             ; 
1FAE                PEEK:     EQU   $   
1FAE                             ; 
1FAE                             ; STMT: A=PEEK(X). RETURNS DECIMAL VALUE OF MEMORY ADDRESS X.
1FAE                             ; 
1FAE   CD 38 1F               CALL   FACDE   ;GET ADDRESS IN D,E
1FB1   EB                     XCHG      ;ADDRESS TO H,L
1FB2   11 00 00               LXI   D,0   ;CLEAR D,E
1FB5   5E                     MOV   E,M   ;PUT MEMORY BYTE IN E
1FB6   C3 8A 1C               JMP   BINFL   ;CONVERT D,E TO BINARY AND RETURN
1FB9                             ; 
1FB9                POKE:     EQU   $   
1FB9                             ; 
1FB9                             ; STMT: POKE <ADDRESS>,<VALUE>.  PUTS IN MEMORY ADDRESS.
1FB9                             ; 
1FB9   CD 8C 0F               CALL   EXPR   ;EVALUATE ADDRESS EXPRESSION
1FBC   7E                     MOV   A,M   ;LOAD NEXT CHARACTER
1FBD   FE 2C                  CPI   ","   ;TEST
1FBF   C2 10 1C               JNZ   SNERR   ;BRIF ERROR
1FC2   23                     INX   H   ;POINT NEXT
1FC3   E5                     PUSH   H   ;SAVE H,L
1FC4   CD 38 1F               CALL   FACDE   ;PUT ADDRESS IN D,E
1FC7   E1                     POP   H   ;RESTORE H,L
1FC8   D5                     PUSH   D   ;SAVE ADDRESS
1FC9   CD 8C 0F               CALL   EXPR   ;EVALUATE VALUE EXPRESSION
1FCC   CD 95 1A               CALL   EOL   ;TEST FOR END OF LINE
1FCF   CD 67 1C               CALL   FBIN   ;CONVERT FACC TO A REGISTER VALUE
1FD2   E1                     POP   H   ;GET D,E ADDRESS IN H,L
1FD3   77                     MOV   M,A   ;MOVE BYTE
1FD4   C3 17 02               JMP   RUN   ;CONTINUE
1FD7                             ; 
1FD7                             ; 
1FD7                JUMP:     EQU   $   
1FD7                             ; 
1FD7                             ; STMT: CALL <ADDRESS>. EXECUTES CODE AT MEMORY ADDRESS.
1FD7                             ; 
1FD7   CD 8C 0F               CALL   EXPR   ;EVALUATE ADDRESS EXPRESSION
1FDA   CD 95 1A               CALL   EOL   ;TEST FOR END OF LINE
1FDD   CD 38 1F               CALL   FACDE   ;CONVERT FACC TO ADDRESS IN D,E
1FE0   21 17 02               LXI   H,RUN   ;MAKE INTO SUBROUTINE
1FE3   E5                     PUSH   H   
1FE4   EB                     XCHG      ;MOVE ADDRESS TO HL
1FE5   E9                     PCHL      ;EXECUTE USER'S ROUTINE
1FE6                             ;PAGE
1FE6                ROMEN:    EQU   $-1   
1FE6                             ; 
2000                          .ORG   8192+OFFSET   ;RAM STARTS OF 8K BOUNDARY
2000                             ;        ORG     2400H+OFFSET   ;RAM STARTS ON 9K BOUNDARY
2000                             ; 
2000                             ; ALL CODE ABOVE THIS POINT IS READ ONLY AND CAN BE PROM'ED
2000                             ; 
2000                             ; 
2000                RAM:      EQU   $   
2000                             ; 
2000                BZERO:    EQU   $   
2000                FORNE:    DS   1   ;# ENTRYS IN TABLE (MUST BE HERE)
2001                          DS   112   ;ROOM FOR 8 NESTS (MUST BE HERE)
2071                TAPES:    DS   1   ;TAPE SWITCH (MUST BE HERE)
2072                DIMSW:    DS   1   ;DIM SWITCH (MUST BE HERE)
2073                OUTSW:    DS   1   ;OUTPUT SWITCH (MUST BE HERE)
2074                ILSW:     DS   1   ;INPUT LINE SWITCH (MUST BE HERE)
2075                RUNSW:    DS   1   ;RUN SWITCH(MUST BE HERE)
2076                EDSW:     DS   1   ;MODE SWITCH(MUST BE HERE)
2077                EZERO:    EQU   $   
2077                             ; 
2077                LINEN:    DS   5   
207C                IMMED:    DS   82   ;IMMEDIATE COMMAND STORAGE AREA
20CE                IOBUF:    DS   82   ;INPUT/OUTPUT BUFFER
2120                STRIN:    DS   256   ;STRING BUFFER AREA
2220                OUTA:     DS   3   ;*** FILLED IN AT RUN TIME
2223                INDX:     DS   2   ;HOLDS VARIABLE NAME OF FOR/NEXT
2225                REL:      DS   1   ;HOLDS THE RELATION IN AN IF STMT
2226                IFTYP:    DS   1   ;HOLDS TYPE CODE OF LEFT SIDE
2227                TVAR1:    DS   4   ;TEMP STORAGE
222B                TVAR2:    DS   4   ;DITTO
222F                TEMP1:    DS   4   ;TEMP STORAGE FOR FUNCTIONS
2233                TEMP2:    DS   4   
2237                TEMP3:    DS   4   
223B                TEMP4:    DS   4   
223F                TEMP5:    DS   4   
2243                TEMP6:    DS   4   
2247                TEMP7:    DS   4   
224B                LINEL:    DS   2   ;HOLDS MIN LINE NUMBER IN LIST
224D                LINEH:    DS   2   ;HOLDS MAX LINE NUMBER IN LIST
224F                PROMP:    DS   1   ;HOLDS PROMPT CHAR
2250                EXPRS:    DS   2   ;HOLDS ADDR OF EXPRESSION
2252                ADDR1:    DS   2   ;HOLDS TEMP ADDRESS
2254                ADDR2:    DS   2   ;HOLDS TEMP ADDRESS
2256                ADDR3:    DS   2   ;HOLDS STMT ADD DURING EXPR EVAL
2258                FACC:     DS   4   
225C                FTEMP:    DS   12   
2268                PARCT:    DS   1   
2269                SPCTR:    DS   2   
226B                CMACT:    DS   1   ;COUNT OF COMMAS
226C                FNARG:    DS   4   ;SYMBOLIC ARG & ADDRESS
2270                STMT:     DS   2   ;HOLDS ADDR OF CURRENT STATEMENT
2272                ENDLI:    DS   2   ;HOLDS ADDR OF MULTI STMT PTR
2274                MULTI:    DS   1   ;SWITCH 0=NO, 1=MULTI STMT LINE
2275                DEXP:     DS   1   
2276                COLUM:    DS   1   ;CURRENT TTY COLUMN
2277                RNDX:     DS   2   ;RANDOM VARIABLE STORAGE
2279                RNDY:     DS   2   ;THE RND<X>,TRND<X>,AND RNDSW
227B                RNDZ:     DS   2   ;MUST BE KEPT IN ORDER
227D                RNDS:     DS   2   
227F                TRNDX:    DS   2   
2281                TRNDY:    DS   2   
2283                TRNDZ:    DS   2   
2285                TRNDS:    DS   2   
2287                RNDSW:    DS   1   
2288                FNMOD:    DS   1   ;SWITCH, 0=NOT, <>0 = IN DEF FN
2289                LINE:     DS   2   ;HOLD ADD OF PREV LINE NUM
228B                STACK:    DS   2   ;HOLDS ADDR OF START OF RETURN STACK
228D                PRSW:     DS   1   ;ON=PRINT ENDED WITH , OR ;
228E                NS:       DS   1   ;HOLDS LAST TYPE (NUMERIC/STRING)
228F                DATAP:    DS   2   ;ADDRESS OF CURRENT DATA STMT
2291                DATAB:    DS   2   ;ADDRESS OF DATA POOL
2293                PROGE:    DS   2   ;ADDRESS OF PROGRAM END
2295                             ; 
2295                             ; 
2295                             ; 
2295                          DS   1   ;DATA STATEMENT FLAG (MUST BE HERE)
2296                BEGPR:       
2296                             ; 
3DD0                          .ORG   $3DD0   
3DD0   41 4C 38 30 20 49 4D 53 41 49 20 38 4B 20 42 41 53 49 43 20 76 31 2E 34 20 30 43 42 31 30 31 00 DB   "AL80 IMSAI 8K BASIC v1.4 0CB101",0   
3DF7                          .ORG   $3DF7   
3DF7   E5 1F                  DW   ROMEN-BASIC   ; data length
3DF9   00 00                  DW   BASIC   ; jump to addess
3DFB   00 00                  DW   BASIC   ; load address
3DFD   0C B1 01               DB   $0c,$b1,$01   ; checksum
3E00                          END      


SIO_RX:             0018 DEFINED AT LINE 70
SIO_TX:             0018 DEFINED AT LINE 71
SIO_RX_STATUS:      0019 DEFINED AT LINE 72
SIO_TX_STATUS:      0019 DEFINED AT LINE 73
SIO_RX_FULL:        0001 DEFINED AT LINE 74
SIO_TX_EMPTY:       0004 DEFINED AT LINE 75
UART_TX_EMPTY:      0020 DEFINED AT LINE 77
                    > USED AT LINE 4302
UART_RX_FULL:       0001 DEFINED AT LINE 78
                    > USED AT LINE 4276
                    > USED AT LINE 4464
UART:               0008 DEFINED AT LINE 80
                    > USED AT LINE 81
                    > USED AT LINE 82
                    > USED AT LINE 83
                    > USED AT LINE 84
                    > USED AT LINE 85
                    > USED AT LINE 86
                    > USED AT LINE 87
                    > USED AT LINE 88
UART0:              0008 DEFINED AT LINE 81
                    > USED AT LINE 89
                    > USED AT LINE 90
                    > USED AT LINE 222
UART1:              0009 DEFINED AT LINE 82
                    > USED AT LINE 224
                    > USED AT LINE 228
UART2:              000A DEFINED AT LINE 83
UART3:              000B DEFINED AT LINE 84
                    > USED AT LINE 219
                    > USED AT LINE 226
UART4:              000C DEFINED AT LINE 85
UART5:              000D DEFINED AT LINE 86
                    > USED AT LINE 4275
                    > USED AT LINE 4301
                    > USED AT LINE 4463
UART6:              000E DEFINED AT LINE 87
UART7:              000F DEFINED AT LINE 88
UART_TX:            0008 DEFINED AT LINE 89
                    > USED AT LINE 4305
UART_RX:            0008 DEFINED AT LINE 90
                    > USED AT LINE 4466
OFFSET:             0000 DEFINED AT LINE 92
                    > USED AT LINE 102
                    > USED AT LINE 178
                    > USED AT LINE 5375
RUBOUT:             0008 DEFINED AT LINE 94
                    > USED AT LINE 451
                    > USED AT LINE 4328
FATAL:              00F7 DEFINED AT LINE 100
                    > USED AT LINE 4881
BASIC:              0000 DEFINED AT LINE 102
                    > USED AT LINE 5457
                    > USED AT LINE 5458
                    > USED AT LINE 5459
RST1:               0008 DEFINED AT LINE 113
                    > USED AT LINE 117
RST2:               0010 DEFINED AT LINE 127
COMP1:              0013 DEFINED AT LINE 129
                    > USED AT LINE 4518
RST3:               0018 DEFINED AT LINE 138
RST4:               0020 DEFINED AT LINE 147
RST5:               0028 DEFINED AT LINE 159
                    > USED AT LINE 3306
                    > USED AT LINE 3736
                    > USED AT LINE 3752
                    > USED AT LINE 3886
RST6:               0030 DEFINED AT LINE 170
RST4A:              003B DEFINED AT LINE 180
                    > USED AT LINE 152
RST4B:              0044 DEFINED AT LINE 185
                    > USED AT LINE 183
INIT1:              0081 DEFINED AT LINE 199
                    > USED AT LINE 105
INIT2:              0084 DEFINED AT LINE 200
                    > USED AT LINE 211
INIT3:              0097 DEFINED AT LINE 213
                    > USED AT LINE 202
                    > USED AT LINE 207
UART_INIT:          009F DEFINED AT LINE 218
RDYM:               00CC DEFINED AT LINE 241
                    > USED AT LINE 444
RDY:                00CF DEFINED AT LINE 243
                    > USED AT LINE 434
                    > USED AT LINE 1478
                    > USED AT LINE 1490
GETCM:              00D5 DEFINED AT LINE 250
                    > USED AT LINE 305
                    > USED AT LINE 335
                    > USED AT LINE 382
                    > USED AT LINE 414
                    > USED AT LINE 425
                    > USED AT LINE 490
                    > USED AT LINE 1087
EDIT1:              00F4 DEFINED AT LINE 276
                    > USED AT LINE 282
EDIT2:              0109 DEFINED AT LINE 289
EDIT3:              010F DEFINED AT LINE 294
                    > USED AT LINE 299
EDIT8:              011B DEFINED AT LINE 300
                    > USED AT LINE 296
EDIT5:              0120 DEFINED AT LINE 303
                    > USED AT LINE 288
EDIT6:              0135 DEFINED AT LINE 314
                    > USED AT LINE 321
                    > USED AT LINE 328
                    > USED AT LINE 330
EDIT7:              0141 DEFINED AT LINE 322
                    > USED AT LINE 320
ED7A:               0149 DEFINED AT LINE 326
                    > USED AT LINE 324
ED7B:               0152 DEFINED AT LINE 331
                    > USED AT LINE 325
IRAM:               015D DEFINED AT LINE 342
                    > USED AT LINE 235
                    > USED AT LINE 467
EXEC:               0170 DEFINED AT LINE 350
                    > USED AT LINE 267
EXEC1:              0180 DEFINED AT LINE 364
                    > USED AT LINE 369
NEW:                0194 DEFINED AT LINE 375
                    > USED AT LINE 5162
NEW0:               019F DEFINED AT LINE 387
NEW1:               01A4 DEFINED AT LINE 390
                    > USED AT LINE 386
FREE:               01AC DEFINED AT LINE 395
                    > USED AT LINE 5172
TAPE:               01CA DEFINED AT LINE 416
                    > USED AT LINE 5166
ENDIT:              01D7 DEFINED AT LINE 427
                    > USED AT LINE 493
                    > USED AT LINE 562
                    > USED AT LINE 584
                    > USED AT LINE 591
                    > USED AT LINE 5201
KEY:                01E8 DEFINED AT LINE 441
                    > USED AT LINE 4473
                    > USED AT LINE 4477
                    > USED AT LINE 4882
                    > USED AT LINE 5170
HDRTL:              01F2 DEFINED AT LINE 446
                    > USED AT LINE 437
                    > USED AT LINE 524
HDR1:               01F4 DEFINED AT LINE 451
                    > USED AT LINE 457
RUNCM:              0200 DEFINED AT LINE 463
                    > USED AT LINE 5158
XEQ:                0205 DEFINED AT LINE 466
                    > USED AT LINE 5160
RUN:                0217 DEFINED AT LINE 476
                    > USED AT LINE 647
                    > USED AT LINE 662
                    > USED AT LINE 768
                    > USED AT LINE 898
                    > USED AT LINE 932
                    > USED AT LINE 1027
                    > USED AT LINE 1100
                    > USED AT LINE 1104
                    > USED AT LINE 1243
                    > USED AT LINE 1267
                    > USED AT LINE 1339
                    > USED AT LINE 1378
                    > USED AT LINE 1464
                    > USED AT LINE 1505
                    > USED AT LINE 1614
                    > USED AT LINE 1662
                    > USED AT LINE 1743
                    > USED AT LINE 5180
                    > USED AT LINE 5203
                    > USED AT LINE 5205
                    > USED AT LINE 5220
                    > USED AT LINE 5358
                    > USED AT LINE 5368
RUN1:               0227 DEFINED AT LINE 483
                    > USED AT LINE 479
RUN2:               0231 DEFINED AT LINE 488
                    > USED AT LINE 473
                    > USED AT LINE 639
RUN3:               0243 DEFINED AT LINE 500
                    > USED AT LINE 373
                    > USED AT LINE 482
RUN4:               0244 DEFINED AT LINE 501
                    > USED AT LINE 1026
RUN7:               025B DEFINED AT LINE 514
                    > USED AT LINE 505
SAVE:               0261 DEFINED AT LINE 520
                    > USED AT LINE 5168
LIST:               026E DEFINED AT LINE 526
                    > USED AT LINE 5156
LIST1:              029E DEFINED AT LINE 558
                    > USED AT LINE 541
                    > USED AT LINE 551
LIST2:              02A1 DEFINED AT LINE 559
                    > USED AT LINE 603
                    > USED AT LINE 609
LIST4:              02C1 DEFINED AT LINE 578
                    > USED AT LINE 572
LIST5:              02D1 DEFINED AT LINE 586
                    > USED AT LINE 583
LIST6:              02DB DEFINED AT LINE 592
                    > USED AT LINE 585
                    > USED AT LINE 590
LIST7:              02E1 DEFINED AT LINE 594
                    > USED AT LINE 599
LIST8:              02F1 DEFINED AT LINE 604
                    > USED AT LINE 571
                    > USED AT LINE 577
CONTI:              02FA DEFINED AT LINE 612
                    > USED AT LINE 5164
GOTO:               0302 DEFINED AT LINE 628
                    > USED AT LINE 1015
                    > USED AT LINE 1025
                    > USED AT LINE 5195
GOTO2:              0312 DEFINED AT LINE 634
                    > USED AT LINE 678
                    > USED AT LINE 1567
RESTO:              0322 DEFINED AT LINE 644
                    > USED AT LINE 5178
RETUR:              032E DEFINED AT LINE 652
                    > USED AT LINE 5188
GOSUB:              0346 DEFINED AT LINE 667
                    > USED AT LINE 1019
                    > USED AT LINE 5186
GOSU1:              034F DEFINED AT LINE 670
                    > USED AT LINE 1566
PRINT:              0361 DEFINED AT LINE 681
                    > USED AT LINE 721
                    > USED AT LINE 5192
                    > USED AT LINE 5207
PRIN4:              0362 DEFINED AT LINE 688
                    > USED AT LINE 739
PRIN7:              0395 DEFINED AT LINE 713
                    > USED AT LINE 726
                    > USED AT LINE 734
PRIN2:              0397 DEFINED AT LINE 716
                    > USED AT LINE 754
PRIN5:              03A2 DEFINED AT LINE 723
                    > USED AT LINE 710
PRIN6:              03AB DEFINED AT LINE 728
                    > USED AT LINE 733
PRIN8:              03B6 DEFINED AT LINE 736
                    > USED AT LINE 695
PRIN9:              03B9 DEFINED AT LINE 737
                    > USED AT LINE 697
PRINA:              03BF DEFINED AT LINE 740
                    > USED AT LINE 702
PRINB:              03D6 DEFINED AT LINE 754
                    > USED AT LINE 758
PRINC:              03DF DEFINED AT LINE 760
                    > USED AT LINE 693
FOR:                03F1 DEFINED AT LINE 771
                    > USED AT LINE 5182
FOR1:               0436 DEFINED AT LINE 815
                    > USED AT LINE 812
FOR2:               043A DEFINED AT LINE 817
                    > USED AT LINE 808
                    > USED AT LINE 814
FOR4:               045E DEFINED AT LINE 836
                    > USED AT LINE 830
FOR5:               046A DEFINED AT LINE 844
                    > USED AT LINE 833
                    > USED AT LINE 834
                    > USED AT LINE 838
FOR6:               047A DEFINED AT LINE 853
                    > USED AT LINE 865
FOR7:               0486 DEFINED AT LINE 861
                    > USED AT LINE 855
FOR8:               048D DEFINED AT LINE 867
                    > USED AT LINE 852
                    > USED AT LINE 860
FOR9:               04BE DEFINED AT LINE 904
                    > USED AT LINE 835
                    > USED AT LINE 839
                    > USED AT LINE 917
                    > USED AT LINE 921
                    > USED AT LINE 927
                    > USED AT LINE 931
FORA:               04EC DEFINED AT LINE 928
                    > USED AT LINE 925
IFSTM:              04F5 DEFINED AT LINE 935
                    > USED AT LINE 5174
IF1:                0513 DEFINED AT LINE 954
                    > USED AT LINE 946
IF2:                0517 DEFINED AT LINE 956
                    > USED AT LINE 953
IF3:                051B DEFINED AT LINE 960
                    > USED AT LINE 985
IF4:                0524 DEFINED AT LINE 966
                    > USED AT LINE 963
IF5:                052C DEFINED AT LINE 971
                    > USED AT LINE 967
IF6:                0536 DEFINED AT LINE 977
                    > USED AT LINE 972
IF8:                056E DEFINED AT LINE 1001
                    > USED AT LINE 998
IF9:                057C DEFINED AT LINE 1006
                    > USED AT LINE 1003
TRUE:               058D DEFINED AT LINE 1012
                    > USED AT LINE 1000
                    > USED AT LINE 1005
                    > USED AT LINE 1063
FALSE:              0217 DEFINED AT LINE 1027
                    > USED AT LINE 1008
                    > USED AT LINE 1010
                    > USED AT LINE 1011
                    > USED AT LINE 1062
IFF:                05B4 DEFINED AT LINE 1028
                    > USED AT LINE 993
IFG:                05BD DEFINED AT LINE 1033
                    > USED AT LINE 1058
IFH:                05C6 DEFINED AT LINE 1039
                    > USED AT LINE 1037
IFI:                05CE DEFINED AT LINE 1044
                    > USED AT LINE 1041
IFJ:                05DC DEFINED AT LINE 1052
                    > USED AT LINE 1050
IFK:                05E2 DEFINED AT LINE 1056
                    > USED AT LINE 1054
IFL:                05E9 DEFINED AT LINE 1060
                    > USED AT LINE 1065
                    > USED AT LINE 1067
IFM:                05F3 DEFINED AT LINE 1064
                    > USED AT LINE 1046
IFN:                05F8 DEFINED AT LINE 1066
                    > USED AT LINE 1047
LET:                05FD DEFINED AT LINE 1070
                    > USED AT LINE 515
                    > USED AT LINE 621
                    > USED AT LINE 5197
LET1:               0618 DEFINED AT LINE 1088
                    > USED AT LINE 1081
LET2:               0632 DEFINED AT LINE 1101
                    > USED AT LINE 1096
LET2A:              063D DEFINED AT LINE 1106
                    > USED AT LINE 1103
                    > USED AT LINE 1377
                    > USED AT LINE 1661
                    > USED AT LINE 4093
LET3:               0649 DEFINED AT LINE 1114
                    > USED AT LINE 1116
LET4:               0657 DEFINED AT LINE 1126
                    > USED AT LINE 1144
LET5:               0663 DEFINED AT LINE 1136
                    > USED AT LINE 1143
LET6:               0670 DEFINED AT LINE 1145
                    > USED AT LINE 1128
LET7:               0685 DEFINED AT LINE 1157
                    > USED AT LINE 1154
                    > USED AT LINE 1155
LET8:               0692 DEFINED AT LINE 1169
                    > USED AT LINE 1109
LET9:               0695 DEFINED AT LINE 1172
                    > USED AT LINE 1177
NEXT:               069E DEFINED AT LINE 1187
                    > USED AT LINE 5184
NEXT1:              06B4 DEFINED AT LINE 1199
                    > USED AT LINE 1209
NEXT2:              06BF DEFINED AT LINE 1206
                    > USED AT LINE 1202
NEXT3:              06C8 DEFINED AT LINE 1211
                    > USED AT LINE 1205
NEXT7:              06FB DEFINED AT LINE 1240
                    > USED AT LINE 1245
NEXT5:              0703 DEFINED AT LINE 1244
                    > USED AT LINE 1237
NEXT6:              0707 DEFINED AT LINE 1246
                    > USED AT LINE 1231
                    > USED AT LINE 1239
INPUT:              072D DEFINED AT LINE 1269
                    > USED AT LINE 5190
INPU1:              073F DEFINED AT LINE 1284
                    > USED AT LINE 1336
INPU2:              074A DEFINED AT LINE 1289
                    > USED AT LINE 1286
INPU3:              074E DEFINED AT LINE 1291
                    > USED AT LINE 1297
INPU4:              0759 DEFINED AT LINE 1298
                    > USED AT LINE 1294
INPU5:              076C DEFINED AT LINE 1308
                    > USED AT LINE 1305
INPU6:              076D DEFINED AT LINE 1309
                    > USED AT LINE 1288
                    > USED AT LINE 1307
INPU7:              0781 DEFINED AT LINE 1319
                    > USED AT LINE 1316
INPU8:              0794 DEFINED AT LINE 1329
                    > USED AT LINE 1326
INPU9:              0799 DEFINED AT LINE 1332
                    > USED AT LINE 1342
INPUB:              07A2 DEFINED AT LINE 1338
                    > USED AT LINE 1426
INPUA:              07A8 DEFINED AT LINE 1340
                    > USED AT LINE 1322
INPL:               07B1 DEFINED AT LINE 1344
                    > USED AT LINE 1278
INPL1:              07D3 DEFINED AT LINE 1365
                    > USED AT LINE 1372
INPL2:              07DF DEFINED AT LINE 1373
                    > USED AT LINE 1367
READ:               07ED DEFINED AT LINE 1381
                    > USED AT LINE 1424
                    > USED AT LINE 5176
READ1:              07FC DEFINED AT LINE 1394
                    > USED AT LINE 1407
READ2:              0817 DEFINED AT LINE 1408
                    > USED AT LINE 1392
                    > USED AT LINE 1402
READ3:              0827 DEFINED AT LINE 1417
                    > USED AT LINE 1428
READ4:              082C DEFINED AT LINE 1420
                    > USED AT LINE 1439
READ5:              0838 DEFINED AT LINE 1427
                    > USED AT LINE 1415
                    > USED AT LINE 1435
READ6:              083F DEFINED AT LINE 1430
                    > USED AT LINE 1411
READ7:              084F DEFINED AT LINE 1437
                    > USED AT LINE 1433
READ8:              0850 DEFINED AT LINE 1438
                    > USED AT LINE 1436
OUTP:               0856 DEFINED AT LINE 1441
                    > USED AT LINE 5213
STOP:               087E DEFINED AT LINE 1467
                    > USED AT LINE 5199
RANDO:              08AB DEFINED AT LINE 1492
                    > USED AT LINE 5209
ON:                 08C1 DEFINED AT LINE 1507
                    > USED AT LINE 5211
ON3:                08E7 DEFINED AT LINE 1533
                    > USED AT LINE 1525
ON3A:               08E8 DEFINED AT LINE 1534
                    > USED AT LINE 1543
                    > USED AT LINE 1549
ON4:                08FB DEFINED AT LINE 1544
                    > USED AT LINE 1541
                    > USED AT LINE 1547
ON5:                0905 DEFINED AT LINE 1548
                    > USED AT LINE 1545
ON6:                0909 DEFINED AT LINE 1550
                    > USED AT LINE 1536
                    > USED AT LINE 1554
ON7:                0915 DEFINED AT LINE 1555
                    > USED AT LINE 1552
ON8:                091E DEFINED AT LINE 1558
                    > USED AT LINE 1562
ON9:                0929 DEFINED AT LINE 1563
                    > USED AT LINE 1560
CHANG:              0936 DEFINED AT LINE 1570
                    > USED AT LINE 5217
CHA1:               095F DEFINED AT LINE 1600
                    > USED AT LINE 1613
CHA2:               0974 DEFINED AT LINE 1617
                    > USED AT LINE 1579
CHA3:               09A4 DEFINED AT LINE 1646
                    > USED AT LINE 1659
DIM:                09BD DEFINED AT LINE 1665
                    > USED AT LINE 1741
                    > USED AT LINE 5215
DIM1:               09DB DEFINED AT LINE 1687
                    > USED AT LINE 1691
DIM2:               0A0D DEFINED AT LINE 1729
                    > USED AT LINE 1734
DIM3:               0A18 DEFINED AT LINE 1736
                    > USED AT LINE 1771
DIM4:               0A23 DEFINED AT LINE 1742
                    > USED AT LINE 1739
REDIM:              0A29 DEFINED AT LINE 1744
                    > USED AT LINE 1697
REDM1:              0A3F DEFINED AT LINE 1760
                    > USED AT LINE 1755
SIN:                0A4D DEFINED AT LINE 1774
                    > USED AT LINE 1865
                    > USED AT LINE 1883
                    > USED AT LINE 5001
SIN1:               0A55 DEFINED AT LINE 1787
                    > USED AT LINE 1792
SIN3A:              0A84 DEFINED AT LINE 1815
                    > USED AT LINE 1809
EVPS:               0A97 DEFINED AT LINE 1834
                    > USED AT LINE 1917
                    > USED AT LINE 1955
                    > USED AT LINE 2009
EVPS1:              0AA1 DEFINED AT LINE 1840
                    > USED AT LINE 1849
EVPS2:              0AA8 DEFINED AT LINE 1843
                    > USED AT LINE 1839
COS:                0ABF DEFINED AT LINE 1855
                    > USED AT LINE 1878
                    > USED AT LINE 5004
TAN:                0AC8 DEFINED AT LINE 1867
                    > USED AT LINE 5007
ATN:                0AE0 DEFINED AT LINE 1887
                    > USED AT LINE 5010
ATN1:               0AEF DEFINED AT LINE 1898
                    > USED AT LINE 1893
                    > USED AT LINE 1895
LN:                 0B1F DEFINED AT LINE 1919
                    > USED AT LINE 1960
                    > USED AT LINE 3263
                    > USED AT LINE 5016
LN0:                0B38 DEFINED AT LINE 1934
                    > USED AT LINE 1932
LN1:                0B44 DEFINED AT LINE 1939
                    > USED AT LINE 1933
LN2:                0B49 DEFINED AT LINE 1941
                    > USED AT LINE 1938
LOG:                0B6D DEFINED AT LINE 1959
                    > USED AT LINE 5019
EXP:                0B76 DEFINED AT LINE 1964
                    > USED AT LINE 3266
                    > USED AT LINE 5022
EXP1:               0B90 DEFINED AT LINE 1982
                    > USED AT LINE 1972
                    > USED AT LINE 1974
ELOOP:              0BA9 DEFINED AT LINE 1993
                    > USED AT LINE 1995
ABS:                0BD3 DEFINED AT LINE 2014
                    > USED AT LINE 1786
                    > USED AT LINE 4986
SGN:                0BDC DEFINED AT LINE 2025
                    > USED AT LINE 4995
SGN1:               0BE2 DEFINED AT LINE 2037
                    > USED AT LINE 3256
INT:                0BEE DEFINED AT LINE 2045
                    > USED AT LINE 1986
                    > USED AT LINE 4992
                    > USED AT LINE 5235
INT2:               0BFC DEFINED AT LINE 2061
                    > USED AT LINE 2058
INT3:               0C0B DEFINED AT LINE 2068
                    > USED AT LINE 2063
INT4:               0C15 DEFINED AT LINE 2075
                    > USED AT LINE 2085
INT5:               0C1B DEFINED AT LINE 2078
                    > USED AT LINE 2083
SQR:                0C33 DEFINED AT LINE 2093
                    > USED AT LINE 4989
SQR1:               0C70 DEFINED AT LINE 2138
                    > USED AT LINE 2120
                    > USED AT LINE 2123
NEG:                0C86 DEFINED AT LINE 2148
                    > USED AT LINE 1796
                    > USED AT LINE 1801
                    > USED AT LINE 1894
                    > USED AT LINE 1896
                    > USED AT LINE 1937
                    > USED AT LINE 1973
                    > USED AT LINE 3290
                    > USED AT LINE 3817
                    > USED AT LINE 3868
                    > USED AT LINE 3870
RND:                0C90 DEFINED AT LINE 2160
                    > USED AT LINE 2863
                    > USED AT LINE 4998
RND1:               0CA2 DEFINED AT LINE 2174
                    > USED AT LINE 2234
RND2:               0CA8 DEFINED AT LINE 2177
                    > USED AT LINE 2182
FND3:               0CB6 DEFINED AT LINE 2186
                    > USED AT LINE 2210
RND4:               0CC5 DEFINED AT LINE 2195
                    > USED AT LINE 2190
RND5:               0CD1 DEFINED AT LINE 2207
                    > USED AT LINE 2191
                    > USED AT LINE 2194
RND6:               0CD9 DEFINED AT LINE 2212
                    > USED AT LINE 2224
RND7:               0D0D DEFINED AT LINE 2243
                    > USED AT LINE 2238
INP:                0D16 DEFINED AT LINE 2247
                    > USED AT LINE 5013
FDEC:               0D26 DEFINED AT LINE 2262
                    > USED AT LINE 1603
                    > USED AT LINE 1936
                    > USED AT LINE 1940
                    > USED AT LINE 2273
                    > USED AT LINE 2354
                    > USED AT LINE 2378
                    > USED AT LINE 2381
                    > USED AT LINE 2413
                    > USED AT LINE 2569
POS:                0D2C DEFINED AT LINE 2266
                    > USED AT LINE 5025
CONCA:              0D32 DEFINED AT LINE 2275
                    > USED AT LINE 3248
CONC2:              0D48 DEFINED AT LINE 2296
                    > USED AT LINE 2291
CONC3:              0D50 DEFINED AT LINE 2300
                    > USED AT LINE 2305
CONC4:              0D58 DEFINED AT LINE 2306
                    > USED AT LINE 2299
CONC5:              0D6E DEFINED AT LINE 2319
                    > USED AT LINE 2321
CONC6:              0D82 DEFINED AT LINE 2334
                    > USED AT LINE 2339
LENFN:              0D95 DEFINED AT LINE 2347
                    > USED AT LINE 5028
CHRFN:              0D9B DEFINED AT LINE 2356
                    > USED AT LINE 5031
ASCII:              0DA6 DEFINED AT LINE 2369
                    > USED AT LINE 5034
NUMFN:              0DB3 DEFINED AT LINE 2383
                    > USED AT LINE 5037
NUM1:               0DBE DEFINED AT LINE 2396
                    > USED AT LINE 2399
VAL:                0DC6 DEFINED AT LINE 2403
                    > USED AT LINE 5040
VAL1:               0DD2 DEFINED AT LINE 2415
                    > USED AT LINE 2422
VAL2:               0DDB DEFINED AT LINE 2421
                    > USED AT LINE 2418
SPACE:              0DED DEFINED AT LINE 2432
                    > USED AT LINE 5043
SPAC1:              0DF5 DEFINED AT LINE 2442
                    > USED AT LINE 2446
STRFN:              0DFD DEFINED AT LINE 2448
                    > USED AT LINE 5046
STR11:              0E0A DEFINED AT LINE 2459
                    > USED AT LINE 2462
LEFT:               0E11 DEFINED AT LINE 2465
                    > USED AT LINE 5049
RIGHT:              0E1A DEFINED AT LINE 2476
                    > USED AT LINE 5052
MIDFN:              0E23 DEFINED AT LINE 2487
                    > USED AT LINE 5055
MID0:               0E2D DEFINED AT LINE 2500
                    > USED AT LINE 2474
                    > USED AT LINE 2485
MID1:               0E3B DEFINED AT LINE 2507
                    > USED AT LINE 2503
                    > USED AT LINE 2504
MID2:               0E48 DEFINED AT LINE 2513
                    > USED AT LINE 2508
                    > USED AT LINE 2510
MID3:               0E4C DEFINED AT LINE 2517
                    > USED AT LINE 2512
MID4:               0E54 DEFINED AT LINE 2522
                    > USED AT LINE 2527
INSTR:              0E5D DEFINED AT LINE 2530
                    > USED AT LINE 5058
INST1:              0E67 DEFINED AT LINE 2543
                    > USED AT LINE 2547
INST2:              0E6C DEFINED AT LINE 2545
                    > USED AT LINE 2542
INST3:              0E73 DEFINED AT LINE 2548
                    > USED AT LINE 2544
                    > USED AT LINE 2546
INST5:              0E8F DEFINED AT LINE 2568
                    > USED AT LINE 2589
                    > USED AT LINE 2598
INST6:              0E93 DEFINED AT LINE 2570
                    > USED AT LINE 2566
                    > USED AT LINE 2596
INST8:              0E9E DEFINED AT LINE 2579
                    > USED AT LINE 2585
INST9:              0EAF DEFINED AT LINE 2590
                    > USED AT LINE 2582
INSTA:              0EB8 DEFINED AT LINE 2597
                    > USED AT LINE 2573
FN:                 0EBD DEFINED AT LINE 2600
                    > USED AT LINE 3060
                    > USED AT LINE 3062
FN2:                0EFF DEFINED AT LINE 2641
                    > USED AT LINE 2663
FN3:                0F1D DEFINED AT LINE 2659
                    > USED AT LINE 2649
                    > USED AT LINE 2655
FN4:                0F25 DEFINED AT LINE 2664
                    > USED AT LINE 2658
EXPR:               0F8C DEFINED AT LINE 2726
                    > USED AT LINE 704
                    > USED AT LINE 741
                    > USED AT LINE 786
                    > USED AT LINE 799
                    > USED AT LINE 816
                    > USED AT LINE 941
                    > USED AT LINE 986
                    > USED AT LINE 1089
                    > USED AT LINE 1446
                    > USED AT LINE 1460
                    > USED AT LINE 1514
                    > USED AT LINE 1677
                    > USED AT LINE 2695
                    > USED AT LINE 4105
                    > USED AT LINE 5344
                    > USED AT LINE 5353
                    > USED AT LINE 5365
LOOKD:              0FA1 DEFINED AT LINE 2745
                    > USED AT LINE 2857
                    > USED AT LINE 2884
                    > USED AT LINE 2894
                    > USED AT LINE 3374
LDNUM:              0FA8 DEFINED AT LINE 2749
                    > USED AT LINE 2759
LDF:                0FAB DEFINED AT LINE 2750
                    > USED AT LINE 2866
LDALP:              0FBB DEFINED AT LINE 2758
                    > USED AT LINE 2748
LDV1:               0FD2 DEFINED AT LINE 2769
                    > USED AT LINE 2796
                    > USED AT LINE 2835
LDV2:               0FDF DEFINED AT LINE 2778
                    > USED AT LINE 2772
LDV:                0FEA DEFINED AT LINE 2784
                    > USED AT LINE 2872
                    > USED AT LINE 3396
LDFN:               1000 DEFINED AT LINE 2795
                    > USED AT LINE 2766
LDFN1:              1006 DEFINED AT LINE 2797
                    > USED AT LINE 2800
FUNC0:              1027 DEFINED AT LINE 2815
                    > USED AT LINE 2859
FUNC4:              1042 DEFINED AT LINE 2831
                    > USED AT LINE 2819
FNL:                104A DEFINED AT LINE 2836
                    > USED AT LINE 2809
FNL3:               1062 DEFINED AT LINE 2852
                    > USED AT LINE 2850
LDRND:              106F DEFINED AT LINE 2858
                    > USED AT LINE 2804
LDPI:               1081 DEFINED AT LINE 2867
                    > USED AT LINE 2814
LDFNC:              108B DEFINED AT LINE 2873
                    > USED AT LINE 2830
LDDTN:              109D DEFINED AT LINE 2885
                    > USED AT LINE 2761
SKPP:               10AD DEFINED AT LINE 2893
                    > USED AT LINE 2896
                    > USED AT LINE 2964
                    > USED AT LINE 3028
                    > USED AT LINE 3039
LDDTP:              10B1 DEFINED AT LINE 2895
                    > USED AT LINE 2886
LITST:              10C5 DEFINED AT LINE 2903
                    > USED AT LINE 2900
LIT1:               10CB DEFINED AT LINE 2906
                    > USED AT LINE 2914
LIT2:               10EF DEFINED AT LINE 2929
                    > USED AT LINE 2931
LIT3:               110B DEFINED AT LINE 2948
                    > USED AT LINE 2953
CERCE:              1117 DEFINED AT LINE 2956
                    > USED AT LINE 2898
LOOKO:              1129 DEFINED AT LINE 2965
                    > USED AT LINE 2757
                    > USED AT LINE 2790
                    > USED AT LINE 2794
                    > USED AT LINE 2955
                    > USED AT LINE 3171
                    > USED AT LINE 3174
ENDXP:              1157 DEFINED AT LINE 2986
                    > USED AT LINE 3032
OP1:                1164 DEFINED AT LINE 2991
                    > USED AT LINE 2968
                    > USED AT LINE 2971
                    > USED AT LINE 2974
                    > USED AT LINE 2977
                    > USED AT LINE 2984
OPLP1:              116F DEFINED AT LINE 2999
                    > USED AT LINE 3009
OPLP2:              1173 DEFINED AT LINE 3002
                    > USED AT LINE 3005
INS:                118D DEFINED AT LINE 3017
                    > USED AT LINE 3011
INS1:               118E DEFINED AT LINE 3018
                    > USED AT LINE 3023
OP2:                11A3 DEFINED AT LINE 3030
                    > USED AT LINE 2981
OP3:                11B8 DEFINED AT LINE 3040
                    > USED AT LINE 2979
OP4:                11C3 DEFINED AT LINE 3045
                    > USED AT LINE 3029
EVAL:               11C6 DEFINED AT LINE 3046
                    > USED AT LINE 2345
                    > USED AT LINE 2990
                    > USED AT LINE 3135
                    > USED AT LINE 3175
                    > USED AT LINE 3281
                    > USED AT LINE 3300
EV1:                11CC DEFINED AT LINE 3048
                    > USED AT LINE 3058
EV1A:               11D4 DEFINED AT LINE 3053
                    > USED AT LINE 3071
EV2:                11DC DEFINED AT LINE 3059
                    > USED AT LINE 3052
EV2A:               11FC DEFINED AT LINE 3073
                    > USED AT LINE 3066
                    > USED AT LINE 3068
EV3:                1213 DEFINED AT LINE 3088
                    > USED AT LINE 2723
                    > USED AT LINE 3082
EV3A:               1234 DEFINED AT LINE 3109
                    > USED AT LINE 3163
EV4:                1258 DEFINED AT LINE 3136
                    > USED AT LINE 3095
EV4A:               126C DEFINED AT LINE 3147
                    > USED AT LINE 3149
EV4B:               1277 DEFINED AT LINE 3156
                    > USED AT LINE 3161
EV5:                1284 DEFINED AT LINE 3164
                    > USED AT LINE 3072
EV6:                12A2 DEFINED AT LINE 3176
                    > USED AT LINE 3165
EV7:                12BE DEFINED AT LINE 3191
                    > USED AT LINE 3196
DV8:                12C8 DEFINED AT LINE 3197
                    > USED AT LINE 3193
EV9:                12D3 DEFINED AT LINE 3202
                    > USED AT LINE 3177
EV10:               1305 DEFINED AT LINE 3221
                    > USED AT LINE 3204
                    > USED AT LINE 3207
                    > USED AT LINE 3210
                    > USED AT LINE 3213
FADDJ:              1327 DEFINED AT LINE 3247
                    > USED AT LINE 3203
POWER:              132F DEFINED AT LINE 3250
                    > USED AT LINE 3219
XSQR:               1354 DEFINED AT LINE 3268
EV11:               135E DEFINED AT LINE 3272
                    > USED AT LINE 3242
EVNEG:              136F DEFINED AT LINE 3282
                    > USED AT LINE 3217
EVCOM:              1383 DEFINED AT LINE 3296
                    > USED AT LINE 3215
EVLD:               138F DEFINED AT LINE 3301
                    > USED AT LINE 3189
                    > USED AT LINE 3229
                    > USED AT LINE 3289
                    > USED AT LINE 3336
                    > USED AT LINE 4953
EVLD1:              13A0 DEFINED AT LINE 3311
                    > USED AT LINE 3316
EDM1:               13A9 DEFINED AT LINE 3319
                    > USED AT LINE 3180
EDM2A:              13B8 DEFINED AT LINE 3326
                    > USED AT LINE 3339
EDM3:               13BC DEFINED AT LINE 3329
                    > USED AT LINE 3322
EDM4:               13D0 DEFINED AT LINE 3340
                    > USED AT LINE 3199
LDV2A:              13E3 DEFINED AT LINE 3351
                    > USED AT LINE 2779
FIN:                143A DEFINED AT LINE 3399
                    > USED AT LINE 1323
                    > USED AT LINE 1412
                    > USED AT LINE 2426
                    > USED AT LINE 2749
FIN2:               144A DEFINED AT LINE 3417
                    > USED AT LINE 3415
FIN3:               1470 DEFINED AT LINE 3439
                    > USED AT LINE 3436
FIN4:               1478 DEFINED AT LINE 3445
                    > USED AT LINE 3427
FIN5:               147A DEFINED AT LINE 3447
                    > USED AT LINE 3456
FIN6:               1487 DEFINED AT LINE 3454
                    > USED AT LINE 3460
FIN7:               148C DEFINED AT LINE 3457
                    > USED AT LINE 3450
FIN8:               1494 DEFINED AT LINE 3469
                    > USED AT LINE 3412
                    > USED AT LINE 3432
FIN8A:              14AC DEFINED AT LINE 3481
                    > USED AT LINE 3475
                    > USED AT LINE 3479
FIN9:               14AE DEFINED AT LINE 3483
                    > USED AT LINE 3416
                    > USED AT LINE 3500
                    > USED AT LINE 3516
FINB:               14CA DEFINED AT LINE 3501
                    > USED AT LINE 3494
FMTEN:              14E1 DEFINED AT LINE 3520
                    > USED AT LINE 3492
                    > USED AT LINE 3591
FIND:               14F1 DEFINED AT LINE 3526
                    > USED AT LINE 3522
                    > USED AT LINE 3523
FIND0:              14F4 DEFINED AT LINE 3527
                    > USED AT LINE 3525
FOUT:               14FC DEFINED AT LINE 3532
                    > USED AT LINE 411
                    > USED AT LINE 711
                    > USED AT LINE 2393
FOUT0:              150D DEFINED AT LINE 3550
                    > USED AT LINE 3548
FOUT2:              1517 DEFINED AT LINE 3556
                    > USED AT LINE 3551
FOUTV:              1522 DEFINED AT LINE 3560
                    > USED AT LINE 3558
FOUT3:              1528 DEFINED AT LINE 3563
                    > USED AT LINE 3572
                    > USED AT LINE 3574
FOUT4:              1533 DEFINED AT LINE 3567
                    > USED AT LINE 3576
                    > USED AT LINE 3587
FOUT5:              1543 DEFINED AT LINE 3573
                    > USED AT LINE 3570
FOUT6:              1549 DEFINED AT LINE 3575
                    > USED AT LINE 3566
FOUTU:              1569 DEFINED AT LINE 3588
                    > USED AT LINE 3584
FOUT7:              156C DEFINED AT LINE 3589
                    > USED AT LINE 3593
FOUT9:              157C DEFINED AT LINE 3595
                    > USED AT LINE 3588
                    > USED AT LINE 3592
                    > USED AT LINE 3646
                    > USED AT LINE 3648
FOUTA:              158B DEFINED AT LINE 3605
                    > USED AT LINE 3602
FOUTB:              158E DEFINED AT LINE 3608
                    > USED AT LINE 3582
FOUTC:              1593 DEFINED AT LINE 3611
                    > USED AT LINE 3620
FOUTD:              1598 DEFINED AT LINE 3613
                    > USED AT LINE 3618
FOUTH:              15A5 DEFINED AT LINE 3622
                    > USED AT LINE 3594
FOUTI:              15BC DEFINED AT LINE 3637
                    > USED AT LINE 3629
FOUTJ:              15C0 DEFINED AT LINE 3640
                    > USED AT LINE 3642
FOUTK:              15DF DEFINED AT LINE 3657
                    > USED AT LINE 3653
FOUTL:              15E2 DEFINED AT LINE 3659
                    > USED AT LINE 3656
FOUTM:              15E5 DEFINED AT LINE 3661
                    > USED AT LINE 3664
FOUTN:              15FD DEFINED AT LINE 3676
                    > USED AT LINE 3684
FOUTO:              1608 DEFINED AT LINE 3685
                    > USED AT LINE 3674
                    > USED AT LINE 3705
                    > USED AT LINE 3722
FOUTP:              1609 DEFINED AT LINE 3686
                    > USED AT LINE 3691
FOUTQ:              1615 DEFINED AT LINE 3692
                    > USED AT LINE 3688
FOUTR:              161D DEFINED AT LINE 3698
                    > USED AT LINE 3675
FOUTS:              162B DEFINED AT LINE 3706
                    > USED AT LINE 3699
FOUTT:              1635 DEFINED AT LINE 3714
                    > USED AT LINE 3720
FADD:               1643 DEFINED AT LINE 3724
                    > USED AT LINE 1223
                    > USED AT LINE 1795
                    > USED AT LINE 1798
                    > USED AT LINE 1841
                    > USED AT LINE 1853
                    > USED AT LINE 1864
                    > USED AT LINE 1899
                    > USED AT LINE 1909
                    > USED AT LINE 2065
                    > USED AT LINE 2113
                    > USED AT LINE 2143
                    > USED AT LINE 3249
                    > USED AT LINE 3869
FADD3:              1662 DEFINED AT LINE 3747
                    > USED AT LINE 3744
FADD4:              166F DEFINED AT LINE 3753
                    > USED AT LINE 3743
                    > USED AT LINE 3748
FADD6:              1692 DEFINED AT LINE 3774
                    > USED AT LINE 3764
FADD7:              1694 DEFINED AT LINE 3776
                    > USED AT LINE 3782
FADD9:              16A0 DEFINED AT LINE 3783
                    > USED AT LINE 3759
FADDA:              16C8 DEFINED AT LINE 3801
                    > USED AT LINE 3789
FNEG1:              16D6 DEFINED AT LINE 3808
                    > USED AT LINE 3815
FNEG2:              16DD DEFINED AT LINE 3812
                    > USED AT LINE 3810
FNORM:              16E9 DEFINED AT LINE 3820
                    > USED AT LINE 2091
                    > USED AT LINE 2243
                    > USED AT LINE 3424
                    > USED AT LINE 3804
                    > USED AT LINE 3816
                    > USED AT LINE 3935
                    > USED AT LINE 4052
                    > USED AT LINE 4974
FNRM1:              16FB DEFINED AT LINE 3841
                    > USED AT LINE 3855
FNRM2:              1705 DEFINED AT LINE 3848
                    > USED AT LINE 3853
FNRM3:              1711 DEFINED AT LINE 3856
                    > USED AT LINE 3844
FSUB:               1718 DEFINED AT LINE 3862
                    > USED AT LINE 832
                    > USED AT LINE 837
                    > USED AT LINE 995
                    > USED AT LINE 1230
                    > USED AT LINE 1791
                    > USED AT LINE 1903
                    > USED AT LINE 1950
                    > USED AT LINE 2007
                    > USED AT LINE 3206
FMUL:               1724 DEFINED AT LINE 3874
                    > USED AT LINE 1820
                    > USED AT LINE 1843
                    > USED AT LINE 1851
                    > USED AT LINE 1915
                    > USED AT LINE 1942
                    > USED AT LINE 1962
                    > USED AT LINE 1983
                    > USED AT LINE 2011
                    > USED AT LINE 2111
                    > USED AT LINE 2133
                    > USED AT LINE 2245
                    > USED AT LINE 3209
                    > USED AT LINE 3265
                    > USED AT LINE 3271
                    > USED AT LINE 3453
                    > USED AT LINE 3571
FMUL5:              174E DEFINED AT LINE 3901
                    > USED AT LINE 3908
FMUL6:              175A DEFINED AT LINE 3910
                    > USED AT LINE 3934
FMUL7:              1760 DEFINED AT LINE 3913
                    > USED AT LINE 3918
FMUL8:              1776 DEFINED AT LINE 3924
                    > USED AT LINE 3919
FMUL9:              177C DEFINED AT LINE 3927
                    > USED AT LINE 3932
MDSGN:              178B DEFINED AT LINE 3947
                    > USED AT LINE 3888
                    > USED AT LINE 3998
SVSGN:              1795 DEFINED AT LINE 3961
                    > USED AT LINE 3793
                    > USED AT LINE 3839
                    > USED AT LINE 3947
RSSGN:              179D DEFINED AT LINE 3977
                    > USED AT LINE 3795
                    > USED AT LINE 3858
                    > USED AT LINE 3890
                    > USED AT LINE 4001
FDIV:               17A7 DEFINED AT LINE 3984
                    > USED AT LINE 1816
                    > USED AT LINE 1885
                    > USED AT LINE 1905
                    > USED AT LINE 1980
                    > USED AT LINE 2141
                    > USED AT LINE 3212
                    > USED AT LINE 3459
                    > USED AT LINE 3573
FDIV3:              17C6 DEFINED AT LINE 4007
                    > USED AT LINE 4014
FDIV5:              17DC DEFINED AT LINE 4022
                    > USED AT LINE 4051
FDIV6:              17F6 DEFINED AT LINE 4032
                    > USED AT LINE 4026
FDIV7:              17FC DEFINED AT LINE 4035
                    > USED AT LINE 4040
FDIV8:              180A DEFINED AT LINE 4044
                    > USED AT LINE 4049
GETST:              1819 DEFINED AT LINE 4056
                    > USED AT LINE 1340
                    > USED AT LINE 1430
GETS1:              1829 DEFINED AT LINE 4063
                    > USED AT LINE 4072
GETS2:              183A DEFINED AT LINE 4073
                    > USED AT LINE 4060
                    > USED AT LINE 4062
GETS3:              183B DEFINED AT LINE 4074
                    > USED AT LINE 4083
GETS4:              184B DEFINED AT LINE 4084
                    > USED AT LINE 4077
GETS5:              184D DEFINED AT LINE 4086
                    > USED AT LINE 4064
                    > USED AT LINE 4066
GETS8:              185B DEFINED AT LINE 4096
                    > USED AT LINE 1076
                    > USED AT LINE 1309
                    > USED AT LINE 1386
GETS9:              1878 DEFINED AT LINE 4112
                    > USED AT LINE 4100
FOVUN:              187D DEFINED AT LINE 4116
                    > USED AT LINE 3977
FOV1:               1889 DEFINED AT LINE 4126
                    > USED AT LINE 4121
SUBSC:              1891 DEFINED AT LINE 4131
                    > USED AT LINE 3392
                    > USED AT LINE 4107
SUB1:               18A4 DEFINED AT LINE 4152
                    > USED AT LINE 4148
SUB2:               18AF DEFINED AT LINE 4161
                    > USED AT LINE 4166
SUB3:               18B9 DEFINED AT LINE 4167
                    > USED AT LINE 4163
SUB4:               18C8 DEFINED AT LINE 4176
                    > USED AT LINE 4172
FTEST:              18DA DEFINED AT LINE 4192
                    > USED AT LINE 825
                    > USED AT LINE 999
                    > USED AT LINE 1004
                    > USED AT LINE 1009
                    > USED AT LINE 1783
                    > USED AT LINE 1892
                    > USED AT LINE 1925
                    > USED AT LINE 1971
                    > USED AT LINE 2034
                    > USED AT LINE 2099
                    > USED AT LINE 2154
                    > USED AT LINE 3255
                    > USED AT LINE 3261
                    > USED AT LINE 3546
                    > USED AT LINE 3733
                    > USED AT LINE 3735
                    > USED AT LINE 3751
                    > USED AT LINE 3791
                    > USED AT LINE 3800
                    > USED AT LINE 3871
                    > USED AT LINE 3880
                    > USED AT LINE 3981
                    > USED AT LINE 3990
FEXP:               18E8 DEFINED AT LINE 4204
                    > USED AT LINE 1808
                    > USED AT LINE 1931
                    > USED AT LINE 2128
                    > USED AT LINE 3557
                    > USED AT LINE 3564
                    > USED AT LINE 3580
                    > USED AT LINE 3737
                    > USED AT LINE 3740
                    > USED AT LINE 3965
FSUBT:              18EF DEFINED AT LINE 4213
                    > USED AT LINE 3803
                    > USED AT LINE 4025
FSB1:               18F0 DEFINED AT LINE 4218
                    > USED AT LINE 4224
FADT3:              18FA DEFINED AT LINE 4229
                    > USED AT LINE 3790
FADDT:              18FC DEFINED AT LINE 4230
                    > USED AT LINE 3529
                    > USED AT LINE 3923
                    > USED AT LINE 4030
FAD1:               18FD DEFINED AT LINE 4231
                    > USED AT LINE 4237
FSHFT:              1907 DEFINED AT LINE 4240
                    > USED AT LINE 3779
                    > USED AT LINE 3799
                    > USED AT LINE 4249
                    > USED AT LINE 5248
TERMI:              1910 DEFINED AT LINE 4253
                    > USED AT LINE 263
                    > USED AT LINE 1318
                    > USED AT LINE 1361
REIN:               1913 DEFINED AT LINE 4265
                    > USED AT LINE 4296
                    > USED AT LINE 4326
TREAD:              1929 DEFINED AT LINE 4274
                    > USED AT LINE 4271
                    > USED AT LINE 4277
                    > USED AT LINE 4281
                    > USED AT LINE 4332
                    > USED AT LINE 4343
                    > USED AT LINE 4353
CR1:                1945 DEFINED AT LINE 4287
                    > USED AT LINE 4294
TESTO:              195B DEFINED AT LINE 4300
                    > USED AT LINE 424
                    > USED AT LINE 452
                    > USED AT LINE 523
                    > USED AT LINE 4269
                    > USED AT LINE 4273
                    > USED AT LINE 4309
                    > USED AT LINE 4311
                    > USED AT LINE 4338
                    > USED AT LINE 4340
                    > USED AT LINE 4342
                    > USED AT LINE 4351
                    > USED AT LINE 4382
                    > USED AT LINE 4413
                    > USED AT LINE 4493
                    > USED AT LINE 4496
TEST1:              195C DEFINED AT LINE 4301
                    > USED AT LINE 4303
CRLF:               1967 DEFINED AT LINE 4308
                    > USED AT LINE 747
                    > USED AT LINE 767
                    > USED AT LINE 4286
                    > USED AT LINE 4325
                    > USED AT LINE 4377
                    > USED AT LINE 4380
                    > USED AT LINE 4401
NOTCR:              1976 DEFINED AT LINE 4322
                    > USED AT LINE 4283
NOTCO:              1984 DEFINED AT LINE 4328
                    > USED AT LINE 4323
NOTBS:              19A7 DEFINED AT LINE 4345
                    > USED AT LINE 4329
NOTCH:              19A7 DEFINED AT LINE 4347
ECHO:               19B2 DEFINED AT LINE 4352
                    > USED AT LINE 4336
                    > USED AT LINE 4349
TERMO:              19B6 DEFINED AT LINE 4355
                    > USED AT LINE 413
                    > USED AT LINE 601
                    > USED AT LINE 719
                    > USED AT LINE 1301
OT1:                19BE DEFINED AT LINE 4372
                    > USED AT LINE 4387
                    > USED AT LINE 4388
OT2:                19CD DEFINED AT LINE 4379
                    > USED AT LINE 4376
OT4:                19DC DEFINED AT LINE 4386
                    > USED AT LINE 4378
TERMM:              19BE DEFINED AT LINE 4388
                    > USED AT LINE 241
                    > USED AT LINE 248
                    > USED AT LINE 436
                    > USED AT LINE 1086
                    > USED AT LINE 1474
                    > USED AT LINE 4475
                    > USED AT LINE 4835
                    > USED AT LINE 4873
                    > USED AT LINE 4876
TABST:              19E0 DEFINED AT LINE 4390
                    > USED AT LINE 736
TBLP:               19EF DEFINED AT LINE 4404
                    > USED AT LINE 4408
TBLP2:              19F6 DEFINED AT LINE 4407
                    > USED AT LINE 4405
TBON:               19FB DEFINED AT LINE 4409
                    > USED AT LINE 4406
TBSPA:              1A00 DEFINED AT LINE 4412
                    > USED AT LINE 4416
LINEO:              1A0A DEFINED AT LINE 4418
                    > USED AT LINE 593
                    > USED AT LINE 1487
                    > USED AT LINE 4831
LOUT:               1A15 DEFINED AT LINE 4431
                    > USED AT LINE 4426
                    > USED AT LINE 4427
NOTZ1:              1A23 DEFINED AT LINE 4441
                    > USED AT LINE 4438
Z1:                 1A29 DEFINED AT LINE 4445
                    > USED AT LINE 4440
NOTZ2:              1A33 DEFINED AT LINE 4450
                    > USED AT LINE 4447
Z2:                 1A39 DEFINED AT LINE 4454
                    > USED AT LINE 4449
TSTCC:              1A3B DEFINED AT LINE 4457
                    > USED AT LINE 502
                    > USED AT LINE 559
GETCH:              1A40 DEFINED AT LINE 4466
                    > USED AT LINE 4278
TSTC1:              1A5F DEFINED AT LINE 4478
                    > USED AT LINE 4469
PRCNT:              1A6E DEFINED AT LINE 4486
                    > USED AT LINE 4324
                    > USED AT LINE 4470
                    > USED AT LINE 4480
COMP2:              1A7A DEFINED AT LINE 4499
                    > USED AT LINE 131
COMP3:              1A7E DEFINED AT LINE 4505
                    > USED AT LINE 4513
COMP4:              1A7F DEFINED AT LINE 4506
                    > USED AT LINE 4514
COMP5:              1A82 DEFINED AT LINE 4509
                    > USED AT LINE 4504
COMP6:              1A8F DEFINED AT LINE 4515
                    > USED AT LINE 4510
EOL:                1A95 DEFINED AT LINE 4520
                    > USED AT LINE 633
                    > USED AT LINE 644
                    > USED AT LINE 652
                    > USED AT LINE 669
                    > USED AT LINE 760
                    > USED AT LINE 821
                    > USED AT LINE 1090
                    > USED AT LINE 1188
                    > USED AT LINE 1259
                    > USED AT LINE 1338
                    > USED AT LINE 1357
                    > USED AT LINE 1461
                    > USED AT LINE 1472
                    > USED AT LINE 1498
                    > USED AT LINE 1563
                    > USED AT LINE 1594
                    > USED AT LINE 1631
                    > USED AT LINE 1742
                    > USED AT LINE 2696
                    > USED AT LINE 5354
                    > USED AT LINE 5366
EOL1:               1AA4 DEFINED AT LINE 4531
                    > USED AT LINE 4529
TSTEL:              1AA9 DEFINED AT LINE 4535
                    > USED AT LINE 692
                    > USED AT LINE 1559
                    > USED AT LINE 4526
                    > USED AT LINE 4552
NOTEO:              1AAE DEFINED AT LINE 4545
                    > USED AT LINE 631
                    > USED AT LINE 667
                    > USED AT LINE 1550
PACK:               1AB6 DEFINED AT LINE 4556
                    > USED AT LINE 264
                    > USED AT LINE 542
                    > USED AT LINE 554
                    > USED AT LINE 632
                    > USED AT LINE 668
                    > USED AT LINE 1557
PK1:                1ABE DEFINED AT LINE 4564
                    > USED AT LINE 4586
PK3:                1AD2 DEFINED AT LINE 4574
                    > USED AT LINE 4581
SQUIS:              1AE3 DEFINED AT LINE 4588
                    > USED AT LINE 2344
                    > USED AT LINE 3134
                    > USED AT LINE 3167
                    > USED AT LINE 3280
                    > USED AT LINE 3297
SQUI2:              1AEE DEFINED AT LINE 4604
                    > USED AT LINE 4609
SKP2Z:              1AFA DEFINED AT LINE 4613
                    > USED AT LINE 4621
                    > USED AT LINE 5310
                    > USED AT LINE 5316
GTEMP:              1B01 DEFINED AT LINE 4623
                    > USED AT LINE 2753
                    > USED AT LINE 3276
                    > USED AT LINE 3293
SADR:               1B1A DEFINED AT LINE 4648
                    > USED AT LINE 2785
ALPHA:              1B22 DEFINED AT LINE 4656
                    > USED AT LINE 2760
                    > USED AT LINE 2795
                    > USED AT LINE 4800
NUMER:              1B2B DEFINED AT LINE 4669
                    > USED AT LINE 1024
                    > USED AT LINE 1544
                    > USED AT LINE 1555
                    > USED AT LINE 2747
                    > USED AT LINE 2765
                    > USED AT LINE 4565
                    > USED AT LINE 4806
NUMEN:              1B31 DEFINED AT LINE 4680
                    > USED AT LINE 4667
SEARC:              1B35 DEFINED AT LINE 4685
                    > USED AT LINE 791
                    > USED AT LINE 1217
                    > USED AT LINE 1355
                    > USED AT LINE 1580
                    > USED AT LINE 1589
                    > USED AT LINE 1620
                    > USED AT LINE 1632
                    > USED AT LINE 1672
                    > USED AT LINE 2783
                    > USED AT LINE 3388
                    > USED AT LINE 4101
                    > USED AT LINE 4112
SCH0:               1B3D DEFINED AT LINE 4694
                    > USED AT LINE 4753
                    > USED AT LINE 4757
SCH1:               1B40 DEFINED AT LINE 4695
                    > USED AT LINE 4722
SCH2:               1B62 DEFINED AT LINE 4721
                    > USED AT LINE 4707
                    > USED AT LINE 4712
SCH3:               1B66 DEFINED AT LINE 4723
                    > USED AT LINE 4697
SCH4:               1B7E DEFINED AT LINE 4738
                    > USED AT LINE 4734
SCH5:               1B82 DEFINED AT LINE 4740
                    > USED AT LINE 4737
                    > USED AT LINE 4743
SCH6:               1B90 DEFINED AT LINE 4750
                    > USED AT LINE 4693
SCH7:               1BA4 DEFINED AT LINE 4764
                    > USED AT LINE 4729
SCH8:               1BB9 DEFINED AT LINE 4777
                    > USED AT LINE 4782
SCH9:               1BC5 DEFINED AT LINE 4786
                    > USED AT LINE 4715
VAR:                1BCA DEFINED AT LINE 4792
                    > USED AT LINE 779
                    > USED AT LINE 1187
                    > USED AT LINE 1351
                    > USED AT LINE 1576
                    > USED AT LINE 1585
                    > USED AT LINE 1627
                    > USED AT LINE 1670
                    > USED AT LINE 2651
                    > USED AT LINE 2669
                    > USED AT LINE 2837
                    > USED AT LINE 4096
VAR2:               1BDF DEFINED AT LINE 4811
                    > USED AT LINE 4807
VAR3:               1BEA DEFINED AT LINE 4818
                    > USED AT LINE 4812
PRLIN:              1BF2 DEFINED AT LINE 4825
                    > USED AT LINE 1475
                    > USED AT LINE 4476
                    > USED AT LINE 4877
EM:                 00FE DEFINED AT LINE 4841
                    > USED AT LINE 4844
                    > USED AT LINE 4846
                    > USED AT LINE 4848
                    > USED AT LINE 4850
                    > USED AT LINE 4852
                    > USED AT LINE 4854
                    > USED AT LINE 4856
                    > USED AT LINE 4858
                    > USED AT LINE 4860
                    > USED AT LINE 4865
                    > USED AT LINE 4868
ULERR:              1C04 DEFINED AT LINE 4843
                    > USED AT LINE 635
ZMERR:              1C08 DEFINED AT LINE 4845
                    > USED AT LINE 1926
                    > USED AT LINE 1927
                    > USED AT LINE 2101
                    > USED AT LINE 3996
STERR:              1C0C DEFINED AT LINE 4847
                    > USED AT LINE 3183
                    > USED AT LINE 3220
SNERR:              1C10 DEFINED AT LINE 4849
                    > USED AT LINE 784
                    > USED AT LINE 798
                    > USED AT LINE 980
                    > USED AT LINE 991
                    > USED AT LINE 1023
                    > USED AT LINE 1084
                    > USED AT LINE 1098
                    > USED AT LINE 1102
                    > USED AT LINE 1354
                    > USED AT LINE 1449
                    > USED AT LINE 1517
                    > USED AT LINE 1529
                    > USED AT LINE 1539
                    > USED AT LINE 1556
                    > USED AT LINE 1584
                    > USED AT LINE 1626
                    > USED AT LINE 1630
                    > USED AT LINE 1671
                    > USED AT LINE 1756
                    > USED AT LINE 1759
                    > USED AT LINE 2643
                    > USED AT LINE 2667
                    > USED AT LINE 2689
                    > USED AT LINE 2693
                    > USED AT LINE 2827
                    > USED AT LINE 2856
                    > USED AT LINE 2902
                    > USED AT LINE 2911
                    > USED AT LINE 2988
                    > USED AT LINE 3043
                    > USED AT LINE 3239
                    > USED AT LINE 3330
                    > USED AT LINE 4147
                    > USED AT LINE 4151
                    > USED AT LINE 4171
                    > USED AT LINE 4175
                    > USED AT LINE 4527
                    > USED AT LINE 4553
                    > USED AT LINE 4571
                    > USED AT LINE 4801
                    > USED AT LINE 5347
RTERR:              1C14 DEFINED AT LINE 4851
                    > USED AT LINE 655
DAERR:              1C18 DEFINED AT LINE 4853
                    > USED AT LINE 1397
NXERR:              1C1C DEFINED AT LINE 4855
                    > USED AT LINE 869
                    > USED AT LINE 910
                    > USED AT LINE 1196
                    > USED AT LINE 1210
CVERR:              1C20 DEFINED AT LINE 4857
                    > USED AT LINE 1328
                    > USED AT LINE 1429
                    > USED AT LINE 2429
                    > USED AT LINE 4079
CKERR:              1C24 DEFINED AT LINE 4859
OVERR:              1C28 DEFINED AT LINE 4864
                    > USED AT LINE 4129
                    > USED AT LINE 5238
                    > USED AT LINE 5241
UNERR:              1C2D DEFINED AT LINE 4867
                    > USED AT LINE 4125
ERROR:              1C32 DEFINED AT LINE 4873
                    > USED AT LINE 174
CPY4D:              1C4C DEFINED AT LINE 4894
                    > USED AT LINE 1953
COPYD:              1C4E DEFINED AT LINE 4895
                    > USED AT LINE 140
                    > USED AT LINE 238
                    > USED AT LINE 348
                    > USED AT LINE 952
                    > USED AT LINE 1504
                    > USED AT LINE 4020
                    > USED AT LINE 4900
                    > USED AT LINE 4909
CPY4H:              1C57 DEFINED AT LINE 4907
                    > USED AT LINE 3756
COPYH:              1C59 DEFINED AT LINE 4908
                    > USED AT LINE 161
                    > USED AT LINE 298
                    > USED AT LINE 334
                    > USED AT LINE 2242
                    > USED AT LINE 3895
ZEROM:              1C5F DEFINED AT LINE 4913
                    > USED AT LINE 344
                    > USED AT LINE 2060
                    > USED AT LINE 2170
                    > USED AT LINE 3325
                    > USED AT LINE 3471
                    > USED AT LINE 3898
                    > USED AT LINE 4920
FBIN:               1C67 DEFINED AT LINE 4923
                    > USED AT LINE 743
                    > USED AT LINE 1451
                    > USED AT LINE 1462
                    > USED AT LINE 1515
                    > USED AT LINE 1641
                    > USED AT LINE 1654
                    > USED AT LINE 2254
                    > USED AT LINE 2362
                    > USED AT LINE 2438
                    > USED AT LINE 2454
                    > USED AT LINE 4959
                    > USED AT LINE 5355
FBIN1:              1C72 DEFINED AT LINE 4937
                    > USED AT LINE 4935
ARG:                1C75 DEFINED AT LINE 4941
                    > USED AT LINE 3085
                    > USED AT LINE 4958
ARGNU:              1C84 DEFINED AT LINE 4956
                    > USED AT LINE 2456
                    > USED AT LINE 2471
                    > USED AT LINE 2482
                    > USED AT LINE 2494
                    > USED AT LINE 2497
                    > USED AT LINE 2539
BINFL:              1C8A DEFINED AT LINE 4961
                    > USED AT LINE 409
                    > USED AT LINE 2264
                    > USED AT LINE 5338
FUNCT:              1C99 DEFINED AT LINE 4984
                    > USED AT LINE 2816
RNDLI:              1CB5 DEFINED AT LINE 4997
                    > USED AT LINE 2802
PCHOF:              1D63 DEFINED AT LINE 5068
                    > USED AT LINE 443
RNDP:               1D66 DEFINED AT LINE 5069
                    > USED AT LINE 2184
NRNDX:              1D6C DEFINED AT LINE 5072
                    > USED AT LINE 236
                    > USED AT LINE 345
WHATL:              1D74 DEFINED AT LINE 5076
                    > USED AT LINE 1085
VERS:               1D79 DEFINED AT LINE 5077
                    > USED AT LINE 240
LLINE:              1D87 DEFINED AT LINE 5079
                    > USED AT LINE 1275
TABLI:              1D8C DEFINED AT LINE 5080
                    > USED AT LINE 700
STEPL:              1D90 DEFINED AT LINE 5081
                    > USED AT LINE 810
THENL:              1D95 DEFINED AT LINE 5082
                    > USED AT LINE 1021
PILIT:              1D9A DEFINED AT LINE 5083
                    > USED AT LINE 2812
TWO:                1D9D DEFINED AT LINE 5084
                    > USED AT LINE 1902
TEN:                1DA1 DEFINED AT LINE 5085
                    > USED AT LINE 3449
                    > USED AT LINE 3569
PI:                 1DA5 DEFINED AT LINE 5086
                    > USED AT LINE 1790
                    > USED AT LINE 2871
QTRPI:              1DA9 DEFINED AT LINE 5087
                    > USED AT LINE 1908
NEGON:              1DAD DEFINED AT LINE 5088
                    > USED AT LINE 2064
LN2C:               1DB1 DEFINED AT LINE 5089
                    > USED AT LINE 1941
SQC1:               1DB5 DEFINED AT LINE 5090
                    > USED AT LINE 2110
SQC2:               1DB9 DEFINED AT LINE 5091
                    > USED AT LINE 2112
SQC3:               1DBD DEFINED AT LINE 5105
                    > USED AT LINE 2132
ATNCO:              1DD5 DEFINED AT LINE 5111
                    > USED AT LINE 1916
HALFP:              1DD9 DEFINED AT LINE 5113
                    > USED AT LINE 1793
                    > USED AT LINE 1815
                    > USED AT LINE 1863
SINCO:              1DE9 DEFINED AT LINE 5117
                    > USED AT LINE 1821
ONE:                1DED DEFINED AT LINE 5119
                    > USED AT LINE 803
                    > USED AT LINE 1898
                    > USED AT LINE 1948
                    > USED AT LINE 1977
                    > USED AT LINE 2000
                    > USED AT LINE 2039
                    > USED AT LINE 2861
NULLI:              1DEF DEFINED AT LINE 5120
                    > USED AT LINE 370
LNCO:               1E09 DEFINED AT LINE 5127
                    > USED AT LINE 1954
LN2E:               1E0D DEFINED AT LINE 5129
                    > USED AT LINE 1982
EXPCO:              1E21 DEFINED AT LINE 5134
                    > USED AT LINE 2008
LNC:                1E25 DEFINED AT LINE 5136
                    > USED AT LINE 1961
READY:              1E29 DEFINED AT LINE 5137
                    > USED AT LINE 247
STOPM:              1E30 DEFINED AT LINE 5140
                    > USED AT LINE 1473
                    > USED AT LINE 4474
ERRMS:              1E3F DEFINED AT LINE 5143
                    > USED AT LINE 4875
TTY:                0002 DEFINED AT LINE 5144
JMPTB:              1E4F DEFINED AT LINE 5154
                    > USED AT LINE 503
KEYL:               1E7C DEFINED AT LINE 5169
                    > USED AT LINE 435
DATAL:              1E9E DEFINED AT LINE 5179
                    > USED AT LINE 1400
NEXTL:              1EAB DEFINED AT LINE 5183
                    > USED AT LINE 915
GOSBL:              1EB2 DEFINED AT LINE 5185
                    > USED AT LINE 1017
                    > USED AT LINE 1527
GOTOL:              1ED3 DEFINED AT LINE 5193
                    > USED AT LINE 1013
                    > USED AT LINE 1522
TOLIT:              1ED5 DEFINED AT LINE 5194
                    > USED AT LINE 796
                    > USED AT LINE 1582
                    > USED AT LINE 1624
DEFLI:              1F21 DEFINED AT LINE 5218
                    > USED AT LINE 2647
FNLIT:              1F24 DEFINED AT LINE 5219
                    > USED AT LINE 2807
FACDE:              1F38 DEFINED AT LINE 5231
                    > USED AT LINE 3340
                    > USED AT LINE 3346
                    > USED AT LINE 4932
                    > USED AT LINE 5334
                    > USED AT LINE 5350
                    > USED AT LINE 5367
FDE1:               1F4D DEFINED AT LINE 5245
                    > USED AT LINE 5250
FDE2:               1F5A DEFINED AT LINE 5251
                    > USED AT LINE 5240
LOCAT:              1F61 DEFINED AT LINE 5258
                    > USED AT LINE 286
                    > USED AT LINE 634
FIND1:              1F64 DEFINED AT LINE 5266
                    > USED AT LINE 5289
FIND2:              1F7E DEFINED AT LINE 5285
                    > USED AT LINE 5273
                    > USED AT LINE 5278
FIND3:              1F86 DEFINED AT LINE 5293
                    > USED AT LINE 5269
                    > USED AT LINE 5274
                    > USED AT LINE 5279
SEEK:               1F89 DEFINED AT LINE 5298
SEEK1:              1F89 DEFINED AT LINE 5303
                    > USED AT LINE 504
                    > USED AT LINE 2818
                    > USED AT LINE 5323
                    > USED AT LINE 5325
SEEK2:              1F9C DEFINED AT LINE 5316
                    > USED AT LINE 5308
SEEK3:              1FAC DEFINED AT LINE 5326
                    > USED AT LINE 5306
PEEK:               1FAE DEFINED AT LINE 5330
                    > USED AT LINE 5061
POKE:               1FB9 DEFINED AT LINE 5340
                    > USED AT LINE 5222
JUMP:               1FD7 DEFINED AT LINE 5361
                    > USED AT LINE 5224
ROMEN:              1FE5 DEFINED AT LINE 5373
                    > USED AT LINE 5457
RAM:                2000 DEFINED AT LINE 5381
                    > USED AT LINE 103
BZERO:              2000 DEFINED AT LINE 5383
                    > USED AT LINE 342
                    > USED AT LINE 343
FORNE:              2000 DEFINED AT LINE 5384
                    > USED AT LINE 844
                    > USED AT LINE 870
                    > USED AT LINE 1192
                    > USED AT LINE 1211
                    > USED AT LINE 1214
                    > USED AT LINE 1240
TAPES:              2071 DEFINED AT LINE 5386
                    > USED AT LINE 422
                    > USED AT LINE 432
                    > USED AT LINE 442
                    > USED AT LINE 521
                    > USED AT LINE 4284
                    > USED AT LINE 4330
                    > USED AT LINE 4347
DIMSW:              2072 DEFINED AT LINE 5387
                    > USED AT LINE 1676
                    > USED AT LINE 2621
                    > USED AT LINE 2624
                    > USED AT LINE 2706
                    > USED AT LINE 3169
                    > USED AT LINE 3178
                    > USED AT LINE 3197
                    > USED AT LINE 3349
                    > USED AT LINE 3369
                    > USED AT LINE 3373
                    > USED AT LINE 3376
                    > USED AT LINE 4103
OUTSW:              2073 DEFINED AT LINE 5388
                    > USED AT LINE 764
                    > USED AT LINE 4368
                    > USED AT LINE 4396
                    > USED AT LINE 4481
                    > USED AT LINE 4483
ILSW:               2074 DEFINED AT LINE 5389
                    > USED AT LINE 1359
                    > USED AT LINE 1373
                    > USED AT LINE 4288
RUNSW:              2075 DEFINED AT LINE 5390
                    > USED AT LINE 361
                    > USED AT LINE 488
                    > USED AT LINE 630
                    > USED AT LINE 1476
EDSW:               2076 DEFINED AT LINE 5391
                    > USED AT LINE 260
                    > USED AT LINE 629
                    > USED AT LINE 1082
                    > USED AT LINE 4471
EZERO:              2077 DEFINED AT LINE 5392
                    > USED AT LINE 343
LINEN:              2077 DEFINED AT LINE 5394
                    > USED AT LINE 618
                    > USED AT LINE 1486
                    > USED AT LINE 4829
                    > USED AT LINE 4834
IMMED:              207C DEFINED AT LINE 5395
                    > USED AT LINE 269
                    > USED AT LINE 284
                    > USED AT LINE 303
                    > USED AT LINE 332
                    > USED AT LINE 363
                    > USED AT LINE 372
IOBUF:              20CE DEFINED AT LINE 5396
                    > USED AT LINE 362
                    > USED AT LINE 410
                    > USED AT LINE 592
                    > USED AT LINE 689
                    > USED AT LINE 947
                    > USED AT LINE 1028
                    > USED AT LINE 1280
                    > USED AT LINE 1290
                    > USED AT LINE 1364
                    > USED AT LINE 4265
                    > USED AT LINE 4297
                    > USED AT LINE 4371
STRIN:              2120 DEFINED AT LINE 5397
                    > USED AT LINE 723
                    > USED AT LINE 948
                    > USED AT LINE 1030
                    > USED AT LINE 1106
                    > USED AT LINE 1150
                    > USED AT LINE 1363
                    > USED AT LINE 1375
                    > USED AT LINE 1635
                    > USED AT LINE 2282
                    > USED AT LINE 2296
                    > USED AT LINE 2308
                    > USED AT LINE 2330
                    > USED AT LINE 2353
                    > USED AT LINE 2363
                    > USED AT LINE 2375
                    > USED AT LINE 2390
                    > USED AT LINE 2409
                    > USED AT LINE 2414
                    > USED AT LINE 2425
                    > USED AT LINE 2439
                    > USED AT LINE 2455
                    > USED AT LINE 2457
                    > USED AT LINE 2501
                    > USED AT LINE 2521
                    > USED AT LINE 2540
                    > USED AT LINE 2904
                    > USED AT LINE 2916
                    > USED AT LINE 2944
                    > USED AT LINE 3136
                    > USED AT LINE 3307
                    > USED AT LINE 4056
                    > USED AT LINE 4086
OUTA:               2220 DEFINED AT LINE 5398
                    > USED AT LINE 1452
                    > USED AT LINE 1463
                    > USED AT LINE 2255
                    > USED AT LINE 2261
INDX:               2223 DEFINED AT LINE 5399
                    > USED AT LINE 781
                    > USED AT LINE 788
                    > USED AT LINE 845
                    > USED AT LINE 919
                    > USED AT LINE 922
                    > USED AT LINE 1190
REL:                2225 DEFINED AT LINE 5400
                    > USED AT LINE 982
                    > USED AT LINE 996
                    > USED AT LINE 1001
                    > USED AT LINE 1006
                    > USED AT LINE 1060
                    > USED AT LINE 1521
                    > USED AT LINE 1531
                    > USED AT LINE 1564
IFTYP:              2226 DEFINED AT LINE 5401
                    > USED AT LINE 944
                    > USED AT LINE 989
TVAR1:              2227 DEFINED AT LINE 5402
                    > USED AT LINE 801
                    > USED AT LINE 827
                    > USED AT LINE 881
                    > USED AT LINE 954
                    > USED AT LINE 994
                    > USED AT LINE 1224
                    > USED AT LINE 1263
TVAR2:              222B DEFINED AT LINE 5403
                    > USED AT LINE 818
                    > USED AT LINE 876
TEMP1:              222F DEFINED AT LINE 5404
                    > USED AT LINE 1805
                    > USED AT LINE 1852
                    > USED AT LINE 1900
                    > USED AT LINE 1904
                    > USED AT LINE 1910
                    > USED AT LINE 1943
                    > USED AT LINE 1975
                    > USED AT LINE 1979
                    > USED AT LINE 2002
                    > USED AT LINE 2114
                    > USED AT LINE 2121
                    > USED AT LINE 2140
                    > USED AT LINE 2142
                    > USED AT LINE 3251
                    > USED AT LINE 3259
                    > USED AT LINE 3268
                    > USED AT LINE 3270
                    > USED AT LINE 3324
                    > USED AT LINE 3337
                    > USED AT LINE 3344
TEMP2:              2233 DEFINED AT LINE 5405
                    > USED AT LINE 1817
                    > USED AT LINE 1819
                    > USED AT LINE 1850
                    > USED AT LINE 1906
                    > USED AT LINE 1928
                    > USED AT LINE 1952
                    > USED AT LINE 2105
                    > USED AT LINE 2138
TEMP3:              2237 DEFINED AT LINE 5406
                    > USED AT LINE 1835
                    > USED AT LINE 1842
                    > USED AT LINE 1984
TEMP4:              223B DEFINED AT LINE 5407
                    > USED AT LINE 1876
                    > USED AT LINE 1881
                    > USED AT LINE 1987
                    > USED AT LINE 1997
                    > USED AT LINE 1999
                    > USED AT LINE 2010
TEMP5:              223F DEFINED AT LINE 5408
                    > USED AT LINE 2006
TEMP6:              2243 DEFINED AT LINE 5409
TEMP7:              2247 DEFINED AT LINE 5410
                    > USED AT LINE 1879
                    > USED AT LINE 1884
                    > USED AT LINE 2166
                    > USED AT LINE 2244
                    > USED AT LINE 3257
                    > USED AT LINE 3264
LINEL:              224B DEFINED AT LINE 5411
                    > USED AT LINE 536
                    > USED AT LINE 546
                    > USED AT LINE 567
LINEH:              224D DEFINED AT LINE 5412
                    > USED AT LINE 538
                    > USED AT LINE 547
                    > USED AT LINE 557
                    > USED AT LINE 579
PROMP:              224F DEFINED AT LINE 5413
                    > USED AT LINE 4264
                    > USED AT LINE 4268
EXPRS:              2250 DEFINED AT LINE 5414
                    > USED AT LINE 2631
                    > USED AT LINE 2698
                    > USED AT LINE 2742
                    > USED AT LINE 2752
                    > USED AT LINE 2754
                    > USED AT LINE 2784
                    > USED AT LINE 2786
                    > USED AT LINE 2841
                    > USED AT LINE 2852
                    > USED AT LINE 2875
                    > USED AT LINE 2882
                    > USED AT LINE 2888
                    > USED AT LINE 2891
                    > USED AT LINE 2935
                    > USED AT LINE 2942
                    > USED AT LINE 2959
                    > USED AT LINE 2962
                    > USED AT LINE 2993
                    > USED AT LINE 3012
                    > USED AT LINE 3024
                    > USED AT LINE 3034
                    > USED AT LINE 3037
                    > USED AT LINE 3046
                    > USED AT LINE 3364
                    > USED AT LINE 3368
                    > USED AT LINE 3379
                    > USED AT LINE 4610
ADDR1:              2252 DEFINED AT LINE 5415
                    > USED AT LINE 501
                    > USED AT LINE 514
                    > USED AT LINE 793
                    > USED AT LINE 831
                    > USED AT LINE 836
                    > USED AT LINE 987
                    > USED AT LINE 1012
                    > USED AT LINE 1016
                    > USED AT LINE 1020
                    > USED AT LINE 1219
                    > USED AT LINE 1265
                    > USED AT LINE 1281
                    > USED AT LINE 1312
                    > USED AT LINE 1329
                    > USED AT LINE 1341
                    > USED AT LINE 2556
                    > USED AT LINE 2562
                    > USED AT LINE 2722
                    > USED AT LINE 3074
                    > USED AT LINE 3110
                    > USED AT LINE 4945
                    > USED AT LINE 4951
ADDR2:              2254 DEFINED AT LINE 5416
                    > USED AT LINE 2719
                    > USED AT LINE 3081
                    > USED AT LINE 3089
                    > USED AT LINE 3116
ADDR3:              2256 DEFINED AT LINE 5417
                    > USED AT LINE 2610
                    > USED AT LINE 2613
                    > USED AT LINE 2636
                    > USED AT LINE 2677
                    > USED AT LINE 2715
                    > USED AT LINE 2989
                    > USED AT LINE 3045
                    > USED AT LINE 3168
                    > USED AT LINE 3200
                    > USED AT LINE 3377
                    > USED AT LINE 3394
FACC:               2258 DEFINED AT LINE 5418
                    > USED AT LINE 138
                    > USED AT LINE 159
                    > USED AT LINE 1236
                    > USED AT LINE 1807
                    > USED AT LINE 1930
                    > USED AT LINE 1947
                    > USED AT LINE 1990
                    > USED AT LINE 1992
                    > USED AT LINE 2020
                    > USED AT LINE 2022
                    > USED AT LINE 2042
                    > USED AT LINE 2055
                    > USED AT LINE 2066
                    > USED AT LINE 2075
                    > USED AT LINE 2086
                    > USED AT LINE 2104
                    > USED AT LINE 2130
                    > USED AT LINE 2145
                    > USED AT LINE 2157
                    > USED AT LINE 2169
                    > USED AT LINE 2172
                    > USED AT LINE 3419
                    > USED AT LINE 3433
                    > USED AT LINE 3469
                    > USED AT LINE 3505
                    > USED AT LINE 3526
                    > USED AT LINE 3527
                    > USED AT LINE 3542
                    > USED AT LINE 3556
                    > USED AT LINE 3563
                    > USED AT LINE 3579
                    > USED AT LINE 3590
                    > USED AT LINE 3610
                    > USED AT LINE 3611
                    > USED AT LINE 3765
                    > USED AT LINE 3785
                    > USED AT LINE 3787
                    > USED AT LINE 3805
                    > USED AT LINE 3827
                    > USED AT LINE 3899
                    > USED AT LINE 3949
                    > USED AT LINE 4002
                    > USED AT LINE 4034
                    > USED AT LINE 4197
                    > USED AT LINE 4200
                    > USED AT LINE 4202
                    > USED AT LINE 4966
                    > USED AT LINE 5236
                    > USED AT LINE 5246
                    > USED AT LINE 5251
FTEMP:              225C DEFINED AT LINE 5419
                    > USED AT LINE 3428
                    > USED AT LINE 3442
                    > USED AT LINE 3495
                    > USED AT LINE 3520
                    > USED AT LINE 3524
                    > USED AT LINE 3577
                    > USED AT LINE 3585
                    > USED AT LINE 3755
                    > USED AT LINE 3760
                    > USED AT LINE 3784
                    > USED AT LINE 3788
                    > USED AT LINE 3892
                    > USED AT LINE 3896
                    > USED AT LINE 3911
                    > USED AT LINE 3920
                    > USED AT LINE 3921
                    > USED AT LINE 3925
                    > USED AT LINE 4003
                    > USED AT LINE 4022
                    > USED AT LINE 4023
                    > USED AT LINE 4027
                    > USED AT LINE 4028
                    > USED AT LINE 4043
PARCT:              2268 DEFINED AT LINE 5420
                    > USED AT LINE 2616
                    > USED AT LINE 2711
                    > USED AT LINE 2735
                    > USED AT LINE 2957
                    > USED AT LINE 2986
                    > USED AT LINE 3030
                    > USED AT LINE 3040
                    > USED AT LINE 3042
                    > USED AT LINE 3172
                    > USED AT LINE 3356
                    > USED AT LINE 3359
                    > USED AT LINE 3383
SPCTR:              2269 DEFINED AT LINE 5421
                    > USED AT LINE 2312
                    > USED AT LINE 2316
                    > USED AT LINE 2614
                    > USED AT LINE 2713
                    > USED AT LINE 2738
                    > USED AT LINE 2924
                    > USED AT LINE 2926
                    > USED AT LINE 3097
                    > USED AT LINE 3100
                    > USED AT LINE 3140
                    > USED AT LINE 3144
                    > USED AT LINE 3190
                    > USED AT LINE 3360
                    > USED AT LINE 3363
                    > USED AT LINE 3381
                    > USED AT LINE 4642
                    > USED AT LINE 4645
CMACT:              226B DEFINED AT LINE 5422
                    > USED AT LINE 3298
FNARG:              226C DEFINED AT LINE 5423
                    > USED AT LINE 2625
                    > USED AT LINE 2627
                    > USED AT LINE 2671
                    > USED AT LINE 2702
                    > USED AT LINE 2704
                    > USED AT LINE 4750
STMT:               2270 DEFINED AT LINE 5424
                    > USED AT LINE 472
                    > USED AT LINE 483
                    > USED AT LINE 487
                    > USED AT LINE 636
                    > USED AT LINE 657
                    > USED AT LINE 674
                    > USED AT LINE 893
                    > USED AT LINE 896
                    > USED AT LINE 904
                    > USED AT LINE 911
                    > USED AT LINE 1254
                    > USED AT LINE 1257
                    > USED AT LINE 1260
                    > USED AT LINE 1480
ENDLI:              2272 DEFINED AT LINE 5425
                    > USED AT LINE 481
                    > USED AT LINE 659
                    > USED AT LINE 672
                    > USED AT LINE 886
                    > USED AT LINE 4532
MULTI:              2274 DEFINED AT LINE 5426
                    > USED AT LINE 358
                    > USED AT LINE 476
                    > USED AT LINE 638
                    > USED AT LINE 661
                    > USED AT LINE 670
                    > USED AT LINE 1479
                    > USED AT LINE 4530
DEXP:               2275 DEFINED AT LINE 5427
                    > USED AT LINE 2102
                    > USED AT LINE 2127
                    > USED AT LINE 3561
                    > USED AT LINE 3567
                    > USED AT LINE 3625
COLUM:              2276 DEFINED AT LINE 5428
                    > USED AT LINE 745
                    > USED AT LINE 2272
                    > USED AT LINE 4319
                    > USED AT LINE 4383
                    > USED AT LINE 4385
                    > USED AT LINE 4399
                    > USED AT LINE 4409
RNDX:               2277 DEFINED AT LINE 5429
                    > USED AT LINE 346
                    > USED AT LINE 1502
                    > USED AT LINE 2240
RNDY:               2279 DEFINED AT LINE 5430
RNDZ:               227B DEFINED AT LINE 5431
                    > USED AT LINE 2174
RNDS:               227D DEFINED AT LINE 5432
                    > USED AT LINE 2212
                    > USED AT LINE 2229
TRNDX:              227F DEFINED AT LINE 5433
                    > USED AT LINE 1501
                    > USED AT LINE 2239
TRNDY:              2281 DEFINED AT LINE 5434
TRNDZ:              2283 DEFINED AT LINE 5435
TRNDS:              2285 DEFINED AT LINE 5436
RNDSW:              2287 DEFINED AT LINE 5437
                    > USED AT LINE 1500
                    > USED AT LINE 2236
FNMOD:              2288 DEFINED AT LINE 5438
                    > USED AT LINE 359
                    > USED AT LINE 2618
                    > USED AT LINE 2635
                    > USED AT LINE 2709
                    > USED AT LINE 4691
LINE:               2289 DEFINED AT LINE 5439
                    > USED AT LINE 371
                    > USED AT LINE 495
                    > USED AT LINE 1262
                    > USED AT LINE 1485
                    > USED AT LINE 4830
STACK:              228B DEFINED AT LINE 5440
                    > USED AT LINE 234
                    > USED AT LINE 261
PRSW:               228D DEFINED AT LINE 5441
                    > USED AT LINE 688
                    > USED AT LINE 762
                    > USED AT LINE 4563
                    > USED AT LINE 4569
                    > USED AT LINE 4572
NS:                 228E DEFINED AT LINE 5442
                    > USED AT LINE 708
                    > USED AT LINE 943
                    > USED AT LINE 988
                    > USED AT LINE 1095
                    > USED AT LINE 3237
                    > USED AT LINE 3303
DATAP:              228F DEFINED AT LINE 5443
                    > USED AT LINE 469
                    > USED AT LINE 646
                    > USED AT LINE 1389
                    > USED AT LINE 1395
                    > USED AT LINE 1403
                    > USED AT LINE 1417
                    > USED AT LINE 1438
DATAB:              2291 DEFINED AT LINE 5444
                    > USED AT LINE 216
                    > USED AT LINE 388
                    > USED AT LINE 400
                    > USED AT LINE 464
                    > USED AT LINE 4694
PROGE:              2293 DEFINED AT LINE 5445
                    > USED AT LINE 302
                    > USED AT LINE 308
                    > USED AT LINE 312
                    > USED AT LINE 391
                    > USED AT LINE 402
                    > USED AT LINE 2629
                    > USED AT LINE 2633
                    > USED AT LINE 2700
                    > USED AT LINE 2739
BEGPR:              2296 DEFINED AT LINE 5450
                    > USED AT LINE 390
                    > USED AT LINE 468
                    > USED AT LINE 558
                    > USED AT LINE 645
                    > USED AT LINE 2640
                    > USED AT LINE 5265